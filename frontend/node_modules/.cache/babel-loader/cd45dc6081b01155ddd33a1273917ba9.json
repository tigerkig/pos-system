{"ast":null,"code":"/*\r\n * wysiwyg web editor\r\n *\r\n * suneditor.js\r\n * Copyright 2017 JiHong Lee.\r\n * MIT license.\r\n */\n'use strict';\n\nimport _Constructor from './constructor';\nimport _Context from './context';\nimport _history from './history';\nimport _util from './util';\nimport _notice from '../plugins/modules/_notice';\n/**\r\n * @description SunEditor constuctor function.\r\n * create core object and event registration.\r\n * core, event, functions\r\n * @param {Object} context\r\n * @param {Object} pluginCallButtons\r\n * @param {Object} plugins \r\n * @param {Object} lang\r\n * @param {Object} options\r\n * @param {Object} _responsiveButtons\r\n * @returns {Object} functions Object\r\n */\n\nexport default function (context, pluginCallButtons, plugins, lang, options, _responsiveButtons) {\n  var _d = context.element.originElement.ownerDocument || document;\n\n  var _w = _d.defaultView || window;\n\n  var util = _util;\n  var icons = options.icons;\n  /**\r\n   * @description editor core object\r\n   * should always bind this object when registering an event in the plug-in.\r\n   */\n\n  var core = {\n    _d: _d,\n    _w: _w,\n    _parser: new _w.DOMParser(),\n    _prevRtl: options.rtl,\n    _editorHeight: 0,\n    _editorHeightPadding: 0,\n    _listCamel: options.__listCommonStyle,\n    _listKebab: util.camelToKebabCase(options.__listCommonStyle),\n\n    /**\r\n     * @description Document object of the iframe if created as an iframe || _d\r\n     * @private\r\n     */\n    _wd: null,\n\n    /**\r\n     * @description Window object of the iframe if created as an iframe || _w\r\n     * @private\r\n     */\n    _ww: null,\n\n    /**\r\n     * @description Closest ShadowRoot to editor if found\r\n     * @private\r\n     */\n    _shadowRoot: null,\n\n    /**\r\n     * @description Block controller mousedown events in \"shadowRoot\" environment\r\n     * @private\r\n     */\n    _shadowRootControllerEventTarget: null,\n\n    /**\r\n     * @description Util object\r\n     */\n    util: util,\n\n    /**\r\n     * @description Functions object\r\n     */\n    functions: null,\n\n    /**\r\n     * @description Editor options\r\n     */\n    options: null,\n\n    /**\r\n     * @description Computed style of the wysiwyg area (window.getComputedStyle(context.element.wysiwyg))\r\n     */\n    wwComputedStyle: null,\n\n    /**\r\n     * @description Notice object\r\n     */\n    notice: _notice,\n\n    /**\r\n     * @description Default icons object\r\n     */\n    icons: icons,\n\n    /**\r\n     * @description History object for undo, redo\r\n     */\n    history: null,\n\n    /**\r\n     * @description Elements and user options parameters of the suneditor\r\n     */\n    context: context,\n\n    /**\r\n     * @description Plugin buttons\r\n     */\n    pluginCallButtons: pluginCallButtons,\n\n    /**\r\n     * @description Loaded plugins\r\n     */\n    plugins: plugins || {},\n\n    /**\r\n     * @description Whether the plugin is initialized\r\n     */\n    initPlugins: {},\n\n    /**\r\n     * @description Object for managing submenu elements\r\n     * @private\r\n     */\n    _targetPlugins: {},\n\n    /**\r\n     * @description Save rendered submenus and containers\r\n     * @private\r\n     */\n    _menuTray: {},\n\n    /**\r\n     * @description loaded language\r\n     */\n    lang: lang,\n\n    /**\r\n     * @description The selection node (core.getSelectionNode()) to which the effect was last applied\r\n     */\n    effectNode: null,\n\n    /**\r\n     * @description submenu element\r\n     */\n    submenu: null,\n\n    /**\r\n     * @description container element\r\n     */\n    container: null,\n\n    /**\r\n     * @description current subment name\r\n     * @private\r\n     */\n    _submenuName: '',\n\n    /**\r\n     * @description binded submenuOff method\r\n     * @private\r\n     */\n    _bindedSubmenuOff: null,\n\n    /**\r\n     * @description binded containerOff method\r\n     * @private\r\n     */\n    _bindedContainerOff: null,\n\n    /**\r\n     * @description active button element in submenu\r\n     */\n    submenuActiveButton: null,\n\n    /**\r\n     * @description active button element in container\r\n     */\n    containerActiveButton: null,\n\n    /**\r\n     * @description The elements array to be processed unvisible when the controllersOff function is executed (resizing, link modified button, table controller)\r\n     */\n    controllerArray: [],\n\n    /**\r\n     * @description The name of the plugin that called the currently active controller\r\n     */\n    currentControllerName: '',\n\n    /**\r\n     * @description The target element of current controller\r\n     */\n    currentControllerTarget: null,\n\n    /**\r\n     * @description The file component object of current selected file tag (getFileComponent)\r\n     */\n    currentFileComponentInfo: null,\n\n    /**\r\n     * @description An array of buttons whose class name is not \"se-code-view-enabled\"\r\n     */\n    codeViewDisabledButtons: [],\n\n    /**\r\n     * @description An array of buttons whose class name is not \"se-resizing-enabled\"\r\n     */\n    resizingDisabledButtons: [],\n\n    /**\r\n     * @description active more layer element in submenu\r\n     * @private\r\n     */\n    _moreLayerActiveButton: null,\n\n    /**\r\n     * @description Tag whitelist RegExp object used in \"_consistencyCheckOfHTML\" method\r\n     * ^(options._editorTagsWhitelist)$\r\n     * @private\r\n     */\n    _htmlCheckWhitelistRegExp: null,\n\n    /**\r\n     * @description Tag blacklist RegExp object used in \"_consistencyCheckOfHTML\" method\r\n     * @private\r\n     */\n    _htmlCheckBlacklistRegExp: null,\n\n    /**\r\n     * @description RegExp when using check disallowd tags. (b, i, ins, strike, s)\r\n     * @private\r\n     */\n    _disallowedTextTagsRegExp: null,\n\n    /**\r\n     * @description Editor tags whitelist (RegExp object)\r\n     * util.createTagsWhitelist(options._editorTagsWhitelist)\r\n     */\n    editorTagsWhitelistRegExp: null,\n\n    /**\r\n     * @description Editor tags blacklist (RegExp object)\r\n     * util.createTagsBlacklist(options.tagsBlacklist)\r\n     */\n    editorTagsBlacklistRegExp: null,\n\n    /**\r\n     * @description Tag whitelist when pasting (RegExp object)\r\n     * util.createTagsWhitelist(options.pasteTagsWhitelist)\r\n     */\n    pasteTagsWhitelistRegExp: null,\n\n    /**\r\n     * @description Tag blacklist when pasting (RegExp object)\r\n     * util.createTagsBlacklist(options.pasteTagsBlacklist)\r\n     */\n    pasteTagsBlacklistRegExp: null,\n\n    /**\r\n     * @description Boolean value of whether the editor has focus\r\n     */\n    hasFocus: false,\n\n    /**\r\n     * @description Boolean value of whether the editor is disabled\r\n     */\n    isDisabled: false,\n\n    /**\r\n     * @description Boolean value of whether the editor is readOnly\r\n     */\n    isReadOnly: false,\n\n    /**\r\n     * @description Attributes whitelist used by the cleanHTML method\r\n     * @private\r\n     */\n    _attributesWhitelistRegExp: null,\n    _attributesWhitelistRegExp_all_data: null,\n\n    /**\r\n     * @description Attributes blacklist used by the cleanHTML method\r\n     * @private\r\n     */\n    _attributesBlacklistRegExp: null,\n\n    /**\r\n     * @description Attributes of tags whitelist used by the cleanHTML method\r\n     * @private\r\n     */\n    _attributesTagsWhitelist: null,\n\n    /**\r\n     * @description Attributes of tags blacklist used by the cleanHTML method\r\n     * @private\r\n     */\n    _attributesTagsBlacklist: null,\n\n    /**\r\n     * @description binded controllersOff method\r\n     * @private\r\n     */\n    _bindControllersOff: null,\n\n    /**\r\n     * @description Is inline mode?\r\n     * @private\r\n     */\n    _isInline: null,\n\n    /**\r\n     * @description Is balloon|balloon-always mode?\r\n     * @private\r\n     */\n    _isBalloon: null,\n\n    /**\r\n     * @description Is balloon-always mode?\r\n     * @private\r\n     */\n    _isBalloonAlways: null,\n\n    /**\r\n     * @description Required value when using inline mode to sticky toolbar\r\n     * @private\r\n     */\n    _inlineToolbarAttr: {\n      top: '',\n      width: '',\n      isShow: false\n    },\n\n    /**\r\n     * @description Variable that controls the \"blur\" event in the editor of inline or balloon mode when the focus is moved to submenu\r\n     * @private\r\n     */\n    _notHideToolbar: false,\n\n    /**\r\n     * @description Variable value that sticky toolbar mode\r\n     * @private\r\n     */\n    _sticky: false,\n\n    /**\r\n     * @description Variables for controlling focus and blur events\r\n     * @private\r\n     */\n    _antiBlur: false,\n\n    /**\r\n     * @description Component line breaker element\r\n     * @private\r\n     */\n    _lineBreaker: null,\n    _lineBreakerButton: null,\n\n    /**\r\n     * @description If true, (initialize, reset) all indexes of image, video information\r\n     * @private\r\n     */\n    _componentsInfoInit: true,\n    _componentsInfoReset: false,\n\n    /**\r\n     * @description Plugins array with \"active\" method.\r\n     * \"activePlugins\" runs the \"add\" method when creating the editor.\r\n     */\n    activePlugins: null,\n\n    /**\r\n     * @description Information of tags that should maintain HTML structure, style, class name, etc. (In use by \"math\" plugin)\r\n     * When inserting \"html\" such as paste, it is executed on the \"html\" to be inserted. (core.cleanHTML)\r\n     * Basic Editor Actions:\r\n     * 1. All classes not starting with \"__se__\" or \"se-\" in the editor are removed.\r\n     * 2. The style of all tags except the \"span\" tag is removed from the editor.\r\n     * \"managedTagsInfo\" structure ex:\r\n     * managedTagsInfo: {\r\n     *   query: '.__se__xxx, se-xxx'\r\n     *   map: {\r\n     *     '__se__xxx': method.bind(core),\r\n     *     'se-xxx': method.bind(core),\r\n     *   }\r\n     * }\r\n     * @example\r\n     * Define in the following return format in the \"managedTagInfo\" function of the plugin.\r\n     * managedTagInfo() => {\r\n     *  return {\r\n     *    className: 'string', // Class name to identify the tag. (\"__se__xxx\", \"se-xxx\")\r\n     *    // Change the html of the \"element\". (\"element\" is the element found with \"className\".)\r\n     *    // \"method\" is executed by binding \"core\".\r\n     *    method: function (element) {\r\n     *      // this === core\r\n     *      element.innerHTML = // (rendered html);\r\n     *    }\r\n     *  }\r\n     * }\r\n     */\n    managedTagsInfo: null,\n\n    /**\r\n     * @description cashing: options.charCounterType === 'byte-html'\r\n     * @private\r\n     */\n    _charTypeHTML: false,\n\n    /**\r\n     * @description Array of \"checkFileInfo\" functions with the core bound\r\n     * (Plugins with \"checkFileInfo\" and \"resetFileInfo\" methods)\r\n     * \"fileInfoPlugins\" runs the \"add\" method when creating the editor.\r\n     * \"checkFileInfo\" method is always call just before the \"change\" event.\r\n     * @private\r\n     */\n    _fileInfoPluginsCheck: null,\n\n    /**\r\n     * @description Array of \"resetFileInfo\" functions with the core bound\r\n     * (Plugins with \"checkFileInfo\" and \"resetFileInfo\" methods)\r\n     * \"checkFileInfo\" method is always call just before the \"functions.setOptions\" method.\r\n     * @private\r\n     */\n    _fileInfoPluginsReset: null,\n\n    /**\r\n     * @description Variables for file component management\r\n     * @private\r\n     */\n    _fileManager: {\n      tags: null,\n      regExp: null,\n      queryString: null,\n      pluginRegExp: null,\n      pluginMap: null\n    },\n\n    /**\r\n     * @description Elements that need to change text or className for each selection change\r\n     * After creating the editor, \"activePlugins\" are added.\r\n     * @property {Element} STRONG bold button\r\n     * @property {Element} U underline button\r\n     * @property {Element} EM italic button\r\n     * @property {Element} DEL strike button\r\n     * @property {Element} SUB subscript button\r\n     * @property {Element} SUP superscript button\r\n     * @property {Element} OUTDENT outdent button\r\n     * @property {Element} INDENT indent button\r\n     */\n    commandMap: null,\n\n    /**\r\n     * @description CSS properties related to style tags \r\n     * @private\r\n     */\n    _commandMapStyles: {\n      STRONG: ['font-weight'],\n      U: ['text-decoration'],\n      EM: ['font-style'],\n      DEL: ['text-decoration']\n    },\n\n    /**\r\n     * @description Style button related to edit area\r\n     * @property {Element} fullScreen fullScreen button element\r\n     * @property {Element} showBlocks showBlocks button element\r\n     * @property {Element} codeView codeView button element\r\n     * @private\r\n     */\n    _styleCommandMap: null,\n\n    /**\r\n     * @private\r\n     */\n    _cleanStyleRegExp: {\n      span: new _w.RegExp('\\s*(font-family|font-size|color|background-color)\\s*:[^;]+(?!;)*', 'ig'),\n      format: new _w.RegExp('\\s*(text-align|margin-left|margin-right)\\s*:[^;]+(?!;)*', 'ig')\n    },\n\n    /**\r\n     * @description Variables used internally in editor operation\r\n     * @property {Boolean} isCodeView State of code view\r\n     * @property {Boolean} isFullScreen State of full screen\r\n     * @property {Number} innerHeight_fullScreen InnerHeight in editor when in full screen\r\n     * @property {Number} resizeClientY Remember the vertical size of the editor before resizing the editor (Used when calculating during resize operation)\r\n     * @property {Number} tabSize Indent size of tab (4)\r\n     * @property {Number} codeIndent Indent size of Code view mode (2)\r\n     * @property {Number} minResizingSize Minimum size of editing area when resized {Number} (.se-wrapper-inner {min-height: 65px;} || 65)\r\n     * @property {Array} currentNodes  An array of the current cursor's node structure\r\n     * @private\r\n     */\n    _variable: {\n      isChanged: false,\n      isCodeView: false,\n      isFullScreen: false,\n      innerHeight_fullScreen: 0,\n      resizeClientY: 0,\n      tabSize: 4,\n      codeIndent: 2,\n      minResizingSize: util.getNumber(context.element.wysiwygFrame.style.minHeight || '65', 0),\n      currentNodes: [],\n      currentNodesMap: [],\n      _range: null,\n      _selectionNode: null,\n      _originCssText: context.element.topArea.style.cssText,\n      _bodyOverflow: '',\n      _editorAreaOriginCssText: '',\n      _wysiwygOriginCssText: '',\n      _codeOriginCssText: '',\n      _fullScreenAttrs: {\n        sticky: false,\n        balloon: false,\n        inline: false\n      },\n      _lineBreakComp: null,\n      _lineBreakDir: ''\n    },\n\n    /**\r\n     * @description Save the current buttons states to \"allCommandButtons\" object\r\n     * @private\r\n     */\n    _saveButtonStates: function _saveButtonStates() {\n      if (!this.allCommandButtons) this.allCommandButtons = {};\n\n      var currentButtons = this.context.element._buttonTray.querySelectorAll('.se-menu-list button[data-display]');\n\n      for (var i = 0, element, command; i < currentButtons.length; i++) {\n        element = currentButtons[i];\n        command = element.getAttribute('data-command');\n        this.allCommandButtons[command] = element;\n      }\n    },\n\n    /**\r\n     * @description Recover the current buttons states from \"allCommandButtons\" object\r\n     * @private\r\n     */\n    _recoverButtonStates: function _recoverButtonStates() {\n      if (this.allCommandButtons) {\n        var currentButtons = this.context.element._buttonTray.querySelectorAll('.se-menu-list button[data-display]');\n\n        for (var i = 0, button, command, oldButton; i < currentButtons.length; i++) {\n          button = currentButtons[i];\n          command = button.getAttribute('data-command');\n          oldButton = this.allCommandButtons[command];\n\n          if (oldButton) {\n            button.parentElement.replaceChild(oldButton, button);\n            if (this.context.tool[command]) this.context.tool[command] = oldButton;\n          }\n        }\n      }\n    },\n\n    /**\r\n     * @description If the plugin is not added, add the plugin and call the 'add' function.\r\n     * If the plugin is added call callBack function.\r\n     * @param {String} pluginName The name of the plugin to call\r\n     * @param {function} callBackFunction Function to be executed immediately after module call\r\n     * @param {Element|null} _target Plugin target button (This is not necessary if you have a button list when creating the editor)\r\n     */\n    callPlugin: function callPlugin(pluginName, callBackFunction, _target) {\n      _target = _target || pluginCallButtons[pluginName];\n\n      if (!this.plugins[pluginName]) {\n        throw Error('[SUNEDITOR.core.callPlugin.fail] The called plugin does not exist or is in an invalid format. (pluginName:\"' + pluginName + '\")');\n      } else if (!this.initPlugins[pluginName]) {\n        this.plugins[pluginName].add(this, _target);\n        this.initPlugins[pluginName] = true;\n      } else if (typeof this._targetPlugins[pluginName] === 'object' && !!_target) {\n        this.initMenuTarget(pluginName, _target, this._targetPlugins[pluginName]);\n      }\n\n      if (this.plugins[pluginName].active && !this.commandMap[pluginName] && !!_target) {\n        this.commandMap[pluginName] = _target;\n        this.activePlugins.push(pluginName);\n      }\n\n      if (typeof callBackFunction === 'function') callBackFunction();\n    },\n\n    /**\r\n     * @description If the module is not added, add the module and call the 'add' function\r\n     * @param {Array} moduleArray module object's Array [dialog, resizing]\r\n     */\n    addModule: function addModule(moduleArray) {\n      for (var i = 0, len = moduleArray.length, moduleName; i < len; i++) {\n        moduleName = moduleArray[i].name;\n\n        if (!this.plugins[moduleName]) {\n          this.plugins[moduleName] = moduleArray[i];\n        }\n\n        if (!this.initPlugins[moduleName]) {\n          this.initPlugins[moduleName] = true;\n          if (typeof this.plugins[moduleName].add === 'function') this.plugins[moduleName].add(this);\n        }\n      }\n    },\n\n    /**\r\n     * @description Gets the current editor-relative scroll offset.\r\n     * @returns {Object} {top, left}\r\n     */\n    getGlobalScrollOffset: function getGlobalScrollOffset() {\n      var t = 0,\n          l = 0;\n      var el = context.element.topArea;\n\n      while (el) {\n        t += el.scrollTop;\n        l += el.scrollLeft;\n        el = el.parentElement;\n      }\n\n      el = this._shadowRoot ? this._shadowRoot.host : null;\n\n      while (el) {\n        t += el.scrollTop;\n        l += el.scrollLeft;\n        el = el.parentElement;\n      }\n\n      return {\n        top: t,\n        left: l\n      };\n    },\n\n    /**\r\n     * @description Method for managing submenu element.\r\n     * You must add the \"submenu\" element using the this method at custom plugin.\r\n     * @param {String} pluginName Plugin name\r\n     * @param {Element|null} target Target button\r\n     * @param {Element} menu Submenu element\r\n     */\n    initMenuTarget: function initMenuTarget(pluginName, target, menu) {\n      if (!target) {\n        this._targetPlugins[pluginName] = menu;\n      } else {\n        context.element._menuTray.appendChild(menu);\n\n        this._targetPlugins[pluginName] = true;\n        this._menuTray[target.getAttribute('data-command')] = menu;\n      }\n    },\n\n    /**\r\n     * @description Enable submenu\r\n     * @param {Element} element Submenu's button element to call\r\n     */\n    submenuOn: function submenuOn(element) {\n      if (this._bindedSubmenuOff) this._bindedSubmenuOff();\n      if (this._bindControllersOff) this.controllersOff();\n      var submenuName = this._submenuName = element.getAttribute('data-command');\n      var menu = this.submenu = this._menuTray[submenuName];\n      this.submenuActiveButton = element;\n\n      this._setMenuPosition(element, menu);\n\n      this._bindedSubmenuOff = this.submenuOff.bind(this);\n      this.addDocEvent('mousedown', this._bindedSubmenuOff, false);\n      if (this.plugins[submenuName].on) this.plugins[submenuName].on.call(this);\n      this._antiBlur = true;\n    },\n\n    /**\r\n     * @description Disable submenu\r\n     */\n    submenuOff: function submenuOff() {\n      this.removeDocEvent('mousedown', this._bindedSubmenuOff);\n      this._bindedSubmenuOff = null;\n\n      if (this.submenu) {\n        this._submenuName = '';\n        this.submenu.style.display = 'none';\n        this.submenu = null;\n        util.removeClass(this.submenuActiveButton, 'on');\n        this.submenuActiveButton = null;\n        this._notHideToolbar = false;\n      }\n\n      this._antiBlur = false;\n    },\n\n    /**\r\n     * @description Disable more layer\r\n     */\n    moreLayerOff: function moreLayerOff() {\n      if (this._moreLayerActiveButton) {\n        var layer = context.element.toolbar.querySelector('.' + this._moreLayerActiveButton.getAttribute('data-command'));\n        layer.style.display = 'none';\n        util.removeClass(this._moreLayerActiveButton, 'on');\n        this._moreLayerActiveButton = null;\n      }\n    },\n\n    /**\r\n     * @description Enable container\r\n     * @param {Element} element Container's button element to call\r\n     */\n    containerOn: function containerOn(element) {\n      if (this._bindedContainerOff) this._bindedContainerOff();\n      var containerName = this._containerName = element.getAttribute('data-command');\n      var menu = this.container = this._menuTray[containerName];\n      this.containerActiveButton = element;\n\n      this._setMenuPosition(element, menu);\n\n      this._bindedContainerOff = this.containerOff.bind(this);\n      this.addDocEvent('mousedown', this._bindedContainerOff, false);\n      if (this.plugins[containerName].on) this.plugins[containerName].on.call(this);\n      this._antiBlur = true;\n    },\n\n    /**\r\n     * @description Disable container\r\n     */\n    containerOff: function containerOff() {\n      this.removeDocEvent('mousedown', this._bindedContainerOff);\n      this._bindedContainerOff = null;\n\n      if (this.container) {\n        this._containerName = '';\n        this.container.style.display = 'none';\n        this.container = null;\n        util.removeClass(this.containerActiveButton, 'on');\n        this.containerActiveButton = null;\n        this._notHideToolbar = false;\n      }\n\n      this._antiBlur = false;\n    },\n\n    /**\r\n     * @description Set the menu position. (submenu, container)\r\n     * @param {*} element Button element\r\n     * @param {*} menu Menu element\r\n     * @private\r\n     */\n    _setMenuPosition: function _setMenuPosition(element, menu) {\n      menu.style.visibility = 'hidden';\n      menu.style.display = 'block';\n      menu.style.height = '';\n      util.addClass(element, 'on');\n      var toolbar = this.context.element.toolbar;\n      var toolbarW = toolbar.offsetWidth;\n\n      var toolbarOffset = event._getEditorOffsets(context.element.toolbar);\n\n      var menuW = menu.offsetWidth;\n      var l = element.parentElement.offsetLeft + 3; // rtl\n\n      if (options.rtl) {\n        var elementW = element.offsetWidth;\n        var rtlW = menuW > elementW ? menuW - elementW : 0;\n        var rtlL = rtlW > 0 ? 0 : elementW - menuW;\n        menu.style.left = l - rtlW + rtlL + 'px';\n\n        if (toolbarOffset.left > event._getEditorOffsets(menu).left) {\n          menu.style.left = '0px';\n        }\n      } else {\n        var overLeft = toolbarW <= menuW ? 0 : toolbarW - (l + menuW);\n        if (overLeft < 0) menu.style.left = l + overLeft + 'px';else menu.style.left = l + 'px';\n      } // get element top\n\n\n      var t = 0;\n      var offsetEl = element;\n\n      while (offsetEl && offsetEl !== toolbar) {\n        t += offsetEl.offsetTop;\n        offsetEl = offsetEl.offsetParent;\n      }\n\n      var bt = t;\n\n      if (this._isBalloon) {\n        t += toolbar.offsetTop + element.offsetHeight;\n      } else {\n        t -= element.offsetHeight;\n      } // set menu position\n\n\n      var toolbarTop = toolbarOffset.top;\n      var menuHeight = menu.offsetHeight;\n      var scrollTop = this.getGlobalScrollOffset().top;\n      var menuHeight_bottom = _w.innerHeight - (toolbarTop - scrollTop + bt + element.parentElement.offsetHeight);\n\n      if (menuHeight_bottom < menuHeight) {\n        var menuTop = -1 * (menuHeight - bt + 3);\n        var insTop = toolbarTop - scrollTop + menuTop;\n        var menuHeight_top = menuHeight + (insTop < 0 ? insTop : 0);\n\n        if (menuHeight_top > menuHeight_bottom) {\n          menu.style.height = menuHeight_top + 'px';\n          menuTop = -1 * (menuHeight_top - bt + 3);\n        } else {\n          menu.style.height = menuHeight_bottom + 'px';\n          menuTop = bt + element.parentElement.offsetHeight;\n        }\n\n        menu.style.top = menuTop + 'px';\n      } else {\n        menu.style.top = bt + element.parentElement.offsetHeight + 'px';\n      }\n\n      menu.style.visibility = '';\n    },\n\n    /**\r\n     * @description Show controller at editor area (controller elements, function, \"controller target element(@Required)\", \"controller name(@Required)\", etc..)\r\n     * @param {*} arguments controller elements, functions..\r\n     */\n    controllersOn: function controllersOn() {\n      if (this._bindControllersOff) this._bindControllersOff();\n      this.controllerArray = [];\n\n      for (var i = 0, arg; i < arguments.length; i++) {\n        arg = arguments[i];\n        if (!arg) continue;\n\n        if (typeof arg === 'string') {\n          this.currentControllerName = arg;\n          continue;\n        }\n\n        if (typeof arg === 'function') {\n          this.controllerArray.push(arg);\n          continue;\n        }\n\n        if (!util.hasClass(arg, 'se-controller')) {\n          this.currentControllerTarget = arg;\n          this.currentFileComponentInfo = this.getFileComponent(arg);\n          continue;\n        }\n\n        if (arg.style) {\n          arg.style.display = 'block';\n\n          if (this._shadowRoot && this._shadowRootControllerEventTarget.indexOf(arg) === -1) {\n            arg.addEventListener('mousedown', function (e) {\n              e.preventDefault();\n              e.stopPropagation();\n            });\n\n            this._shadowRootControllerEventTarget.push(arg);\n          }\n        }\n\n        this.controllerArray.push(arg);\n      }\n\n      this._bindControllersOff = this.controllersOff.bind(this);\n      this.addDocEvent('mousedown', this._bindControllersOff, false);\n      this.addDocEvent('keydown', this._bindControllersOff, false);\n      this._antiBlur = true;\n      if (typeof functions.showController === 'function') functions.showController(this.currentControllerName, this.controllerArray, this);\n    },\n\n    /**\r\n     * @description Hide controller at editor area (link button, image resize button..)\r\n     * @param {KeyboardEvent|MouseEvent|null} e Event object when called from mousedown and keydown events registered in \"core.controllersOn\"\r\n     */\n    controllersOff: function controllersOff(e) {\n      this._lineBreaker.style.display = 'none';\n      var len = this.controllerArray.length;\n\n      if (e && e.target && len > 0) {\n        for (var i = 0; i < len; i++) {\n          if (typeof this.controllerArray[i].contains === 'function' && this.controllerArray[i].contains(e.target)) return;\n        }\n      }\n\n      if (this._fileManager.pluginRegExp.test(this.currentControllerName) && e && e.type === 'keydown' && e.keyCode !== 27) return;\n      context.element.lineBreaker_t.style.display = context.element.lineBreaker_b.style.display = 'none';\n      this._variable._lineBreakComp = null;\n      this.currentControllerName = '';\n      this.currentControllerTarget = null;\n      this.currentFileComponentInfo = null;\n      this.effectNode = null;\n      if (!this._bindControllersOff) return;\n      this.removeDocEvent('mousedown', this._bindControllersOff);\n      this.removeDocEvent('keydown', this._bindControllersOff);\n      this._bindControllersOff = null;\n\n      if (len > 0) {\n        for (var _i = 0; _i < len; _i++) {\n          if (typeof this.controllerArray[_i] === 'function') this.controllerArray[_i]();else this.controllerArray[_i].style.display = 'none';\n        }\n\n        this.controllerArray = [];\n      }\n\n      this._antiBlur = false;\n    },\n\n    /**\r\n     * @description Specify the position of the controller.\r\n     * @param {Element} controller Controller element.\r\n     * @param {Element} referEl Element that is the basis of the controller's position.\r\n     * @param {String} position Type of position (\"top\" | \"bottom\")\r\n     * When using the \"top\" position, there should not be an arrow on the controller.\r\n     * When using the \"bottom\" position there should be an arrow on the controller.\r\n     * @param {Object} addOffset These are the left and top values that need to be added specially. \r\n     * This argument is required. - {left: 0, top: 0}\r\n     * Please enter the value based on ltr mode.\r\n     * Calculated automatically in rtl mode.\r\n     */\n    setControllerPosition: function setControllerPosition(controller, referEl, position, addOffset) {\n      if (options.rtl) addOffset.left *= -1;\n      var offset = util.getOffset(referEl, context.element.wysiwygFrame);\n      controller.style.visibility = 'hidden';\n      controller.style.display = 'block'; // Height value of the arrow element is 11px\n\n      var topMargin = position === 'top' ? -(controller.offsetHeight + 2) : referEl.offsetHeight + 12;\n      controller.style.top = offset.top + topMargin + addOffset.top + 'px';\n      var l = offset.left - context.element.wysiwygFrame.scrollLeft + addOffset.left;\n      var controllerW = controller.offsetWidth;\n      var referElW = referEl.offsetWidth;\n      var allow = util.hasClass(controller.firstElementChild, 'se-arrow') ? controller.firstElementChild : null; // rtl (Width value of the arrow element is 22px)\n\n      if (options.rtl) {\n        var rtlW = controllerW > referElW ? controllerW - referElW : 0;\n        var rtlL = rtlW > 0 ? 0 : referElW - controllerW;\n        controller.style.left = l - rtlW + rtlL + 'px';\n\n        if (rtlW > 0) {\n          if (allow) allow.style.left = (controllerW - 14 < 10 + rtlW ? controllerW - 14 : 10 + rtlW) + 'px';\n        }\n\n        var overSize = context.element.wysiwygFrame.offsetLeft - controller.offsetLeft;\n\n        if (overSize > 0) {\n          controller.style.left = '0px';\n          if (allow) allow.style.left = overSize + 'px';\n        }\n      } else {\n        controller.style.left = l + 'px';\n\n        var _overSize = context.element.wysiwygFrame.offsetWidth - (controller.offsetLeft + controllerW);\n\n        if (_overSize < 0) {\n          controller.style.left = controller.offsetLeft + _overSize + 'px';\n          if (allow) allow.style.left = 20 - _overSize + 'px';\n        } else {\n          if (allow) allow.style.left = '20px';\n        }\n      }\n\n      controller.style.visibility = '';\n    },\n\n    /**\r\n     * @description javascript execCommand\r\n     * @param {String} command javascript execCommand function property\r\n     * @param {Boolean|undefined} showDefaultUI javascript execCommand function property\r\n     * @param {String|undefined} value javascript execCommand function property\r\n     */\n    execCommand: function execCommand(command, showDefaultUI, value) {\n      this._wd.execCommand(command, showDefaultUI, command === 'formatBlock' ? '<' + value + '>' : value); // history stack\n\n\n      this.history.push(true);\n    },\n\n    /**\r\n     * @description Focus to wysiwyg area using \"native focus function\"\r\n     */\n    nativeFocus: function nativeFocus() {\n      this.__focus();\n\n      this._editorRange();\n    },\n\n    /**\r\n     * @description Focus method\r\n     * @private\r\n     */\n    __focus: function __focus() {\n      var caption = util.getParentElement(this.getSelectionNode(), 'figcaption');\n\n      if (caption) {\n        caption.focus();\n      } else {\n        context.element.wysiwyg.focus();\n      }\n    },\n\n    /**\r\n     * @description Focus to wysiwyg area\r\n     */\n    focus: function focus() {\n      if (context.element.wysiwygFrame.style.display === 'none') return;\n\n      if (options.iframe) {\n        this.nativeFocus();\n      } else {\n        try {\n          var range = this.getRange();\n\n          if (range.startContainer === range.endContainer && util.isWysiwygDiv(range.startContainer)) {\n            var currentNode = range.commonAncestorContainer.children[range.startOffset];\n\n            if (!util.isFormatElement(currentNode) && !util.isComponent(currentNode)) {\n              var format = util.createElement(options.defaultTag);\n              var br = util.createElement('BR');\n              format.appendChild(br);\n              context.element.wysiwyg.insertBefore(format, currentNode);\n              this.setRange(br, 0, br, 0);\n              return;\n            }\n          }\n\n          this.setRange(range.startContainer, range.startOffset, range.endContainer, range.endOffset);\n        } catch (e) {\n          this.nativeFocus();\n        }\n      }\n\n      event._applyTagEffects();\n\n      if (this._isBalloon) event._toggleToolbarBalloon();\n    },\n\n    /**\r\n     * @description If \"focusEl\" is a component, then that component is selected; if it is a format element, the last text is selected\r\n     * If \"focusEdge\" is null, then selected last element\r\n     * @param {Element|null} focusEl Focus element\r\n     */\n    focusEdge: function focusEdge(focusEl) {\n      if (!focusEl) focusEl = context.element.wysiwyg.lastElementChild;\n      var fileComponentInfo = this.getFileComponent(focusEl);\n\n      if (fileComponentInfo) {\n        this.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName);\n      } else if (focusEl) {\n        focusEl = util.getChildElement(focusEl, function (current) {\n          return current.childNodes.length === 0 || current.nodeType === 3;\n        }, true);\n        if (!focusEl) this.nativeFocus();else this.setRange(focusEl, focusEl.textContent.length, focusEl, focusEl.textContent.length);\n      } else {\n        this.focus();\n      }\n    },\n\n    /**\r\n     * @description Focusout to wysiwyg area (.blur())\r\n     */\n    blur: function blur() {\n      if (options.iframe) {\n        context.element.wysiwygFrame.blur();\n      } else {\n        context.element.wysiwyg.blur();\n      }\n    },\n\n    /**\r\n     * @description Set current editor's range object and return.\r\n     * @param {Node} startCon The startContainer property of the selection object.\r\n     * @param {Number} startOff The startOffset property of the selection object.\r\n     * @param {Node} endCon The endContainer property of the selection object.\r\n     * @param {Number} endOff The endOffset property of the selection object.\r\n     * @returns {Object} Range object.\r\n     */\n    setRange: function setRange(startCon, startOff, endCon, endOff) {\n      if (!startCon || !endCon) return;\n      if (startOff > startCon.textContent.length) startOff = startCon.textContent.length;\n      if (endOff > endCon.textContent.length) endOff = endCon.textContent.length;\n\n      if (util.isFormatElement(startCon)) {\n        startCon = startCon.childNodes[startOff] || startCon.childNodes[startOff - 1] || startCon;\n        startOff = startOff > 0 ? startCon.nodeType === 1 ? 1 : startCon.textContent ? startCon.textContent.length : 0 : 0;\n      }\n\n      if (util.isFormatElement(endCon)) {\n        endCon = endCon.childNodes[endOff] || endCon.childNodes[endOff - 1] || endCon;\n        endOff = endOff > 0 ? endCon.nodeType === 1 ? 1 : endCon.textContent ? endCon.textContent.length : 0 : 0;\n      }\n\n      var range = this._wd.createRange();\n\n      try {\n        range.setStart(startCon, startOff);\n        range.setEnd(endCon, endOff);\n      } catch (error) {\n        console.warn('[SUNEDITOR.core.focus.error] ' + error);\n        this.nativeFocus();\n        return;\n      }\n\n      var selection = this.getSelection();\n\n      if (selection.removeAllRanges) {\n        selection.removeAllRanges();\n      }\n\n      selection.addRange(range);\n\n      this._rangeInfo(range, this.getSelection());\n\n      if (options.iframe) this.__focus();\n      return range;\n    },\n\n    /**\r\n     * @description Remove range object and button effect\r\n     */\n    removeRange: function removeRange() {\n      this._variable._range = null;\n      this._variable._selectionNode = null;\n      if (this.hasFocus) this.getSelection().removeAllRanges();\n\n      this._setKeyEffect([]);\n    },\n\n    /**\r\n     * @description Get current editor's range object\r\n     * @returns {Object}\r\n     */\n    getRange: function getRange() {\n      var range = this._variable._range || this._createDefaultRange();\n\n      var selection = this.getSelection();\n      if (range.collapsed === selection.isCollapsed || !context.element.wysiwyg.contains(selection.focusNode)) return range;\n\n      if (selection.rangeCount > 0) {\n        this._variable._range = selection.getRangeAt(0);\n        return this._variable._range;\n      } else {\n        var sc = selection.anchorNode,\n            ec = selection.focusNode,\n            so = selection.anchorOffset,\n            eo = selection.focusOffset;\n        var compareValue = util.compareElements(sc, ec);\n        var rightDir = compareValue.ancestor && (compareValue.result === 0 ? so <= eo : compareValue.result > 1 ? true : false);\n        return this.setRange(rightDir ? sc : ec, rightDir ? so : eo, rightDir ? ec : sc, rightDir ? eo : so);\n      }\n    },\n\n    /**\r\n     * @description If the \"range\" object is a non-editable area, add a line at the top of the editor and update the \"range\" object.\r\n     * Returns a new \"range\" or argument \"range\".\r\n     * @param {Object} range core.getRange()\r\n     * @param {Element|null} container If there is \"container\" argument, it creates a line in front of the container.\r\n     * @returns {Object} range\r\n     */\n    getRange_addLine: function getRange_addLine(range, container) {\n      if (this._selectionVoid(range)) {\n        var wysiwyg = context.element.wysiwyg;\n        var op = util.createElement(options.defaultTag);\n        op.innerHTML = '<br>';\n        wysiwyg.insertBefore(op, container && container !== wysiwyg ? container.nextElementSibling : wysiwyg.firstElementChild);\n        this.setRange(op.firstElementChild, 0, op.firstElementChild, 1);\n        range = this._variable._range;\n      }\n\n      return range;\n    },\n\n    /**\r\n     * @description Get window selection obejct\r\n     * @returns {Object}\r\n     */\n    getSelection: function getSelection() {\n      return this._shadowRoot && this._shadowRoot.getSelection ? this._shadowRoot.getSelection() : this._ww.getSelection();\n    },\n\n    /**\r\n     * @description Get current select node\r\n     * @returns {Node}\r\n     */\n    getSelectionNode: function getSelectionNode() {\n      if (!context.element.wysiwyg.contains(this._variable._selectionNode)) this._editorRange();\n\n      if (!this._variable._selectionNode) {\n        var selectionNode = util.getChildElement(context.element.wysiwyg.firstChild, function (current) {\n          return current.childNodes.length === 0 || current.nodeType === 3;\n        }, false);\n\n        if (!selectionNode) {\n          this._editorRange();\n        } else {\n          this._variable._selectionNode = selectionNode;\n          return selectionNode;\n        }\n      }\n\n      return this._variable._selectionNode;\n    },\n\n    /**\r\n     * @description Saving the range object and the currently selected node of editor\r\n     * @private\r\n     */\n    _editorRange: function _editorRange() {\n      var selection = this.getSelection();\n      if (!selection) return null;\n      var range = null;\n\n      if (selection.rangeCount > 0) {\n        range = selection.getRangeAt(0);\n      } else {\n        range = this._createDefaultRange();\n      }\n\n      if (util.isFormatElement(range.endContainer) && range.endOffset === 0) {\n        range = this.setRange(range.startContainer, range.startOffset, range.startContainer, range.startContainer.length);\n      }\n\n      this._rangeInfo(range, selection);\n    },\n\n    /**\r\n     * @description Set \"range\" and \"selection\" info.\r\n     * @param {Object} range range object.\r\n     * @param {Object} selection selection object.\r\n     */\n    _rangeInfo: function _rangeInfo(range, selection) {\n      var selectionNode = null;\n      this._variable._range = range;\n\n      if (range.collapsed) {\n        if (util.isWysiwygDiv(range.commonAncestorContainer)) selectionNode = range.commonAncestorContainer.children[range.startOffset] || range.commonAncestorContainer;else selectionNode = range.commonAncestorContainer;\n      } else {\n        selectionNode = selection.extentNode || selection.anchorNode;\n      }\n\n      this._variable._selectionNode = selectionNode;\n    },\n\n    /**\r\n     * @description Return the range object of editor's first child node\r\n     * @returns {Object}\r\n     * @private\r\n     */\n    _createDefaultRange: function _createDefaultRange() {\n      var wysiwyg = context.element.wysiwyg;\n      wysiwyg.focus();\n\n      var range = this._wd.createRange();\n\n      var focusEl = wysiwyg.firstElementChild;\n\n      if (!focusEl) {\n        focusEl = util.createElement(options.defaultTag);\n        focusEl.innerHTML = '<br>';\n        wysiwyg.appendChild(focusEl);\n      }\n\n      range.setStart(focusEl, 0);\n      range.setEnd(focusEl, 0);\n      return range;\n    },\n\n    /**\r\n     * @description Returns true if there is no valid \"selection\".\r\n     * @param {Object} range core.getRange()\r\n     * @returns {Object} range\r\n     * @private\r\n     */\n    _selectionVoid: function _selectionVoid(range) {\n      var comm = range.commonAncestorContainer;\n      return util.isWysiwygDiv(range.startContainer) && util.isWysiwygDiv(range.endContainer) || /FIGURE/i.test(comm.nodeName) || this._fileManager.regExp.test(comm.nodeName) || util.isMediaComponent(comm);\n    },\n\n    /**\r\n     * @description Reset range object to text node selected status.\r\n     * @returns {Boolean} Returns false if there is no valid selection.\r\n     * @private\r\n     */\n    _resetRangeToTextNode: function _resetRangeToTextNode() {\n      var range = this.getRange();\n      if (this._selectionVoid(range)) return false;\n      var startCon = range.startContainer;\n      var startOff = range.startOffset;\n      var endCon = range.endContainer;\n      var endOff = range.endOffset;\n      var tempCon, tempOffset, tempChild;\n\n      if (util.isFormatElement(startCon)) {\n        if (!startCon.childNodes[startOff]) {\n          startCon = startCon.lastChild || startCon;\n          startOff = startCon.textContent.length;\n        } else {\n          startCon = startCon.childNodes[startOff] || startCon;\n          startOff = 0;\n        }\n\n        while (startCon && startCon.nodeType === 1 && startCon.firstChild) {\n          startCon = startCon.firstChild || startCon;\n          startOff = 0;\n        }\n      }\n\n      if (util.isFormatElement(endCon)) {\n        endCon = endCon.childNodes[endOff] || endCon.lastChild || endCon;\n\n        while (endCon && endCon.nodeType === 1 && endCon.lastChild) {\n          endCon = endCon.lastChild;\n        }\n\n        endOff = endCon.textContent.length;\n      } // startContainer\n\n\n      tempCon = util.isWysiwygDiv(startCon) ? context.element.wysiwyg.firstChild : startCon;\n      tempOffset = startOff;\n\n      if (util.isBreak(tempCon) || tempCon.nodeType === 1 && tempCon.childNodes.length > 0) {\n        var onlyBreak = util.isBreak(tempCon);\n\n        if (!onlyBreak) {\n          while (tempCon && !util.isBreak(tempCon) && tempCon.nodeType === 1) {\n            tempCon = tempCon.childNodes[tempOffset] || tempCon.nextElementSibling || tempCon.nextSibling;\n            tempOffset = 0;\n          }\n\n          var format = util.getFormatElement(tempCon, null);\n\n          if (format === util.getRangeFormatElement(format, null)) {\n            format = util.createElement(util.getParentElement(tempCon, util.isCell) ? 'DIV' : options.defaultTag);\n            tempCon.parentNode.insertBefore(format, tempCon);\n            format.appendChild(tempCon);\n          }\n        }\n\n        if (util.isBreak(tempCon)) {\n          var emptyText = util.createTextNode(util.zeroWidthSpace);\n          tempCon.parentNode.insertBefore(emptyText, tempCon);\n          tempCon = emptyText;\n\n          if (onlyBreak) {\n            if (startCon === endCon) {\n              endCon = tempCon;\n              endOff = 1;\n            }\n          }\n        }\n      } // set startContainer\n\n\n      startCon = tempCon;\n      startOff = tempOffset; // endContainer\n\n      tempCon = util.isWysiwygDiv(endCon) ? context.element.wysiwyg.lastChild : endCon;\n      tempOffset = endOff;\n\n      if (util.isBreak(tempCon) || tempCon.nodeType === 1 && tempCon.childNodes.length > 0) {\n        var _onlyBreak = util.isBreak(tempCon);\n\n        if (!_onlyBreak) {\n          while (tempCon && !util.isBreak(tempCon) && tempCon.nodeType === 1) {\n            tempChild = tempCon.childNodes;\n            if (tempChild.length === 0) break;\n            tempCon = tempChild[tempOffset > 0 ? tempOffset - 1 : tempOffset] || !/FIGURE/i.test(tempChild[0].nodeName) ? tempChild[0] : tempCon.previousElementSibling || tempCon.previousSibling || startCon;\n            tempOffset = tempOffset > 0 ? tempCon.textContent.length : tempOffset;\n          }\n\n          var _format = util.getFormatElement(tempCon, null);\n\n          if (_format === util.getRangeFormatElement(_format, null)) {\n            _format = util.createElement(util.isCell(_format) ? 'DIV' : options.defaultTag);\n            tempCon.parentNode.insertBefore(_format, tempCon);\n\n            _format.appendChild(tempCon);\n          }\n        }\n\n        if (util.isBreak(tempCon)) {\n          var _emptyText = util.createTextNode(util.zeroWidthSpace);\n\n          tempCon.parentNode.insertBefore(_emptyText, tempCon);\n          tempCon = _emptyText;\n          tempOffset = 1;\n\n          if (_onlyBreak && !tempCon.previousSibling) {\n            util.removeItem(endCon);\n          }\n        }\n      } // set endContainer\n\n\n      endCon = tempCon;\n      endOff = tempOffset; // set Range\n\n      this.setRange(startCon, startOff, endCon, endOff);\n      return true;\n    },\n\n    /**\r\n     * @description Returns a \"formatElement\"(util.isFormatElement) array from the currently selected range.\r\n     * @param {Function|null} validation The validation function. (Replaces the default validation function-util.isFormatElement(current))\r\n     * @returns {Array}\r\n     */\n    getSelectedElements: function getSelectedElements(validation) {\n      if (!this._resetRangeToTextNode()) return [];\n      var range = this.getRange();\n\n      if (util.isWysiwygDiv(range.startContainer)) {\n        var children = context.element.wysiwyg.children;\n        if (children.length === 0) return [];\n        this.setRange(children[0], 0, children[children.length - 1], children[children.length - 1].textContent.trim().length);\n        range = this.getRange();\n      }\n\n      var startCon = range.startContainer;\n      var endCon = range.endContainer;\n      var commonCon = range.commonAncestorContainer; // get line nodes\n\n      var lineNodes = util.getListChildren(commonCon, function (current) {\n        return validation ? validation(current) : util.isFormatElement(current);\n      });\n      if (!util.isWysiwygDiv(commonCon) && !util.isRangeFormatElement(commonCon)) lineNodes.unshift(util.getFormatElement(commonCon, null));\n      if (startCon === endCon || lineNodes.length === 1) return lineNodes;\n      var startLine = util.getFormatElement(startCon, null);\n      var endLine = util.getFormatElement(endCon, null);\n      var startIdx = null;\n      var endIdx = null;\n\n      var onlyTable = function onlyTable(current) {\n        return util.isTable(current) ? /^TABLE$/i.test(current.nodeName) : true;\n      };\n\n      var startRangeEl = util.getRangeFormatElement(startLine, onlyTable);\n      var endRangeEl = util.getRangeFormatElement(endLine, onlyTable);\n      if (util.isTable(startRangeEl) && util.isListCell(startRangeEl.parentNode)) startRangeEl = startRangeEl.parentNode;\n      if (util.isTable(endRangeEl) && util.isListCell(endRangeEl.parentNode)) endRangeEl = endRangeEl.parentNode;\n      var sameRange = startRangeEl === endRangeEl;\n\n      for (var i = 0, len = lineNodes.length, line; i < len; i++) {\n        line = lineNodes[i];\n\n        if (startLine === line || !sameRange && line === startRangeEl) {\n          startIdx = i;\n          continue;\n        }\n\n        if (endLine === line || !sameRange && line === endRangeEl) {\n          endIdx = i;\n          break;\n        }\n      }\n\n      if (startIdx === null) startIdx = 0;\n      if (endIdx === null) endIdx = lineNodes.length - 1;\n      return lineNodes.slice(startIdx, endIdx + 1);\n    },\n\n    /**\r\n     * @description Get format elements and components from the selected area. (P, DIV, H[1-6], OL, UL, TABLE..)\r\n     * If some of the component are included in the selection, get the entire that component.\r\n     * @param {Boolean} removeDuplicate If true, if there is a parent and child tag among the selected elements, the child tag is excluded.\r\n     * @returns {Array}\r\n     */\n    getSelectedElementsAndComponents: function getSelectedElementsAndComponents(removeDuplicate) {\n      var commonCon = this.getRange().commonAncestorContainer;\n      var myComponent = util.getParentElement(commonCon, util.isComponent);\n      var selectedLines = util.isTable(commonCon) ? this.getSelectedElements(null) : this.getSelectedElements(function (current) {\n        var component = this.getParentElement(current, this.isComponent);\n        return this.isFormatElement(current) && (!component || component === myComponent) || this.isComponent(current) && !this.getFormatElement(current);\n      }.bind(util));\n\n      if (removeDuplicate) {\n        for (var i = 0, len = selectedLines.length; i < len; i++) {\n          for (var j = i - 1; j >= 0; j--) {\n            if (selectedLines[j].contains(selectedLines[i])) {\n              selectedLines.splice(i, 1);\n              i--;\n              len--;\n              break;\n            }\n          }\n        }\n      }\n\n      return selectedLines;\n    },\n\n    /**\r\n     * @description Determine if this offset is the edge offset of container\r\n     * @param {Node} container The node of the selection object. (range.startContainer..)\r\n     * @param {Number} offset The offset of the selection object. (core.getRange().startOffset...)\r\n     * @param {String|undefined} dir Select check point - Both edge, Front edge or End edge. (\"front\": Front edge, \"end\": End edge, undefined: Both edge)\r\n     * @returns {Boolean}\r\n     */\n    isEdgePoint: function isEdgePoint(container, offset, dir) {\n      return dir !== 'end' && offset === 0 || (!dir || dir !== 'front') && !container.nodeValue && offset === 1 || (!dir || dir === 'end') && !!container.nodeValue && offset === container.nodeValue.length;\n    },\n\n    /**\r\n     * @description Check if the container and offset values are the edges of the format tag\r\n     * @param {Node} container The node of the selection object. (range.startContainer..)\r\n     * @param {Number} offset The offset of the selection object. (core.getRange().startOffset...)\r\n     * @param {String} dir Select check point - \"front\": Front edge, \"end\": End edge, undefined: Both edge.\r\n     * @returns {Array|null}\r\n     * @private\r\n     */\n    _isEdgeFormat: function _isEdgeFormat(node, offset, dir) {\n      if (!this.isEdgePoint(node, offset, dir)) return false;\n      var result = [];\n      dir = dir === 'front' ? 'previousSibling' : 'nextSibling';\n\n      while (node && !util.isFormatElement(node) && !util.isWysiwygDiv(node)) {\n        if (!node[dir] || util.isBreak(node[dir]) && !node[dir][dir]) {\n          if (node.nodeType === 1) result.push(node.cloneNode(false));\n          node = node.parentNode;\n        } else {\n          return null;\n        }\n      }\n\n      return result;\n    },\n\n    /**\r\n     * @description Show loading box\r\n     */\n    showLoading: function showLoading() {\n      context.element.loading.style.display = 'block';\n    },\n\n    /**\r\n     * @description Close loading box\r\n     */\n    closeLoading: function closeLoading() {\n      context.element.loading.style.display = 'none';\n    },\n\n    /**\r\n     * @description Append format element to sibling node of argument element.\r\n     * If the \"formatNodeName\" argument value is present, the tag of that argument value is inserted,\r\n     * If not, the currently selected format tag is inserted.\r\n     * @param {Element} element Insert as siblings of that element\r\n     * @param {String|Element|null} formatNode Node name or node obejct to be inserted\r\n     * @returns {Element}\r\n     */\n    appendFormatTag: function appendFormatTag(element, formatNode) {\n      if (!element || !element.parentNode) return null;\n      var currentFormatEl = util.getFormatElement(this.getSelectionNode(), null);\n      var oFormat = null;\n\n      if (!util.isFormatElement(element) && util.isFreeFormatElement(currentFormatEl || element.parentNode)) {\n        oFormat = util.createElement('BR');\n      } else {\n        var oFormatName = formatNode ? typeof formatNode === 'string' ? formatNode : formatNode.nodeName : util.isFormatElement(currentFormatEl) && !util.isRangeFormatElement(currentFormatEl) && !util.isFreeFormatElement(currentFormatEl) ? currentFormatEl.nodeName : options.defaultTag;\n        oFormat = util.createElement(oFormatName);\n        oFormat.innerHTML = '<br>';\n\n        if (formatNode && typeof formatNode !== 'string' || !formatNode && util.isFormatElement(currentFormatEl)) {\n          util.copyTagAttributes(oFormat, formatNode || currentFormatEl);\n        }\n      }\n\n      if (util.isCell(element)) element.insertBefore(oFormat, element.nextElementSibling);else element.parentNode.insertBefore(oFormat, element.nextElementSibling);\n      return oFormat;\n    },\n\n    /**\r\n     * @description The method to insert a element and return. (used elements : table, hr, image, video)\r\n     * If \"element\" is \"HR\", insert and return the new line.\r\n     * @param {Element} element Element to be inserted\r\n     * @param {Boolean} notHistoryPush When true, it does not update the history stack and the selection object and return EdgeNodes (util.getEdgeChildNodes)\r\n     * @param {Boolean} checkCharCount If true, if \"options.maxCharCount\" is exceeded when \"element\" is added, null is returned without addition.\r\n     * @param {Boolean} notSelect If true, Do not automatically select the inserted component.\r\n     * @returns {Element}\r\n     */\n    insertComponent: function insertComponent(element, notHistoryPush, checkCharCount, notSelect) {\n      if (this.isReadOnly || checkCharCount && !this.checkCharCount(element, null)) {\n        return null;\n      }\n\n      var r = this.removeNode();\n      this.getRange_addLine(this.getRange(), r.container);\n      var oNode = null;\n      var selectionNode = this.getSelectionNode();\n      var formatEl = util.getFormatElement(selectionNode, null);\n\n      if (util.isListCell(formatEl)) {\n        this.insertNode(element, selectionNode === formatEl ? null : r.container.nextSibling, false);\n        if (!element.nextSibling) element.parentNode.appendChild(util.createElement('BR'));\n      } else {\n        if (this.getRange().collapsed && (r.container.nodeType === 3 || util.isBreak(r.container))) {\n          var depthFormat = util.getParentElement(r.container, function (current) {\n            return this.isRangeFormatElement(current);\n          }.bind(util));\n          oNode = util.splitElement(r.container, r.offset, !depthFormat ? 0 : util.getElementDepth(depthFormat) + 1);\n          if (oNode) formatEl = oNode.previousSibling;\n        }\n\n        this.insertNode(element, util.isRangeFormatElement(formatEl) ? null : formatEl, false);\n        if (formatEl && util.onlyZeroWidthSpace(formatEl)) util.removeItem(formatEl);\n      }\n\n      if (!notSelect) {\n        this.setRange(element, 0, element, 0);\n        var fileComponentInfo = this.getFileComponent(element);\n\n        if (fileComponentInfo) {\n          this.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName);\n        } else if (oNode) {\n          oNode = util.getEdgeChildNodes(oNode, null).sc || oNode;\n          this.setRange(oNode, 0, oNode, 0);\n        }\n      } // history stack\n\n\n      if (!notHistoryPush) this.history.push(1);\n      return oNode || element;\n    },\n\n    /**\r\n     * @description Gets the file component and that plugin name\r\n     * return: {target, component, pluginName} | null\r\n     * @param {Element} element Target element (figure tag, component div, file tag)\r\n     * @returns {Object|null}\r\n     */\n    getFileComponent: function getFileComponent(element) {\n      if (!this._fileManager.queryString || !element) return null;\n      var target, pluginName;\n\n      if (/^FIGURE$/i.test(element.nodeName) || /se-component/.test(element.className)) {\n        target = element.querySelector(this._fileManager.queryString);\n      }\n\n      if (!target && element.nodeName && this._fileManager.regExp.test(element.nodeName)) {\n        target = element;\n      }\n\n      if (target) {\n        pluginName = this._fileManager.pluginMap[target.nodeName.toLowerCase()];\n\n        if (pluginName) {\n          return {\n            target: target,\n            component: util.getParentElement(target, util.isComponent),\n            pluginName: pluginName\n          };\n        }\n      }\n\n      return null;\n    },\n\n    /**\r\n     * @description The component(image, video) is selected and the resizing module is called.\r\n     * @param {Element} element Element tag (img, iframe, video)\r\n     * @param {String} pluginName Plugin name (image, video)\r\n     */\n    selectComponent: function selectComponent(element, pluginName) {\n      if (util.isUneditableComponent(util.getParentElement(element, util.isComponent)) || util.isUneditableComponent(element)) return false;\n      if (!this.hasFocus) this.focus();\n      var plugin = this.plugins[pluginName];\n      if (!plugin) return;\n\n      _w.setTimeout(function () {\n        if (typeof plugin.select === 'function') this.callPlugin(pluginName, plugin.select.bind(this, element), null);\n\n        this._setComponentLineBreaker(element);\n      }.bind(this));\n    },\n\n    /**\r\n     * @description Set line breaker of component\r\n     * @param {Element} element Element tag (img, iframe, video)\r\n     * @private\r\n     */\n    _setComponentLineBreaker: function _setComponentLineBreaker(element) {\n      // line breaker\n      this._lineBreaker.style.display = 'none';\n      var container = util.getParentElement(element, util.isComponent);\n      var t_style = context.element.lineBreaker_t.style;\n      var b_style = context.element.lineBreaker_b.style;\n      var target = this.context.resizing.resizeContainer.style.display === 'block' ? this.context.resizing.resizeContainer : element;\n      var isList = util.isListCell(container.parentNode);\n      var componentTop, wScroll, w; // top\n\n      if (isList ? !container.previousSibling : !util.isFormatElement(container.previousElementSibling)) {\n        this._variable._lineBreakComp = container;\n        wScroll = context.element.wysiwyg.scrollTop;\n        componentTop = util.getOffset(element, context.element.wysiwygFrame).top + wScroll;\n        w = target.offsetWidth / 2 / 2;\n        t_style.top = componentTop - wScroll - 12 + 'px';\n        t_style.left = util.getOffset(target).left + w + 'px';\n        t_style.display = 'block';\n      } else {\n        t_style.display = 'none';\n      } // bottom\n\n\n      if (isList ? !container.nextSibling : !util.isFormatElement(container.nextElementSibling)) {\n        if (!componentTop) {\n          this._variable._lineBreakComp = container;\n          wScroll = context.element.wysiwyg.scrollTop;\n          componentTop = util.getOffset(element, context.element.wysiwygFrame).top + wScroll;\n          w = target.offsetWidth / 2 / 2;\n        }\n\n        b_style.top = componentTop + target.offsetHeight - wScroll - 12 + 'px';\n        b_style.left = util.getOffset(target).left + target.offsetWidth - w - 24 + 'px';\n        b_style.display = 'block';\n      } else {\n        b_style.display = 'none';\n      }\n    },\n\n    /**\r\n     * @description Delete selected node and insert argument value node and return.\r\n     * If the \"afterNode\" exists, it is inserted after the \"afterNode\"\r\n     * Inserting a text node merges with both text nodes on both sides and returns a new \"{ container, startOffset, endOffset }\".\r\n     * @param {Node} oNode Element to be inserted\r\n     * @param {Node|null} afterNode If the node exists, it is inserted after the node\r\n     * @param {Boolean} checkCharCount If true, if \"options.maxCharCount\" is exceeded when \"element\" is added, null is returned without addition.\r\n     * @returns {Object|Node|null}\r\n     */\n    insertNode: function insertNode(oNode, afterNode, checkCharCount) {\n      if (this.isReadOnly || checkCharCount && !this.checkCharCount(oNode, null)) {\n        return null;\n      }\n\n      var range = this.getRange();\n      var line = util.isListCell(range.commonAncestorContainer) ? range.commonAncestorContainer : util.getFormatElement(this.getSelectionNode(), null);\n      var insertListCell = util.isListCell(line) && (util.isListCell(oNode) || util.isList(oNode));\n      var parentNode,\n          originAfter,\n          tempAfterNode,\n          tempParentNode = null;\n      var freeFormat = util.isFreeFormatElement(line);\n      var isFormats = !freeFormat && (util.isFormatElement(oNode) || util.isRangeFormatElement(oNode)) || util.isComponent(oNode);\n\n      if (insertListCell) {\n        tempAfterNode = afterNode || util.isList(oNode) ? line.lastChild : line.nextElementSibling;\n        tempParentNode = util.isList(oNode) ? line : (tempAfterNode || line).parentNode;\n      }\n\n      if (!afterNode && (isFormats || util.isComponent(oNode) || util.isMedia(oNode))) {\n        var isEdge = this.isEdgePoint(range.endContainer, range.endOffset, 'end');\n        var r = this.removeNode();\n        var container = r.container;\n        var prevContainer = container === r.prevContainer && range.collapsed ? null : r.prevContainer;\n\n        if (insertListCell && prevContainer) {\n          tempParentNode = prevContainer.nodeType === 3 ? prevContainer.parentNode : prevContainer;\n\n          if (tempParentNode.contains(container)) {\n            var sameParent = true;\n            tempAfterNode = container;\n\n            while (tempAfterNode.parentNode && tempAfterNode.parentNode !== tempParentNode) {\n              tempAfterNode = tempAfterNode.parentNode;\n              sameParent = false;\n            }\n\n            if (sameParent && container === prevContainer) tempAfterNode = tempAfterNode.nextSibling;\n          } else {\n            tempAfterNode = null;\n          }\n        } else if (insertListCell && util.isListCell(container) && !line.parentElement) {\n          line = util.createElement('LI');\n          tempParentNode.appendChild(line);\n          container.appendChild(tempParentNode);\n          tempAfterNode = null;\n        } else if (container.nodeType === 3 || util.isBreak(container) || insertListCell) {\n          var depthFormat = util.getParentElement(container, function (current) {\n            return this.isRangeFormatElement(current) || this.isListCell(current);\n          }.bind(util));\n          afterNode = util.splitElement(container, r.offset, !depthFormat ? 0 : util.getElementDepth(depthFormat) + 1);\n\n          if (afterNode) {\n            if (insertListCell) {\n              if (line.contains(container)) {\n                var subList = util.isList(line.lastElementChild);\n                var newCell = null;\n\n                if (!isEdge) {\n                  newCell = line.cloneNode(false);\n                  newCell.appendChild(afterNode.textContent.trim() ? afterNode : util.createTextNode(util.zeroWidthSpace));\n                }\n\n                if (subList) {\n                  if (!newCell) {\n                    newCell = line.cloneNode(false);\n                    newCell.appendChild(util.createTextNode(util.zeroWidthSpace));\n                  }\n\n                  newCell.appendChild(line.lastElementChild);\n                }\n\n                if (newCell) {\n                  line.parentNode.insertBefore(newCell, line.nextElementSibling);\n                  tempAfterNode = afterNode = newCell;\n                }\n              }\n            } else {\n              afterNode = afterNode.previousSibling;\n            }\n          }\n        }\n      }\n\n      range = !afterNode && !isFormats ? this.getRange_addLine(this.getRange(), null) : this.getRange();\n      var commonCon = range.commonAncestorContainer;\n      var startOff = range.startOffset;\n      var endOff = range.endOffset;\n      var formatRange = range.startContainer === commonCon && util.isFormatElement(commonCon);\n      var startCon = formatRange ? commonCon.childNodes[startOff] || commonCon.childNodes[0] || range.startContainer : range.startContainer;\n      var endCon = formatRange ? commonCon.childNodes[endOff] || commonCon.childNodes[commonCon.childNodes.length - 1] || range.endContainer : range.endContainer;\n\n      if (!insertListCell) {\n        if (!afterNode) {\n          parentNode = startCon;\n\n          if (startCon.nodeType === 3) {\n            parentNode = startCon.parentNode;\n          }\n          /** No Select range node */\n\n\n          if (range.collapsed) {\n            if (commonCon.nodeType === 3) {\n              if (commonCon.textContent.length > endOff) afterNode = commonCon.splitText(endOff);else afterNode = commonCon.nextSibling;\n            } else {\n              if (!util.isBreak(parentNode)) {\n                var c = parentNode.childNodes[startOff];\n                var focusNode = c && c.nodeType === 3 && util.onlyZeroWidthSpace(c) && util.isBreak(c.nextSibling) ? c.nextSibling : c;\n\n                if (focusNode) {\n                  if (!focusNode.nextSibling) {\n                    parentNode.removeChild(focusNode);\n                    afterNode = null;\n                  } else {\n                    afterNode = util.isBreak(focusNode) && !util.isBreak(oNode) ? focusNode : focusNode.nextSibling;\n                  }\n                } else {\n                  afterNode = null;\n                }\n              } else {\n                afterNode = parentNode;\n                parentNode = parentNode.parentNode;\n              }\n            }\n          } else {\n            /** Select range nodes */\n            var isSameContainer = startCon === endCon;\n\n            if (isSameContainer) {\n              if (this.isEdgePoint(endCon, endOff)) afterNode = endCon.nextSibling;else afterNode = endCon.splitText(endOff);\n              var removeNode = startCon;\n              if (!this.isEdgePoint(startCon, startOff)) removeNode = startCon.splitText(startOff);\n              parentNode.removeChild(removeNode);\n\n              if (parentNode.childNodes.length === 0 && isFormats) {\n                parentNode.innerHTML = '<br>';\n              }\n            } else {\n              var removedTag = this.removeNode();\n              var _container = removedTag.container;\n              var _prevContainer = removedTag.prevContainer;\n\n              if (_container && _container.childNodes.length === 0 && isFormats) {\n                if (util.isFormatElement(_container)) {\n                  _container.innerHTML = '<br>';\n                } else if (util.isRangeFormatElement(_container)) {\n                  _container.innerHTML = '<' + options.defaultTag + '><br></' + options.defaultTag + '>';\n                }\n              }\n\n              if (util.isListCell(_container) && oNode.nodeType === 3) {\n                parentNode = _container;\n                afterNode = null;\n              } else if (!isFormats && _prevContainer) {\n                parentNode = _prevContainer.nodeType === 3 ? _prevContainer.parentNode : _prevContainer;\n\n                if (parentNode.contains(_container)) {\n                  var _sameParent = true;\n                  afterNode = _container;\n\n                  while (afterNode.parentNode && afterNode.parentNode !== parentNode) {\n                    afterNode = afterNode.parentNode;\n                    _sameParent = false;\n                  }\n\n                  if (_sameParent && _container === _prevContainer) afterNode = afterNode.nextSibling;\n                } else {\n                  afterNode = null;\n                }\n              } else {\n                afterNode = isFormats ? endCon : _container === _prevContainer ? _container.nextSibling : _container;\n                parentNode = !afterNode || !afterNode.parentNode ? commonCon : afterNode.parentNode;\n              }\n\n              while (afterNode && !util.isFormatElement(afterNode) && afterNode.parentNode !== commonCon) {\n                afterNode = afterNode.parentNode;\n              }\n            }\n          }\n        } else {\n          // has afterNode\n          parentNode = afterNode.parentNode;\n          afterNode = afterNode.nextSibling;\n          originAfter = true;\n        }\n      }\n\n      try {\n        // set node\n        if (!insertListCell) {\n          if (util.isWysiwygDiv(afterNode) || parentNode === context.element.wysiwyg.parentNode) {\n            parentNode = context.element.wysiwyg;\n            afterNode = null;\n          }\n\n          if (util.isFormatElement(oNode) || util.isRangeFormatElement(oNode) || !util.isListCell(parentNode) && util.isComponent(oNode)) {\n            var oldParent = parentNode;\n\n            if (util.isList(afterNode)) {\n              parentNode = afterNode;\n              afterNode = null;\n            } else if (util.isListCell(afterNode)) {\n              parentNode = afterNode.previousElementSibling || afterNode;\n            } else if (!originAfter && !afterNode) {\n              var _r = this.removeNode();\n\n              var _container2 = _r.container.nodeType === 3 ? util.isListCell(util.getFormatElement(_r.container, null)) ? _r.container : util.getFormatElement(_r.container, null) || _r.container.parentNode : _r.container;\n\n              var rangeCon = util.isWysiwygDiv(_container2) || util.isRangeFormatElement(_container2);\n              parentNode = rangeCon ? _container2 : _container2.parentNode;\n              afterNode = rangeCon ? null : _container2.nextSibling;\n            }\n\n            if (oldParent.childNodes.length === 0 && parentNode !== oldParent) util.removeItem(oldParent);\n          }\n\n          if (isFormats && !freeFormat && !util.isRangeFormatElement(parentNode) && !util.isListCell(parentNode) && !util.isWysiwygDiv(parentNode)) {\n            afterNode = parentNode.nextElementSibling;\n            parentNode = parentNode.parentNode;\n          }\n\n          if (util.isWysiwygDiv(parentNode) && (oNode.nodeType === 3 || util.isBreak(oNode))) {\n            var fNode = util.createElement(options.defaultTag);\n            fNode.appendChild(oNode);\n            oNode = fNode;\n          }\n        } // insert--\n\n\n        if (insertListCell) {\n          if (!tempParentNode.parentNode) {\n            parentNode = context.element.wysiwyg;\n            afterNode = null;\n          } else {\n            parentNode = tempParentNode;\n            afterNode = tempAfterNode;\n          }\n        } else {\n          afterNode = parentNode === afterNode ? parentNode.lastChild : afterNode;\n        }\n\n        if (util.isListCell(oNode) && !util.isList(parentNode)) {\n          if (util.isListCell(parentNode)) {\n            afterNode = parentNode.nextElementSibling;\n            parentNode = parentNode.parentNode;\n          } else {\n            var ul = util.createElement('ol');\n            parentNode.insertBefore(ul, afterNode);\n            parentNode = ul;\n            afterNode = null;\n          }\n\n          insertListCell = true;\n        }\n\n        parentNode.insertBefore(oNode, afterNode);\n\n        if (insertListCell) {\n          if (util.onlyZeroWidthSpace(line.textContent.trim())) {\n            util.removeItem(line);\n            oNode = oNode.lastChild;\n          } else {\n            var chList = util.getArrayItem(line.children, util.isList);\n\n            if (chList) {\n              if (oNode !== chList) {\n                oNode.appendChild(chList);\n                oNode = chList.previousSibling;\n              } else {\n                parentNode.appendChild(oNode);\n                oNode = parentNode;\n              }\n\n              if (util.onlyZeroWidthSpace(line.textContent.trim())) {\n                util.removeItem(line);\n              }\n            }\n          }\n        }\n      } catch (e) {\n        parentNode.appendChild(oNode);\n      } finally {\n        if ((util.isFormatElement(oNode) || util.isComponent(oNode)) && startCon === endCon) {\n          var cItem = util.getFormatElement(commonCon, null);\n\n          if (cItem && cItem.nodeType === 1 && util.isEmptyLine(cItem)) {\n            util.removeItem(cItem);\n          }\n        }\n\n        if (freeFormat && (util.isFormatElement(oNode) || util.isRangeFormatElement(oNode))) {\n          oNode = this._setIntoFreeFormat(oNode);\n        }\n\n        if (!util.isComponent(oNode)) {\n          var offset = 1;\n\n          if (oNode.nodeType === 3) {\n            var previous = oNode.previousSibling;\n            var next = oNode.nextSibling;\n            var previousText = !previous || previous.nodeType === 1 || util.onlyZeroWidthSpace(previous) ? '' : previous.textContent;\n            var nextText = !next || next.nodeType === 1 || util.onlyZeroWidthSpace(next) ? '' : next.textContent;\n\n            if (previous && previousText.length > 0) {\n              oNode.textContent = previousText + oNode.textContent;\n              util.removeItem(previous);\n            }\n\n            if (next && next.length > 0) {\n              oNode.textContent += nextText;\n              util.removeItem(next);\n            }\n\n            var newRange = {\n              container: oNode,\n              startOffset: previousText.length,\n              endOffset: oNode.textContent.length - nextText.length\n            };\n            this.setRange(oNode, newRange.startOffset, oNode, newRange.endOffset);\n            return newRange;\n          } else if (!util.isBreak(oNode) && !util.isListCell(oNode) && util.isFormatElement(parentNode)) {\n            var zeroWidth = null;\n\n            if (!oNode.previousSibling || util.isBreak(oNode.previousSibling)) {\n              zeroWidth = util.createTextNode(util.zeroWidthSpace);\n              oNode.parentNode.insertBefore(zeroWidth, oNode);\n            }\n\n            if (!oNode.nextSibling || util.isBreak(oNode.nextSibling)) {\n              zeroWidth = util.createTextNode(util.zeroWidthSpace);\n              oNode.parentNode.insertBefore(zeroWidth, oNode.nextSibling);\n            }\n\n            if (util._isIgnoreNodeChange(oNode)) {\n              oNode = oNode.nextSibling;\n              offset = 0;\n            }\n          }\n\n          this.setRange(oNode, offset, oNode, offset);\n        } // history stack\n\n\n        this.history.push(true);\n        return oNode;\n      }\n    },\n    _setIntoFreeFormat: function _setIntoFreeFormat(oNode) {\n      var parentNode = oNode.parentNode;\n      var oNodeChildren, lastONode;\n\n      while (util.isFormatElement(oNode) || util.isRangeFormatElement(oNode)) {\n        oNodeChildren = oNode.childNodes;\n        lastONode = null;\n\n        while (oNodeChildren[0]) {\n          lastONode = oNodeChildren[0];\n\n          if (util.isFormatElement(lastONode) || util.isRangeFormatElement(lastONode)) {\n            this._setIntoFreeFormat(lastONode);\n\n            if (!oNode.parentNode) break;\n            oNodeChildren = oNode.childNodes;\n            continue;\n          }\n\n          parentNode.insertBefore(lastONode, oNode);\n        }\n\n        if (oNode.childNodes.length === 0) util.removeItem(oNode);\n        oNode = util.createElement('BR');\n        parentNode.insertBefore(oNode, lastONode.nextSibling);\n      }\n\n      return oNode;\n    },\n\n    /**\r\n     * @description Delete the currently selected nodes and reset selection range\r\n     * Returns {container: \"the last element after deletion\", offset: \"offset\", prevContainer: \"previousElementSibling Of the deleted area\"}\r\n     * @returns {Object}\r\n     */\n    removeNode: function removeNode() {\n      this._resetRangeToTextNode();\n\n      var range = this.getRange();\n      var container,\n          offset = 0;\n      var startCon = range.startContainer;\n      var endCon = range.endContainer;\n      var startOff = range.startOffset;\n      var endOff = range.endOffset;\n      var commonCon = range.commonAncestorContainer.nodeType === 3 && range.commonAncestorContainer.parentNode === startCon.parentNode ? startCon.parentNode : range.commonAncestorContainer;\n\n      if (commonCon === startCon && commonCon === endCon) {\n        startCon = commonCon.children[startOff];\n        endCon = commonCon.children[endOff];\n        startOff = endOff = 0;\n      }\n\n      var beforeNode = null;\n      var afterNode = null;\n      var childNodes = util.getListChildNodes(commonCon, null);\n      var startIndex = util.getArrayIndex(childNodes, startCon);\n      var endIndex = util.getArrayIndex(childNodes, endCon);\n\n      if (childNodes.length > 0 && startIndex > -1 && endIndex > -1) {\n        for (var i = startIndex + 1, startNode = startCon; i >= 0; i--) {\n          if (childNodes[i] === startNode.parentNode && childNodes[i].firstChild === startNode && startOff === 0) {\n            startIndex = i;\n            startNode = startNode.parentNode;\n          }\n        }\n\n        for (var _i2 = endIndex - 1, endNode = endCon; _i2 > startIndex; _i2--) {\n          if (childNodes[_i2] === endNode.parentNode && childNodes[_i2].nodeType === 1) {\n            childNodes.splice(_i2, 1);\n            endNode = endNode.parentNode;\n            --endIndex;\n          }\n        }\n      } else {\n        if (childNodes.length === 0) {\n          if (util.isFormatElement(commonCon) || util.isRangeFormatElement(commonCon) || util.isWysiwygDiv(commonCon) || util.isBreak(commonCon) || util.isMedia(commonCon)) {\n            return {\n              container: commonCon,\n              offset: 0\n            };\n          } else if (commonCon.nodeType === 3) {\n            return {\n              container: commonCon,\n              offset: endOff\n            };\n          }\n\n          childNodes.push(commonCon);\n          startCon = endCon = commonCon;\n        } else {\n          startCon = endCon = childNodes[0];\n\n          if (util.isBreak(startCon) || util.onlyZeroWidthSpace(startCon)) {\n            return {\n              container: util.isMedia(commonCon) ? commonCon : startCon,\n              offset: 0\n            };\n          }\n        }\n\n        startIndex = endIndex = 0;\n      }\n\n      for (var _i3 = startIndex; _i3 <= endIndex; _i3++) {\n        var item = childNodes[_i3];\n\n        if (item.length === 0 || item.nodeType === 3 && item.data === undefined) {\n          this._nodeRemoveListItem(item);\n\n          continue;\n        }\n\n        if (item === startCon) {\n          if (startCon.nodeType === 1) {\n            if (util.isComponent(startCon)) continue;else beforeNode = util.createTextNode(startCon.textContent);\n          } else {\n            if (item === endCon) {\n              beforeNode = util.createTextNode(startCon.substringData(0, startOff) + endCon.substringData(endOff, endCon.length - endOff));\n              offset = startOff;\n            } else {\n              beforeNode = util.createTextNode(startCon.substringData(0, startOff));\n            }\n          }\n\n          if (beforeNode.length > 0) {\n            startCon.data = beforeNode.data;\n          } else {\n            this._nodeRemoveListItem(startCon);\n          }\n\n          if (item === endCon) break;\n          continue;\n        }\n\n        if (item === endCon) {\n          if (endCon.nodeType === 1) {\n            if (util.isComponent(endCon)) continue;else afterNode = util.createTextNode(endCon.textContent);\n          } else {\n            afterNode = util.createTextNode(endCon.substringData(endOff, endCon.length - endOff));\n          }\n\n          if (afterNode.length > 0) {\n            endCon.data = afterNode.data;\n          } else {\n            this._nodeRemoveListItem(endCon);\n          }\n\n          continue;\n        }\n\n        this._nodeRemoveListItem(item);\n      }\n\n      var endUl = util.getParentElement(endCon, 'ul');\n      var startLi = util.getParentElement(startCon, 'li');\n\n      if (endUl && startLi && startLi.contains(endUl)) {\n        container = endUl.previousSibling;\n        offset = container.textContent.length;\n      } else {\n        container = endCon && endCon.parentNode ? endCon : startCon && startCon.parentNode ? startCon : range.endContainer || range.startContainer;\n      }\n\n      if (!util.isWysiwygDiv(container) && container.childNodes.length === 0) {\n        var rc = util.removeItemAllParents(container, null, null);\n        if (rc) container = rc.sc || rc.ec || context.element.wysiwyg;\n      } // set range\n\n\n      this.setRange(container, offset, container, offset); // history stack\n\n      this.history.push(true);\n      return {\n        container: container,\n        offset: offset,\n        prevContainer: startCon && startCon.parentNode ? startCon : null\n      };\n    },\n    _nodeRemoveListItem: function _nodeRemoveListItem(item) {\n      var format = util.getFormatElement(item, null);\n      util.removeItem(item);\n      if (!util.isListCell(format)) return;\n      util.removeItemAllParents(format, null, null);\n\n      if (format && util.isList(format.firstChild)) {\n        format.insertBefore(util.createTextNode(util.zeroWidthSpace), format.firstChild);\n      }\n    },\n\n    /**\r\n     * @description Appended all selected format Element to the argument element and insert\r\n     * @param {Element} rangeElement Element of wrap the arguments (BLOCKQUOTE...)\r\n     */\n    applyRangeFormatElement: function applyRangeFormatElement(rangeElement) {\n      this.getRange_addLine(this.getRange(), null);\n      var rangeLines = this.getSelectedElementsAndComponents(false);\n      if (!rangeLines || rangeLines.length === 0) return;\n\n      linesLoop: for (var i = 0, len = rangeLines.length, line, nested, fEl, lEl, f, l; i < len; i++) {\n        line = rangeLines[i];\n        if (!util.isListCell(line)) continue;\n        nested = line.lastElementChild;\n\n        if (nested && util.isListCell(line.nextElementSibling) && rangeLines.indexOf(line.nextElementSibling) > -1) {\n          lEl = nested.lastElementChild;\n\n          if (rangeLines.indexOf(lEl) > -1) {\n            var list = null;\n\n            while (list = lEl.lastElementChild) {\n              if (util.isList(list)) {\n                if (rangeLines.indexOf(list.lastElementChild) > -1) {\n                  lEl = list.lastElementChild;\n                } else {\n                  continue linesLoop;\n                }\n              }\n            }\n\n            fEl = nested.firstElementChild;\n            f = rangeLines.indexOf(fEl);\n            l = rangeLines.indexOf(lEl);\n            rangeLines.splice(f, l - f + 1);\n            len = rangeLines.length;\n            continue;\n          }\n        }\n      }\n\n      var last = rangeLines[rangeLines.length - 1];\n      var standTag, beforeTag, pElement;\n\n      if (util.isRangeFormatElement(last) || util.isFormatElement(last)) {\n        standTag = last;\n      } else {\n        standTag = util.getRangeFormatElement(last, null) || util.getFormatElement(last, null);\n      }\n\n      if (util.isCell(standTag)) {\n        beforeTag = null;\n        pElement = standTag;\n      } else {\n        beforeTag = standTag.nextSibling;\n        pElement = standTag.parentNode;\n      }\n\n      var parentDepth = util.getElementDepth(standTag);\n      var listParent = null;\n      var lineArr = [];\n\n      var removeItems = function removeItems(parent, origin, before) {\n        var cc = null;\n\n        if (parent !== origin && !util.isTable(origin)) {\n          if (origin && util.getElementDepth(parent) === util.getElementDepth(origin)) return before;\n          cc = util.removeItemAllParents(origin, null, parent);\n        }\n\n        return cc ? cc.ec : before;\n      };\n\n      for (var _i4 = 0, _len = rangeLines.length, _line, originParent, depth, before, nextLine, nextList, _nested; _i4 < _len; _i4++) {\n        _line = rangeLines[_i4];\n        originParent = _line.parentNode;\n        if (!originParent || rangeElement.contains(originParent)) continue;\n        depth = util.getElementDepth(_line);\n\n        if (util.isList(originParent)) {\n          if (listParent === null) {\n            if (nextList) {\n              listParent = nextList;\n              _nested = true;\n              nextList = null;\n            } else {\n              listParent = originParent.cloneNode(false);\n            }\n          }\n\n          lineArr.push(_line);\n          nextLine = rangeLines[_i4 + 1];\n\n          if (_i4 === _len - 1 || nextLine && nextLine.parentNode !== originParent) {\n            // nested list\n            if (nextLine && _line.contains(nextLine.parentNode)) {\n              nextList = nextLine.parentNode.cloneNode(false);\n            }\n\n            var _list = originParent.parentNode,\n                p = void 0;\n\n            while (util.isList(_list)) {\n              p = util.createElement(_list.nodeName);\n              p.appendChild(listParent);\n              listParent = p;\n              _list = _list.parentNode;\n            }\n\n            var _edge = this.detachRangeFormatElement(originParent, lineArr, null, true, true);\n\n            if (parentDepth >= depth) {\n              parentDepth = depth;\n              pElement = _edge.cc;\n              beforeTag = removeItems(pElement, originParent, _edge.ec);\n              if (beforeTag) pElement = beforeTag.parentNode;\n            } else if (pElement === _edge.cc) {\n              beforeTag = _edge.ec;\n            }\n\n            if (pElement !== _edge.cc) {\n              before = removeItems(pElement, _edge.cc, before);\n              if (before !== undefined) beforeTag = before;else beforeTag = _edge.cc;\n            }\n\n            for (var c = 0, cLen = _edge.removeArray.length; c < cLen; c++) {\n              listParent.appendChild(_edge.removeArray[c]);\n            }\n\n            if (!_nested) rangeElement.appendChild(listParent);\n            if (nextList) _edge.removeArray[_edge.removeArray.length - 1].appendChild(nextList);\n            listParent = null;\n            _nested = false;\n          }\n        } else {\n          if (parentDepth >= depth) {\n            parentDepth = depth;\n            pElement = originParent;\n            beforeTag = _line.nextSibling;\n          }\n\n          rangeElement.appendChild(_line);\n\n          if (pElement !== originParent) {\n            before = removeItems(pElement, originParent);\n            if (before !== undefined) beforeTag = before;\n          }\n        }\n      }\n\n      this.effectNode = null;\n      util.mergeSameTags(rangeElement, null, false);\n      util.mergeNestedTags(rangeElement, function (current) {\n        return this.isList(current);\n      }.bind(util)); // Nested list\n\n      if (beforeTag && util.getElementDepth(beforeTag) > 0 && (util.isList(beforeTag.parentNode) || util.isList(beforeTag.parentNode.parentNode))) {\n        var depthFormat = util.getParentElement(beforeTag, function (current) {\n          return this.isRangeFormatElement(current) && !this.isList(current);\n        }.bind(util));\n        var splitRange = util.splitElement(beforeTag, null, !depthFormat ? 0 : util.getElementDepth(depthFormat) + 1);\n        splitRange.parentNode.insertBefore(rangeElement, splitRange);\n      } else {\n        // basic\n        pElement.insertBefore(rangeElement, beforeTag);\n        removeItems(rangeElement, beforeTag);\n      }\n\n      var edge = util.getEdgeChildNodes(rangeElement.firstElementChild, rangeElement.lastElementChild);\n\n      if (rangeLines.length > 1) {\n        this.setRange(edge.sc, 0, edge.ec, edge.ec.textContent.length);\n      } else {\n        this.setRange(edge.ec, edge.ec.textContent.length, edge.ec, edge.ec.textContent.length);\n      } // history stack\n\n\n      this.history.push(false);\n    },\n\n    /**\r\n     * @description The elements of the \"selectedFormats\" array are detached from the \"rangeElement\" element. (\"LI\" tags are converted to \"P\" tags)\r\n     * When \"selectedFormats\" is null, all elements are detached and return {cc: parentNode, sc: nextSibling, ec: previousSibling, removeArray: [Array of removed elements]}.\r\n     * @param {Element} rangeElement Range format element (PRE, BLOCKQUOTE, OL, UL...)\r\n     * @param {Array|null} selectedFormats Array of format elements (P, DIV, LI...) to remove.\r\n     * If null, Applies to all elements and return {cc: parentNode, sc: nextSibling, ec: previousSibling}\r\n     * @param {Element|null} newRangeElement The node(rangeElement) to replace the currently wrapped node.\r\n     * @param {Boolean} remove If true, deleted without detached.\r\n     * @param {Boolean} notHistoryPush When true, it does not update the history stack and the selection object and return EdgeNodes (util.getEdgeChildNodes)\r\n     * @returns {Object}\r\n     */\n    detachRangeFormatElement: function detachRangeFormatElement(rangeElement, selectedFormats, newRangeElement, remove, notHistoryPush) {\n      var range = this.getRange();\n      var so = range.startOffset;\n      var eo = range.endOffset;\n      var children = util.getListChildNodes(rangeElement, function (current) {\n        return current.parentNode === rangeElement;\n      });\n      var parent = rangeElement.parentNode;\n      var firstNode = null;\n      var lastNode = null;\n      var rangeEl = rangeElement.cloneNode(false);\n      var removeArray = [];\n      var newList = util.isList(newRangeElement);\n      var insertedNew = false;\n      var reset = false;\n      var moveComplete = false;\n\n      function appendNode(parent, insNode, sibling, originNode) {\n        if (util.onlyZeroWidthSpace(insNode)) insNode.innerHTML = util.zeroWidthSpace;\n\n        if (insNode.nodeType === 3) {\n          parent.insertBefore(insNode, sibling);\n          return insNode;\n        }\n\n        var insChildren = (moveComplete ? insNode : originNode).childNodes;\n        var format = insNode.cloneNode(false);\n        var first = null;\n        var c = null;\n\n        while (insChildren[0]) {\n          c = insChildren[0];\n\n          if (util._notTextNode(c) && !util.isBreak(c) && !util.isListCell(format)) {\n            if (format.childNodes.length > 0) {\n              if (!first) first = format;\n              parent.insertBefore(format, sibling);\n              format = insNode.cloneNode(false);\n            }\n\n            parent.insertBefore(c, sibling);\n            if (!first) first = c;\n          } else {\n            format.appendChild(c);\n          }\n        }\n\n        if (format.childNodes.length > 0) {\n          if (util.isListCell(parent) && util.isListCell(format) && util.isList(sibling)) {\n            if (newList) {\n              first = sibling;\n\n              while (sibling) {\n                format.appendChild(sibling);\n                sibling = sibling.nextSibling;\n              }\n\n              parent.parentNode.insertBefore(format, parent.nextElementSibling);\n            } else {\n              var originNext = originNode.nextElementSibling;\n              var detachRange = util.detachNestedList(originNode, false);\n\n              if (rangeElement !== detachRange || originNext !== originNode.nextElementSibling) {\n                var fChildren = format.childNodes;\n\n                while (fChildren[0]) {\n                  originNode.appendChild(fChildren[0]);\n                }\n\n                rangeElement = detachRange;\n                reset = true;\n              }\n            }\n          } else {\n            parent.insertBefore(format, sibling);\n          }\n\n          if (!first) first = format;\n        }\n\n        return first;\n      } // detach loop\n\n\n      for (var i = 0, len = children.length, insNode, lineIndex, next; i < len; i++) {\n        insNode = children[i];\n        if (insNode.nodeType === 3 && util.isList(rangeEl)) continue;\n        moveComplete = false;\n\n        if (remove && i === 0) {\n          if (!selectedFormats || selectedFormats.length === len || selectedFormats[0] === insNode) {\n            firstNode = rangeElement.previousSibling;\n          } else {\n            firstNode = rangeEl;\n          }\n        }\n\n        if (selectedFormats) lineIndex = selectedFormats.indexOf(insNode);\n\n        if (selectedFormats && lineIndex === -1) {\n          if (!rangeEl) rangeEl = rangeElement.cloneNode(false);\n          rangeEl.appendChild(insNode);\n        } else {\n          if (selectedFormats) next = selectedFormats[lineIndex + 1];\n\n          if (rangeEl && rangeEl.children.length > 0) {\n            parent.insertBefore(rangeEl, rangeElement);\n            rangeEl = null;\n          }\n\n          if (!newList && util.isListCell(insNode)) {\n            if (next && util.getElementDepth(insNode) !== util.getElementDepth(next) && (util.isListCell(parent) || util.getArrayItem(insNode.children, util.isList, false))) {\n              var insNext = insNode.nextElementSibling;\n              var detachRange = util.detachNestedList(insNode, false);\n\n              if (rangeElement !== detachRange || insNext !== insNode.nextElementSibling) {\n                rangeElement = detachRange;\n                reset = true;\n              }\n            } else {\n              var inner = insNode;\n              insNode = util.createElement(remove ? inner.nodeName : util.isList(rangeElement.parentNode) || util.isListCell(rangeElement.parentNode) ? 'LI' : util.isCell(rangeElement.parentNode) ? 'DIV' : options.defaultTag);\n              var isCell = util.isListCell(insNode);\n              var innerChildren = inner.childNodes;\n\n              while (innerChildren[0]) {\n                if (util.isList(innerChildren[0]) && !isCell) break;\n                insNode.appendChild(innerChildren[0]);\n              }\n\n              util.copyFormatAttributes(insNode, inner);\n              moveComplete = true;\n            }\n          } else {\n            insNode = insNode.cloneNode(false);\n          }\n\n          if (!reset) {\n            if (!remove) {\n              if (newRangeElement) {\n                if (!insertedNew) {\n                  parent.insertBefore(newRangeElement, rangeElement);\n                  insertedNew = true;\n                }\n\n                insNode = appendNode(newRangeElement, insNode, null, children[i]);\n              } else {\n                insNode = appendNode(parent, insNode, rangeElement, children[i]);\n              }\n\n              if (!reset) {\n                if (selectedFormats) {\n                  lastNode = insNode;\n\n                  if (!firstNode) {\n                    firstNode = insNode;\n                  }\n                } else if (!firstNode) {\n                  firstNode = lastNode = insNode;\n                }\n              }\n            } else {\n              removeArray.push(insNode);\n              util.removeItem(children[i]);\n            }\n\n            if (reset) {\n              reset = moveComplete = false;\n              children = util.getListChildNodes(rangeElement, function (current) {\n                return current.parentNode === rangeElement;\n              });\n              rangeEl = rangeElement.cloneNode(false);\n              parent = rangeElement.parentNode;\n              i = -1;\n              len = children.length;\n              continue;\n            }\n          }\n        }\n      }\n\n      var rangeParent = rangeElement.parentNode;\n      var rangeRight = rangeElement.nextSibling;\n\n      if (rangeEl && rangeEl.children.length > 0) {\n        rangeParent.insertBefore(rangeEl, rangeRight);\n      }\n\n      if (newRangeElement) firstNode = newRangeElement.previousSibling;else if (!firstNode) firstNode = rangeElement.previousSibling;\n      rangeRight = rangeElement.nextSibling !== rangeEl ? rangeElement.nextSibling : rangeEl ? rangeEl.nextSibling : null;\n\n      if (rangeElement.children.length === 0 || rangeElement.textContent.length === 0) {\n        util.removeItem(rangeElement);\n      } else {\n        util.removeEmptyNode(rangeElement, null);\n      }\n\n      var edge = null;\n\n      if (remove) {\n        edge = {\n          cc: rangeParent,\n          sc: firstNode,\n          ec: rangeRight,\n          removeArray: removeArray\n        };\n      } else {\n        if (!firstNode) firstNode = lastNode;\n        if (!lastNode) lastNode = firstNode;\n        var childEdge = util.getEdgeChildNodes(firstNode, lastNode.parentNode ? firstNode : lastNode);\n        edge = {\n          cc: (childEdge.sc || childEdge.ec).parentNode,\n          sc: childEdge.sc,\n          ec: childEdge.ec\n        };\n      }\n\n      this.effectNode = null;\n      if (notHistoryPush) return edge;\n\n      if (!remove && edge) {\n        if (!selectedFormats) {\n          this.setRange(edge.sc, 0, edge.sc, 0);\n        } else {\n          this.setRange(edge.sc, so, edge.ec, eo);\n        }\n      } // history stack\n\n\n      this.history.push(false);\n    },\n\n    /**\r\n     * @description \"selectedFormats\" array are detached from the list element.\r\n     * The return value is applied when the first and last lines of \"selectedFormats\" are \"LI\" respectively.\r\n     * @param {Array} selectedFormats Array of format elements (LI, P...) to remove.\r\n     * @param {Boolean} remove If true, deleted without detached.\r\n     * @returns {Object} {sc: <LI>, ec: <LI>}.\r\n     */\n    detachList: function detachList(selectedFormats, remove) {\n      var rangeArr = {};\n      var listFirst = false;\n      var listLast = false;\n      var first = null;\n      var last = null;\n\n      var passComponent = function (current) {\n        return !this.isComponent(current);\n      }.bind(util);\n\n      for (var i = 0, len = selectedFormats.length, r, o, lastIndex, isList; i < len; i++) {\n        lastIndex = i === len - 1;\n        o = util.getRangeFormatElement(selectedFormats[i], passComponent);\n        isList = util.isList(o);\n\n        if (!r && isList) {\n          r = o;\n          rangeArr = {\n            r: r,\n            f: [util.getParentElement(selectedFormats[i], 'LI')]\n          };\n          if (i === 0) listFirst = true;\n        } else if (r && isList) {\n          if (r !== o) {\n            var edge = this.detachRangeFormatElement(rangeArr.f[0].parentNode, rangeArr.f, null, remove, true);\n            o = selectedFormats[i].parentNode;\n\n            if (listFirst) {\n              first = edge.sc;\n              listFirst = false;\n            }\n\n            if (lastIndex) last = edge.ec;\n\n            if (isList) {\n              r = o;\n              rangeArr = {\n                r: r,\n                f: [util.getParentElement(selectedFormats[i], 'LI')]\n              };\n              if (lastIndex) listLast = true;\n            } else {\n              r = null;\n            }\n          } else {\n            rangeArr.f.push(util.getParentElement(selectedFormats[i], 'LI'));\n            if (lastIndex) listLast = true;\n          }\n        }\n\n        if (lastIndex && util.isList(r)) {\n          var _edge2 = this.detachRangeFormatElement(rangeArr.f[0].parentNode, rangeArr.f, null, remove, true);\n\n          if (listLast || len === 1) last = _edge2.ec;\n          if (listFirst) first = _edge2.sc || last;\n        }\n      }\n\n      return {\n        sc: first,\n        ec: last\n      };\n    },\n\n    /**\r\n     * @description Add, update, and delete nodes from selected text.\r\n     * 1. If there is a node in the \"appendNode\" argument, a node with the same tags and attributes as \"appendNode\" is added to the selection text.\r\n     * 2. If it is in the same tag, only the tag's attributes are changed without adding a tag.\r\n     * 3. If the \"appendNode\" argument is null, the node of the selection is update or remove without adding a new node.\r\n     * 4. The same style as the style attribute of the \"styleArray\" argument is deleted.\r\n     *    (Styles should be put with attribute names from css. [\"background-color\"])\r\n     * 5. The same class name as the class attribute of the \"styleArray\" argument is deleted.\r\n     *    (The class name is preceded by \".\" [\".className\"])\r\n     * 6. Use a list of styles and classes of \"appendNode\" in \"styleArray\" to avoid duplicate property values.\r\n     * 7. If a node with all styles and classes removed has the same tag name as \"appendNode\" or \"removeNodeArray\", or \"appendNode\" is null, that node is deleted.\r\n     * 8. Regardless of the style and class of the node, the tag with the same name as the \"removeNodeArray\" argument value is deleted.\r\n     * 9. If the \"strictRemove\" argument is true, only nodes with all styles and classes removed from the nodes of \"removeNodeArray\" are removed.\r\n     *10. It won't work if the parent node has the same class and same value style.\r\n     *    However, if there is a value in \"removeNodeArray\", it works and the text node is separated even if there is no node to replace.\r\n     * @param {Element|null} appendNode The element to be added to the selection. If it is null, only delete the node.\r\n     * @param {Array|null} styleArray The style or className attribute name Array to check (['font-size'], ['.className'], ['font-family', 'color', '.className']...])\r\n     * @param {Array|null} removeNodeArray An array of node names to remove types from, remove all formats when \"appendNode\" is null and there is an empty array or null value. (['span'], ['strong', 'em'] ...])\r\n     * @param {Boolean|null} strictRemove If true, only nodes with all styles and classes removed from the nodes of \"removeNodeArray\" are removed.\r\n     */\n    nodeChange: function nodeChange(appendNode, styleArray, removeNodeArray, strictRemove) {\n      this._resetRangeToTextNode();\n\n      var range = this.getRange_addLine(this.getRange(), null);\n      styleArray = styleArray && styleArray.length > 0 ? styleArray : false;\n      removeNodeArray = removeNodeArray && removeNodeArray.length > 0 ? removeNodeArray : false;\n      var isRemoveNode = !appendNode;\n      var isRemoveFormat = isRemoveNode && !removeNodeArray && !styleArray;\n      var startCon = range.startContainer;\n      var startOff = range.startOffset;\n      var endCon = range.endContainer;\n      var endOff = range.endOffset;\n\n      if (isRemoveFormat && range.collapsed && util.isFormatElement(startCon.parentNode) || startCon === endCon && startCon.nodeType === 1 && util.isNonEditable(startCon)) {\n        var format = startCon.parentNode;\n        if (!util.isListCell(format) || !util.getValues(format.style).some(function (k) {\n          return this._listKebab.indexOf(k) > -1;\n        }.bind(this))) return;\n      }\n\n      if (range.collapsed && !isRemoveFormat) {\n        if (startCon.nodeType === 1 && !util.isBreak(startCon) && !util.isComponent(startCon)) {\n          var afterNode = null;\n          var focusNode = startCon.childNodes[startOff];\n\n          if (focusNode) {\n            if (!focusNode.nextSibling) {\n              afterNode = null;\n            } else {\n              afterNode = util.isBreak(focusNode) ? focusNode : focusNode.nextSibling;\n            }\n          }\n\n          var zeroWidth = util.createTextNode(util.zeroWidthSpace);\n          startCon.insertBefore(zeroWidth, afterNode);\n          this.setRange(zeroWidth, 1, zeroWidth, 1);\n          range = this.getRange();\n          startCon = range.startContainer;\n          startOff = range.startOffset;\n          endCon = range.endContainer;\n          endOff = range.endOffset;\n        }\n      }\n\n      if (util.isFormatElement(startCon)) {\n        startCon = startCon.childNodes[startOff] || startCon.firstChild;\n        startOff = 0;\n      }\n\n      if (util.isFormatElement(endCon)) {\n        endCon = endCon.childNodes[endOff] || endCon.lastChild;\n        endOff = endCon.textContent.length;\n      }\n\n      if (isRemoveNode) {\n        appendNode = util.createElement('DIV');\n      }\n\n      var wRegExp = _w.RegExp;\n      var newNodeName = appendNode.nodeName;\n      /* checked same style property */\n\n      if (!isRemoveFormat && startCon === endCon && !removeNodeArray && appendNode) {\n        var sNode = startCon;\n        var checkCnt = 0;\n        var checkAttrs = [];\n        var checkStyles = appendNode.style;\n\n        for (var i = 0, len = checkStyles.length; i < len; i++) {\n          checkAttrs.push(checkStyles[i]);\n        }\n\n        var ckeckClasses = appendNode.classList;\n\n        for (var _i5 = 0, _len2 = ckeckClasses.length; _i5 < _len2; _i5++) {\n          checkAttrs.push('.' + ckeckClasses[_i5]);\n        }\n\n        if (checkAttrs.length > 0) {\n          while (!util.isFormatElement(sNode) && !util.isWysiwygDiv(sNode)) {\n            for (var _i6 = 0; _i6 < checkAttrs.length; _i6++) {\n              if (sNode.nodeType === 1) {\n                var s = checkAttrs[_i6];\n                var classReg = /^\\./.test(s) ? new wRegExp('\\\\s*' + s.replace(/^\\./, '') + '(\\\\s+|$)', 'ig') : false;\n                var styleCheck = isRemoveNode ? !!sNode.style[s] : !!sNode.style[s] && !!appendNode.style[s] && sNode.style[s] === appendNode.style[s];\n                var classCheck = classReg === false ? false : isRemoveNode ? !!sNode.className.match(classReg) : !!sNode.className.match(classReg) && !!appendNode.className.match(classReg);\n\n                if (styleCheck || classCheck) {\n                  checkCnt++;\n                }\n              }\n            }\n\n            sNode = sNode.parentNode;\n          }\n\n          if (checkCnt >= checkAttrs.length) return;\n        }\n      }\n\n      var start = {},\n          end = {};\n      var newNode,\n          styleRegExp = '',\n          classRegExp = '',\n          removeNodeRegExp = '';\n\n      if (styleArray) {\n        for (var _i7 = 0, _len3 = styleArray.length, _s; _i7 < _len3; _i7++) {\n          _s = styleArray[_i7];\n\n          if (/^\\./.test(_s)) {\n            classRegExp += (classRegExp ? '|' : '\\\\s*(?:') + _s.replace(/^\\./, '');\n          } else {\n            styleRegExp += (styleRegExp ? '|' : '(?:;|^|\\\\s)(?:') + _s;\n          }\n        }\n\n        if (styleRegExp) {\n          styleRegExp += ')\\\\s*:[^;]*\\\\s*(?:;|$)';\n          styleRegExp = new wRegExp(styleRegExp, 'ig');\n        }\n\n        if (classRegExp) {\n          classRegExp += ')(?=\\\\s+|$)';\n          classRegExp = new wRegExp(classRegExp, 'ig');\n        }\n      }\n\n      if (removeNodeArray) {\n        removeNodeRegExp = '^(?:' + removeNodeArray[0];\n\n        for (var _i8 = 1; _i8 < removeNodeArray.length; _i8++) {\n          removeNodeRegExp += '|' + removeNodeArray[_i8];\n        }\n\n        removeNodeRegExp += ')$';\n        removeNodeRegExp = new wRegExp(removeNodeRegExp, 'i');\n      }\n      /** validation check function*/\n\n\n      var wBoolean = _w.Boolean;\n      var _removeCheck = {\n        v: false\n      };\n\n      var validation = function validation(checkNode) {\n        var vNode = checkNode.cloneNode(false); // all path\n\n        if (vNode.nodeType === 3 || util.isBreak(vNode)) return vNode; // all remove\n\n        if (isRemoveFormat) return null; // remove node check\n\n        var tagRemove = !removeNodeRegExp && isRemoveNode || removeNodeRegExp && removeNodeRegExp.test(vNode.nodeName); // tag remove\n\n        if (tagRemove && !strictRemove) {\n          _removeCheck.v = true;\n          return null;\n        } // style regexp\n\n\n        var originStyle = vNode.style.cssText;\n        var style = '';\n\n        if (styleRegExp && originStyle.length > 0) {\n          style = originStyle.replace(styleRegExp, '').trim();\n          if (style !== originStyle) _removeCheck.v = true;\n        } // class check\n\n\n        var originClasses = vNode.className;\n        var classes = '';\n\n        if (classRegExp && originClasses.length > 0) {\n          classes = originClasses.replace(classRegExp, '').trim();\n          if (classes !== originClasses) _removeCheck.v = true;\n        } // remove only\n\n\n        if (isRemoveNode) {\n          if ((classRegExp || !originClasses) && (styleRegExp || !originStyle) && !style && !classes && tagRemove) {\n            _removeCheck.v = true;\n            return null;\n          }\n        } // change\n\n\n        if (style || classes || vNode.nodeName !== newNodeName || wBoolean(styleRegExp) !== wBoolean(originStyle) || wBoolean(classRegExp) !== wBoolean(originClasses)) {\n          if (styleRegExp && originStyle.length > 0) vNode.style.cssText = style;\n\n          if (!vNode.style.cssText) {\n            vNode.removeAttribute('style');\n          }\n\n          if (classRegExp && originClasses.length > 0) vNode.className = classes.trim();\n\n          if (!vNode.className.trim()) {\n            vNode.removeAttribute('class');\n          }\n\n          if (!vNode.style.cssText && !vNode.className && (vNode.nodeName === newNodeName || tagRemove)) {\n            _removeCheck.v = true;\n            return null;\n          }\n\n          return vNode;\n        }\n\n        _removeCheck.v = true;\n        return null;\n      }; // get line nodes\n\n\n      var lineNodes = this.getSelectedElements(null);\n      range = this.getRange();\n      startCon = range.startContainer;\n      startOff = range.startOffset;\n      endCon = range.endContainer;\n      endOff = range.endOffset;\n\n      if (!util.getFormatElement(startCon, null)) {\n        startCon = util.getChildElement(lineNodes[0], function (current) {\n          return current.nodeType === 3;\n        }, false);\n        startOff = 0;\n      }\n\n      if (!util.getFormatElement(endCon, null)) {\n        endCon = util.getChildElement(lineNodes[lineNodes.length - 1], function (current) {\n          return current.nodeType === 3;\n        }, false);\n        endOff = endCon.textContent.length;\n      }\n\n      var oneLine = util.getFormatElement(startCon, null) === util.getFormatElement(endCon, null);\n      var endLength = lineNodes.length - (oneLine ? 0 : 1); // node Changes\n\n      newNode = appendNode.cloneNode(false);\n\n      var isRemoveAnchor = isRemoveFormat || isRemoveNode && function (arr) {\n        for (var n = 0, _len4 = arr.length; n < _len4; n++) {\n          if (util._isMaintainedNode(arr[n]) || util._isSizeNode(arr[n])) return true;\n        }\n\n        return false;\n      }(removeNodeArray);\n\n      var isSizeNode = isRemoveNode || util._isSizeNode(newNode);\n\n      var _getMaintainedNode = this._util_getMaintainedNode.bind(util, isRemoveAnchor, isSizeNode);\n\n      var _isMaintainedNode = this._util_isMaintainedNode.bind(util, isRemoveAnchor, isSizeNode); // one line\n\n\n      if (oneLine) {\n        if (this._resetCommonListCell(lineNodes[0], styleArray)) range = this.setRange(startCon, startOff, endCon, endOff);\n\n        var newRange = this._nodeChange_oneLine(lineNodes[0], newNode, validation, startCon, startOff, endCon, endOff, isRemoveFormat, isRemoveNode, range.collapsed, _removeCheck, _getMaintainedNode, _isMaintainedNode);\n\n        start.container = newRange.startContainer;\n        start.offset = newRange.startOffset;\n        end.container = newRange.endContainer;\n        end.offset = newRange.endOffset;\n\n        if (start.container === end.container && util.onlyZeroWidthSpace(start.container)) {\n          start.offset = end.offset = 1;\n        }\n\n        this._setCommonListStyle(newRange.ancestor, null);\n      } else {\n        // multi line \n        var appliedCommonList = false;\n        if (endLength > 0 && this._resetCommonListCell(lineNodes[endLength], styleArray)) appliedCommonList = true;\n        if (this._resetCommonListCell(lineNodes[0], styleArray)) appliedCommonList = true;\n        if (appliedCommonList) this.setRange(startCon, startOff, endCon, endOff); // end\n\n        if (endLength > 0) {\n          newNode = appendNode.cloneNode(false);\n          end = this._nodeChange_endLine(lineNodes[endLength], newNode, validation, endCon, endOff, isRemoveFormat, isRemoveNode, _removeCheck, _getMaintainedNode, _isMaintainedNode);\n        } // mid\n\n\n        for (var _i9 = endLength - 1, _newRange; _i9 > 0; _i9--) {\n          this._resetCommonListCell(lineNodes[_i9], styleArray);\n\n          newNode = appendNode.cloneNode(false);\n          _newRange = this._nodeChange_middleLine(lineNodes[_i9], newNode, validation, isRemoveFormat, isRemoveNode, _removeCheck, end.container);\n\n          if (_newRange.endContainer && _newRange.ancestor.contains(_newRange.endContainer)) {\n            end.ancestor = null;\n            end.container = _newRange.endContainer;\n          }\n\n          this._setCommonListStyle(_newRange.ancestor, null);\n        } // start\n\n\n        newNode = appendNode.cloneNode(false);\n        start = this._nodeChange_startLine(lineNodes[0], newNode, validation, startCon, startOff, isRemoveFormat, isRemoveNode, _removeCheck, _getMaintainedNode, _isMaintainedNode, end.container);\n\n        if (start.endContainer) {\n          end.ancestor = null;\n          end.container = start.endContainer;\n        }\n\n        if (endLength <= 0) {\n          end = start;\n        } else if (!end.container) {\n          end.ancestor = null;\n          end.container = start.container;\n          end.offset = start.container.textContent.length;\n        }\n\n        this._setCommonListStyle(start.ancestor, null);\n\n        this._setCommonListStyle(end.ancestor || util.getFormatElement(end.container), null);\n      } // set range\n\n\n      this.controllersOff();\n      this.setRange(start.container, start.offset, end.container, end.offset); // history stack\n\n      this.history.push(false);\n    },\n\n    /**\r\n     * @description Reset common style of list cell\r\n     * @param {Element} el List cell element. <li>\r\n     * @param {Array|null} styleArray Style array\r\n     * @private\r\n     */\n    _resetCommonListCell: function _resetCommonListCell(el, styleArray) {\n      if (!util.isListCell(el)) return;\n      if (!styleArray) styleArray = this._listKebab;\n      var children = util.getArrayItem(el.childNodes, function (current) {\n        return !util.isBreak(current);\n      }, true);\n      var elStyles = el.style;\n      var ec = [],\n          ek = [],\n          elKeys = util.getValues(elStyles);\n\n      for (var i = 0, len = this._listKebab.length; i < len; i++) {\n        if (elKeys.indexOf(this._listKebab[i]) > -1 && styleArray.indexOf(this._listKebab[i]) > -1) {\n          ec.push(this._listCamel[i]);\n          ek.push(this._listKebab[i]);\n        }\n      }\n\n      if (!ec.length) return; // reset cell style---\n\n      var refer = util.createElement('SPAN');\n\n      for (var _i10 = 0, _len5 = ec.length; _i10 < _len5; _i10++) {\n        refer.style[ec[_i10]] = elStyles[ek[_i10]];\n        elStyles.removeProperty(ek[_i10]);\n      }\n\n      var sel = refer.cloneNode(false);\n      var r = null,\n          appliedEl = false;\n\n      var _loop = function _loop(_c, _s2, _i11, _len6) {\n        _c = children[_i11];\n\n        if (options._textTagsMap[_c.nodeName.toLowerCase()]) {\n          s = _s2;\n          {\n            c = _c;\n            return \"continue\";\n          }\n        }\n\n        _s2 = util.getValues(_c.style);\n\n        if (_s2.length === 0 || ec.some(function (k) {\n          c = _c;\n          s = _s2;\n          return _s2.indexOf(k) === -1;\n        }) && _s2.some(function (k) {\n          ec.indexOf(k) > -1;\n        })) {\n          r = _c.nextSibling;\n          sel.appendChild(_c);\n        } else if (sel.childNodes.length > 0) {\n          el.insertBefore(sel, r);\n          sel = refer.cloneNode(false);\n          r = null;\n          appliedEl = true;\n        }\n\n        c = _c;\n        s = _s2;\n      };\n\n      for (var _i11 = 0, _len6 = children.length, c, s; _i11 < _len6; _i11++) {\n        var _ret = _loop(c, s, _i11, _len6);\n\n        if (_ret === \"continue\") continue;\n      }\n\n      if (sel.childNodes.length > 0) {\n        el.insertBefore(sel, r);\n        appliedEl = true;\n      }\n\n      if (!elStyles.length) {\n        el.removeAttribute('style');\n      }\n\n      return appliedEl;\n    },\n\n    /**\r\n     * @description If certain styles are applied to all child nodes of the list cell, the style of the list cell is also changed. (bold, color, size)\r\n     * @param {Element} el List cell element. <li>\r\n     * @param {Element|null} child Variable for recursive call. (\"null\" on the first call)\r\n     * @private\r\n     */\n    _setCommonListStyle: function _setCommonListStyle(el, child) {\n      if (!util.isListCell(el)) return;\n      var children = util.getArrayItem((child || el).childNodes, function (current) {\n        return !util.isBreak(current);\n      }, true);\n      child = children[0];\n      if (!child || children.length > 1 || child.nodeType !== 1) return; // set cell style---\n\n      var childStyle = child.style;\n      var elStyle = el.style;\n      var nodeName = child.nodeName.toLowerCase();\n      var appliedEl = false; // bold, italic\n\n      if (options._textTagsMap[nodeName] === options._defaultCommand.bold.toLowerCase()) elStyle.fontWeight = 'bold';\n      if (options._textTagsMap[nodeName] === options._defaultCommand.italic.toLowerCase()) elStyle.fontStyle = 'italic'; // styles\n\n      var cKeys = util.getValues(childStyle);\n\n      if (cKeys.length > 0) {\n        for (var i = 0, len = this._listCamel.length; i < len; i++) {\n          if (cKeys.indexOf(this._listKebab[i]) > -1) {\n            elStyle[this._listCamel[i]] = childStyle[this._listCamel[i]];\n            childStyle.removeProperty(this._listKebab[i]);\n            appliedEl = true;\n          }\n        }\n      }\n\n      this._setCommonListStyle(el, child);\n\n      if (!appliedEl) return; // common style\n\n      if (!childStyle.length) {\n        var ch = child.childNodes;\n        var p = child.parentNode;\n        var n = child.nextSibling;\n\n        while (ch.length > 0) {\n          p.insertBefore(ch[0], n);\n        }\n\n        util.removeItem(child);\n      }\n    },\n\n    /**\r\n     * @description Strip remove node\r\n     * @param {Node} removeNode The remove node\r\n     * @private\r\n     */\n    _stripRemoveNode: function _stripRemoveNode(removeNode) {\n      var element = removeNode.parentNode;\n      if (!removeNode || removeNode.nodeType === 3 || !element) return;\n      var children = removeNode.childNodes;\n\n      while (children[0]) {\n        element.insertBefore(children[0], removeNode);\n      }\n\n      element.removeChild(removeNode);\n    },\n\n    /**\r\n     * @description Return the parent maintained tag. (bind and use a util object)\r\n     * @param {Element} element Element\r\n     * @returns {Element}\r\n     * @private\r\n     */\n    _util_getMaintainedNode: function _util_getMaintainedNode(_isRemove, _isSizeNode, element) {\n      if (!element || _isRemove) return null;\n      return this.getParentElement(element, this._isMaintainedNode.bind(this)) || (!_isSizeNode ? this.getParentElement(element, this._isSizeNode.bind(this)) : null);\n    },\n\n    /**\r\n     * @description Check if element is a tag that should be persisted. (bind and use a util object)\r\n     * @param {Element} element Element\r\n     * @returns {Element}\r\n     * @private\r\n     */\n    _util_isMaintainedNode: function _util_isMaintainedNode(_isRemove, _isSizeNode, element) {\n      if (!element || _isRemove || element.nodeType !== 1) return false;\n\n      var anchor = this._isMaintainedNode(element);\n\n      return this.getParentElement(element, this._isMaintainedNode.bind(this)) ? anchor : anchor || (!_isSizeNode ? this._isSizeNode(element) : false);\n    },\n\n    /**\r\n     * @description wraps text nodes of line selected text.\r\n     * @param {Element} element The node of the line that contains the selected text node.\r\n     * @param {Element} newInnerNode The dom that will wrap the selected text area\r\n     * @param {Function} validation Check if the node should be stripped.\r\n     * @param {Node} startCon The startContainer property of the selection object.\r\n     * @param {Number} startOff The startOffset property of the selection object.\r\n     * @param {Node} endCon The endContainer property of the selection object.\r\n     * @param {Number} endOff The endOffset property of the selection object.\r\n     * @param {Boolean} isRemoveFormat Is the remove all formats command?\r\n     * @param {Boolean} isRemoveNode \"newInnerNode\" is remove node?\r\n     * @param {Boolean} collapsed range.collapsed\r\n     * @returns {{ancestor: *, startContainer: *, startOffset: *, endContainer: *, endOffset: *}}\r\n     * @private\r\n     */\n    _nodeChange_oneLine: function _nodeChange_oneLine(element, newInnerNode, validation, startCon, startOff, endCon, endOff, isRemoveFormat, isRemoveNode, collapsed, _removeCheck, _getMaintainedNode, _isMaintainedNode) {\n      // not add tag\n      var parentCon = startCon.parentNode;\n\n      while (!parentCon.nextSibling && !parentCon.previousSibling && !util.isFormatElement(parentCon.parentNode) && !util.isWysiwygDiv(parentCon.parentNode)) {\n        if (parentCon.nodeName === newInnerNode.nodeName) break;\n        parentCon = parentCon.parentNode;\n      }\n\n      if (!isRemoveNode && parentCon === endCon.parentNode && parentCon.nodeName === newInnerNode.nodeName) {\n        if (util.onlyZeroWidthSpace(startCon.textContent.slice(0, startOff)) && util.onlyZeroWidthSpace(endCon.textContent.slice(endOff))) {\n          var children = parentCon.childNodes;\n          var sameTag = true;\n\n          for (var i = 0, len = children.length, _c2, _s3, e, z; i < len; i++) {\n            _c2 = children[i];\n            z = !util.onlyZeroWidthSpace(_c2);\n\n            if (_c2 === startCon) {\n              _s3 = true;\n              continue;\n            }\n\n            if (_c2 === endCon) {\n              e = true;\n              continue;\n            }\n\n            if (!_s3 && z || _s3 && e && z) {\n              sameTag = false;\n              break;\n            }\n          }\n\n          if (sameTag) {\n            util.copyTagAttributes(parentCon, newInnerNode);\n            return {\n              ancestor: element,\n              startContainer: startCon,\n              startOffset: startOff,\n              endContainer: endCon,\n              endOffset: endOff\n            };\n          }\n        }\n      } // add tag\n\n\n      _removeCheck.v = false;\n      var el = element;\n      var nNodeArray = [newInnerNode];\n      var pNode = element.cloneNode(false);\n      var isSameNode = startCon === endCon;\n      var startContainer = startCon;\n      var startOffset = startOff;\n      var endContainer = endCon;\n      var endOffset = endOff;\n      var startPass = false;\n      var endPass = false;\n      var pCurrent, newNode, appendNode, cssText, anchorNode;\n      var wRegExp = _w.RegExp;\n\n      function checkCss(vNode) {\n        var regExp = new wRegExp('(?:;|^|\\\\s)(?:' + cssText + 'null)\\\\s*:[^;]*\\\\s*(?:;|$)', 'ig');\n        var style = '';\n\n        if (regExp && vNode.style.cssText.length > 0) {\n          style = regExp.test(vNode.style.cssText);\n        }\n\n        return !style;\n      }\n\n      (function recursionFunc(current, ancestor) {\n        var childNodes = current.childNodes;\n\n        for (var _i12 = 0, _len7 = childNodes.length, vNode; _i12 < _len7; _i12++) {\n          var child = childNodes[_i12];\n          if (!child) continue;\n          var coverNode = ancestor;\n          var cloneNode = void 0; // startContainer\n\n          if (!startPass && child === startContainer) {\n            var line = pNode;\n            anchorNode = _getMaintainedNode(child);\n            var prevNode = util.createTextNode(startContainer.nodeType === 1 ? '' : startContainer.substringData(0, startOffset));\n            var textNode = util.createTextNode(startContainer.nodeType === 1 ? '' : startContainer.substringData(startOffset, isSameNode ? endOffset >= startOffset ? endOffset - startOffset : startContainer.data.length - startOffset : startContainer.data.length - startOffset));\n\n            if (anchorNode) {\n              var a = _getMaintainedNode(ancestor);\n\n              if (a && a.parentNode !== line) {\n                var m = a;\n                var p = null;\n\n                while (m.parentNode !== line) {\n                  ancestor = p = m.parentNode.cloneNode(false);\n\n                  while (m.childNodes[0]) {\n                    p.appendChild(m.childNodes[0]);\n                  }\n\n                  m.appendChild(p);\n                  m = m.parentNode;\n                }\n\n                m.parentNode.appendChild(a);\n              }\n\n              anchorNode = anchorNode.cloneNode(false);\n            }\n\n            if (!util.onlyZeroWidthSpace(prevNode)) {\n              ancestor.appendChild(prevNode);\n            }\n\n            var prevAnchorNode = _getMaintainedNode(ancestor);\n\n            if (!!prevAnchorNode) anchorNode = prevAnchorNode;\n            if (anchorNode) line = anchorNode;\n            newNode = child;\n            pCurrent = [];\n            cssText = '';\n\n            while (newNode !== line && newNode !== el && newNode !== null) {\n              vNode = _isMaintainedNode(newNode) ? null : validation(newNode);\n\n              if (vNode && newNode.nodeType === 1 && checkCss(newNode)) {\n                pCurrent.push(vNode);\n                cssText += newNode.style.cssText.substr(0, newNode.style.cssText.indexOf(':')) + '|';\n              }\n\n              newNode = newNode.parentNode;\n            }\n\n            var childNode = pCurrent.pop() || textNode;\n            appendNode = newNode = childNode;\n\n            while (pCurrent.length > 0) {\n              newNode = pCurrent.pop();\n              appendNode.appendChild(newNode);\n              appendNode = newNode;\n            }\n\n            newInnerNode.appendChild(childNode);\n            line.appendChild(newInnerNode);\n\n            if (anchorNode && !_getMaintainedNode(endContainer)) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              pNode.appendChild(newInnerNode);\n              nNodeArray.push(newInnerNode);\n            }\n\n            startContainer = textNode;\n            startOffset = 0;\n            startPass = true;\n            if (newNode !== textNode) newNode.appendChild(startContainer);\n            if (!isSameNode) continue;\n          } // endContainer\n\n\n          if (!endPass && child === endContainer) {\n            anchorNode = _getMaintainedNode(child);\n            var afterNode = util.createTextNode(endContainer.nodeType === 1 ? '' : endContainer.substringData(endOffset, endContainer.length - endOffset));\n\n            var _textNode = util.createTextNode(isSameNode || endContainer.nodeType === 1 ? '' : endContainer.substringData(0, endOffset));\n\n            if (anchorNode) {\n              anchorNode = anchorNode.cloneNode(false);\n            } else if (_isMaintainedNode(newInnerNode.parentNode) && !anchorNode) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              pNode.appendChild(newInnerNode);\n              nNodeArray.push(newInnerNode);\n            }\n\n            if (!util.onlyZeroWidthSpace(afterNode)) {\n              newNode = child;\n              cssText = '';\n              pCurrent = [];\n              var anchors = [];\n\n              while (newNode !== pNode && newNode !== el && newNode !== null) {\n                if (newNode.nodeType === 1 && checkCss(newNode)) {\n                  if (_isMaintainedNode(newNode)) anchors.push(newNode.cloneNode(false));else pCurrent.push(newNode.cloneNode(false));\n                  cssText += newNode.style.cssText.substr(0, newNode.style.cssText.indexOf(':')) + '|';\n                }\n\n                newNode = newNode.parentNode;\n              }\n\n              pCurrent = pCurrent.concat(anchors);\n              cloneNode = appendNode = newNode = pCurrent.pop() || afterNode;\n\n              while (pCurrent.length > 0) {\n                newNode = pCurrent.pop();\n                appendNode.appendChild(newNode);\n                appendNode = newNode;\n              }\n\n              pNode.appendChild(cloneNode);\n              newNode.textContent = afterNode.data;\n            }\n\n            if (anchorNode && cloneNode) {\n              var afterAnchorNode = _getMaintainedNode(cloneNode);\n\n              if (afterAnchorNode) {\n                anchorNode = afterAnchorNode;\n              }\n            }\n\n            newNode = child;\n            pCurrent = [];\n            cssText = '';\n\n            while (newNode !== pNode && newNode !== el && newNode !== null) {\n              vNode = _isMaintainedNode(newNode) ? null : validation(newNode);\n\n              if (vNode && newNode.nodeType === 1 && checkCss(newNode)) {\n                pCurrent.push(vNode);\n                cssText += newNode.style.cssText.substr(0, newNode.style.cssText.indexOf(':')) + '|';\n              }\n\n              newNode = newNode.parentNode;\n            }\n\n            var _childNode = pCurrent.pop() || _textNode;\n\n            appendNode = newNode = _childNode;\n\n            while (pCurrent.length > 0) {\n              newNode = pCurrent.pop();\n              appendNode.appendChild(newNode);\n              appendNode = newNode;\n            }\n\n            if (anchorNode) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              newInnerNode.appendChild(_childNode);\n              anchorNode.insertBefore(newInnerNode, anchorNode.firstChild);\n              pNode.appendChild(anchorNode);\n              nNodeArray.push(newInnerNode);\n              anchorNode = null;\n            } else {\n              newInnerNode.appendChild(_childNode);\n            }\n\n            endContainer = _textNode;\n            endOffset = _textNode.data.length;\n            endPass = true;\n\n            if (!isRemoveFormat && collapsed) {\n              newInnerNode = _textNode;\n              _textNode.textContent = util.zeroWidthSpace;\n            }\n\n            if (newNode !== _textNode) newNode.appendChild(endContainer);\n            continue;\n          } // other\n\n\n          if (startPass) {\n            if (child.nodeType === 1 && !util.isBreak(child)) {\n              if (util._isIgnoreNodeChange(child)) {\n                pNode.appendChild(child.cloneNode(true));\n\n                if (!collapsed) {\n                  newInnerNode = newInnerNode.cloneNode(false);\n                  pNode.appendChild(newInnerNode);\n                  nNodeArray.push(newInnerNode);\n                }\n              } else {\n                recursionFunc(child, child);\n              }\n\n              continue;\n            }\n\n            newNode = child;\n            pCurrent = [];\n            cssText = '';\n            var _anchors = [];\n\n            while (newNode.parentNode !== null && newNode !== el && newNode !== newInnerNode) {\n              vNode = endPass ? newNode.cloneNode(false) : validation(newNode);\n\n              if (newNode.nodeType === 1 && !util.isBreak(child) && vNode && checkCss(newNode)) {\n                if (_isMaintainedNode(newNode)) {\n                  if (!anchorNode) _anchors.push(vNode);\n                } else {\n                  pCurrent.push(vNode);\n                }\n\n                cssText += newNode.style.cssText.substr(0, newNode.style.cssText.indexOf(':')) + '|';\n              }\n\n              newNode = newNode.parentNode;\n            }\n\n            pCurrent = pCurrent.concat(_anchors);\n\n            var _childNode2 = pCurrent.pop() || child;\n\n            appendNode = newNode = _childNode2;\n\n            while (pCurrent.length > 0) {\n              newNode = pCurrent.pop();\n              appendNode.appendChild(newNode);\n              appendNode = newNode;\n            }\n\n            if (_isMaintainedNode(newInnerNode.parentNode) && !_isMaintainedNode(_childNode2) && !util.onlyZeroWidthSpace(newInnerNode)) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              pNode.appendChild(newInnerNode);\n              nNodeArray.push(newInnerNode);\n            }\n\n            if (!endPass && !anchorNode && _isMaintainedNode(_childNode2)) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              var aChildren = _childNode2.childNodes;\n\n              for (var _a = 0, aLen = aChildren.length; _a < aLen; _a++) {\n                newInnerNode.appendChild(aChildren[_a]);\n              }\n\n              _childNode2.appendChild(newInnerNode);\n\n              pNode.appendChild(_childNode2);\n              nNodeArray.push(newInnerNode);\n              if (newInnerNode.children.length > 0) ancestor = newNode;else ancestor = newInnerNode;\n            } else if (_childNode2 === child) {\n              if (!endPass) ancestor = newInnerNode;else ancestor = pNode;\n            } else if (endPass) {\n              pNode.appendChild(_childNode2);\n              ancestor = newNode;\n            } else {\n              newInnerNode.appendChild(_childNode2);\n              ancestor = newNode;\n            }\n\n            if (anchorNode && child.nodeType === 3) {\n              if (_getMaintainedNode(child)) {\n                var ancestorAnchorNode = util.getParentElement(ancestor, function (current) {\n                  return this._isMaintainedNode(current.parentNode) || current.parentNode === pNode;\n                }.bind(util));\n                anchorNode.appendChild(ancestorAnchorNode);\n                newInnerNode = ancestorAnchorNode.cloneNode(false);\n                nNodeArray.push(newInnerNode);\n                pNode.appendChild(newInnerNode);\n              } else {\n                anchorNode = null;\n              }\n            }\n          }\n\n          cloneNode = child.cloneNode(false);\n          ancestor.appendChild(cloneNode);\n          if (child.nodeType === 1 && !util.isBreak(child)) coverNode = cloneNode;\n          recursionFunc(child, coverNode);\n        }\n      })(element, pNode); // not remove tag\n\n\n      if (isRemoveNode && !isRemoveFormat && !_removeCheck.v) {\n        return {\n          ancestor: element,\n          startContainer: startCon,\n          startOffset: startOff,\n          endContainer: endCon,\n          endOffset: endOff\n        };\n      }\n\n      isRemoveFormat = isRemoveFormat && isRemoveNode;\n\n      if (isRemoveFormat) {\n        for (var _i13 = 0; _i13 < nNodeArray.length; _i13++) {\n          var removeNode = nNodeArray[_i13];\n          var textNode = void 0,\n              textNode_s = void 0,\n              textNode_e = void 0;\n\n          if (collapsed) {\n            textNode = util.createTextNode(util.zeroWidthSpace);\n            pNode.replaceChild(textNode, removeNode);\n          } else {\n            var rChildren = removeNode.childNodes;\n            textNode_s = rChildren[0];\n\n            while (rChildren[0]) {\n              textNode_e = rChildren[0];\n              pNode.insertBefore(textNode_e, removeNode);\n            }\n\n            util.removeItem(removeNode);\n          }\n\n          if (_i13 === 0) {\n            if (collapsed) {\n              startContainer = endContainer = textNode;\n            } else {\n              startContainer = textNode_s;\n              endContainer = textNode_e;\n            }\n          }\n        }\n      } else {\n        if (isRemoveNode) {\n          for (var _i14 = 0; _i14 < nNodeArray.length; _i14++) {\n            this._stripRemoveNode(nNodeArray[_i14]);\n          }\n        }\n\n        if (collapsed) {\n          startContainer = endContainer = newInnerNode;\n        }\n      }\n\n      util.removeEmptyNode(pNode, newInnerNode);\n\n      if (collapsed) {\n        startOffset = startContainer.textContent.length;\n        endOffset = endContainer.textContent.length;\n      } // endContainer reset\n\n\n      var endConReset = isRemoveFormat || endContainer.textContent.length === 0;\n\n      if (!util.isBreak(endContainer) && endContainer.textContent.length === 0) {\n        util.removeItem(endContainer);\n        endContainer = startContainer;\n      }\n\n      endOffset = endConReset ? endContainer.textContent.length : endOffset; // node change\n\n      var newStartOffset = {\n        s: 0,\n        e: 0\n      };\n      var startPath = util.getNodePath(startContainer, pNode, newStartOffset);\n      var mergeEndCon = !endContainer.parentNode;\n      if (mergeEndCon) endContainer = startContainer;\n      var newEndOffset = {\n        s: 0,\n        e: 0\n      };\n      var endPath = util.getNodePath(endContainer, pNode, !mergeEndCon && !endConReset ? newEndOffset : null);\n      startOffset += newStartOffset.s;\n      endOffset = collapsed ? startOffset : mergeEndCon ? startContainer.textContent.length : endConReset ? endOffset + newStartOffset.s : endOffset + newEndOffset.s; // tag merge\n\n      var newOffsets = util.mergeSameTags(pNode, [startPath, endPath], true);\n      element.parentNode.replaceChild(pNode, element);\n      startContainer = util.getNodeFromPath(startPath, pNode);\n      endContainer = util.getNodeFromPath(endPath, pNode);\n      return {\n        ancestor: pNode,\n        startContainer: startContainer,\n        startOffset: startOffset + newOffsets[0],\n        endContainer: endContainer,\n        endOffset: endOffset + newOffsets[1]\n      };\n    },\n\n    /**\r\n     * @description wraps first line selected text.\r\n     * @param {Element} element The node of the line that contains the selected text node.\r\n     * @param {Element} newInnerNode The dom that will wrap the selected text area\r\n     * @param {Function} validation Check if the node should be stripped.\r\n     * @param {Node} startCon The startContainer property of the selection object.\r\n     * @param {Number} startOff The startOffset property of the selection object.\r\n     * @param {Boolean} isRemoveFormat Is the remove all formats command?\r\n     * @param {Boolean} isRemoveNode \"newInnerNode\" is remove node?\r\n     * @returns {null|Node} If end container is renewed, returned renewed node\r\n     * @returns {Object} { ancestor, container, offset, endContainer }\r\n     * @private\r\n     */\n    _nodeChange_startLine: function _nodeChange_startLine(element, newInnerNode, validation, startCon, startOff, isRemoveFormat, isRemoveNode, _removeCheck, _getMaintainedNode, _isMaintainedNode, _endContainer) {\n      // not add tag\n      var parentCon = startCon.parentNode;\n\n      while (!parentCon.nextSibling && !parentCon.previousSibling && !util.isFormatElement(parentCon.parentNode) && !util.isWysiwygDiv(parentCon.parentNode)) {\n        if (parentCon.nodeName === newInnerNode.nodeName) break;\n        parentCon = parentCon.parentNode;\n      }\n\n      if (!isRemoveNode && parentCon.nodeName === newInnerNode.nodeName && !util.isFormatElement(parentCon) && !parentCon.nextSibling && util.onlyZeroWidthSpace(startCon.textContent.slice(0, startOff))) {\n        var sameTag = true;\n        var _s4 = startCon.previousSibling;\n\n        while (_s4) {\n          if (!util.onlyZeroWidthSpace(_s4)) {\n            sameTag = false;\n            break;\n          }\n\n          _s4 = _s4.previousSibling;\n        }\n\n        if (sameTag) {\n          util.copyTagAttributes(parentCon, newInnerNode);\n          return {\n            ancestor: element,\n            container: startCon,\n            offset: startOff\n          };\n        }\n      } // add tag\n\n\n      _removeCheck.v = false;\n      var el = element;\n      var nNodeArray = [newInnerNode];\n      var pNode = element.cloneNode(false);\n      var container = startCon;\n      var offset = startOff;\n      var passNode = false;\n      var pCurrent, newNode, appendNode, anchorNode;\n\n      (function recursionFunc(current, ancestor) {\n        var childNodes = current.childNodes;\n\n        for (var i = 0, len = childNodes.length, vNode, cloneChild; i < len; i++) {\n          var child = childNodes[i];\n          if (!child) continue;\n          var coverNode = ancestor;\n\n          if (passNode && !util.isBreak(child)) {\n            if (child.nodeType === 1) {\n              if (util._isIgnoreNodeChange(child)) {\n                newInnerNode = newInnerNode.cloneNode(false);\n                cloneChild = child.cloneNode(true);\n                pNode.appendChild(cloneChild);\n                pNode.appendChild(newInnerNode);\n                nNodeArray.push(newInnerNode); // end container\n\n                if (_endContainer && child.contains(_endContainer)) {\n                  var endPath = util.getNodePath(_endContainer, child);\n                  _endContainer = util.getNodeFromPath(endPath, cloneChild);\n                }\n              } else {\n                recursionFunc(child, child);\n              }\n\n              continue;\n            }\n\n            newNode = child;\n            pCurrent = [];\n            var anchors = [];\n\n            while (newNode.parentNode !== null && newNode !== el && newNode !== newInnerNode) {\n              vNode = validation(newNode);\n\n              if (newNode.nodeType === 1 && vNode) {\n                if (_isMaintainedNode(newNode)) {\n                  if (!anchorNode) anchors.push(vNode);\n                } else {\n                  pCurrent.push(vNode);\n                }\n              }\n\n              newNode = newNode.parentNode;\n            }\n\n            pCurrent = pCurrent.concat(anchors);\n            var isTopNode = pCurrent.length > 0;\n            var childNode = pCurrent.pop() || child;\n            appendNode = newNode = childNode;\n\n            while (pCurrent.length > 0) {\n              newNode = pCurrent.pop();\n              appendNode.appendChild(newNode);\n              appendNode = newNode;\n            }\n\n            if (_isMaintainedNode(newInnerNode.parentNode) && !_isMaintainedNode(childNode)) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              pNode.appendChild(newInnerNode);\n              nNodeArray.push(newInnerNode);\n            }\n\n            if (!anchorNode && _isMaintainedNode(childNode)) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              var aChildren = childNode.childNodes;\n\n              for (var a = 0, aLen = aChildren.length; a < aLen; a++) {\n                newInnerNode.appendChild(aChildren[a]);\n              }\n\n              childNode.appendChild(newInnerNode);\n              pNode.appendChild(childNode);\n              ancestor = !_isMaintainedNode(newNode) ? newNode : newInnerNode;\n              nNodeArray.push(newInnerNode);\n            } else if (isTopNode) {\n              newInnerNode.appendChild(childNode);\n              ancestor = newNode;\n            } else {\n              ancestor = newInnerNode;\n            }\n\n            if (anchorNode && child.nodeType === 3) {\n              if (_getMaintainedNode(child)) {\n                var ancestorAnchorNode = util.getParentElement(ancestor, function (current) {\n                  return this._isMaintainedNode(current.parentNode) || current.parentNode === pNode;\n                }.bind(util));\n                anchorNode.appendChild(ancestorAnchorNode);\n                newInnerNode = ancestorAnchorNode.cloneNode(false);\n                nNodeArray.push(newInnerNode);\n                pNode.appendChild(newInnerNode);\n              } else {\n                anchorNode = null;\n              }\n            }\n          } // startContainer\n\n\n          if (!passNode && child === container) {\n            var line = pNode;\n            anchorNode = _getMaintainedNode(child);\n            var prevNode = util.createTextNode(container.nodeType === 1 ? '' : container.substringData(0, offset));\n            var textNode = util.createTextNode(container.nodeType === 1 ? '' : container.substringData(offset, container.length - offset));\n\n            if (anchorNode) {\n              var _a2 = _getMaintainedNode(ancestor);\n\n              if (_a2 && _a2.parentNode !== line) {\n                var m = _a2;\n                var p = null;\n\n                while (m.parentNode !== line) {\n                  ancestor = p = m.parentNode.cloneNode(false);\n\n                  while (m.childNodes[0]) {\n                    p.appendChild(m.childNodes[0]);\n                  }\n\n                  m.appendChild(p);\n                  m = m.parentNode;\n                }\n\n                m.parentNode.appendChild(_a2);\n              }\n\n              anchorNode = anchorNode.cloneNode(false);\n            }\n\n            if (!util.onlyZeroWidthSpace(prevNode)) {\n              ancestor.appendChild(prevNode);\n            }\n\n            var prevAnchorNode = _getMaintainedNode(ancestor);\n\n            if (!!prevAnchorNode) anchorNode = prevAnchorNode;\n            if (anchorNode) line = anchorNode;\n            newNode = ancestor;\n            pCurrent = [];\n\n            while (newNode !== line && newNode !== null) {\n              vNode = validation(newNode);\n\n              if (newNode.nodeType === 1 && vNode) {\n                pCurrent.push(vNode);\n              }\n\n              newNode = newNode.parentNode;\n            }\n\n            var _childNode3 = pCurrent.pop() || ancestor;\n\n            appendNode = newNode = _childNode3;\n\n            while (pCurrent.length > 0) {\n              newNode = pCurrent.pop();\n              appendNode.appendChild(newNode);\n              appendNode = newNode;\n            }\n\n            if (_childNode3 !== ancestor) {\n              newInnerNode.appendChild(_childNode3);\n              ancestor = newNode;\n            } else {\n              ancestor = newInnerNode;\n            }\n\n            if (util.isBreak(child)) newInnerNode.appendChild(child.cloneNode(false));\n            line.appendChild(newInnerNode);\n            container = textNode;\n            offset = 0;\n            passNode = true;\n            ancestor.appendChild(container);\n            continue;\n          }\n\n          vNode = !passNode ? child.cloneNode(false) : validation(child);\n\n          if (vNode) {\n            ancestor.appendChild(vNode);\n            if (child.nodeType === 1 && !util.isBreak(child)) coverNode = vNode;\n          }\n\n          recursionFunc(child, coverNode);\n        }\n      })(element, pNode); // not remove tag\n\n\n      if (isRemoveNode && !isRemoveFormat && !_removeCheck.v) {\n        return {\n          ancestor: element,\n          container: startCon,\n          offset: startOff,\n          endContainer: _endContainer\n        };\n      }\n\n      isRemoveFormat = isRemoveFormat && isRemoveNode;\n\n      if (isRemoveFormat) {\n        for (var i = 0; i < nNodeArray.length; i++) {\n          var removeNode = nNodeArray[i];\n          var rChildren = removeNode.childNodes;\n          var textNode = rChildren[0];\n\n          while (rChildren[0]) {\n            pNode.insertBefore(rChildren[0], removeNode);\n          }\n\n          util.removeItem(removeNode);\n          if (i === 0) container = textNode;\n        }\n      } else if (isRemoveNode) {\n        newInnerNode = newInnerNode.firstChild;\n\n        for (var _i15 = 0; _i15 < nNodeArray.length; _i15++) {\n          this._stripRemoveNode(nNodeArray[_i15]);\n        }\n      }\n\n      if (!isRemoveFormat && pNode.childNodes.length === 0) {\n        if (element.childNodes) {\n          container = element.childNodes[0];\n        } else {\n          container = util.createTextNode(util.zeroWidthSpace);\n          element.appendChild(container);\n        }\n      } else {\n        util.removeEmptyNode(pNode, newInnerNode);\n\n        if (util.onlyZeroWidthSpace(pNode.textContent)) {\n          container = pNode.firstChild;\n          offset = 0;\n        } // node change\n\n\n        var offsets = {\n          s: 0,\n          e: 0\n        };\n        var path = util.getNodePath(container, pNode, offsets);\n        offset += offsets.s; // tag merge\n\n        var newOffsets = util.mergeSameTags(pNode, [path], true);\n        element.parentNode.replaceChild(pNode, element);\n        container = util.getNodeFromPath(path, pNode);\n        offset += newOffsets[0];\n      }\n\n      return {\n        ancestor: pNode,\n        container: container,\n        offset: offset,\n        endContainer: _endContainer\n      };\n    },\n\n    /**\r\n     * @description wraps mid lines selected text.\r\n     * @param {Element} element The node of the line that contains the selected text node.\r\n     * @param {Element} newInnerNode The dom that will wrap the selected text area\r\n     * @param {Function} validation Check if the node should be stripped.\r\n     * @param {Boolean} isRemoveFormat Is the remove all formats command?\r\n     * @param {Boolean} isRemoveNode \"newInnerNode\" is remove node?\r\n     * @param {Node} _endContainer Offset node of last line already modified (end.container)\r\n     * @returns {Object} { ancestor, endContainer: \"If end container is renewed, returned renewed node\" }\r\n     * @private\r\n     */\n    _nodeChange_middleLine: function _nodeChange_middleLine(element, newInnerNode, validation, isRemoveFormat, isRemoveNode, _removeCheck, _endContainer) {\n      // not add tag\n      if (!isRemoveNode) {\n        // end container path\n        var endPath = null;\n        if (_endContainer && element.contains(_endContainer)) endPath = util.getNodePath(_endContainer, element);\n        var tempNode = element.cloneNode(true);\n        var newNodeName = newInnerNode.nodeName;\n        var newCssText = newInnerNode.style.cssText;\n        var newClass = newInnerNode.className;\n        var children = tempNode.childNodes;\n        var i = 0,\n            len = children.length;\n\n        for (var child; i < len; i++) {\n          child = children[i];\n          if (child.nodeType === 3) break;\n\n          if (child.nodeName === newNodeName) {\n            child.style.cssText += newCssText;\n            util.addClass(child, newClass);\n          } else if (!util.isBreak(child) && util._isIgnoreNodeChange(child)) {\n            continue;\n          } else if (len === 1) {\n            children = child.childNodes;\n            len = children.length;\n            i = -1;\n            continue;\n          } else {\n            break;\n          }\n        }\n\n        if (len > 0 && i === len) {\n          element.innerHTML = tempNode.innerHTML;\n          return {\n            ancestor: element,\n            endContainer: endPath ? util.getNodeFromPath(endPath, element) : null\n          };\n        }\n      } // add tag\n\n\n      _removeCheck.v = false;\n      var pNode = element.cloneNode(false);\n      var nNodeArray = [newInnerNode];\n      var noneChange = true;\n\n      (function recursionFunc(current, ancestor) {\n        var childNodes = current.childNodes;\n\n        for (var _i16 = 0, _len8 = childNodes.length, vNode, cloneChild; _i16 < _len8; _i16++) {\n          var _child = childNodes[_i16];\n          if (!_child) continue;\n          var coverNode = ancestor;\n\n          if (!util.isBreak(_child) && util._isIgnoreNodeChange(_child)) {\n            if (newInnerNode.childNodes.length > 0) {\n              pNode.appendChild(newInnerNode);\n              newInnerNode = newInnerNode.cloneNode(false);\n            }\n\n            cloneChild = _child.cloneNode(true);\n            pNode.appendChild(cloneChild);\n            pNode.appendChild(newInnerNode);\n            nNodeArray.push(newInnerNode);\n            ancestor = newInnerNode; // end container\n\n            if (_endContainer && _child.contains(_endContainer)) {\n              var _endPath = util.getNodePath(_endContainer, _child);\n\n              _endContainer = util.getNodeFromPath(_endPath, cloneChild);\n            }\n\n            continue;\n          } else {\n            vNode = validation(_child);\n\n            if (vNode) {\n              noneChange = false;\n              ancestor.appendChild(vNode);\n              if (_child.nodeType === 1) coverNode = vNode;\n            }\n          }\n\n          if (!util.isBreak(_child)) recursionFunc(_child, coverNode);\n        }\n      })(element, newInnerNode); // not remove tag\n\n\n      if (noneChange || isRemoveNode && !isRemoveFormat && !_removeCheck.v) return {\n        ancestor: element,\n        endContainer: _endContainer\n      };\n      pNode.appendChild(newInnerNode);\n\n      if (isRemoveFormat && isRemoveNode) {\n        for (var _i17 = 0; _i17 < nNodeArray.length; _i17++) {\n          var removeNode = nNodeArray[_i17];\n          var rChildren = removeNode.childNodes;\n\n          while (rChildren[0]) {\n            pNode.insertBefore(rChildren[0], removeNode);\n          }\n\n          util.removeItem(removeNode);\n        }\n      } else if (isRemoveNode) {\n        newInnerNode = newInnerNode.firstChild;\n\n        for (var _i18 = 0; _i18 < nNodeArray.length; _i18++) {\n          this._stripRemoveNode(nNodeArray[_i18]);\n        }\n      }\n\n      util.removeEmptyNode(pNode, newInnerNode);\n      util.mergeSameTags(pNode, null, true); // node change\n\n      element.parentNode.replaceChild(pNode, element);\n      return {\n        ancestor: pNode,\n        endContainer: _endContainer\n      };\n    },\n\n    /**\r\n     * @description wraps last line selected text.\r\n     * @param {Element} element The node of the line that contains the selected text node.\r\n     * @param {Element} newInnerNode The dom that will wrap the selected text area\r\n     * @param {Function} validation Check if the node should be stripped.\r\n     * @param {Node} endCon The endContainer property of the selection object.\r\n     * @param {Number} endOff The endOffset property of the selection object.\r\n     * @param {Boolean} isRemoveFormat Is the remove all formats command?\r\n     * @param {Boolean} isRemoveNode \"newInnerNode\" is remove node?\r\n     * @returns {Object} { ancestor, container, offset }\r\n     * @private\r\n     */\n    _nodeChange_endLine: function _nodeChange_endLine(element, newInnerNode, validation, endCon, endOff, isRemoveFormat, isRemoveNode, _removeCheck, _getMaintainedNode, _isMaintainedNode) {\n      // not add tag\n      var parentCon = endCon.parentNode;\n\n      while (!parentCon.nextSibling && !parentCon.previousSibling && !util.isFormatElement(parentCon.parentNode) && !util.isWysiwygDiv(parentCon.parentNode)) {\n        if (parentCon.nodeName === newInnerNode.nodeName) break;\n        parentCon = parentCon.parentNode;\n      }\n\n      if (!isRemoveNode && parentCon.nodeName === newInnerNode.nodeName && !util.isFormatElement(parentCon) && !parentCon.previousSibling && util.onlyZeroWidthSpace(endCon.textContent.slice(endOff))) {\n        var sameTag = true;\n        var e = endCon.nextSibling;\n\n        while (e) {\n          if (!util.onlyZeroWidthSpace(e)) {\n            sameTag = false;\n            break;\n          }\n\n          e = e.nextSibling;\n        }\n\n        if (sameTag) {\n          util.copyTagAttributes(parentCon, newInnerNode);\n          return {\n            ancestor: element,\n            container: endCon,\n            offset: endOff\n          };\n        }\n      } // add tag\n\n\n      _removeCheck.v = false;\n      var el = element;\n      var nNodeArray = [newInnerNode];\n      var pNode = element.cloneNode(false);\n      var container = endCon;\n      var offset = endOff;\n      var passNode = false;\n      var pCurrent, newNode, appendNode, anchorNode;\n\n      (function recursionFunc(current, ancestor) {\n        var childNodes = current.childNodes;\n\n        for (var i = childNodes.length - 1, vNode; 0 <= i; i--) {\n          var child = childNodes[i];\n          if (!child) continue;\n          var coverNode = ancestor;\n\n          if (passNode && !util.isBreak(child)) {\n            if (child.nodeType === 1) {\n              if (util._isIgnoreNodeChange(child)) {\n                newInnerNode = newInnerNode.cloneNode(false);\n                var cloneChild = child.cloneNode(true);\n                pNode.insertBefore(cloneChild, ancestor);\n                pNode.insertBefore(newInnerNode, cloneChild);\n                nNodeArray.push(newInnerNode);\n              } else {\n                recursionFunc(child, child);\n              }\n\n              continue;\n            }\n\n            newNode = child;\n            pCurrent = [];\n            var anchors = [];\n\n            while (newNode.parentNode !== null && newNode !== el && newNode !== newInnerNode) {\n              vNode = validation(newNode);\n\n              if (vNode && newNode.nodeType === 1) {\n                if (_isMaintainedNode(newNode)) {\n                  if (!anchorNode) anchors.push(vNode);\n                } else {\n                  pCurrent.push(vNode);\n                }\n              }\n\n              newNode = newNode.parentNode;\n            }\n\n            pCurrent = pCurrent.concat(anchors);\n            var isTopNode = pCurrent.length > 0;\n            var childNode = pCurrent.pop() || child;\n            appendNode = newNode = childNode;\n\n            while (pCurrent.length > 0) {\n              newNode = pCurrent.pop();\n              appendNode.appendChild(newNode);\n              appendNode = newNode;\n            }\n\n            if (_isMaintainedNode(newInnerNode.parentNode) && !_isMaintainedNode(childNode)) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              pNode.insertBefore(newInnerNode, pNode.firstChild);\n              nNodeArray.push(newInnerNode);\n            }\n\n            if (!anchorNode && _isMaintainedNode(childNode)) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              var aChildren = childNode.childNodes;\n\n              for (var a = 0, aLen = aChildren.length; a < aLen; a++) {\n                newInnerNode.appendChild(aChildren[a]);\n              }\n\n              childNode.appendChild(newInnerNode);\n              pNode.insertBefore(childNode, pNode.firstChild);\n              nNodeArray.push(newInnerNode);\n              if (newInnerNode.children.length > 0) ancestor = newNode;else ancestor = newInnerNode;\n            } else if (isTopNode) {\n              newInnerNode.insertBefore(childNode, newInnerNode.firstChild);\n              ancestor = newNode;\n            } else {\n              ancestor = newInnerNode;\n            }\n\n            if (anchorNode && child.nodeType === 3) {\n              if (_getMaintainedNode(child)) {\n                var ancestorAnchorNode = util.getParentElement(ancestor, function (current) {\n                  return this._isMaintainedNode(current.parentNode) || current.parentNode === pNode;\n                }.bind(util));\n                anchorNode.appendChild(ancestorAnchorNode);\n                newInnerNode = ancestorAnchorNode.cloneNode(false);\n                nNodeArray.push(newInnerNode);\n                pNode.insertBefore(newInnerNode, pNode.firstChild);\n              } else {\n                anchorNode = null;\n              }\n            }\n          } // endContainer\n\n\n          if (!passNode && child === container) {\n            anchorNode = _getMaintainedNode(child);\n            var afterNode = util.createTextNode(container.nodeType === 1 ? '' : container.substringData(offset, container.length - offset));\n            var textNode = util.createTextNode(container.nodeType === 1 ? '' : container.substringData(0, offset));\n\n            if (anchorNode) {\n              anchorNode = anchorNode.cloneNode(false);\n\n              var _a3 = _getMaintainedNode(ancestor);\n\n              if (_a3 && _a3.parentNode !== pNode) {\n                var m = _a3;\n                var p = null;\n\n                while (m.parentNode !== pNode) {\n                  ancestor = p = m.parentNode.cloneNode(false);\n\n                  while (m.childNodes[0]) {\n                    p.appendChild(m.childNodes[0]);\n                  }\n\n                  m.appendChild(p);\n                  m = m.parentNode;\n                }\n\n                m.parentNode.insertBefore(_a3, m.parentNode.firstChild);\n              }\n\n              anchorNode = anchorNode.cloneNode(false);\n            } else if (_isMaintainedNode(newInnerNode.parentNode) && !anchorNode) {\n              newInnerNode = newInnerNode.cloneNode(false);\n              pNode.appendChild(newInnerNode);\n              nNodeArray.push(newInnerNode);\n            }\n\n            if (!util.onlyZeroWidthSpace(afterNode)) {\n              ancestor.insertBefore(afterNode, ancestor.firstChild);\n            }\n\n            newNode = ancestor;\n            pCurrent = [];\n\n            while (newNode !== pNode && newNode !== null) {\n              vNode = _isMaintainedNode(newNode) ? null : validation(newNode);\n\n              if (vNode && newNode.nodeType === 1) {\n                pCurrent.push(vNode);\n              }\n\n              newNode = newNode.parentNode;\n            }\n\n            var _childNode4 = pCurrent.pop() || ancestor;\n\n            appendNode = newNode = _childNode4;\n\n            while (pCurrent.length > 0) {\n              newNode = pCurrent.pop();\n              appendNode.appendChild(newNode);\n              appendNode = newNode;\n            }\n\n            if (_childNode4 !== ancestor) {\n              newInnerNode.insertBefore(_childNode4, newInnerNode.firstChild);\n              ancestor = newNode;\n            } else {\n              ancestor = newInnerNode;\n            }\n\n            if (util.isBreak(child)) newInnerNode.appendChild(child.cloneNode(false));\n\n            if (anchorNode) {\n              anchorNode.insertBefore(newInnerNode, anchorNode.firstChild);\n              pNode.insertBefore(anchorNode, pNode.firstChild);\n              anchorNode = null;\n            } else {\n              pNode.insertBefore(newInnerNode, pNode.firstChild);\n            }\n\n            container = textNode;\n            offset = textNode.data.length;\n            passNode = true;\n            ancestor.insertBefore(container, ancestor.firstChild);\n            continue;\n          }\n\n          vNode = !passNode ? child.cloneNode(false) : validation(child);\n\n          if (vNode) {\n            ancestor.insertBefore(vNode, ancestor.firstChild);\n            if (child.nodeType === 1 && !util.isBreak(child)) coverNode = vNode;\n          }\n\n          recursionFunc(child, coverNode);\n        }\n      })(element, pNode); // not remove tag\n\n\n      if (isRemoveNode && !isRemoveFormat && !_removeCheck.v) {\n        return {\n          ancestor: element,\n          container: endCon,\n          offset: endOff\n        };\n      }\n\n      isRemoveFormat = isRemoveFormat && isRemoveNode;\n\n      if (isRemoveFormat) {\n        for (var i = 0; i < nNodeArray.length; i++) {\n          var removeNode = nNodeArray[i];\n          var rChildren = removeNode.childNodes;\n          var textNode = null;\n\n          while (rChildren[0]) {\n            textNode = rChildren[0];\n            pNode.insertBefore(textNode, removeNode);\n          }\n\n          util.removeItem(removeNode);\n\n          if (i === nNodeArray.length - 1) {\n            container = textNode;\n            offset = textNode.textContent.length;\n          }\n        }\n      } else if (isRemoveNode) {\n        newInnerNode = newInnerNode.firstChild;\n\n        for (var _i19 = 0; _i19 < nNodeArray.length; _i19++) {\n          this._stripRemoveNode(nNodeArray[_i19]);\n        }\n      }\n\n      if (!isRemoveFormat && pNode.childNodes.length === 0) {\n        if (element.childNodes) {\n          container = element.childNodes[0];\n        } else {\n          container = util.createTextNode(util.zeroWidthSpace);\n          element.appendChild(container);\n        }\n      } else {\n        if (!isRemoveNode && newInnerNode.textContent.length === 0) {\n          util.removeEmptyNode(pNode, null);\n          return {\n            ancestor: null,\n            container: null,\n            offset: 0\n          };\n        }\n\n        util.removeEmptyNode(pNode, newInnerNode);\n\n        if (util.onlyZeroWidthSpace(pNode.textContent)) {\n          container = pNode.firstChild;\n          offset = container.textContent.length;\n        } else if (util.onlyZeroWidthSpace(container)) {\n          container = newInnerNode;\n          offset = 1;\n        } // node change\n\n\n        var offsets = {\n          s: 0,\n          e: 0\n        };\n        var path = util.getNodePath(container, pNode, offsets);\n        offset += offsets.s; // tag merge\n\n        var newOffsets = util.mergeSameTags(pNode, [path], true);\n        element.parentNode.replaceChild(pNode, element);\n        container = util.getNodeFromPath(path, pNode);\n        offset += newOffsets[0];\n      }\n\n      return {\n        ancestor: pNode,\n        container: container,\n        offset: container.nodeType === 1 && offset === 1 ? container.childNodes.length : offset\n      };\n    },\n\n    /**\r\n     * @description Run plugin calls and basic commands.\r\n     * @param {String} command Command string\r\n     * @param {String} display Display type string ('command', 'submenu', 'dialog', 'container')\r\n     * @param {Element} target The element of command button\r\n     */\n    actionCall: function actionCall(command, display, target) {\n      // call plugins\n      if (display) {\n        if (/more/i.test(display)) {\n          if (target !== this._moreLayerActiveButton) {\n            var layer = context.element.toolbar.querySelector('.' + command);\n\n            if (layer) {\n              if (this._moreLayerActiveButton) this.moreLayerOff();\n              this._moreLayerActiveButton = target;\n              layer.style.display = 'block';\n\n              event._showToolbarBalloon();\n\n              event._showToolbarInline();\n            }\n\n            util.addClass(target, 'on');\n          } else {\n            var _layer = context.element.toolbar.querySelector('.' + this._moreLayerActiveButton.getAttribute('data-command'));\n\n            if (_layer) {\n              this.moreLayerOff();\n\n              event._showToolbarBalloon();\n\n              event._showToolbarInline();\n            }\n          }\n\n          return;\n        }\n\n        if (/container/.test(display) && (this._menuTray[command] === null || target !== this.containerActiveButton)) {\n          this.callPlugin(command, this.containerOn.bind(this, target), target);\n          return;\n        }\n\n        if (this.isReadOnly && util.arrayIncludes(this.resizingDisabledButtons, target)) return;\n\n        if (/submenu/.test(display) && (this._menuTray[command] === null || target !== this.submenuActiveButton)) {\n          this.callPlugin(command, this.submenuOn.bind(this, target), target);\n          return;\n        } else if (/dialog/.test(display)) {\n          this.callPlugin(command, this.plugins[command].open.bind(this), target);\n          return;\n        } else if (/command/.test(display)) {\n          this.callPlugin(command, this.plugins[command].action.bind(this), target);\n        } else if (/fileBrowser/.test(display)) {\n          this.callPlugin(command, this.plugins[command].open.bind(this, null), target);\n        }\n      } // default command\n      else if (command) {\n        this.commandHandler(target, command);\n      }\n\n      if (/submenu/.test(display)) {\n        this.submenuOff();\n      } else if (!/command/.test(display)) {\n        this.submenuOff();\n        this.containerOff();\n      }\n    },\n\n    /**\r\n     * @description Execute command of command button(All Buttons except submenu and dialog)\r\n     * (selectAll, codeView, fullScreen, indent, outdent, undo, redo, removeFormat, print, preview, showBlocks, save, bold, underline, italic, strike, subscript, superscript, copy, cut, paste)\r\n     * @param {Element|null} target The element of command button\r\n     * @param {String} command Property of command button (data-value)\r\n     */\n    commandHandler: function commandHandler(target, command) {\n      if (core.isReadOnly && !/copy|cut|selectAll|codeView|fullScreen|print|preview|showBlocks/.test(command)) return;\n\n      switch (command) {\n        case 'copy':\n        case 'cut':\n          this.execCommand(command);\n          break;\n\n        case 'paste':\n          break;\n\n        case 'selectAll':\n          this.containerOff();\n          var wysiwyg = context.element.wysiwyg;\n          var first = util.getChildElement(wysiwyg.firstChild, function (current) {\n            return current.childNodes.length === 0 || current.nodeType === 3;\n          }, false) || wysiwyg.firstChild;\n          var last = util.getChildElement(wysiwyg.lastChild, function (current) {\n            return current.childNodes.length === 0 || current.nodeType === 3;\n          }, true) || wysiwyg.lastChild;\n          if (!first || !last) return;\n\n          if (util.isMedia(first)) {\n            var info = this.getFileComponent(first);\n            var br = util.createElement('BR');\n            var format = util.createElement(options.defaultTag);\n            format.appendChild(br);\n            first = info ? info.component : first;\n            first.parentNode.insertBefore(format, first);\n            first = br;\n          }\n\n          if (util.isMedia(last)) {\n            var _br = util.createElement('BR');\n\n            var _format2 = util.createElement(options.defaultTag);\n\n            _format2.appendChild(_br);\n\n            wysiwyg.appendChild(_format2);\n            last = _br;\n          }\n\n          event._showToolbarBalloon(this.setRange(first, 0, last, last.textContent.length));\n\n          break;\n\n        case 'codeView':\n          this.toggleCodeView();\n          break;\n\n        case 'fullScreen':\n          this.toggleFullScreen(target);\n          break;\n\n        case 'indent':\n        case 'outdent':\n          this.indent(command);\n          break;\n\n        case 'undo':\n          this.history.undo();\n          break;\n\n        case 'redo':\n          this.history.redo();\n          break;\n\n        case 'removeFormat':\n          this.removeFormat();\n          this.focus();\n          break;\n\n        case 'print':\n          this.print();\n          break;\n\n        case 'preview':\n          this.preview();\n          break;\n\n        case 'showBlocks':\n          this.toggleDisplayBlocks();\n          break;\n\n        case 'dir':\n          this.setDir(options.rtl ? 'ltr' : 'rtl');\n          break;\n\n        case 'dir_ltr':\n          this.setDir('ltr');\n          break;\n\n        case 'dir_rtl':\n          this.setDir('rtl');\n          break;\n\n        case 'save':\n          if (typeof options.callBackSave === 'function') {\n            options.callBackSave(this.getContents(false), this._variable.isChanged);\n          } else if (this._variable.isChanged && typeof functions.save === 'function') {\n            functions.save();\n          } else {\n            throw Error('[SUNEDITOR.core.commandHandler.fail] Please register call back function in creation option. (callBackSave : Function)');\n          }\n\n          this._variable.isChanged = false;\n          if (context.tool.save) context.tool.save.setAttribute('disabled', true);\n          break;\n\n        default:\n          // 'STRONG', 'U', 'EM', 'DEL', 'SUB', 'SUP'..\n          command = options._defaultCommand[command.toLowerCase()] || command;\n          if (!this.commandMap[command]) this.commandMap[command] = target;\n          var nodesMap = this._variable.currentNodesMap;\n          var cmd = nodesMap.indexOf(command) > -1 ? null : util.createElement(command);\n          var removeNode = command;\n\n          if (/^SUB$/i.test(command) && nodesMap.indexOf('SUP') > -1) {\n            removeNode = 'SUP';\n          } else if (/^SUP$/i.test(command) && nodesMap.indexOf('SUB') > -1) {\n            removeNode = 'SUB';\n          }\n\n          this.nodeChange(cmd, this._commandMapStyles[command] || null, [removeNode], false);\n          this.focus();\n      }\n    },\n\n    /**\r\n     * @description Remove format of the currently selected range\r\n     */\n    removeFormat: function removeFormat() {\n      this.nodeChange(null, null, null, null);\n    },\n\n    /**\r\n     * @description This method implements indentation to selected range.\r\n     * Setted \"margin-left\" to \"25px\" in the top \"P\" tag of the parameter node.\r\n     * @param {String} command Separator (\"indent\" or \"outdent\")\r\n     */\n    indent: function indent(command) {\n      var range = this.getRange();\n      var rangeLines = this.getSelectedElements(null);\n      var cells = [];\n      var shift = 'indent' !== command;\n      var marginDir = options.rtl ? 'marginRight' : 'marginLeft';\n      var sc = range.startContainer;\n      var ec = range.endContainer;\n      var so = range.startOffset;\n      var eo = range.endOffset;\n\n      for (var i = 0, len = rangeLines.length, f, margin; i < len; i++) {\n        f = rangeLines[i];\n\n        if (!util.isListCell(f) || !this.plugins.list) {\n          margin = /\\d+/.test(f.style[marginDir]) ? util.getNumber(f.style[marginDir], 0) : 0;\n\n          if (shift) {\n            margin -= 25;\n          } else {\n            margin += 25;\n          }\n\n          util.setStyle(f, marginDir, margin <= 0 ? '' : margin + 'px');\n        } else {\n          if (shift || f.previousElementSibling) {\n            cells.push(f);\n          }\n        }\n      } // list cells\n\n\n      if (cells.length > 0) {\n        this.plugins.list.editInsideList.call(this, shift, cells);\n      }\n\n      this.effectNode = null;\n      this.setRange(sc, so, ec, eo); // history stack\n\n      this.history.push(false);\n    },\n\n    /**\r\n     * @description Add or remove the class name of \"body\" so that the code block is visible\r\n     */\n    toggleDisplayBlocks: function toggleDisplayBlocks() {\n      var wysiwyg = context.element.wysiwyg;\n      util.toggleClass(wysiwyg, 'se-show-block');\n\n      if (util.hasClass(wysiwyg, 'se-show-block')) {\n        util.addClass(this._styleCommandMap.showBlocks, 'active');\n      } else {\n        util.removeClass(this._styleCommandMap.showBlocks, 'active');\n      }\n\n      this._resourcesStateChange();\n    },\n\n    /**\r\n     * @description Changes to code view or wysiwyg view\r\n     */\n    toggleCodeView: function toggleCodeView() {\n      var isCodeView = this._variable.isCodeView;\n      this.controllersOff();\n      util.setDisabledButtons(!isCodeView, this.codeViewDisabledButtons);\n\n      if (isCodeView) {\n        if (!util.isNonEditable(context.element.wysiwygFrame)) this._setCodeDataToEditor();\n        context.element.wysiwygFrame.scrollTop = 0;\n        context.element.code.style.display = 'none';\n        context.element.wysiwygFrame.style.display = 'block';\n        this._variable._codeOriginCssText = this._variable._codeOriginCssText.replace(/(\\s?display(\\s+)?:(\\s+)?)[a-zA-Z]+(?=;)/, 'display: none');\n        this._variable._wysiwygOriginCssText = this._variable._wysiwygOriginCssText.replace(/(\\s?display(\\s+)?:(\\s+)?)[a-zA-Z]+(?=;)/, 'display: block');\n        if (options.height === 'auto' && !options.codeMirrorEditor) context.element.code.style.height = '0px';\n        this._variable.isCodeView = false;\n\n        if (!this._variable.isFullScreen) {\n          this._notHideToolbar = false;\n\n          if (/balloon|balloon-always/i.test(options.mode)) {\n            context.element._arrow.style.display = '';\n            this._isInline = false;\n            this._isBalloon = true;\n\n            event._hideToolbar();\n          }\n        }\n\n        this.nativeFocus();\n        util.removeClass(this._styleCommandMap.codeView, 'active'); // history stack\n\n        if (!util.isNonEditable(context.element.wysiwygFrame)) {\n          this.history.push(false);\n\n          this.history._resetCachingButton();\n        }\n      } else {\n        this._setEditorDataToCodeView();\n\n        this._variable._codeOriginCssText = this._variable._codeOriginCssText.replace(/(\\s?display(\\s+)?:(\\s+)?)[a-zA-Z]+(?=;)/, 'display: block');\n        this._variable._wysiwygOriginCssText = this._variable._wysiwygOriginCssText.replace(/(\\s?display(\\s+)?:(\\s+)?)[a-zA-Z]+(?=;)/, 'display: none');\n        if (this._variable.isFullScreen) context.element.code.style.height = '100%';else if (options.height === 'auto' && !options.codeMirrorEditor) context.element.code.style.height = context.element.code.scrollHeight > 0 ? context.element.code.scrollHeight + 'px' : 'auto';\n        if (options.codeMirrorEditor) options.codeMirrorEditor.refresh();\n        this._variable.isCodeView = true;\n\n        if (!this._variable.isFullScreen) {\n          this._notHideToolbar = true;\n\n          if (this._isBalloon) {\n            context.element._arrow.style.display = 'none';\n            context.element.toolbar.style.left = '';\n            this._isInline = true;\n            this._isBalloon = false;\n\n            event._showToolbarInline();\n          }\n        }\n\n        this._variable._range = null;\n        context.element.code.focus();\n        util.addClass(this._styleCommandMap.codeView, 'active');\n      }\n\n      this._checkPlaceholder();\n\n      if (this.isReadOnly) util.setDisabledButtons(true, this.resizingDisabledButtons); // user event\n\n      if (typeof functions.toggleCodeView === 'function') functions.toggleCodeView(this._variable.isCodeView, this);\n    },\n\n    /**\r\n     * @description Convert the data of the code view and put it in the WYSIWYG area.\r\n     * @private\r\n     */\n    _setCodeDataToEditor: function _setCodeDataToEditor() {\n      var code_html = this._getCodeView();\n\n      if (options.fullPage) {\n        var parseDocument = this._parser.parseFromString(code_html, 'text/html');\n\n        var headChildren = parseDocument.head.children;\n\n        for (var i = 0, len = headChildren.length; i < len; i++) {\n          if (/^script$/i.test(headChildren[i].tagName)) {\n            parseDocument.head.removeChild(headChildren[i]);\n            i--, len--;\n          }\n        }\n\n        var headers = parseDocument.head.innerHTML;\n\n        if (!parseDocument.head.querySelector('link[rel=\"stylesheet\"]') || this.options.height === 'auto' && !parseDocument.head.querySelector('style')) {\n          headers += util._setIframeCssTags(this.options);\n        }\n\n        this._wd.head.innerHTML = headers;\n        this._wd.body.innerHTML = this.convertContentsForEditor(parseDocument.body.innerHTML);\n        var attrs = parseDocument.body.attributes;\n\n        for (var _i20 = 0, _len9 = attrs.length; _i20 < _len9; _i20++) {\n          if (attrs[_i20].name === 'contenteditable') continue;\n\n          this._wd.body.setAttribute(attrs[_i20].name, attrs[_i20].value);\n        }\n\n        if (!util.hasClass(this._wd.body, 'sun-editor-editable')) {\n          var editableClasses = options._editableClass.split(' ');\n\n          for (var _i21 = 0; _i21 < editableClasses.length; _i21++) {\n            util.addClass(this._wd.body, options._editableClass[_i21]);\n          }\n        }\n      } else {\n        context.element.wysiwyg.innerHTML = code_html.length > 0 ? this.convertContentsForEditor(code_html) : '<' + options.defaultTag + '><br></' + options.defaultTag + '>';\n      }\n    },\n\n    /**\r\n     * @description Convert the data of the WYSIWYG area and put it in the code view area.\r\n     * @private\r\n     */\n    _setEditorDataToCodeView: function _setEditorDataToCodeView() {\n      var codeContents = this.convertHTMLForCodeView(context.element.wysiwyg, false);\n      var codeValue = '';\n\n      if (options.fullPage) {\n        var attrs = util.getAttributesToString(this._wd.body, null);\n        codeValue = '<!DOCTYPE html>\\n<html>\\n' + this._wd.head.outerHTML.replace(/>(?!\\n)/g, '>\\n') + '<body ' + attrs + '>\\n' + codeContents + '</body>\\n</html>';\n      } else {\n        codeValue = codeContents;\n      }\n\n      context.element.code.style.display = 'block';\n      context.element.wysiwygFrame.style.display = 'none';\n\n      this._setCodeView(codeValue);\n    },\n\n    /**\r\n     * @description Changes to full screen or default screen\r\n     * @param {Element|null} element full screen button\r\n     */\n    toggleFullScreen: function toggleFullScreen(element) {\n      var topArea = context.element.topArea;\n      var toolbar = context.element.toolbar;\n      var editorArea = context.element.editorArea;\n      var wysiwygFrame = context.element.wysiwygFrame;\n      var code = context.element.code;\n      var _var = this._variable;\n      this.controllersOff();\n      var wasToolbarHidden = toolbar.style.display === 'none' || this._isInline && !this._inlineToolbarAttr.isShow;\n\n      if (!_var.isFullScreen) {\n        _var.isFullScreen = true;\n        _var._fullScreenAttrs.inline = this._isInline;\n        _var._fullScreenAttrs.balloon = this._isBalloon;\n\n        if (this._isInline || this._isBalloon) {\n          this._isInline = false;\n          this._isBalloon = false;\n        }\n\n        if (!!options.toolbarContainer) context.element.relative.insertBefore(toolbar, editorArea);\n        topArea.style.position = 'fixed';\n        topArea.style.top = '0';\n        topArea.style.left = '0';\n        topArea.style.width = '100%';\n        topArea.style.maxWidth = '100%';\n        topArea.style.height = '100%';\n        topArea.style.zIndex = '2147483647';\n\n        if (context.element._stickyDummy.style.display !== ('none' && '')) {\n          _var._fullScreenAttrs.sticky = true;\n          context.element._stickyDummy.style.display = 'none';\n          util.removeClass(toolbar, 'se-toolbar-sticky');\n        }\n\n        _var._bodyOverflow = _d.body.style.overflow;\n        _d.body.style.overflow = 'hidden';\n        _var._editorAreaOriginCssText = editorArea.style.cssText;\n        _var._wysiwygOriginCssText = wysiwygFrame.style.cssText;\n        _var._codeOriginCssText = code.style.cssText;\n        editorArea.style.cssText = toolbar.style.cssText = '';\n        wysiwygFrame.style.cssText = (wysiwygFrame.style.cssText.match(/\\s?display(\\s+)?:(\\s+)?[a-zA-Z]+;/) || [''])[0];\n        code.style.cssText = (code.style.cssText.match(/\\s?display(\\s+)?:(\\s+)?[a-zA-Z]+;/) || [''])[0];\n        toolbar.style.width = wysiwygFrame.style.height = code.style.height = '100%';\n        toolbar.style.position = 'relative';\n        toolbar.style.display = 'block';\n        _var.innerHeight_fullScreen = _w.innerHeight - toolbar.offsetHeight;\n        editorArea.style.height = _var.innerHeight_fullScreen - options.fullScreenOffset + 'px';\n        if (element) util.changeElement(element.firstElementChild, icons.reduction);\n\n        if (options.iframe && options.height === 'auto') {\n          editorArea.style.overflow = 'auto';\n\n          this._iframeAutoHeight();\n        }\n\n        context.element.topArea.style.marginTop = options.fullScreenOffset + 'px';\n        util.addClass(this._styleCommandMap.fullScreen, 'active');\n      } else {\n        _var.isFullScreen = false;\n        wysiwygFrame.style.cssText = _var._wysiwygOriginCssText;\n        code.style.cssText = _var._codeOriginCssText;\n        toolbar.style.cssText = '';\n        editorArea.style.cssText = _var._editorAreaOriginCssText;\n        topArea.style.cssText = _var._originCssText;\n        _d.body.style.overflow = _var._bodyOverflow;\n        if (options.height === 'auto' && !options.codeMirrorEditor) event._codeViewAutoHeight();\n        if (!!options.toolbarContainer) options.toolbarContainer.appendChild(toolbar);\n\n        if (options.stickyToolbar > -1) {\n          util.removeClass(toolbar, 'se-toolbar-sticky');\n        }\n\n        if (_var._fullScreenAttrs.sticky && !options.toolbarContainer) {\n          _var._fullScreenAttrs.sticky = false;\n          context.element._stickyDummy.style.display = 'block';\n          util.addClass(toolbar, \"se-toolbar-sticky\");\n        }\n\n        this._isInline = _var._fullScreenAttrs.inline;\n        this._isBalloon = _var._fullScreenAttrs.balloon;\n        if (this._isInline) event._showToolbarInline();\n        if (!!options.toolbarContainer) util.removeClass(toolbar, 'se-toolbar-balloon');\n        event.onScroll_window();\n        if (element) util.changeElement(element.firstElementChild, icons.expansion);\n        context.element.topArea.style.marginTop = '';\n        util.removeClass(this._styleCommandMap.fullScreen, 'active');\n      }\n\n      if (wasToolbarHidden) functions.toolbar.hide(); // user event\n\n      if (typeof functions.toggleFullScreen === 'function') functions.toggleFullScreen(this._variable.isFullScreen, this);\n    },\n\n    /**\r\n     * @description Prints the current contents of the editor.\r\n     */\n    print: function print() {\n      var iframe = util.createElement('IFRAME');\n      iframe.style.display = 'none';\n\n      _d.body.appendChild(iframe);\n\n      var contentsHTML = options.printTemplate ? options.printTemplate.replace(/\\{\\{\\s*contents\\s*\\}\\}/i, this.getContents(true)) : this.getContents(true);\n      var printDocument = util.getIframeDocument(iframe);\n      var wDoc = this._wd;\n\n      if (options.iframe) {\n        var arrts = options._printClass !== null ? 'class=\"' + options._printClass + '\"' : options.fullPage ? util.getAttributesToString(wDoc.body, ['contenteditable']) : 'class=\"' + options._editableClass + '\"';\n        printDocument.write('' + '<!DOCTYPE html><html>' + '<head>' + wDoc.head.innerHTML + '</head>' + '<body ' + arrts + '>' + contentsHTML + '</body>' + '</html>');\n      } else {\n        var links = _d.head.getElementsByTagName('link');\n\n        var styles = _d.head.getElementsByTagName('style');\n\n        var linkHTML = '';\n\n        for (var i = 0, len = links.length; i < len; i++) {\n          linkHTML += links[i].outerHTML;\n        }\n\n        for (var _i22 = 0, _len10 = styles.length; _i22 < _len10; _i22++) {\n          linkHTML += styles[_i22].outerHTML;\n        }\n\n        printDocument.write('' + '<!DOCTYPE html><html>' + '<head>' + linkHTML + '</head>' + '<body class=\"' + (options._printClass !== null ? options._printClass : options._editableClass) + '\">' + contentsHTML + '</body>' + '</html>');\n      }\n\n      this.showLoading();\n\n      _w.setTimeout(function () {\n        try {\n          iframe.focus(); // IE or Edge, Chromium\n\n          if (util.isIE_Edge || util.isChromium || !!_d.documentMode || !!_w.StyleMedia) {\n            try {\n              iframe.contentWindow.document.execCommand('print', false, null);\n            } catch (e) {\n              iframe.contentWindow.print();\n            }\n          } else {\n            // Other browsers\n            iframe.contentWindow.print();\n          }\n        } catch (error) {\n          throw Error('[SUNEDITOR.core.print.fail] error: ' + error);\n        } finally {\n          core.closeLoading();\n          util.removeItem(iframe);\n        }\n      }, 1000);\n    },\n\n    /**\r\n     * @description Open the preview window.\r\n     */\n    preview: function preview() {\n      core.submenuOff();\n      core.containerOff();\n      core.controllersOff();\n      var contentsHTML = options.previewTemplate ? options.previewTemplate.replace(/\\{\\{\\s*contents\\s*\\}\\}/i, this.getContents(true)) : this.getContents(true);\n\n      var windowObject = _w.open('', '_blank');\n\n      windowObject.mimeType = 'text/html';\n      var wDoc = this._wd;\n\n      if (options.iframe) {\n        var arrts = options._printClass !== null ? 'class=\"' + options._printClass + '\"' : options.fullPage ? util.getAttributesToString(wDoc.body, ['contenteditable']) : 'class=\"' + options._editableClass + '\"';\n        windowObject.document.write('' + '<!DOCTYPE html><html>' + '<head>' + wDoc.head.innerHTML + '<style>body {overflow:auto !important; margin: 10px auto !important; height:auto !important; outline:1px dashed #ccc;}</style>' + '</head>' + '<body ' + arrts + '>' + contentsHTML + '</body>' + '</html>');\n      } else {\n        var links = _d.head.getElementsByTagName('link');\n\n        var styles = _d.head.getElementsByTagName('style');\n\n        var linkHTML = '';\n\n        for (var i = 0, len = links.length; i < len; i++) {\n          linkHTML += links[i].outerHTML;\n        }\n\n        for (var _i23 = 0, _len11 = styles.length; _i23 < _len11; _i23++) {\n          linkHTML += styles[_i23].outerHTML;\n        }\n\n        windowObject.document.write('' + '<!DOCTYPE html><html>' + '<head>' + '<meta charset=\"utf-8\" />' + '<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">' + '<title>' + lang.toolbar.preview + '</title>' + linkHTML + '</head>' + '<body class=\"' + (options._printClass !== null ? options._printClass : options._editableClass) + '\" style=\"margin:10px auto !important; height:auto !important; outline:1px dashed #ccc;\">' + contentsHTML + '</body>' + '</html>');\n      }\n    },\n\n    /**\r\n     * @description Set direction to \"rtl\" or \"ltr\".\r\n     * @param {String} dir \"rtl\" or \"ltr\"\r\n     */\n    setDir: function setDir(dir) {\n      var rtl = dir === 'rtl';\n      var changeDir = this._prevRtl !== rtl;\n      this._prevRtl = options.rtl = rtl;\n\n      if (changeDir) {\n        // align buttons\n        if (this.plugins.align) {\n          this.plugins.align.exchangeDir.call(this);\n        } // indent buttons\n\n\n        if (context.tool.indent) util.changeElement(context.tool.indent.firstElementChild, icons.indent);\n        if (context.tool.outdent) util.changeElement(context.tool.outdent.firstElementChild, icons.outdent);\n      }\n\n      var el = context.element;\n\n      if (rtl) {\n        util.addClass(el.topArea, 'se-rtl');\n        util.addClass(el.wysiwygFrame, 'se-rtl');\n      } else {\n        util.removeClass(el.topArea, 'se-rtl');\n        util.removeClass(el.wysiwygFrame, 'se-rtl');\n      }\n\n      var lineNodes = util.getListChildren(el.wysiwyg, function (current) {\n        return util.isFormatElement(current) && (current.style.marginRight || current.style.marginLeft || current.style.textAlign);\n      });\n\n      for (var i = 0, len = lineNodes.length, n, l, r; i < len; i++) {\n        n = lineNodes[i]; // indent margin\n\n        r = n.style.marginRight;\n        l = n.style.marginLeft;\n\n        if (r || l) {\n          n.style.marginRight = l;\n          n.style.marginLeft = r;\n        } // text align\n\n\n        r = n.style.textAlign;\n        if (r === 'left') n.style.textAlign = 'right';else if (r === 'right') n.style.textAlign = 'left';\n      }\n\n      var tool = context.tool;\n\n      if (tool.dir) {\n        util.changeTxt(tool.dir.querySelector('.se-tooltip-text'), lang.toolbar[options.rtl ? 'dir_ltr' : 'dir_rtl']);\n        util.changeElement(tool.dir.firstElementChild, icons[options.rtl ? 'dir_ltr' : 'dir_rtl']);\n      }\n\n      if (tool.dir_ltr) {\n        if (rtl) util.removeClass(tool.dir_ltr, 'active');else util.addClass(tool.dir_ltr, 'active');\n      }\n\n      if (tool.dir_rtl) {\n        if (rtl) util.addClass(tool.dir_rtl, 'active');else util.removeClass(tool.dir_rtl, 'active');\n      }\n    },\n\n    /**\r\n     * @description Sets the HTML string\r\n     * @param {String|undefined} html HTML string\r\n     */\n    setContents: function setContents(html) {\n      this.removeRange();\n      var convertValue = html === null || html === undefined ? '' : this.convertContentsForEditor(html);\n\n      this._resetComponents();\n\n      if (!this._variable.isCodeView) {\n        context.element.wysiwyg.innerHTML = convertValue; // history stack\n\n        this.history.push(false);\n      } else {\n        var value = this.convertHTMLForCodeView(convertValue, false);\n\n        this._setCodeView(value);\n      }\n    },\n\n    /**\r\n     * @description Sets the contents of the iframe's head tag and body tag when using the \"iframe\" or \"fullPage\" option.\r\n     * @param {Object} ctx { head: HTML string, body: HTML string}\r\n     */\n    setIframeContents: function setIframeContents(ctx) {\n      if (!options.iframe) return false;\n      if (ctx.head) this._wd.head.innerHTML = ctx.head.replace(/<script[\\s\\S]*>[\\s\\S]*<\\/script>/gi, '');\n      if (ctx.body) this._wd.body.innerHTML = this.convertContentsForEditor(ctx.body);\n    },\n\n    /**\r\n     * @description Gets the current contents\r\n     * @param {Boolean} onlyContents Return only the contents of the body without headers when the \"fullPage\" option is true\r\n     * @returns {Object}\r\n     */\n    getContents: function getContents(onlyContents) {\n      var contents = this.convertHTMLForCodeView(context.element.wysiwyg, true);\n      var renderHTML = util.createElement('DIV');\n      renderHTML.innerHTML = contents;\n      var figcaptions = util.getListChildren(renderHTML, function (current) {\n        return /FIGCAPTION/i.test(current.nodeName);\n      });\n\n      for (var i = 0, len = figcaptions.length; i < len; i++) {\n        figcaptions[i].removeAttribute('contenteditable');\n      }\n\n      if (options.fullPage && !onlyContents) {\n        var attrs = util.getAttributesToString(this._wd.body, ['contenteditable']);\n        return '<!DOCTYPE html><html>' + this._wd.head.outerHTML + '<body ' + attrs + '>' + renderHTML.innerHTML + '</body></html>';\n      } else {\n        return renderHTML.innerHTML;\n      }\n    },\n\n    /**\r\n     * @description Gets the current contents with containing parent div(div.sun-editor-editable).\r\n     * <div class=\"sun-editor-editable\">{contents}</div>\r\n     * @param {Boolean} onlyContents Return only the contents of the body without headers when the \"fullPage\" option is true\r\n     * @returns {String}\r\n     */\n    getFullContents: function getFullContents(onlyContents) {\n      return '<div class=\"sun-editor-editable' + (options.rtl ? ' se-rtl' : '') + '\">' + this.getContents(onlyContents) + '</div>';\n    },\n\n    /**\r\n     * @description Returns HTML string according to tag type and configuration.\r\n     * Use only \"cleanHTML\"\r\n     * @param {Node} node Node\r\n     * @param {Boolean} requireFormat If true, text nodes that do not have a format node is wrapped with the format tag.\r\n     * @private\r\n     */\n    _makeLine: function _makeLine(node, requireFormat) {\n      var defaultTag = options.defaultTag; // element\n\n      if (node.nodeType === 1) {\n        if (util._disallowedTags(node)) return '';\n        var ch = util.getListChildNodes(node, function (current) {\n          return util.isSpanWithoutAttr(current);\n        }) || [];\n\n        for (var i = ch.length - 1; i >= 0; i--) {\n          ch[i].outerHTML = ch[i].innerHTML;\n        }\n\n        if (!requireFormat || util.isFormatElement(node) || util.isRangeFormatElement(node) || util.isComponent(node) || util.isMedia(node) || util.isAnchor(node) && util.isMedia(node.firstElementChild)) {\n          return util.isSpanWithoutAttr(node) ? node.innerHTML : node.outerHTML;\n        } else {\n          return '<' + defaultTag + '>' + (util.isSpanWithoutAttr(node) ? node.innerHTML : node.outerHTML) + '</' + defaultTag + '>';\n        }\n      } // text\n\n\n      if (node.nodeType === 3) {\n        if (!requireFormat) return util._HTMLConvertor(node.textContent);\n        var textArray = node.textContent.split(/\\n/g);\n        var html = '';\n\n        for (var _i24 = 0, tLen = textArray.length, text; _i24 < tLen; _i24++) {\n          text = textArray[_i24].trim();\n          if (text.length > 0) html += '<' + defaultTag + '>' + util._HTMLConvertor(text) + '</' + defaultTag + '>';\n        }\n\n        return html;\n      } // comments\n\n\n      if (node.nodeType === 8 && this._allowHTMLComments) {\n        return '<!--' + node.textContent.trim() + '-->';\n      }\n\n      return '';\n    },\n\n    /**\r\n     * @description Removes attribute values such as style and converts tags that do not conform to the \"html5\" standard.\r\n     * @param {String} text \r\n     * @returns {String} HTML string\r\n     * @private\r\n     */\n    _tagConvertor: function _tagConvertor(text) {\n      if (!this._disallowedTextTagsRegExp) return text;\n      var ec = options._textTagsMap;\n      return text.replace(this._disallowedTextTagsRegExp, function (m, t, n, p) {\n        return t + (typeof ec[n] === 'string' ? ec[n] : n) + (p ? ' ' + p : '');\n      });\n    },\n\n    /**\r\n     * @description Delete disallowed tags\r\n     * @param {String} html HTML string\r\n     * @returns {String}\r\n     * @private\r\n     */\n    _deleteDisallowedTags: function _deleteDisallowedTags(html) {\n      return html.replace(/\\n/g, '').replace(/<(script|style)[\\s\\S]*>[\\s\\S]*<\\/(script|style)>/gi, '').replace(/<[a-z0-9]+\\:[a-z0-9]+[^>^\\/]*>[^>]*<\\/[a-z0-9]+\\:[a-z0-9]+>/gi, '').replace(this.editorTagsWhitelistRegExp, '').replace(this.editorTagsBlacklistRegExp, '');\n    },\n    _cleanStyle: function _cleanStyle(m, v, name) {\n      var sv = m.match(/style\\s*=\\s*(?:\"|')[^\"']*(?:\"|')/);\n\n      if (sv) {\n        if (!v) v = [];\n        var style = sv[0].replace(/&quot;/g, '').match(this._cleanStyleRegExp[name]);\n\n        if (style) {\n          var allowedStyle = [];\n\n          for (var i = 0, len = style.length, r; i < len; i++) {\n            r = style[i].match(/(.+)(:)([^:]+$)/);\n\n            if (r && !/inherit|initial/i.test(r[3])) {\n              var k = util.kebabToCamelCase(r[1].trim());\n\n              var _v = this.wwComputedStyle[k].replace(/\"/g, '');\n\n              var _c3 = r[3].trim();\n\n              switch (k) {\n                case 'fontFamily':\n                  if (!options.plugins.font || options.font.indexOf(_c3) === -1) continue;\n                  break;\n\n                case 'fontSize':\n                  if (!options.plugins.fontSize) continue;\n                  break;\n\n                case 'color':\n                  if (!options.plugins.fontColor || /rgba\\(([0-9]+\\s*,\\s*){3}0\\)|windowtext/i.test(_c3)) continue;\n                  break;\n\n                case 'backgroundColor':\n                  if (!options.plugins.hiliteColor || /rgba\\(([0-9]+\\s*,\\s*){3}0\\)|windowtext/i.test(_c3)) continue;\n                  break;\n              }\n\n              if (_v !== _c3) {\n                allowedStyle.push(r[0]);\n              }\n            }\n          }\n\n          if (allowedStyle.length > 0) v.push('style=\"' + allowedStyle.join(';') + '\"');\n        }\n      }\n\n      return v;\n    },\n\n    /**\r\n     * @description Tag and tag attribute check RegExp function. (used by \"cleanHTML\" and \"convertContentsForEditor\")\r\n     * @param {Boolean} lowLevelCheck Row level check\r\n     * @param {String} m RegExp value\r\n     * @param {String} t RegExp value\r\n     * @returns {String}\r\n     * @private\r\n     */\n    _cleanTags: function _cleanTags(lowLevelCheck, m, t) {\n      if (/^<[a-z0-9]+\\:[a-z0-9]+/i.test(m)) return m;\n      var v = null;\n      var tagName = t.match(/(?!<)[a-zA-Z0-9\\-]+/)[0].toLowerCase(); // blacklist\n\n      var bAttr = this._attributesTagsBlacklist[tagName];\n      m = m.replace(/\\s(?:on[a-z]+)\\s*=\\s*(\")[^\"]*\\1/ig, '');\n      if (bAttr) m = m.replace(bAttr, '');else m = m.replace(this._attributesBlacklistRegExp, ''); // whitelist\n\n      var wAttr = this._attributesTagsWhitelist[tagName];\n      if (wAttr) v = m.match(wAttr);else v = m.match(lowLevelCheck ? this._attributesWhitelistRegExp : this._attributesWhitelistRegExp_all_data); // attribute\n\n      if (lowLevelCheck) {\n        if (tagName === 'a') {\n          var sv = m.match(/(?:(?:id|name)\\s*=\\s*(?:\"|')[^\"']*(?:\"|'))/g);\n\n          if (sv) {\n            if (!v) v = [];\n            v.push(sv[0]);\n          }\n        } else if (!v || !/style=/i.test(v.toString())) {\n          if (tagName === 'span') {\n            v = this._cleanStyle(m, v, 'span');\n          } else if (/^(P|DIV|H[1-6]|PRE)$/i.test(tagName)) {\n            v = this._cleanStyle(m, v, 'format');\n          }\n        }\n      } else {\n        var _sv = m.match(/style\\s*=\\s*(?:\"|')[^\"']*(?:\"|')/);\n\n        if (_sv && !v) v = [_sv[0]];else if (_sv && !v.some(function (v) {\n          return /^style/.test(v.trim());\n        })) v.push(_sv[0]);\n      } // img\n\n\n      if (tagName === 'img') {\n        var w = '',\n            h = '';\n\n        var _sv2 = m.match(/style\\s*=\\s*(?:\"|')[^\"']*(?:\"|')/);\n\n        if (!v) v = [];\n\n        if (_sv2) {\n          w = _sv2[0].match(/width:(.+);/);\n          w = util.getNumber(w ? w[1] : '', -1) || '';\n          h = _sv2[0].match(/height:(.+);/);\n          h = util.getNumber(h ? h[1] : '', -1) || '';\n        }\n\n        if (!w || !h) {\n          var avw = m.match(/width\\s*=\\s*((?:\"|')[^\"']*(?:\"|'))/);\n          var avh = m.match(/height\\s*=\\s*((?:\"|')[^\"']*(?:\"|'))/);\n\n          if (avw || avh) {\n            w = !w ? util.getNumber(avw ? avw[1] : '') || '' : w;\n            h = !h ? util.getNumber(avh ? avh[1] : '') || '' : h;\n          }\n        }\n\n        v.push('data-origin=\"' + (w + ',' + h) + '\"');\n      }\n\n      if (v) {\n        for (var i = 0, len = v.length; i < len; i++) {\n          if (lowLevelCheck && /^class=\"(?!(__se__|se-|katex))/.test(v[i].trim())) continue;\n          t += ' ' + (/^(?:href|src)\\s*=\\s*('|\"|\\s)*javascript\\s*\\:/i.test(v[i].trim()) ? '' : v[i]);\n        }\n      }\n\n      return t;\n    },\n\n    /**\r\n     * @description Determines if formatting is required and returns a domTree\r\n     * @param {Element} dom documentFragment\r\n     * @returns {Element}\r\n     * @private\r\n     */\n    _editFormat: function _editFormat(dom) {\n      var value = '',\n          f;\n      var tempTree = dom.childNodes;\n\n      for (var i = 0, len = tempTree.length, n; i < len; i++) {\n        n = tempTree[i];\n\n        if (!util.isFormatElement(n) && !util.isRangeFormatElement(n) && !util.isComponent(n) && !/meta/i.test(n.nodeName)) {\n          if (!f) f = util.createElement(options.defaultTag);\n          f.appendChild(n);\n          i--;\n          len--;\n        } else {\n          if (f) {\n            value += f.outerHTML;\n            f = null;\n          }\n\n          value += n.outerHTML;\n        }\n      }\n\n      if (f) value += f.outerHTML;\n      return _d.createRange().createContextualFragment(value);\n    },\n    _convertListCell: function _convertListCell(domTree) {\n      var html = '';\n\n      for (var i = 0, len = domTree.length, node; i < len; i++) {\n        node = domTree[i];\n\n        if (node.nodeType === 1) {\n          if (util.isList(node)) {\n            html += node.innerHTML;\n          } else if (util.isListCell(node)) {\n            html += node.outerHTML;\n          } else if (util.isFormatElement(node)) {\n            html += '<li>' + (node.innerHTML.trim() || '<br>') + '</li>';\n          } else if (util.isRangeFormatElement(node) && !util.isTable(node)) {\n            html += this._convertListCell(node);\n          } else {\n            html += '<li>' + node.outerHTML + '</li>';\n          }\n        } else {\n          html += '<li>' + (node.textContent || '<br>') + '</li>';\n        }\n      }\n\n      return html;\n    },\n    _isFormatData: function _isFormatData(domTree) {\n      var requireFormat = false;\n\n      for (var i = 0, len = domTree.length, t; i < len; i++) {\n        t = domTree[i];\n\n        if (t.nodeType === 1 && !util.isTextStyleElement(t) && !util.isBreak(t) && !util._disallowedTags(t)) {\n          requireFormat = true;\n          break;\n        }\n      }\n\n      return requireFormat;\n    },\n\n    /**\r\n     * @description Gets the clean HTML code for editor\r\n     * @param {String} html HTML string\r\n     * @param {String|RegExp|null} whitelist Regular expression of allowed tags.\r\n     * RegExp object is create by util.createTagsWhitelist method. (core.pasteTagsWhitelistRegExp)\r\n     * @param {String|RegExp|null} blacklist Regular expression of disallowed tags.\r\n     * RegExp object is create by util.createTagsBlacklist method. (core.pasteTagsBlacklistRegExp)\r\n     * @returns {String}\r\n     */\n    cleanHTML: function cleanHTML(html, whitelist, blacklist) {\n      html = this._deleteDisallowedTags(this._parser.parseFromString(html, 'text/html').body.innerHTML).replace(/(<[a-zA-Z0-9\\-]+)[^>]*(?=>)/g, this._cleanTags.bind(this, true)).replace(/^.+\\x3C!--StartFragment--\\>|\\x3C!--EndFragment-->.+$/g, '');\n\n      var dom = _d.createRange().createContextualFragment(html);\n\n      try {\n        util._consistencyCheckOfHTML(dom, this._htmlCheckWhitelistRegExp, this._htmlCheckBlacklistRegExp, true);\n      } catch (error) {\n        console.warn('[SUNEDITOR.cleanHTML.consistencyCheck.fail] ' + error);\n      }\n\n      if (this.managedTagsInfo && this.managedTagsInfo.query) {\n        var textCompList = dom.querySelectorAll(this.managedTagsInfo.query);\n\n        for (var i = 0, len = textCompList.length, initMethod, classList; i < len; i++) {\n          classList = [].slice.call(textCompList[i].classList);\n\n          for (var _c4 = 0, cLen = classList.length; _c4 < cLen; _c4++) {\n            initMethod = this.managedTagsInfo.map[classList[_c4]];\n\n            if (initMethod) {\n              initMethod(textCompList[i]);\n              break;\n            }\n          }\n        }\n      }\n\n      var domTree = dom.childNodes;\n      var cleanHTML = '';\n\n      var requireFormat = this._isFormatData(domTree);\n\n      if (requireFormat) {\n        domTree = this._editFormat(dom).childNodes;\n      }\n\n      for (var _i25 = 0, _len12 = domTree.length; _i25 < _len12; _i25++) {\n        cleanHTML += this._makeLine(domTree[_i25], requireFormat);\n      }\n\n      cleanHTML = util.htmlRemoveWhiteSpace(cleanHTML);\n\n      if (!cleanHTML) {\n        cleanHTML = html;\n      } else {\n        if (whitelist) cleanHTML = cleanHTML.replace(typeof whitelist === 'string' ? util.createTagsWhitelist(whitelist) : whitelist, '');\n        if (blacklist) cleanHTML = cleanHTML.replace(typeof blacklist === 'string' ? util.createTagsBlacklist(blacklist) : blacklist, '');\n      }\n\n      return this._tagConvertor(cleanHTML);\n    },\n\n    /**\r\n     * @description Converts contents into a format that can be placed in an editor\r\n     * @param {String} contents contents\r\n     * @returns {String}\r\n     */\n    convertContentsForEditor: function convertContentsForEditor(contents) {\n      contents = this._deleteDisallowedTags(this._parser.parseFromString(contents, 'text/html').body.innerHTML).replace(/(<[a-zA-Z0-9\\-]+)[^>]*(?=>)/g, this._cleanTags.bind(this, false));\n\n      var dom = _d.createRange().createContextualFragment(contents);\n\n      try {\n        util._consistencyCheckOfHTML(dom, this._htmlCheckWhitelistRegExp, this._htmlCheckBlacklistRegExp, false);\n      } catch (error) {\n        console.warn('[SUNEDITOR.convertContentsForEditor.consistencyCheck.fail] ' + error);\n      }\n\n      if (this.managedTagsInfo && this.managedTagsInfo.query) {\n        var textCompList = dom.querySelectorAll(this.managedTagsInfo.query);\n\n        for (var i = 0, len = textCompList.length, initMethod, classList; i < len; i++) {\n          classList = [].slice.call(textCompList[i].classList);\n\n          for (var _c5 = 0, cLen = classList.length; _c5 < cLen; _c5++) {\n            initMethod = this.managedTagsInfo.map[classList[_c5]];\n\n            if (initMethod) {\n              initMethod(textCompList[i]);\n              break;\n            }\n          }\n        }\n      }\n\n      var domTree = dom.childNodes;\n      var cleanHTML = '',\n          p = null;\n\n      for (var _i26 = 0, t; _i26 < domTree.length; _i26++) {\n        t = domTree[_i26];\n\n        if (!util.isFormatElement(t) && !util.isRangeFormatElement(t) && !util.isComponent(t) && !util.isMedia(t) && t.nodeType !== 8) {\n          if (!p) p = util.createElement(options.defaultTag);\n          p.appendChild(t);\n          _i26--;\n\n          if (domTree[_i26 + 1] && !util.isFormatElement(domTree[_i26 + 1])) {\n            continue;\n          } else {\n            t = p;\n            p = null;\n          }\n        }\n\n        if (p) {\n          cleanHTML += this._makeLine(p, true);\n          p = null;\n        }\n\n        cleanHTML += this._makeLine(t, true);\n      }\n\n      if (p) cleanHTML += this._makeLine(p, true);\n      if (cleanHTML.length === 0) return '<' + options.defaultTag + '><br></' + options.defaultTag + '>';\n      cleanHTML = util.htmlRemoveWhiteSpace(cleanHTML);\n      return this._tagConvertor(cleanHTML);\n    },\n\n    /**\r\n     * @description Converts wysiwyg area element into a format that can be placed in an editor of code view mode\r\n     * @param {Element|String} html WYSIWYG element (context.element.wysiwyg) or HTML string.\r\n     * @param {Boolean} comp If true, does not line break and indentation of tags.\r\n     * @returns {String}\r\n     */\n    convertHTMLForCodeView: function convertHTMLForCodeView(html, comp) {\n      var returnHTML = '';\n      var wRegExp = _w.RegExp;\n      var brReg = new wRegExp('^(BLOCKQUOTE|PRE|TABLE|THEAD|TBODY|TR|TH|TD|OL|UL|IMG|IFRAME|VIDEO|AUDIO|FIGURE|FIGCAPTION|HR|BR|CANVAS|SELECT)$', 'i');\n      var wDoc = typeof html === 'string' ? _d.createRange().createContextualFragment(html) : html;\n\n      var isFormat = function (current) {\n        return this.isFormatElement(current) || this.isComponent(current);\n      }.bind(util);\n\n      var brChar = comp ? '' : '\\n';\n      var indentSize = comp ? 0 : this._variable.codeIndent * 1;\n      indentSize = indentSize > 0 ? new _w.Array(indentSize + 1).join(' ') : '';\n\n      (function recursionFunc(element, indent) {\n        var children = element.childNodes;\n        var elementRegTest = brReg.test(element.nodeName);\n        var elementIndent = elementRegTest ? indent : '';\n\n        for (var i = 0, len = children.length, node, br, lineBR, nodeRegTest, tag, tagIndent; i < len; i++) {\n          node = children[i];\n          nodeRegTest = brReg.test(node.nodeName);\n          br = nodeRegTest ? brChar : '';\n          lineBR = isFormat(node) && !elementRegTest && !/^(TH|TD)$/i.test(element.nodeName) ? brChar : '';\n\n          if (node.nodeType === 8) {\n            returnHTML += '\\n<!-- ' + node.textContent.trim() + ' -->' + br;\n            continue;\n          }\n\n          if (node.nodeType === 3) {\n            if (!util.isList(node.parentElement)) returnHTML += util._HTMLConvertor(/^\\n+$/.test(node.data) ? '' : node.data);\n            continue;\n          }\n\n          if (node.childNodes.length === 0) {\n            returnHTML += (/^HR$/i.test(node.nodeName) ? brChar : '') + (/^PRE$/i.test(node.parentElement.nodeName) && /^BR$/i.test(node.nodeName) ? '' : elementIndent) + node.outerHTML + br;\n            continue;\n          }\n\n          if (!node.outerHTML) {\n            // IE\n            returnHTML += new _w.XMLSerializer().serializeToString(node);\n          } else {\n            tag = node.nodeName.toLowerCase();\n            tagIndent = elementIndent || nodeRegTest ? indent : '';\n            returnHTML += (lineBR || (elementRegTest ? '' : br)) + tagIndent + node.outerHTML.match(wRegExp('<' + tag + '[^>]*>', 'i'))[0] + br;\n            recursionFunc(node, indent + indentSize, '');\n            returnHTML += (/\\n$/.test(returnHTML) ? tagIndent : '') + '</' + tag + '>' + (lineBR || br || elementRegTest ? brChar : '' || /^(TH|TD)$/i.test(node.nodeName) ? brChar : '');\n          }\n        }\n      })(wDoc, '');\n\n      return returnHTML.trim() + brChar;\n    },\n\n    /**\r\n     * @description Add an event to document.\r\n     * When created as an Iframe, the same event is added to the document in the Iframe.\r\n     * @param {String} type Event type\r\n     * @param {Function} listener Event listener\r\n     * @param {Boolean} useCapture Use event capture\r\n     */\n    addDocEvent: function addDocEvent(type, listener, useCapture) {\n      _d.addEventListener(type, listener, useCapture);\n\n      if (options.iframe) {\n        this._wd.addEventListener(type, listener);\n      }\n    },\n\n    /**\r\n     * @description Remove events from document.\r\n     * When created as an Iframe, the event of the document inside the Iframe is also removed.\r\n     * @param {String} type Event type\r\n     * @param {Function} listener Event listener\r\n     */\n    removeDocEvent: function removeDocEvent(type, listener) {\n      _d.removeEventListener(type, listener);\n\n      if (options.iframe) {\n        this._wd.removeEventListener(type, listener);\n      }\n    },\n\n    /**\r\n     * @description The current number of characters is counted and displayed.\r\n     * @param {String} inputText Text added.\r\n     * @returns {Boolean}\r\n     * @private\r\n     */\n    _charCount: function _charCount(inputText) {\n      var maxCharCount = options.maxCharCount;\n      var countType = options.charCounterType;\n      var nextCharCount = 0;\n      if (!!inputText) nextCharCount = this.getCharLength(inputText, countType);\n\n      this._setCharCount();\n\n      if (maxCharCount > 0) {\n        var over = false;\n        var count = functions.getCharCount(countType);\n\n        if (count > maxCharCount) {\n          over = true;\n\n          if (nextCharCount > 0) {\n            this._editorRange();\n\n            var range = this.getRange();\n            var endOff = range.endOffset - 1;\n            var text = this.getSelectionNode().textContent;\n            var slicePosition = range.endOffset - (count - maxCharCount);\n            this.getSelectionNode().textContent = text.slice(0, slicePosition < 0 ? 0 : slicePosition) + text.slice(range.endOffset, text.length);\n            this.setRange(range.endContainer, endOff, range.endContainer, endOff);\n          }\n        } else if (count + nextCharCount > maxCharCount) {\n          over = true;\n        }\n\n        if (over) {\n          this._callCounterBlink();\n\n          if (nextCharCount > 0) return false;\n        }\n      }\n\n      return true;\n    },\n\n    /**\r\n     * @description When \"element\" is added, if it is greater than \"options.maxCharCount\", false is returned.\r\n     * @param {Node|String} element Element node or String.\r\n     * @param {String|null} charCounterType charCounterType. If it is null, the options.charCounterType\r\n     * @returns {Boolean}\r\n     */\n    checkCharCount: function checkCharCount(element, charCounterType) {\n      if (options.maxCharCount) {\n        var countType = charCounterType || options.charCounterType;\n        var length = this.getCharLength(typeof element === 'string' ? element : this._charTypeHTML && element.nodeType === 1 ? element.outerHTML : element.textContent, countType);\n\n        if (length > 0 && length + functions.getCharCount(countType) > options.maxCharCount) {\n          this._callCounterBlink();\n\n          return false;\n        }\n      }\n\n      return true;\n    },\n\n    /**\r\n     * @description Get the length of the content.\r\n     * Depending on the option, the length of the character is taken. (charCounterType)\r\n     * @param {String} content Content to count\r\n     * @param {String} charCounterType options.charCounterType\r\n     * @returns {Number}\r\n     */\n    getCharLength: function getCharLength(content, charCounterType) {\n      return /byte/.test(charCounterType) ? util.getByteLength(content) : content.length;\n    },\n\n    /**\r\n     * @description Reset buttons of the responsive toolbar.\r\n     */\n    resetResponsiveToolbar: function resetResponsiveToolbar() {\n      core.controllersOff();\n      var responsiveSize = event._responsiveButtonSize;\n\n      if (responsiveSize) {\n        var w = 0;\n\n        if ((core._isBalloon || core._isInline) && options.toolbarWidth === 'auto') {\n          w = context.element.topArea.offsetWidth;\n        } else {\n          w = context.element.toolbar.offsetWidth;\n        }\n\n        var responsiveWidth = 'default';\n\n        for (var i = 1, len = responsiveSize.length; i < len; i++) {\n          if (w < responsiveSize[i]) {\n            responsiveWidth = responsiveSize[i] + '';\n            break;\n          }\n        }\n\n        if (event._responsiveCurrentSize !== responsiveWidth) {\n          event._responsiveCurrentSize = responsiveWidth;\n          functions.setToolbarButtons(event._responsiveButtons[responsiveWidth]);\n        }\n      }\n    },\n\n    /**\r\n     * @description Set the char count to charCounter element textContent.\r\n     * @private\r\n     */\n    _setCharCount: function _setCharCount() {\n      if (context.element.charCounter) {\n        _w.setTimeout(function () {\n          context.element.charCounter.textContent = functions.getCharCount(options.charCounterType);\n        });\n      }\n    },\n\n    /**\r\n     * @description The character counter blinks.\r\n     * @private\r\n     */\n    _callCounterBlink: function _callCounterBlink() {\n      var charWrapper = context.element.charWrapper;\n\n      if (charWrapper && !util.hasClass(charWrapper, 'se-blink')) {\n        util.addClass(charWrapper, 'se-blink');\n\n        _w.setTimeout(function () {\n          util.removeClass(charWrapper, 'se-blink');\n        }, 600);\n      }\n    },\n\n    /**\r\n     * @description Check the components such as image and video and modify them according to the format.\r\n     * @private\r\n     */\n    _checkComponents: function _checkComponents() {\n      for (var i = 0, len = this._fileInfoPluginsCheck.length; i < len; i++) {\n        this._fileInfoPluginsCheck[i]();\n      }\n    },\n\n    /**\r\n     * @description Initialize the information of the components.\r\n     * @private\r\n     */\n    _resetComponents: function _resetComponents() {\n      for (var i = 0, len = this._fileInfoPluginsReset.length; i < len; i++) {\n        this._fileInfoPluginsReset[i]();\n      }\n    },\n\n    /**\r\n     * @description Set method in the code view area\r\n     * @param {String} value HTML string\r\n     * @private\r\n     */\n    _setCodeView: function _setCodeView(value) {\n      if (options.codeMirrorEditor) {\n        options.codeMirrorEditor.getDoc().setValue(value);\n      } else {\n        context.element.code.value = value;\n      }\n    },\n\n    /**\r\n     * @description Get method in the code view area\r\n     * @private\r\n     */\n    _getCodeView: function _getCodeView() {\n      return options.codeMirrorEditor ? options.codeMirrorEditor.getDoc().getValue() : context.element.code.value;\n    },\n\n    /**\r\n     * @description remove class, display text.\r\n     * @param {Array|null} ignoredList Igonred button list\r\n     */\n    _setKeyEffect: function _setKeyEffect(ignoredList) {\n      var commandMap = this.commandMap;\n      var activePlugins = this.activePlugins;\n\n      for (var key in commandMap) {\n        if (ignoredList.indexOf(key) > -1 || !util.hasOwn(commandMap, key)) continue;\n\n        if (activePlugins.indexOf(key) > -1) {\n          plugins[key].active.call(this, null);\n        } else if (commandMap.OUTDENT && /^OUTDENT$/i.test(key)) {\n          if (!util.isImportantDisabled(commandMap.OUTDENT)) commandMap.OUTDENT.setAttribute('disabled', true);\n        } else if (commandMap.INDENT && /^INDENT$/i.test(key)) {\n          if (!util.isImportantDisabled(commandMap.INDENT)) commandMap.INDENT.removeAttribute('disabled');\n        } else {\n          util.removeClass(commandMap[key], 'active');\n        }\n      }\n    },\n\n    /**\r\n     * @description Initializ core variable\r\n     * @param {Boolean} reload Is relooad?\r\n     * @param {String} _initHTML initial html string\r\n     * @private\r\n     */\n    _init: function _init(reload, _initHTML) {\n      var wRegExp = _w.RegExp;\n      this._ww = options.iframe ? context.element.wysiwygFrame.contentWindow : _w;\n      this._wd = _d;\n      this._charTypeHTML = options.charCounterType === 'byte-html';\n      this.wwComputedStyle = _w.getComputedStyle(context.element.wysiwyg);\n      this._editorHeight = context.element.wysiwygFrame.offsetHeight;\n      this._editorHeightPadding = util.getNumber(this.wwComputedStyle.getPropertyValue('padding-top')) + util.getNumber(this.wwComputedStyle.getPropertyValue('padding-bottom'));\n\n      if (!options.iframe && typeof _w.ShadowRoot === 'function') {\n        var child = context.element.wysiwygFrame;\n\n        while (child) {\n          if (child.shadowRoot) {\n            this._shadowRoot = child.shadowRoot;\n            break;\n          } else if (child instanceof _w.ShadowRoot) {\n            this._shadowRoot = child;\n            break;\n          }\n\n          child = child.parentNode;\n        }\n\n        if (this._shadowRoot) this._shadowRootControllerEventTarget = [];\n      } // set disallow text nodes\n\n\n      var disallowTextTags = _w.Object.keys(options._textTagsMap);\n\n      var allowTextTags = !options.addTagsWhitelist ? [] : options.addTagsWhitelist.split('|').filter(function (v) {\n        return /b|i|ins|s|strike/i.test(v);\n      });\n\n      for (var i = 0; i < allowTextTags.length; i++) {\n        disallowTextTags.splice(disallowTextTags.indexOf(allowTextTags[i].toLowerCase()), 1);\n      }\n\n      this._disallowedTextTagsRegExp = disallowTextTags.length === 0 ? null : new wRegExp('(<\\\\/?)(' + disallowTextTags.join('|') + ')\\\\b\\\\s*([^>^<]+)?\\\\s*(?=>)', 'gi'); // set whitelist\n\n      var getRegList = function getRegList(str, str2) {\n        return !str ? '^' : str === '*' ? '[a-z-]+' : !str2 ? str : str + '|' + str2;\n      }; // tags\n\n\n      var defaultAttr = 'contenteditable|colspan|rowspan|target|href|download|rel|src|alt|class|type|controls|origin-size';\n      var dataAttr = 'data-format|data-size|data-file-size|data-file-name|data-origin|data-align|data-image-link|data-rotate|data-proportion|data-percentage|data-exp|data-font-size';\n      this._allowHTMLComments = options._editorTagsWhitelist.indexOf('//') > -1 || options._editorTagsWhitelist === '*'; // html check\n\n      this._htmlCheckWhitelistRegExp = new wRegExp('^(' + getRegList(options._editorTagsWhitelist.replace('|//', ''), '') + ')$', 'i');\n      this._htmlCheckBlacklistRegExp = new wRegExp('^(' + (options.tagsBlacklist || '^') + ')$', 'i'); // tags\n\n      this.editorTagsWhitelistRegExp = util.createTagsWhitelist(getRegList(options._editorTagsWhitelist.replace('|//', '|<!--|-->'), ''));\n      this.editorTagsBlacklistRegExp = util.createTagsBlacklist(options.tagsBlacklist.replace('|//', '|<!--|-->')); // paste tags\n\n      this.pasteTagsWhitelistRegExp = util.createTagsWhitelist(getRegList(options.pasteTagsWhitelist, ''));\n      this.pasteTagsBlacklistRegExp = util.createTagsBlacklist(options.pasteTagsBlacklist); // attributes\n\n      var regEndStr = '\\\\s*=\\\\s*(\\\")[^\\\"]*\\\\1';\n      var _wAttr = options.attributesWhitelist;\n      var tagsAttr = {};\n      var allAttr = '';\n\n      if (!!_wAttr) {\n        for (var k in _wAttr) {\n          if (!util.hasOwn(_wAttr, k) || /^on[a-z]+$/i.test(_wAttr[k])) continue;\n\n          if (k === 'all') {\n            allAttr = getRegList(_wAttr[k], defaultAttr);\n          } else {\n            tagsAttr[k] = new wRegExp('\\\\s(?:' + getRegList(_wAttr[k], '') + ')' + regEndStr, 'ig');\n          }\n        }\n      }\n\n      this._attributesWhitelistRegExp = new wRegExp('\\\\s(?:' + (allAttr || defaultAttr + '|' + dataAttr) + ')' + regEndStr, 'ig');\n      this._attributesWhitelistRegExp_all_data = new wRegExp('\\\\s(?:' + ((allAttr || defaultAttr) + '|data-[a-z0-9\\\\-]+') + ')' + regEndStr, 'ig');\n      this._attributesTagsWhitelist = tagsAttr; // blacklist\n\n      var _bAttr = options.attributesBlacklist;\n      tagsAttr = {};\n      allAttr = '';\n\n      if (!!_bAttr) {\n        for (var _k in _bAttr) {\n          if (!util.hasOwn(_bAttr, _k)) continue;\n\n          if (_k === 'all') {\n            allAttr = getRegList(_bAttr[_k], '');\n          } else {\n            tagsAttr[_k] = new wRegExp('\\\\s(?:' + getRegList(_bAttr[_k], '') + ')' + regEndStr, 'ig');\n          }\n        }\n      }\n\n      this._attributesBlacklistRegExp = new wRegExp('\\\\s(?:' + (allAttr || '^') + ')' + regEndStr, 'ig');\n      this._attributesTagsBlacklist = tagsAttr; // set modes\n\n      this._isInline = /inline/i.test(options.mode);\n      this._isBalloon = /balloon|balloon-always/i.test(options.mode);\n      this._isBalloonAlways = /balloon-always/i.test(options.mode); // caching buttons\n\n      this._cachingButtons(); // file components\n\n\n      this._fileInfoPluginsCheck = [];\n      this._fileInfoPluginsReset = []; // text components\n\n      this.managedTagsInfo = {\n        query: '',\n        map: {}\n      };\n      var managedClass = []; // Command and file plugins registration\n\n      this.activePlugins = [];\n      this._fileManager.tags = [];\n      this._fileManager.pluginMap = {};\n      var filePluginRegExp = [];\n      var plugin, button;\n\n      for (var key in plugins) {\n        if (!util.hasOwn(plugins, key)) continue;\n        plugin = plugins[key];\n        button = pluginCallButtons[key];\n\n        if ((plugin.active || plugin.action) && button) {\n          this.callPlugin(key, null, button);\n        }\n\n        if (typeof plugin.checkFileInfo === 'function' && typeof plugin.resetFileInfo === 'function') {\n          this.callPlugin(key, null, button);\n\n          this._fileInfoPluginsCheck.push(plugin.checkFileInfo.bind(this));\n\n          this._fileInfoPluginsReset.push(plugin.resetFileInfo.bind(this));\n        }\n\n        if (_w.Array.isArray(plugin.fileTags)) {\n          var fileTags = plugin.fileTags;\n          this.callPlugin(key, null, button);\n          this._fileManager.tags = this._fileManager.tags.concat(fileTags);\n          filePluginRegExp.push(key);\n\n          for (var tag = 0, tLen = fileTags.length; tag < tLen; tag++) {\n            this._fileManager.pluginMap[fileTags[tag].toLowerCase()] = key;\n          }\n        }\n\n        if (plugin.managedTags) {\n          var info = plugin.managedTags();\n          managedClass.push('.' + info.className);\n          this.managedTagsInfo.map[info.className] = info.method.bind(this);\n        }\n      }\n\n      this.managedTagsInfo.query = managedClass.toString();\n      this._fileManager.queryString = this._fileManager.tags.join(',');\n      this._fileManager.regExp = new wRegExp('^(' + (this._fileManager.tags.join('|') || '^') + ')$', 'i');\n      this._fileManager.pluginRegExp = new wRegExp('^(' + (filePluginRegExp.length === 0 ? '^' : filePluginRegExp.join('|')) + ')$', 'i'); // cache editor's element\n\n      this._variable._originCssText = context.element.topArea.style.cssText;\n      this._placeholder = context.element.placeholder;\n      this._lineBreaker = context.element.lineBreaker;\n      this._lineBreakerButton = this._lineBreaker.querySelector('button'); // Excute history function\n\n      this.history = _history(this, this._onChange_historyStack.bind(this)); // register notice module\n\n      this.addModule([_notice]); // Init, validate\n\n      if (options.iframe) {\n        this._wd = context.element.wysiwygFrame.contentDocument;\n        context.element.wysiwyg = this._wd.body;\n        if (options._editorStyles.editor) context.element.wysiwyg.style.cssText = options._editorStyles.editor;\n        if (options.height === 'auto') this._iframeAuto = this._wd.body;\n      }\n\n      this._initWysiwygArea(reload, _initHTML);\n    },\n\n    /**\r\n     * @description Caching basic buttons to use\r\n     * @private\r\n     */\n    _cachingButtons: function _cachingButtons() {\n      this.codeViewDisabledButtons = context.element._buttonTray.querySelectorAll('.se-menu-list button[data-display]:not([class~=\"se-code-view-enabled\"]):not([data-display=\"MORE\"])');\n      this.resizingDisabledButtons = context.element._buttonTray.querySelectorAll('.se-menu-list button[data-display]:not([class~=\"se-resizing-enabled\"]):not([data-display=\"MORE\"])');\n\n      this._saveButtonStates();\n\n      var tool = context.tool;\n      this.commandMap = {\n        OUTDENT: tool.outdent,\n        INDENT: tool.indent\n      };\n      this.commandMap[options.textTags.bold.toUpperCase()] = tool.bold;\n      this.commandMap[options.textTags.underline.toUpperCase()] = tool.underline;\n      this.commandMap[options.textTags.italic.toUpperCase()] = tool.italic;\n      this.commandMap[options.textTags.strike.toUpperCase()] = tool.strike;\n      this.commandMap[options.textTags.sub.toUpperCase()] = tool.subscript;\n      this.commandMap[options.textTags.sup.toUpperCase()] = tool.superscript;\n      this._styleCommandMap = {\n        fullScreen: tool.fullScreen,\n        showBlocks: tool.showBlocks,\n        codeView: tool.codeView\n      };\n    },\n\n    /**\r\n     * @description Initializ wysiwyg area (Only called from core._init)\r\n     * @param {Boolean} reload Is relooad?\r\n     * @param {String} _initHTML initial html string\r\n     * @private\r\n     */\n    _initWysiwygArea: function _initWysiwygArea(reload, _initHTML) {\n      context.element.wysiwyg.innerHTML = reload ? _initHTML : this.convertContentsForEditor(typeof _initHTML === 'string' ? _initHTML : context.element.originElement.value);\n    },\n\n    /**\r\n     * @description Called when there are changes to tags in the wysiwyg region.\r\n     * @private\r\n     */\n    _resourcesStateChange: function _resourcesStateChange() {\n      this._iframeAutoHeight();\n\n      this._checkPlaceholder();\n    },\n\n    /**\r\n     * @description Called when after execute \"history.push\"\r\n     * @private\r\n     */\n    _onChange_historyStack: function _onChange_historyStack() {\n      if (this.hasFocus) event._applyTagEffects();\n      this._variable.isChanged = true;\n      if (context.tool.save) context.tool.save.removeAttribute('disabled'); // user event\n\n      if (functions.onChange) functions.onChange(this.getContents(true), this);\n      if (context.element.toolbar.style.display === 'block') event._showToolbarBalloon();\n    },\n\n    /**\r\n     * @description Modify the height value of the iframe when the height of the iframe is automatic.\r\n     * @private\r\n     */\n    _iframeAutoHeight: function _iframeAutoHeight() {\n      if (this._iframeAuto) {\n        _w.setTimeout(function () {\n          var h = core._iframeAuto.offsetHeight;\n          context.element.wysiwygFrame.style.height = h + 'px';\n          if (util.isIE) core.__callResizeFunction(h, null);\n        });\n      } else if (util.isIE) {\n        core.__callResizeFunction(context.element.wysiwygFrame.offsetHeight, null);\n      }\n    },\n    __callResizeFunction: function __callResizeFunction(h, resizeObserverEntry) {\n      h = h === -1 ? resizeObserverEntry.borderBoxSize ? resizeObserverEntry.borderBoxSize[0].blockSize : resizeObserverEntry.contentRect.height + this._editorHeightPadding : h;\n\n      if (this._editorHeight !== h) {\n        if (typeof functions.onResizeEditor === 'function') functions.onResizeEditor(h, this._editorHeight, core, resizeObserverEntry);\n        this._editorHeight = h;\n      }\n    },\n\n    /**\r\n     * @description Set display property when there is placeholder.\r\n     * @private\r\n     */\n    _checkPlaceholder: function _checkPlaceholder() {\n      if (this._placeholder) {\n        if (this._variable.isCodeView) {\n          this._placeholder.style.display = 'none';\n          return;\n        }\n\n        var wysiwyg = context.element.wysiwyg;\n\n        if (!util.onlyZeroWidthSpace(wysiwyg.textContent) || wysiwyg.querySelector(util._allowedEmptyNodeList) || (wysiwyg.innerText.match(/\\n/g) || '').length > 1) {\n          this._placeholder.style.display = 'none';\n        } else {\n          this._placeholder.style.display = 'block';\n        }\n      }\n    },\n\n    /**\r\n     * @description If there is no default format, add a format and move \"selection\".\r\n     * @param {String|null} formatName Format tag name (default: 'P')\r\n     * @returns {undefined|null}\r\n     * @private\r\n     */\n    _setDefaultFormat: function _setDefaultFormat(formatName) {\n      if (this._fileManager.pluginRegExp.test(this.currentControllerName)) return;\n      var range = this.getRange();\n      var commonCon = range.commonAncestorContainer;\n      var startCon = range.startContainer;\n      var rangeEl = util.getRangeFormatElement(commonCon, null);\n      var focusNode, offset, format;\n      var fileComponent = util.getParentElement(commonCon, util.isComponent);\n\n      if (fileComponent && !util.isTable(fileComponent)) {\n        return;\n      } else if (commonCon.nodeType === 1 && commonCon.getAttribute('data-se-embed') === 'true') {\n        var el = commonCon.nextElementSibling;\n        if (!util.isFormatElement(el)) el = this.appendFormatTag(commonCon, options.defaultTag);\n        this.setRange(el.firstChild, 0, el.firstChild, 0);\n        return;\n      }\n\n      if ((util.isRangeFormatElement(startCon) || util.isWysiwygDiv(startCon)) && (util.isComponent(startCon.children[range.startOffset]) || util.isComponent(startCon.children[range.startOffset - 1]))) return;\n      if (util.getParentElement(commonCon, util.isNotCheckingNode)) return null;\n\n      if (rangeEl) {\n        format = util.createElement(formatName || options.defaultTag);\n        format.innerHTML = rangeEl.innerHTML;\n        if (format.childNodes.length === 0) format.innerHTML = util.zeroWidthSpace;\n        rangeEl.innerHTML = format.outerHTML;\n        format = rangeEl.firstChild;\n        focusNode = util.getEdgeChildNodes(format, null).sc;\n\n        if (!focusNode) {\n          focusNode = util.createTextNode(util.zeroWidthSpace);\n          format.insertBefore(focusNode, format.firstChild);\n        }\n\n        offset = focusNode.textContent.length;\n        this.setRange(focusNode, offset, focusNode, offset);\n        return;\n      }\n\n      if (util.isRangeFormatElement(commonCon) && commonCon.childNodes.length <= 1) {\n        var br = null;\n\n        if (commonCon.childNodes.length === 1 && util.isBreak(commonCon.firstChild)) {\n          br = commonCon.firstChild;\n        } else {\n          br = util.createTextNode(util.zeroWidthSpace);\n          commonCon.appendChild(br);\n        }\n\n        this.setRange(br, 1, br, 1);\n        return;\n      }\n\n      this.execCommand('formatBlock', false, formatName || options.defaultTag);\n      focusNode = util.getEdgeChildNodes(commonCon, commonCon);\n      focusNode = focusNode ? focusNode.ec : commonCon;\n      format = util.getFormatElement(focusNode, null);\n\n      if (!format) {\n        this.removeRange();\n\n        this._editorRange();\n\n        return;\n      }\n\n      if (util.isBreak(format.nextSibling)) util.removeItem(format.nextSibling);\n      if (util.isBreak(format.previousSibling)) util.removeItem(format.previousSibling);\n\n      if (util.isBreak(focusNode)) {\n        var zeroWidth = util.createTextNode(util.zeroWidthSpace);\n        focusNode.parentNode.insertBefore(zeroWidth, focusNode);\n        focusNode = zeroWidth;\n      }\n\n      this.effectNode = null;\n      this.nativeFocus();\n    },\n\n    /**\r\n     * @description Initialization after \"setOptions\"\r\n     * @param {Object} el context.element\r\n     * @param {String} _initHTML Initial html string\r\n     * @private\r\n     */\n    _setOptionsInit: function _setOptionsInit(el, _initHTML) {\n      this.context = context = _Context(el.originElement, this._getConstructed(el), options);\n      this._componentsInfoReset = true;\n\n      this._editorInit(true, _initHTML);\n    },\n\n    /**\r\n     * @description Initializ editor\r\n     * @param {Boolean} reload Is relooad?\r\n     * @param {String} _initHTML initial html string\r\n     * @private\r\n     */\n    _editorInit: function _editorInit(reload, _initHTML) {\n      // initialize core and add event listeners\n      this._init(reload, _initHTML);\n\n      event._addEvent();\n\n      this._setCharCount();\n\n      event._offStickyToolbar();\n\n      event.onResize_window(); // toolbar visibility\n\n      context.element.toolbar.style.visibility = '';\n\n      this._checkComponents();\n\n      this._componentsInfoInit = false;\n      this._componentsInfoReset = false;\n      this.history.reset(true);\n\n      this._resourcesStateChange();\n\n      _w.setTimeout(function () {\n        // observer\n        if (event._resizeObserver) event._resizeObserver.observe(context.element.wysiwygFrame);\n        if (event._toolbarObserver) event._toolbarObserver.observe(context.element._toolbarShadow); // user event\n\n        if (typeof functions.onload === 'function') functions.onload(core, reload);\n      });\n    },\n\n    /**\r\n     * @description Create and return an object to cache the new context.\r\n     * @param {Element} contextEl context.element\r\n     * @returns {Object}\r\n     * @private\r\n     */\n    _getConstructed: function _getConstructed(contextEl) {\n      return {\n        _top: contextEl.topArea,\n        _relative: contextEl.relative,\n        _toolBar: contextEl.toolbar,\n        _toolbarShadow: contextEl._toolbarShadow,\n        _menuTray: contextEl._menuTray,\n        _editorArea: contextEl.editorArea,\n        _wysiwygArea: contextEl.wysiwygFrame,\n        _codeArea: contextEl.code,\n        _placeholder: contextEl.placeholder,\n        _resizingBar: contextEl.resizingBar,\n        _navigation: contextEl.navigation,\n        _charCounter: contextEl.charCounter,\n        _charWrapper: contextEl.charWrapper,\n        _loading: contextEl.loading,\n        _lineBreaker: contextEl.lineBreaker,\n        _lineBreaker_t: contextEl.lineBreaker_t,\n        _lineBreaker_b: contextEl.lineBreaker_b,\n        _resizeBack: contextEl.resizeBackground,\n        _stickyDummy: contextEl._stickyDummy,\n        _arrow: contextEl._arrow\n      };\n    }\n  };\n  /**\r\n   * @description event function\r\n   */\n\n  var event = {\n    _IEisComposing: false,\n    // In IE, there is no \"e.isComposing\" in the key-up event.\n    _lineBreakerBind: null,\n    _responsiveCurrentSize: 'default',\n    _responsiveButtonSize: null,\n    _responsiveButtons: null,\n    _directionKeyCode: new _w.RegExp('^(8|13|3[2-9]|40|46)$'),\n    _nonTextKeyCode: new _w.RegExp('^(8|13|1[6-9]|20|27|3[3-9]|40|45|46|11[2-9]|12[0-3]|144|145)$'),\n    _historyIgnoreKeyCode: new _w.RegExp('^(1[6-9]|20|27|3[3-9]|40|45|11[2-9]|12[0-3]|144|145)$'),\n    _onButtonsCheck: new _w.RegExp('^(' + _w.Object.keys(options._textTagsMap).join('|') + ')$', 'i'),\n    _frontZeroWidthReg: new _w.RegExp(util.zeroWidthSpace + '+', ''),\n    _keyCodeShortcut: {\n      65: 'A',\n      66: 'B',\n      83: 'S',\n      85: 'U',\n      73: 'I',\n      89: 'Y',\n      90: 'Z',\n      219: '[',\n      221: ']'\n    },\n    _shortcutCommand: function _shortcutCommand(keyCode, shift) {\n      var command = null;\n      var keyStr = event._keyCodeShortcut[keyCode];\n\n      switch (keyStr) {\n        case 'A':\n          command = 'selectAll';\n          break;\n\n        case 'B':\n          if (options.shortcutsDisable.indexOf('bold') === -1) {\n            command = 'bold';\n          }\n\n          break;\n\n        case 'S':\n          if (shift && options.shortcutsDisable.indexOf('strike') === -1) {\n            command = 'strike';\n          } else if (!shift && options.shortcutsDisable.indexOf('save') === -1) {\n            command = 'save';\n          }\n\n          break;\n\n        case 'U':\n          if (options.shortcutsDisable.indexOf('underline') === -1) {\n            command = 'underline';\n          }\n\n          break;\n\n        case 'I':\n          if (options.shortcutsDisable.indexOf('italic') === -1) {\n            command = 'italic';\n          }\n\n          break;\n\n        case 'Z':\n          if (options.shortcutsDisable.indexOf('undo') === -1) {\n            if (shift) {\n              command = 'redo';\n            } else {\n              command = 'undo';\n            }\n          }\n\n          break;\n\n        case 'Y':\n          if (options.shortcutsDisable.indexOf('undo') === -1) {\n            command = 'redo';\n          }\n\n          break;\n\n        case '[':\n          if (options.shortcutsDisable.indexOf('indent') === -1) {\n            command = options.rtl ? 'indent' : 'outdent';\n          }\n\n          break;\n\n        case ']':\n          if (options.shortcutsDisable.indexOf('indent') === -1) {\n            command = options.rtl ? 'outdent' : 'indent';\n          }\n\n          break;\n      }\n\n      if (!command) return !!keyStr;\n      core.commandHandler(core.commandMap[command], command);\n      return true;\n    },\n    _applyTagEffects: function _applyTagEffects() {\n      var selectionNode = core.getSelectionNode();\n      if (selectionNode === core.effectNode) return;\n      core.effectNode = selectionNode;\n      var marginDir = options.rtl ? 'marginRight' : 'marginLeft';\n      var commandMap = core.commandMap;\n      var classOnCheck = event._onButtonsCheck;\n      var commandMapNodes = [];\n      var currentNodes = [];\n      var activePlugins = core.activePlugins;\n      var cLen = activePlugins.length;\n      var nodeName = '';\n\n      while (selectionNode.firstChild) {\n        selectionNode = selectionNode.firstChild;\n      }\n\n      for (var element = selectionNode; !util.isWysiwygDiv(element); element = element.parentNode) {\n        if (!element) break;\n        if (element.nodeType !== 1 || util.isBreak(element)) continue;\n        nodeName = element.nodeName.toUpperCase();\n        currentNodes.push(nodeName);\n        /* Active plugins */\n\n        if (!core.isReadOnly) {\n          for (var _c6 = 0, name; _c6 < cLen; _c6++) {\n            name = activePlugins[_c6];\n\n            if (commandMapNodes.indexOf(name) === -1 && plugins[name].active.call(core, element)) {\n              commandMapNodes.push(name);\n            }\n          }\n        }\n\n        if (util.isFormatElement(element)) {\n          /* Outdent */\n          if (commandMapNodes.indexOf('OUTDENT') === -1 && commandMap.OUTDENT && !util.isImportantDisabled(commandMap.OUTDENT)) {\n            if (util.isListCell(element) || element.style[marginDir] && util.getNumber(element.style[marginDir], 0) > 0) {\n              commandMapNodes.push('OUTDENT');\n              commandMap.OUTDENT.removeAttribute('disabled');\n            }\n          }\n          /* Indent */\n\n\n          if (commandMapNodes.indexOf('INDENT') === -1 && commandMap.INDENT && !util.isImportantDisabled(commandMap.INDENT)) {\n            commandMapNodes.push('INDENT');\n\n            if (util.isListCell(element) && !element.previousElementSibling) {\n              commandMap.INDENT.setAttribute('disabled', true);\n            } else {\n              commandMap.INDENT.removeAttribute('disabled');\n            }\n          }\n\n          continue;\n        }\n        /** default active buttons [strong, ins, em, del, sub, sup] */\n\n\n        if (classOnCheck && classOnCheck.test(nodeName)) {\n          commandMapNodes.push(nodeName);\n          util.addClass(commandMap[nodeName], 'active');\n        }\n      }\n\n      core._setKeyEffect(commandMapNodes);\n      /** save current nodes */\n\n\n      core._variable.currentNodes = currentNodes.reverse();\n      core._variable.currentNodesMap = commandMapNodes;\n      /**  Displays the current node structure to resizingBar */\n\n      if (options.showPathLabel) context.element.navigation.textContent = core._variable.currentNodes.join(' > ');\n    },\n    _cancelCaptionEdit: function _cancelCaptionEdit() {\n      this.setAttribute('contenteditable', false);\n      this.removeEventListener('blur', event._cancelCaptionEdit);\n    },\n    _buttonsEventHandler: function _buttonsEventHandler(e) {\n      var target = e.target;\n      if (core._bindControllersOff) e.stopPropagation();\n\n      if (/^(input|textarea|select|option)$/i.test(target.nodeName)) {\n        core._antiBlur = false;\n      } else {\n        e.preventDefault();\n      }\n\n      if (util.getParentElement(target, '.se-submenu')) {\n        e.stopPropagation();\n        core._notHideToolbar = true;\n      } else {\n        var command = target.getAttribute('data-command');\n        var className = target.className;\n\n        while (!command && !/se-menu-list/.test(className) && !/sun-editor-common/.test(className)) {\n          target = target.parentNode;\n          command = target.getAttribute('data-command');\n          className = target.className;\n        }\n\n        if (command === core._submenuName || command === core._containerName) {\n          e.stopPropagation();\n        }\n      }\n    },\n    onClick_toolbar: function onClick_toolbar(e) {\n      var target = e.target;\n      var display = target.getAttribute('data-display');\n      var command = target.getAttribute('data-command');\n      var className = target.className;\n      core.controllersOff();\n\n      while (target.parentNode && !command && !/se-menu-list/.test(className) && !/se-toolbar/.test(className)) {\n        target = target.parentNode;\n        command = target.getAttribute('data-command');\n        display = target.getAttribute('data-display');\n        className = target.className;\n      }\n\n      if (!command && !display) return;\n      if (target.disabled) return;\n      core.actionCall(command, display, target);\n    },\n    onMouseDown_wysiwyg: function onMouseDown_wysiwyg(e) {\n      if (core.isReadOnly || util.isNonEditable(context.element.wysiwyg)) return; // user event\n\n      if (typeof functions.onMouseDown === 'function' && functions.onMouseDown(e, core) === false) return;\n      var tableCell = util.getParentElement(e.target, util.isCell);\n\n      if (tableCell) {\n        var tablePlugin = core.plugins.table;\n\n        if (tablePlugin && tableCell !== tablePlugin._fixedCell && !tablePlugin._shift) {\n          core.callPlugin('table', function () {\n            tablePlugin.onTableCellMultiSelect.call(core, tableCell, false);\n          }, null);\n        }\n      }\n\n      if (core._isBalloon) {\n        event._hideToolbar();\n      }\n\n      if (/FIGURE/i.test(e.target.nodeName)) e.preventDefault();\n    },\n    onClick_wysiwyg: function onClick_wysiwyg(e) {\n      var targetElement = e.target;\n\n      if (core.isReadOnly) {\n        e.preventDefault();\n\n        if (util.isAnchor(targetElement)) {\n          _w.open(targetElement.href, targetElement.target);\n        }\n\n        return false;\n      }\n\n      if (util.isNonEditable(context.element.wysiwyg)) return; // user event\n\n      if (typeof functions.onClick === 'function' && functions.onClick(e, core) === false) return;\n      var fileComponentInfo = core.getFileComponent(targetElement);\n\n      if (fileComponentInfo) {\n        e.preventDefault();\n        core.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName);\n        return;\n      }\n\n      var figcaption = util.getParentElement(targetElement, 'FIGCAPTION');\n\n      if (figcaption && (util.isNonEditable(figcaption) || !figcaption.getAttribute(\"contenteditable\"))) {\n        e.preventDefault();\n        figcaption.setAttribute('contenteditable', true);\n        figcaption.focus();\n\n        if (core._isInline && !core._inlineToolbarAttr.isShow) {\n          event._showToolbarInline();\n\n          var hideToolbar = function hideToolbar() {\n            event._hideToolbar();\n\n            figcaption.removeEventListener('blur', hideToolbar);\n          };\n\n          figcaption.addEventListener('blur', hideToolbar);\n        }\n      }\n\n      _w.setTimeout(core._editorRange.bind(core));\n\n      core._editorRange();\n\n      var selectionNode = core.getSelectionNode();\n      var formatEl = util.getFormatElement(selectionNode, null);\n      var rangeEl = util.getRangeFormatElement(selectionNode, null);\n\n      if (!formatEl && !util.isNonEditable(targetElement) && !util.isList(rangeEl)) {\n        var range = core.getRange();\n\n        if (util.getFormatElement(range.startContainer) === util.getFormatElement(range.endContainer)) {\n          if (util.isList(rangeEl)) {\n            e.preventDefault();\n            var oLi = util.createElement('LI');\n            var prevLi = selectionNode.nextElementSibling;\n            oLi.appendChild(selectionNode);\n            rangeEl.insertBefore(oLi, prevLi);\n            core.focus();\n          } else if (!util.isWysiwygDiv(selectionNode) && !util.isComponent(selectionNode) && (!util.isTable(selectionNode) || util.isCell(selectionNode)) && core._setDefaultFormat(util.isRangeFormatElement(rangeEl) ? 'DIV' : options.defaultTag) !== null) {\n            e.preventDefault();\n            core.focus();\n          } else {\n            event._applyTagEffects();\n          }\n        }\n      } else {\n        event._applyTagEffects();\n      }\n\n      if (core._isBalloon) _w.setTimeout(event._toggleToolbarBalloon);\n    },\n    _balloonDelay: null,\n    _showToolbarBalloonDelay: function _showToolbarBalloonDelay() {\n      if (event._balloonDelay) {\n        _w.clearTimeout(event._balloonDelay);\n      }\n\n      event._balloonDelay = _w.setTimeout(function () {\n        _w.clearTimeout(this._balloonDelay);\n\n        this._balloonDelay = null;\n\n        this._showToolbarBalloon();\n      }.bind(event), 350);\n    },\n    _toggleToolbarBalloon: function _toggleToolbarBalloon() {\n      core._editorRange();\n\n      var range = core.getRange();\n      if (core._bindControllersOff || !core._isBalloonAlways && range.collapsed) event._hideToolbar();else event._showToolbarBalloon(range);\n    },\n    _showToolbarBalloon: function _showToolbarBalloon(rangeObj) {\n      if (!core._isBalloon) return;\n      var range = rangeObj || core.getRange();\n      var toolbar = context.element.toolbar;\n      var topArea = context.element.topArea;\n      var selection = core.getSelection();\n      var isDirTop;\n\n      if (core._isBalloonAlways && range.collapsed) {\n        isDirTop = true;\n      } else if (selection.focusNode === selection.anchorNode) {\n        isDirTop = selection.focusOffset < selection.anchorOffset;\n      } else {\n        var childNodes = util.getListChildNodes(range.commonAncestorContainer, null);\n        isDirTop = util.getArrayIndex(childNodes, selection.focusNode) < util.getArrayIndex(childNodes, selection.anchorNode);\n      }\n\n      var rects = range.getClientRects();\n      rects = rects[isDirTop ? 0 : rects.length - 1];\n      var globalScroll = core.getGlobalScrollOffset();\n      var scrollLeft = globalScroll.left;\n      var scrollTop = globalScroll.top;\n      var editorWidth = topArea.offsetWidth;\n\n      var offsets = event._getEditorOffsets(null);\n\n      var stickyTop = offsets.top;\n      var editorLeft = offsets.left;\n      toolbar.style.top = '-10000px';\n      toolbar.style.visibility = 'hidden';\n      toolbar.style.display = 'block';\n\n      if (!rects) {\n        var node = core.getSelectionNode();\n\n        if (util.isFormatElement(node)) {\n          var zeroWidth = util.createTextNode(util.zeroWidthSpace);\n          core.insertNode(zeroWidth, null, false);\n          core.setRange(zeroWidth, 1, zeroWidth, 1);\n\n          core._editorRange();\n\n          rects = core.getRange().getClientRects();\n          rects = rects[isDirTop ? 0 : rects.length - 1];\n        }\n\n        if (!rects) {\n          var nodeOffset = util.getOffset(node, context.element.wysiwygFrame);\n          rects = {\n            left: nodeOffset.left,\n            top: nodeOffset.top,\n            right: nodeOffset.left,\n            bottom: nodeOffset.top + node.offsetHeight,\n            noText: true\n          };\n          scrollLeft = 0;\n          scrollTop = 0;\n        }\n\n        isDirTop = true;\n      }\n\n      var arrowMargin = _w.Math.round(context.element._arrow.offsetWidth / 2);\n\n      var toolbarWidth = toolbar.offsetWidth;\n      var toolbarHeight = toolbar.offsetHeight;\n      var iframeRects = /iframe/i.test(context.element.wysiwygFrame.nodeName) ? context.element.wysiwygFrame.getClientRects()[0] : null;\n\n      if (iframeRects) {\n        rects = {\n          left: rects.left + iframeRects.left,\n          top: rects.top + iframeRects.top,\n          right: rects.right + iframeRects.right - iframeRects.width,\n          bottom: rects.bottom + iframeRects.bottom - iframeRects.height\n        };\n      }\n\n      event._setToolbarOffset(isDirTop, rects, toolbar, editorLeft, editorWidth, scrollLeft, scrollTop, stickyTop, arrowMargin);\n\n      if (toolbarWidth !== toolbar.offsetWidth || toolbarHeight !== toolbar.offsetHeight) {\n        event._setToolbarOffset(isDirTop, rects, toolbar, editorLeft, editorWidth, scrollLeft, scrollTop, stickyTop, arrowMargin);\n      }\n\n      if (options.toolbarContainer) {\n        var editorParent = topArea.parentElement;\n        var container = options.toolbarContainer;\n        var left = container.offsetLeft;\n        var top = container.offsetTop;\n\n        while (!container.parentElement.contains(editorParent) || !/^(BODY|HTML)$/i.test(container.parentElement.nodeName)) {\n          container = container.offsetParent;\n          left += container.offsetLeft;\n          top += container.offsetTop;\n        }\n\n        toolbar.style.left = toolbar.offsetLeft - left + topArea.offsetLeft + 'px';\n        toolbar.style.top = toolbar.offsetTop - top + topArea.offsetTop + 'px';\n      }\n\n      toolbar.style.visibility = '';\n    },\n    _setToolbarOffset: function _setToolbarOffset(isDirTop, rects, toolbar, editorLeft, editorWidth, scrollLeft, scrollTop, stickyTop, arrowMargin) {\n      var padding = 1;\n      var toolbarWidth = toolbar.offsetWidth;\n      var toolbarHeight = rects.noText && !isDirTop ? 0 : toolbar.offsetHeight;\n      var absoluteLeft = (isDirTop ? rects.left : rects.right) - editorLeft - toolbarWidth / 2 + scrollLeft;\n      var overRight = absoluteLeft + toolbarWidth - editorWidth;\n      var t = (isDirTop ? rects.top - toolbarHeight - arrowMargin : rects.bottom + arrowMargin) - (rects.noText ? 0 : stickyTop) + scrollTop;\n      var l = absoluteLeft < 0 ? padding : overRight < 0 ? absoluteLeft : absoluteLeft - overRight - padding - 1;\n      var resetTop = false;\n      var space = t + (isDirTop ? event._getEditorOffsets(null).top : toolbar.offsetHeight - context.element.wysiwyg.offsetHeight);\n\n      if (!isDirTop && space > 0 && event._getPageBottomSpace() < space) {\n        isDirTop = true;\n        resetTop = true;\n      } else if (isDirTop && _d.documentElement.offsetTop > space) {\n        isDirTop = false;\n        resetTop = true;\n      }\n\n      if (resetTop) t = (isDirTop ? rects.top - toolbarHeight - arrowMargin : rects.bottom + arrowMargin) - (rects.noText ? 0 : stickyTop) + scrollTop;\n      toolbar.style.left = _w.Math.floor(l) + 'px';\n      toolbar.style.top = _w.Math.floor(t) + 'px';\n\n      if (isDirTop) {\n        util.removeClass(context.element._arrow, 'se-arrow-up');\n        util.addClass(context.element._arrow, 'se-arrow-down');\n        context.element._arrow.style.top = toolbarHeight + 'px';\n      } else {\n        util.removeClass(context.element._arrow, 'se-arrow-down');\n        util.addClass(context.element._arrow, 'se-arrow-up');\n        context.element._arrow.style.top = -arrowMargin + 'px';\n      }\n\n      var arrow_left = _w.Math.floor(toolbarWidth / 2 + (absoluteLeft - l));\n\n      context.element._arrow.style.left = (arrow_left + arrowMargin > toolbar.offsetWidth ? toolbar.offsetWidth - arrowMargin : arrow_left < arrowMargin ? arrowMargin : arrow_left) + 'px';\n    },\n    _showToolbarInline: function _showToolbarInline() {\n      if (!core._isInline) return;\n      var toolbar = context.element.toolbar;\n      if (options.toolbarContainer) toolbar.style.position = 'relative';else toolbar.style.position = 'absolute';\n      toolbar.style.visibility = 'hidden';\n      toolbar.style.display = 'block';\n      core._inlineToolbarAttr.width = toolbar.style.width = options.toolbarWidth;\n      core._inlineToolbarAttr.top = toolbar.style.top = (options.toolbarContainer ? 0 : -1 - toolbar.offsetHeight) + 'px';\n      if (typeof functions.showInline === 'function') functions.showInline(toolbar, context, core);\n      event.onScroll_window();\n      core._inlineToolbarAttr.isShow = true;\n      toolbar.style.visibility = '';\n    },\n    _hideToolbar: function _hideToolbar() {\n      if (!core._notHideToolbar && !core._variable.isFullScreen) {\n        context.element.toolbar.style.display = 'none';\n        core._inlineToolbarAttr.isShow = false;\n      }\n    },\n    onInput_wysiwyg: function onInput_wysiwyg(e) {\n      if (core.isReadOnly || core.isDisabled) {\n        e.preventDefault();\n        e.stopPropagation();\n        core.history.go(core.history.getCurrentIndex());\n        return false;\n      }\n\n      core._editorRange(); // user event\n\n\n      if (typeof functions.onInput === 'function' && functions.onInput(e, core) === false) return;\n      var data = (e.data === null ? '' : e.data === undefined ? ' ' : e.data) || '';\n\n      if (!core._charCount(data)) {\n        e.preventDefault();\n        e.stopPropagation();\n        return false;\n      } // history stack\n\n\n      core.history.push(true);\n    },\n    _isUneditableNode: function _isUneditableNode(range, isFront) {\n      var container = isFront ? range.startContainer : range.endContainer;\n      var offset = isFront ? range.startOffset : range.endOffset;\n      var siblingKey = isFront ? 'previousSibling' : 'nextSibling';\n      var isElement = container.nodeType === 1;\n      var siblingNode;\n\n      if (isElement) {\n        siblingNode = event._isUneditableNode_getSibling(container.childNodes[offset], siblingKey, container);\n        return siblingNode && siblingNode.nodeType === 1 && siblingNode.getAttribute('contenteditable') === 'false';\n      } else {\n        siblingNode = event._isUneditableNode_getSibling(container, siblingKey, container);\n        return core.isEdgePoint(container, offset, isFront ? 'front' : 'end') && siblingNode && siblingNode.nodeType === 1 && siblingNode.getAttribute('contenteditable') === 'false';\n      }\n    },\n    _isUneditableNode_getSibling: function _isUneditableNode_getSibling(selectNode, siblingKey, container) {\n      if (!selectNode) return null;\n      var siblingNode = selectNode[siblingKey];\n\n      if (!siblingNode) {\n        siblingNode = util.getFormatElement(container);\n        siblingNode = siblingNode ? siblingNode[siblingKey] : null;\n        if (siblingNode && !util.isComponent(siblingNode)) siblingNode = siblingKey === 'previousSibling' ? siblingNode.firstElementChild : siblingNode.lastElementChild;else return null;\n      }\n\n      return siblingNode;\n    },\n    _onShortcutKey: false,\n    onKeyDown_wysiwyg: function onKeyDown_wysiwyg(e) {\n      var keyCode = e.keyCode;\n      var shift = e.shiftKey;\n      var ctrl = e.ctrlKey || e.metaKey || keyCode === 91 || keyCode === 92 || keyCode === 224;\n      var alt = e.altKey;\n      event._IEisComposing = keyCode === 229;\n\n      if (!ctrl && core.isReadOnly && !event._directionKeyCode.test(keyCode)) {\n        e.preventDefault();\n        return false;\n      }\n\n      core.submenuOff();\n\n      if (core._isBalloon) {\n        event._hideToolbar();\n      } // user event\n\n\n      if (typeof functions.onKeyDown === 'function' && functions.onKeyDown(e, core) === false) return;\n      /** Shortcuts */\n\n      if (ctrl && event._shortcutCommand(keyCode, shift)) {\n        event._onShortcutKey = true;\n        e.preventDefault();\n        e.stopPropagation();\n        return false;\n      } else if (event._onShortcutKey) {\n        event._onShortcutKey = false;\n      }\n      /** default key action */\n\n\n      var selectionNode = core.getSelectionNode();\n      var range = core.getRange();\n      var selectRange = !range.collapsed || range.startContainer !== range.endContainer;\n      var fileComponentName = core._fileManager.pluginRegExp.test(core.currentControllerName) ? core.currentControllerName : '';\n      var formatEl = util.getFormatElement(selectionNode, null) || selectionNode;\n      var rangeEl = util.getRangeFormatElement(formatEl, null);\n\n      switch (keyCode) {\n        case 8:\n          /** backspace key */\n          if (!selectRange) {\n            if (fileComponentName) {\n              e.preventDefault();\n              e.stopPropagation();\n              core.plugins[fileComponentName].destroy.call(core);\n              break;\n            }\n          }\n\n          if (selectRange && event._hardDelete()) {\n            e.preventDefault();\n            e.stopPropagation();\n            break;\n          }\n\n          if (!util.isFormatElement(formatEl) && !context.element.wysiwyg.firstElementChild && !util.isComponent(selectionNode) && core._setDefaultFormat(options.defaultTag) !== null) {\n            e.preventDefault();\n            e.stopPropagation();\n            return false;\n          }\n\n          if (!selectRange && !formatEl.previousElementSibling && range.startOffset === 0 && !selectionNode.previousSibling && !util.isListCell(formatEl) && util.isFormatElement(formatEl) && (!util.isFreeFormatElement(formatEl) || util.isClosureFreeFormatElement(formatEl))) {\n            // closure range\n            if (util.isClosureRangeFormatElement(formatEl.parentNode)) {\n              e.preventDefault();\n              e.stopPropagation();\n              return false;\n            } // maintain default format\n\n\n            if (util.isWysiwygDiv(formatEl.parentNode) && formatEl.childNodes.length <= 1 && (!formatEl.firstChild || util.onlyZeroWidthSpace(formatEl.textContent))) {\n              e.preventDefault();\n              e.stopPropagation();\n\n              if (formatEl.nodeName.toUpperCase() === options.defaultTag.toUpperCase()) {\n                formatEl.innerHTML = '<br>';\n                var attrs = formatEl.attributes;\n\n                while (attrs[0]) {\n                  formatEl.removeAttribute(attrs[0].name);\n                }\n              } else {\n                var defaultFormat = util.createElement(options.defaultTag);\n                defaultFormat.innerHTML = '<br>';\n                formatEl.parentElement.replaceChild(defaultFormat, formatEl);\n              }\n\n              core.nativeFocus();\n              return false;\n            }\n          } // clean remove tag\n\n\n          if (formatEl && range.startContainer === range.endContainer && selectionNode.nodeType === 3 && !util.isFormatElement(selectionNode.parentNode)) {\n            if (range.collapsed ? selectionNode.textContent.length === 1 : range.endOffset - range.startOffset === selectionNode.textContent.length) {\n              e.preventDefault();\n              var offset = null;\n              var prev = selectionNode.parentNode.previousSibling;\n              var next = selectionNode.parentNode.nextSibling;\n\n              if (!prev) {\n                if (!next) {\n                  prev = util.createElement('BR');\n                  formatEl.appendChild(prev);\n                } else {\n                  prev = next;\n                  offset = 0;\n                }\n              }\n\n              selectionNode.textContent = '';\n              util.removeItemAllParents(selectionNode, null, formatEl);\n              offset = typeof offset === 'number' ? offset : prev.nodeType === 3 ? prev.textContent.length : 1;\n              core.setRange(prev, offset, prev, offset);\n              break;\n            }\n          } // tag[contenteditable=\"false\"]\n\n\n          if (event._isUneditableNode(range, true)) {\n            e.preventDefault();\n            e.stopPropagation();\n            break;\n          } // nested list\n\n\n          var commonCon = range.commonAncestorContainer;\n          formatEl = util.getFormatElement(range.startContainer, null);\n          rangeEl = util.getRangeFormatElement(formatEl, null);\n\n          if (rangeEl && formatEl && !util.isCell(rangeEl) && !/^FIGCAPTION$/i.test(rangeEl.nodeName)) {\n            if (util.isListCell(formatEl) && util.isList(rangeEl) && (util.isListCell(rangeEl.parentNode) || formatEl.previousElementSibling) && (selectionNode === formatEl || selectionNode.nodeType === 3 && (!selectionNode.previousSibling || util.isList(selectionNode.previousSibling))) && (util.getFormatElement(range.startContainer, null) !== util.getFormatElement(range.endContainer, null) ? rangeEl.contains(range.startContainer) : range.startOffset === 0 && range.collapsed)) {\n              if (range.startContainer !== range.endContainer) {\n                e.preventDefault();\n                core.removeNode();\n\n                if (range.startContainer.nodeType === 3) {\n                  core.setRange(range.startContainer, range.startContainer.textContent.length, range.startContainer, range.startContainer.textContent.length);\n                } // history stack\n\n\n                core.history.push(true);\n              } else {\n                var _prev = formatEl.previousElementSibling || rangeEl.parentNode;\n\n                if (util.isListCell(_prev)) {\n                  e.preventDefault();\n                  var prevLast = _prev;\n\n                  if (!_prev.contains(formatEl) && util.isListCell(prevLast) && util.isList(prevLast.lastElementChild)) {\n                    prevLast = prevLast.lastElementChild.lastElementChild;\n\n                    while (util.isListCell(prevLast) && util.isList(prevLast.lastElementChild)) {\n                      prevLast = prevLast.lastElementChild && prevLast.lastElementChild.lastElementChild;\n                    }\n\n                    _prev = prevLast;\n                  }\n\n                  var con = _prev === rangeEl.parentNode ? rangeEl.previousSibling : _prev.lastChild;\n\n                  if (!con) {\n                    con = util.createTextNode(util.zeroWidthSpace);\n                    rangeEl.parentNode.insertBefore(con, rangeEl.parentNode.firstChild);\n                  }\n\n                  var _offset = con.nodeType === 3 ? con.textContent.length : 1;\n\n                  var children = formatEl.childNodes;\n                  var after = con;\n                  var child = children[0];\n\n                  while (child = children[0]) {\n                    _prev.insertBefore(child, after.nextSibling);\n\n                    after = child;\n                  }\n\n                  util.removeItem(formatEl);\n                  if (rangeEl.children.length === 0) util.removeItem(rangeEl);\n                  core.setRange(con, _offset, con, _offset); // history stack\n\n                  core.history.push(true);\n                }\n              }\n\n              break;\n            } // detach range\n\n\n            if (!selectRange && range.startOffset === 0) {\n              var detach = true;\n              var comm = commonCon;\n\n              while (comm && comm !== rangeEl && !util.isWysiwygDiv(comm)) {\n                if (comm.previousSibling) {\n                  if (comm.previousSibling.nodeType === 1 || !util.onlyZeroWidthSpace(comm.previousSibling.textContent.trim())) {\n                    detach = false;\n                    break;\n                  }\n                }\n\n                comm = comm.parentNode;\n              }\n\n              if (detach && rangeEl.parentNode) {\n                e.preventDefault();\n                core.detachRangeFormatElement(rangeEl, util.isListCell(formatEl) ? [formatEl] : null, null, false, false); // history stack\n\n                core.history.push(true);\n                break;\n              }\n            }\n          } // component\n\n\n          if (!selectRange && formatEl && (range.startOffset === 0 || (selectionNode === formatEl ? !!formatEl.childNodes[range.startOffset] : false))) {\n            var sel = selectionNode === formatEl ? formatEl.childNodes[range.startOffset] : selectionNode;\n            var _prev2 = formatEl.previousSibling; // select file component\n\n            var ignoreZWS = (commonCon.nodeType === 3 || util.isBreak(commonCon)) && !commonCon.previousSibling && range.startOffset === 0;\n\n            if (!sel.previousSibling && (util.isComponent(commonCon.previousSibling) || ignoreZWS && util.isComponent(_prev2))) {\n              var fileComponentInfo = core.getFileComponent(_prev2);\n\n              if (fileComponentInfo) {\n                e.preventDefault();\n                e.stopPropagation();\n                if (formatEl.textContent.length === 0) util.removeItem(formatEl);\n                if (core.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName) === false) core.blur();\n              } else if (util.isComponent(_prev2)) {\n                e.preventDefault();\n                e.stopPropagation();\n                util.removeItem(_prev2);\n              }\n\n              break;\n            } // delete nonEditable\n\n\n            if (util.isNonEditable(sel.previousSibling)) {\n              e.preventDefault();\n              e.stopPropagation();\n              util.removeItem(sel.previousSibling);\n              break;\n            }\n          }\n\n          break;\n\n        case 46:\n          /** delete key */\n          if (fileComponentName) {\n            e.preventDefault();\n            e.stopPropagation();\n            core.plugins[fileComponentName].destroy.call(core);\n            break;\n          }\n\n          if (selectRange && event._hardDelete()) {\n            e.preventDefault();\n            e.stopPropagation();\n            break;\n          } // tag[contenteditable=\"false\"]\n\n\n          if (event._isUneditableNode(range, false)) {\n            e.preventDefault();\n            e.stopPropagation();\n            break;\n          } // component\n\n\n          if ((util.isFormatElement(selectionNode) || selectionNode.nextSibling === null || util.onlyZeroWidthSpace(selectionNode.nextSibling) && selectionNode.nextSibling.nextSibling === null) && range.startOffset === selectionNode.textContent.length) {\n            var nextEl = formatEl.nextElementSibling;\n            if (!nextEl) break;\n\n            if (util.isComponent(nextEl)) {\n              e.preventDefault();\n\n              if (util.onlyZeroWidthSpace(formatEl)) {\n                util.removeItem(formatEl); // table component\n\n                if (util.isTable(nextEl)) {\n                  var cell = util.getChildElement(nextEl, util.isCell, false);\n                  cell = cell.firstElementChild || cell;\n                  core.setRange(cell, 0, cell, 0);\n                  break;\n                }\n              } // select file component\n\n\n              var _fileComponentInfo = core.getFileComponent(nextEl);\n\n              if (_fileComponentInfo) {\n                e.stopPropagation();\n                if (core.selectComponent(_fileComponentInfo.target, _fileComponentInfo.pluginName) === false) core.blur();\n              } else if (util.isComponent(nextEl)) {\n                e.stopPropagation();\n                util.removeItem(nextEl);\n              }\n\n              break;\n            }\n          }\n\n          if (!selectRange && (core.isEdgePoint(range.endContainer, range.endOffset) || (selectionNode === formatEl ? !!formatEl.childNodes[range.startOffset] : false))) {\n            var _sel = selectionNode === formatEl ? formatEl.childNodes[range.startOffset] || selectionNode : selectionNode; // delete nonEditable\n\n\n            if (_sel && util.isNonEditable(_sel.nextSibling)) {\n              e.preventDefault();\n              e.stopPropagation();\n              util.removeItem(_sel.nextSibling);\n              break;\n            } else if (util.isComponent(_sel)) {\n              e.preventDefault();\n              e.stopPropagation();\n              util.removeItem(_sel);\n              break;\n            }\n          } // nested list\n\n\n          formatEl = util.getFormatElement(range.startContainer, null);\n          rangeEl = util.getRangeFormatElement(formatEl, null);\n\n          if (util.isListCell(formatEl) && util.isList(rangeEl) && (selectionNode === formatEl || selectionNode.nodeType === 3 && (!selectionNode.nextSibling || util.isList(selectionNode.nextSibling)) && (util.getFormatElement(range.startContainer, null) !== util.getFormatElement(range.endContainer, null) ? rangeEl.contains(range.endContainer) : range.endOffset === selectionNode.textContent.length && range.collapsed))) {\n            if (range.startContainer !== range.endContainer) core.removeNode();\n\n            var _next = util.getArrayItem(formatEl.children, util.isList, false);\n\n            _next = _next || formatEl.nextElementSibling || rangeEl.parentNode.nextElementSibling;\n\n            if (_next && (util.isList(_next) || util.getArrayItem(_next.children, util.isList, false))) {\n              e.preventDefault();\n\n              var _con, _children;\n\n              if (util.isList(_next)) {\n                var _child2 = _next.firstElementChild;\n                _children = _child2.childNodes;\n                _con = _children[0];\n\n                while (_children[0]) {\n                  formatEl.insertBefore(_children[0], _next);\n                }\n\n                util.removeItem(_child2);\n              } else {\n                _con = _next.firstChild;\n                _children = _next.childNodes;\n\n                while (_children[0]) {\n                  formatEl.appendChild(_children[0]);\n                }\n\n                util.removeItem(_next);\n              }\n\n              core.setRange(_con, 0, _con, 0); // history stack\n\n              core.history.push(true);\n            }\n\n            break;\n          }\n\n          break;\n\n        case 9:\n          /** tab key */\n          if (fileComponentName || options.tabDisable) break;\n          e.preventDefault();\n          if (ctrl || alt || util.isWysiwygDiv(selectionNode)) break;\n          var isEdge = !range.collapsed || core.isEdgePoint(range.startContainer, range.startOffset);\n          var selectedFormats = core.getSelectedElements(null);\n          selectionNode = core.getSelectionNode();\n          var cells = [];\n          var lines = [];\n          var fc = util.isListCell(selectedFormats[0]),\n              lc = util.isListCell(selectedFormats[selectedFormats.length - 1]);\n          var r = {\n            sc: range.startContainer,\n            so: range.startOffset,\n            ec: range.endContainer,\n            eo: range.endOffset\n          };\n\n          for (var i = 0, len = selectedFormats.length, f; i < len; i++) {\n            f = selectedFormats[i];\n\n            if (util.isListCell(f)) {\n              if (!f.previousElementSibling && !shift) {\n                continue;\n              } else {\n                cells.push(f);\n              }\n            } else {\n              lines.push(f);\n            }\n          } // Nested list\n\n\n          if (cells.length > 0 && isEdge && core.plugins.list) {\n            r = core.plugins.list.editInsideList.call(core, shift, cells);\n          } else {\n            // table\n            var tableCell = util.getParentElement(selectionNode, util.isCell);\n\n            if (tableCell && isEdge) {\n              var table = util.getParentElement(tableCell, 'table');\n\n              var _cells = util.getListChildren(table, util.isCell);\n\n              var idx = shift ? util.prevIdx(_cells, tableCell) : util.nextIdx(_cells, tableCell);\n              if (idx === _cells.length && !shift) idx = 0;\n              if (idx === -1 && shift) idx = _cells.length - 1;\n              var moveCell = _cells[idx];\n              if (!moveCell) break;\n              moveCell = moveCell.firstElementChild || moveCell;\n              core.setRange(moveCell, 0, moveCell, 0);\n              break;\n            }\n\n            lines = lines.concat(cells);\n            fc = lc = null;\n          } // Lines tab(4)\n\n\n          if (lines.length > 0) {\n            if (!shift) {\n              var tabText = util.createTextNode(new _w.Array(core._variable.tabSize + 1).join(\"\\xA0\"));\n\n              if (lines.length === 1) {\n                var textRange = core.insertNode(tabText, null, true);\n                if (!textRange) return false;\n\n                if (!fc) {\n                  r.sc = tabText;\n                  r.so = textRange.endOffset;\n                }\n\n                if (!lc) {\n                  r.ec = tabText;\n                  r.eo = textRange.endOffset;\n                }\n              } else {\n                var _len13 = lines.length - 1;\n\n                for (var _i27 = 0, _child3; _i27 <= _len13; _i27++) {\n                  _child3 = lines[_i27].firstChild;\n                  if (!_child3) continue;\n\n                  if (util.isBreak(_child3)) {\n                    lines[_i27].insertBefore(tabText.cloneNode(false), _child3);\n                  } else {\n                    _child3.textContent = tabText.textContent + _child3.textContent;\n                  }\n                }\n\n                var firstChild = util.getChildElement(lines[0], 'text', false);\n                var endChild = util.getChildElement(lines[_len13], 'text', true);\n\n                if (!fc && firstChild) {\n                  r.sc = firstChild;\n                  r.so = 0;\n                }\n\n                if (!lc && endChild) {\n                  r.ec = endChild;\n                  r.eo = endChild.textContent.length;\n                }\n              }\n            } else {\n              var _len14 = lines.length - 1;\n\n              for (var _i28 = 0, line; _i28 <= _len14; _i28++) {\n                line = lines[_i28].childNodes;\n\n                for (var _c7 = 0, cLen = line.length, _child4; _c7 < cLen; _c7++) {\n                  _child4 = line[_c7];\n                  if (!_child4) break;\n                  if (util.onlyZeroWidthSpace(_child4)) continue;\n\n                  if (/^\\s{1,4}$/.test(_child4.textContent)) {\n                    util.removeItem(_child4);\n                  } else if (/^\\s{1,4}/.test(_child4.textContent)) {\n                    _child4.textContent = _child4.textContent.replace(/^\\s{1,4}/, '');\n                  }\n\n                  break;\n                }\n              }\n\n              var _firstChild = util.getChildElement(lines[0], 'text', false);\n\n              var _endChild = util.getChildElement(lines[_len14], 'text', true);\n\n              if (!fc && _firstChild) {\n                r.sc = _firstChild;\n                r.so = 0;\n              }\n\n              if (!lc && _endChild) {\n                r.ec = _endChild;\n                r.eo = _endChild.textContent.length;\n              }\n            }\n          }\n\n          core.setRange(r.sc, r.so, r.ec, r.eo); // history stack\n\n          core.history.push(false);\n          break;\n\n        case 13:\n          /** enter key */\n          var freeFormatEl = util.getFreeFormatElement(selectionNode, null);\n\n          if (core._charTypeHTML) {\n            var enterHTML = '';\n\n            if (!shift && freeFormatEl || shift) {\n              enterHTML = '<br>';\n            } else {\n              enterHTML = '<' + formatEl.nodeName + '><br></' + formatEl.nodeName + '>';\n            }\n\n            if (!core.checkCharCount(enterHTML, 'byte-html')) {\n              e.preventDefault();\n              return false;\n            }\n          }\n\n          if (!shift) {\n            var formatInners = core._isEdgeFormat(range.endContainer, range.endOffset, 'end');\n\n            if (formatInners && /^H[1-6]$/i.test(formatEl.nodeName) || /^HR$/i.test(formatEl.nodeName)) {\n              e.preventDefault();\n              var temp = null;\n              var newFormat = core.appendFormatTag(formatEl, options.defaultTag);\n\n              if (formatInners && formatInners.length > 0) {\n                temp = formatInners.pop();\n                var innerNode = temp;\n\n                while (formatInners.length > 0) {\n                  temp = temp.appendChild(formatInners.pop());\n                }\n\n                newFormat.appendChild(innerNode);\n              }\n\n              temp = !temp ? newFormat.firstChild : temp.appendChild(newFormat.firstChild);\n              core.setRange(temp, 0, temp, 0);\n              break;\n            } else if (options.lineAttrReset && formatEl && !util.isListCell(formatEl)) {\n              e.preventDefault();\n              e.stopPropagation();\n              var newEl;\n\n              if (!range.collapsed) {\n                var isMultiLine = util.getFormatElement(range.startContainer, null) !== util.getFormatElement(range.endContainer, null);\n\n                var _r2 = core.removeNode();\n\n                if (isMultiLine) {\n                  newEl = util.getFormatElement(_r2.container, null);\n\n                  if (!_r2.prevContainer) {\n                    var _newFormat = formatEl.cloneNode(false);\n\n                    _newFormat.innerHTML = '<br>';\n                    newEl.parentNode.insertBefore(_newFormat, newEl);\n                  } else if (newEl !== formatEl && newEl.nextElementSibling === formatEl) {\n                    newEl = formatEl;\n                  }\n                } else {\n                  newEl = util.splitElement(_r2.container, _r2.offset, 0);\n                }\n              } else {\n                if (util.onlyZeroWidthSpace(formatEl)) newEl = core.appendFormatTag(formatEl, formatEl.cloneNode(false));else newEl = util.splitElement(range.endContainer, range.endOffset, 0);\n              }\n\n              var resetAttr = options.lineAttrReset === '*' ? null : options.lineAttrReset;\n              var _attrs = newEl.attributes;\n              var _i29 = 0;\n\n              while (_attrs[_i29]) {\n                if (resetAttr && resetAttr.test(_attrs[_i29].name)) {\n                  _i29++;\n                  continue;\n                }\n\n                newEl.removeAttribute(_attrs[_i29].name);\n              }\n\n              core.setRange(newEl.firstChild, 0, newEl.firstChild, 0);\n              break;\n            }\n\n            if (freeFormatEl) {\n              e.preventDefault();\n              var selectionFormat = selectionNode === freeFormatEl;\n              var wSelection = core.getSelection();\n              var _children2 = selectionNode.childNodes,\n                  _offset2 = wSelection.focusOffset,\n                  _prev3 = selectionNode.previousElementSibling,\n                  _next2 = selectionNode.nextSibling;\n\n              if (!util.isClosureFreeFormatElement(freeFormatEl) && !!_children2 && (selectionFormat && range.collapsed && _children2.length - 1 <= _offset2 + 1 && util.isBreak(_children2[_offset2]) && (!_children2[_offset2 + 1] || (!_children2[_offset2 + 2] || util.onlyZeroWidthSpace(_children2[_offset2 + 2].textContent)) && _children2[_offset2 + 1].nodeType === 3 && util.onlyZeroWidthSpace(_children2[_offset2 + 1].textContent)) && _offset2 > 0 && util.isBreak(_children2[_offset2 - 1]) || !selectionFormat && util.onlyZeroWidthSpace(selectionNode.textContent) && util.isBreak(_prev3) && (util.isBreak(_prev3.previousSibling) || !util.onlyZeroWidthSpace(_prev3.previousSibling.textContent)) && (!_next2 || !util.isBreak(_next2) && util.onlyZeroWidthSpace(_next2.textContent)))) {\n                if (selectionFormat) util.removeItem(_children2[_offset2 - 1]);else util.removeItem(selectionNode);\n\n                var _newEl = core.appendFormatTag(freeFormatEl, util.isFormatElement(freeFormatEl.nextElementSibling) && !util.isRangeFormatElement(freeFormatEl.nextElementSibling) ? freeFormatEl.nextElementSibling : null);\n\n                util.copyFormatAttributes(_newEl, freeFormatEl);\n                core.setRange(_newEl, 1, _newEl, 1);\n                break;\n              }\n\n              if (selectionFormat) {\n                functions.insertHTML(range.collapsed && util.isBreak(range.startContainer.childNodes[range.startOffset - 1]) ? '<br>' : '<br><br>', true, false);\n                var focusNode = wSelection.focusNode;\n                var wOffset = wSelection.focusOffset;\n\n                if (freeFormatEl === focusNode) {\n                  focusNode = focusNode.childNodes[wOffset - _offset2 > 1 ? wOffset - 1 : wOffset];\n                }\n\n                core.setRange(focusNode, 1, focusNode, 1);\n              } else {\n                var focusNext = wSelection.focusNode.nextSibling;\n                var br = util.createElement('BR');\n                core.insertNode(br, null, false);\n                var brPrev = br.previousSibling,\n                    brNext = br.nextSibling;\n\n                if (!util.isBreak(focusNext) && !util.isBreak(brPrev) && (!brNext || util.onlyZeroWidthSpace(brNext))) {\n                  br.parentNode.insertBefore(br.cloneNode(false), br);\n                  core.setRange(br, 1, br, 1);\n                } else {\n                  core.setRange(brNext, 0, brNext, 0);\n                }\n              }\n\n              event._onShortcutKey = true;\n              break;\n            }\n          }\n\n          if (selectRange) break;\n\n          if (rangeEl && formatEl && !util.isCell(rangeEl) && !/^FIGCAPTION$/i.test(rangeEl.nodeName)) {\n            var _range = core.getRange();\n\n            if (core.isEdgePoint(_range.endContainer, _range.endOffset) && util.isList(selectionNode.nextSibling)) {\n              e.preventDefault();\n\n              var _newEl2 = util.createElement('LI');\n\n              var _br2 = util.createElement('BR');\n\n              _newEl2.appendChild(_br2);\n\n              formatEl.parentNode.insertBefore(_newEl2, formatEl.nextElementSibling);\n\n              _newEl2.appendChild(selectionNode.nextSibling);\n\n              core.setRange(_br2, 1, _br2, 1);\n              break;\n            }\n\n            if ((_range.commonAncestorContainer.nodeType === 3 ? !_range.commonAncestorContainer.nextElementSibling : true) && util.onlyZeroWidthSpace(formatEl.innerText.trim())) {\n              e.preventDefault();\n              var _newEl3 = null;\n\n              if (util.isListCell(rangeEl.parentNode)) {\n                rangeEl = formatEl.parentNode.parentNode.parentNode;\n                _newEl3 = util.splitElement(formatEl, null, util.getElementDepth(formatEl) - 2);\n\n                if (!_newEl3) {\n                  var newListCell = util.createElement('LI');\n                  newListCell.innerHTML = '<br>';\n                  rangeEl.insertBefore(newListCell, _newEl3);\n                  _newEl3 = newListCell;\n                }\n              } else {\n                var _newFormat2 = util.isCell(rangeEl.parentNode) ? 'DIV' : util.isList(rangeEl.parentNode) ? 'LI' : util.isFormatElement(rangeEl.nextElementSibling) && !util.isRangeFormatElement(rangeEl.nextElementSibling) ? rangeEl.nextElementSibling.nodeName : util.isFormatElement(rangeEl.previousElementSibling) && !util.isRangeFormatElement(rangeEl.previousElementSibling) ? rangeEl.previousElementSibling.nodeName : options.defaultTag;\n\n                _newEl3 = util.createElement(_newFormat2);\n                var edge = core.detachRangeFormatElement(rangeEl, [formatEl], null, true, true);\n                edge.cc.insertBefore(_newEl3, edge.ec);\n              }\n\n              _newEl3.innerHTML = '<br>';\n              util.removeItemAllParents(formatEl, null, null);\n              core.setRange(_newEl3, 1, _newEl3, 1);\n              break;\n            }\n          }\n\n          if (rangeEl && util.getParentElement(rangeEl, 'FIGCAPTION') && util.getParentElement(rangeEl, util.isList)) {\n            e.preventDefault();\n            formatEl = core.appendFormatTag(formatEl, null);\n            core.setRange(formatEl, 0, formatEl, 0);\n          }\n\n          if (fileComponentName) {\n            e.preventDefault();\n            e.stopPropagation();\n            var compContext = context[fileComponentName];\n            var container = compContext._container;\n            var sibling = container.previousElementSibling || container.nextElementSibling;\n            var _newEl4 = null;\n\n            if (util.isListCell(container.parentNode)) {\n              _newEl4 = util.createElement('BR');\n            } else {\n              _newEl4 = util.createElement(util.isFormatElement(sibling) && !util.isRangeFormatElement(sibling) ? sibling.nodeName : options.defaultTag);\n              _newEl4.innerHTML = '<br>';\n            }\n\n            container.parentNode.insertBefore(_newEl4, container);\n            core.callPlugin(fileComponentName, function () {\n              if (core.selectComponent(compContext._element, fileComponentName) === false) core.blur();\n            }, null);\n          }\n\n          break;\n\n        case 27:\n          if (fileComponentName) {\n            e.preventDefault();\n            e.stopPropagation();\n            core.controllersOff();\n            return false;\n          }\n\n          break;\n      }\n\n      if (shift && keyCode === 16) {\n        e.preventDefault();\n        e.stopPropagation();\n        var tablePlugin = core.plugins.table;\n\n        if (tablePlugin && !tablePlugin._shift && !tablePlugin._ref) {\n          var _cell = util.getParentElement(formatEl, util.isCell);\n\n          if (_cell) {\n            tablePlugin.onTableCellMultiSelect.call(core, _cell, true);\n            return;\n          }\n        }\n      } else if (shift && (util.isOSX_IOS ? alt : ctrl) && keyCode === 32) {\n        e.preventDefault();\n        e.stopPropagation();\n        var nbsp = core.insertNode(util.createTextNode(\"\\xA0\"));\n\n        if (nbsp && nbsp.container) {\n          core.setRange(nbsp.container, nbsp.endOffset, nbsp.container, nbsp.endOffset);\n          return;\n        }\n      }\n\n      if (util.isIE && !ctrl && !alt && !selectRange && !event._nonTextKeyCode.test(keyCode) && util.isBreak(range.commonAncestorContainer)) {\n        var zeroWidth = util.createTextNode(util.zeroWidthSpace);\n        core.insertNode(zeroWidth, null, false);\n        core.setRange(zeroWidth, 1, zeroWidth, 1);\n      }\n    },\n    onKeyUp_wysiwyg: function onKeyUp_wysiwyg(e) {\n      if (event._onShortcutKey) return;\n\n      core._editorRange();\n\n      var keyCode = e.keyCode;\n      var ctrl = e.ctrlKey || e.metaKey || keyCode === 91 || keyCode === 92 || keyCode === 224;\n      var alt = e.altKey;\n\n      if (core.isReadOnly) {\n        if (!ctrl && event._directionKeyCode.test(keyCode)) event._applyTagEffects();\n        return;\n      }\n\n      var range = core.getRange();\n      var selectionNode = core.getSelectionNode();\n\n      if (core._isBalloon && (core._isBalloonAlways && keyCode !== 27 || !range.collapsed)) {\n        if (core._isBalloonAlways) {\n          if (keyCode !== 27) event._showToolbarBalloonDelay();\n        } else {\n          event._showToolbarBalloon();\n\n          return;\n        }\n      }\n      /** when format tag deleted */\n\n\n      if (keyCode === 8 && util.isWysiwygDiv(selectionNode) && selectionNode.textContent === '' && selectionNode.children.length === 0) {\n        e.preventDefault();\n        e.stopPropagation();\n        selectionNode.innerHTML = '';\n        var oFormatTag = util.createElement(util.isFormatElement(core._variable.currentNodes[0]) ? core._variable.currentNodes[0] : options.defaultTag);\n        oFormatTag.innerHTML = '<br>';\n        selectionNode.appendChild(oFormatTag);\n        core.setRange(oFormatTag, 0, oFormatTag, 0);\n\n        event._applyTagEffects();\n\n        core.history.push(false);\n        return;\n      }\n\n      var formatEl = util.getFormatElement(selectionNode, null);\n      var rangeEl = util.getRangeFormatElement(selectionNode, null);\n\n      if (!formatEl && range.collapsed && !util.isComponent(selectionNode) && !util.isList(selectionNode) && core._setDefaultFormat(util.isRangeFormatElement(rangeEl) ? 'DIV' : options.defaultTag) !== null) {\n        selectionNode = core.getSelectionNode();\n      }\n\n      if (event._directionKeyCode.test(keyCode)) {\n        event._applyTagEffects();\n      }\n\n      var textKey = !ctrl && !alt && !event._nonTextKeyCode.test(keyCode);\n\n      if (textKey && selectionNode.nodeType === 3 && util.zeroWidthRegExp.test(selectionNode.textContent) && !(e.isComposing !== undefined ? e.isComposing : event._IEisComposing)) {\n        var so = range.startOffset,\n            eo = range.endOffset;\n        var frontZeroWidthCnt = (selectionNode.textContent.substring(0, eo).match(event._frontZeroWidthReg) || '').length;\n        so = range.startOffset - frontZeroWidthCnt;\n        eo = range.endOffset - frontZeroWidthCnt;\n        selectionNode.textContent = selectionNode.textContent.replace(util.zeroWidthRegExp, '');\n        core.setRange(selectionNode, so < 0 ? 0 : so, selectionNode, eo < 0 ? 0 : eo);\n      }\n\n      core._charCount(''); // user event\n\n\n      if (typeof functions.onKeyUp === 'function' && functions.onKeyUp(e, core) === false) return; // history stack\n\n      if (!ctrl && !alt && !event._historyIgnoreKeyCode.test(keyCode)) {\n        core.history.push(true);\n      }\n    },\n    onScroll_wysiwyg: function onScroll_wysiwyg(e) {\n      core.controllersOff();\n      if (core._isBalloon) event._hideToolbar(); // user event\n\n      if (typeof functions.onScroll === 'function') functions.onScroll(e, core);\n    },\n    onFocus_wysiwyg: function onFocus_wysiwyg(e) {\n      if (core._antiBlur) return;\n      core.hasFocus = true;\n\n      _w.setTimeout(event._applyTagEffects);\n\n      if (core._isInline) event._showToolbarInline(); // user event\n\n      if (typeof functions.onFocus === 'function') functions.onFocus(e, core);\n    },\n    onBlur_wysiwyg: function onBlur_wysiwyg(e) {\n      if (core._antiBlur || core._variable.isCodeView) return;\n      core.hasFocus = false;\n      core.effectNode = null;\n      core.controllersOff();\n      if (core._isInline || core._isBalloon) event._hideToolbar();\n\n      core._setKeyEffect([]);\n\n      core._variable.currentNodes = [];\n      core._variable.currentNodesMap = [];\n      if (options.showPathLabel) context.element.navigation.textContent = ''; // user event\n\n      if (typeof functions.onBlur === 'function') functions.onBlur(e, core);\n    },\n    onMouseDown_resizingBar: function onMouseDown_resizingBar(e) {\n      e.stopPropagation();\n      core.submenuOff();\n      core.controllersOff();\n      core._variable.resizeClientY = e.clientY;\n      context.element.resizeBackground.style.display = 'block';\n\n      function closureFunc() {\n        context.element.resizeBackground.style.display = 'none';\n\n        _d.removeEventListener('mousemove', event._resize_editor);\n\n        _d.removeEventListener('mouseup', closureFunc);\n      }\n\n      _d.addEventListener('mousemove', event._resize_editor);\n\n      _d.addEventListener('mouseup', closureFunc);\n    },\n    _resize_editor: function _resize_editor(e) {\n      var resizeInterval = context.element.editorArea.offsetHeight + (e.clientY - core._variable.resizeClientY);\n      var h = resizeInterval < core._variable.minResizingSize ? core._variable.minResizingSize : resizeInterval;\n      context.element.wysiwygFrame.style.height = context.element.code.style.height = h + 'px';\n      core._variable.resizeClientY = e.clientY;\n      if (util.isIE) core.__callResizeFunction(h, null);\n    },\n    onResize_window: function onResize_window() {\n      if (util.isIE) core.resetResponsiveToolbar();\n      if (context.element.toolbar.offsetWidth === 0) return;\n\n      if (context.fileBrowser && context.fileBrowser.area.style.display === 'block') {\n        context.fileBrowser.body.style.maxHeight = _w.innerHeight - context.fileBrowser.header.offsetHeight - 50 + 'px';\n      }\n\n      if (core.submenuActiveButton && core.submenu) {\n        core._setMenuPosition(core.submenuActiveButton, core.submenu);\n      }\n\n      if (core._variable.isFullScreen) {\n        core._variable.innerHeight_fullScreen += _w.innerHeight - context.element.toolbar.offsetHeight - core._variable.innerHeight_fullScreen;\n        context.element.editorArea.style.height = core._variable.innerHeight_fullScreen + 'px';\n        return;\n      }\n\n      if (core._variable.isCodeView && core._isInline) {\n        event._showToolbarInline();\n\n        return;\n      }\n\n      core._iframeAutoHeight();\n\n      if (core._sticky) {\n        context.element.toolbar.style.width = context.element.topArea.offsetWidth - 2 + 'px';\n        event.onScroll_window();\n      }\n    },\n    onScroll_window: function onScroll_window() {\n      if (core._variable.isFullScreen || context.element.toolbar.offsetWidth === 0 || options.stickyToolbar < 0) return;\n      var element = context.element;\n      var editorHeight = element.editorArea.offsetHeight;\n      var y = (this.scrollY || _d.documentElement.scrollTop) + options.stickyToolbar;\n      var editorTop = event._getEditorOffsets(options.toolbarContainer).top - (core._isInline ? element.toolbar.offsetHeight : 0);\n      var inlineOffset = core._isInline && y - editorTop > 0 ? y - editorTop - context.element.toolbar.offsetHeight : 0;\n\n      if (y < editorTop) {\n        event._offStickyToolbar();\n      } else if (y + core._variable.minResizingSize >= editorHeight + editorTop) {\n        if (!core._sticky) event._onStickyToolbar(inlineOffset);\n        element.toolbar.style.top = inlineOffset + editorHeight + editorTop + options.stickyToolbar - y - core._variable.minResizingSize + 'px';\n      } else if (y >= editorTop) {\n        event._onStickyToolbar(inlineOffset);\n      }\n    },\n    _getEditorOffsets: function _getEditorOffsets(container) {\n      var offsetEl = container || context.element.topArea;\n      var t = 0,\n          l = 0,\n          s = 0;\n\n      while (offsetEl) {\n        t += offsetEl.offsetTop;\n        l += offsetEl.offsetLeft;\n        s += offsetEl.scrollTop;\n        offsetEl = offsetEl.offsetParent;\n      }\n\n      return {\n        top: t,\n        left: l,\n        scroll: s\n      };\n    },\n    _getPageBottomSpace: function _getPageBottomSpace() {\n      return _d.documentElement.scrollHeight - (event._getEditorOffsets(null).top + context.element.topArea.offsetHeight);\n    },\n    _onStickyToolbar: function _onStickyToolbar(inlineOffset) {\n      var element = context.element;\n\n      if (!core._isInline && !options.toolbarContainer) {\n        element._stickyDummy.style.height = element.toolbar.offsetHeight + 'px';\n        element._stickyDummy.style.display = 'block';\n      }\n\n      element.toolbar.style.top = options.stickyToolbar + inlineOffset + 'px';\n      element.toolbar.style.width = core._isInline ? core._inlineToolbarAttr.width : element.toolbar.offsetWidth + 'px';\n      util.addClass(element.toolbar, 'se-toolbar-sticky');\n      core._sticky = true;\n    },\n    _offStickyToolbar: function _offStickyToolbar() {\n      var element = context.element;\n      element._stickyDummy.style.display = 'none';\n      element.toolbar.style.top = core._isInline ? core._inlineToolbarAttr.top : '';\n      element.toolbar.style.width = core._isInline ? core._inlineToolbarAttr.width : '';\n      element.editorArea.style.marginTop = '';\n      util.removeClass(element.toolbar, 'se-toolbar-sticky');\n      core._sticky = false;\n    },\n    _codeViewAutoHeight: function _codeViewAutoHeight() {\n      if (core._variable.isFullScreen) return;\n      context.element.code.style.height = context.element.code.scrollHeight + 'px';\n    },\n    // FireFox - table delete, Chrome - image, video, audio\n    _hardDelete: function _hardDelete() {\n      var range = core.getRange();\n      var sc = range.startContainer;\n      var ec = range.endContainer; // table\n\n      var sCell = util.getRangeFormatElement(sc);\n      var eCell = util.getRangeFormatElement(ec);\n      var sIsCell = util.isCell(sCell);\n      var eIsCell = util.isCell(eCell);\n      var ancestor = range.commonAncestorContainer;\n\n      if ((sIsCell && !sCell.previousElementSibling && !sCell.parentElement.previousElementSibling || eIsCell && !eCell.nextElementSibling && !eCell.parentElement.nextElementSibling) && sCell !== eCell) {\n        if (!sIsCell) {\n          util.removeItem(util.getParentElement(eCell, function (current) {\n            return ancestor === current.parentNode;\n          }));\n        } else if (!eIsCell) {\n          util.removeItem(util.getParentElement(sCell, function (current) {\n            return ancestor === current.parentNode;\n          }));\n        } else {\n          util.removeItem(util.getParentElement(sCell, function (current) {\n            return ancestor === current.parentNode;\n          }));\n          core.nativeFocus();\n          return true;\n        }\n      } // component\n\n\n      var sComp = sc.nodeType === 1 ? util.getParentElement(sc, '.se-component') : null;\n      var eComp = ec.nodeType === 1 ? util.getParentElement(ec, '.se-component') : null;\n      if (sComp) util.removeItem(sComp);\n      if (eComp) util.removeItem(eComp);\n      return false;\n    },\n    onPaste_wysiwyg: function onPaste_wysiwyg(e) {\n      var clipboardData = util.isIE ? _w.clipboardData : e.clipboardData;\n      if (!clipboardData) return true;\n      return event._dataTransferAction('paste', e, clipboardData);\n    },\n    _setClipboardComponent: function _setClipboardComponent(e, info, clipboardData) {\n      e.preventDefault();\n      e.stopPropagation();\n      clipboardData.setData('text/html', info.component.outerHTML);\n    },\n    onCopy_wysiwyg: function onCopy_wysiwyg(e) {\n      var clipboardData = util.isIE ? _w.clipboardData : e.clipboardData; // user event\n\n      if (typeof functions.onCopy === 'function' && !functions.onCopy(e, clipboardData, core)) {\n        e.preventDefault();\n        e.stopPropagation();\n        return false;\n      }\n\n      var info = core.currentFileComponentInfo;\n\n      if (info && !util.isIE) {\n        event._setClipboardComponent(e, info, clipboardData);\n\n        util.addClass(info.component, 'se-component-copy'); // copy effect\n\n        _w.setTimeout(function () {\n          util.removeClass(info.component, 'se-component-copy');\n        }, 150);\n      }\n    },\n    onSave_wysiwyg: function onSave_wysiwyg(content) {\n      // user event\n      if (typeof functions.onSave === 'function') {\n        functions.onSave(content, core);\n        return;\n      }\n    },\n    onCut_wysiwyg: function onCut_wysiwyg(e) {\n      var clipboardData = util.isIE ? _w.clipboardData : e.clipboardData; // user event\n\n      if (typeof functions.onCut === 'function' && !functions.onCut(e, clipboardData, core)) {\n        e.preventDefault();\n        e.stopPropagation();\n        return false;\n      }\n\n      var info = core.currentFileComponentInfo;\n\n      if (info && !util.isIE) {\n        event._setClipboardComponent(e, info, clipboardData);\n\n        util.removeItem(info.component);\n        core.controllersOff();\n      }\n\n      _w.setTimeout(function () {\n        // history stack\n        core.history.push(false);\n      });\n    },\n    onDrop_wysiwyg: function onDrop_wysiwyg(e) {\n      if (core.isReadOnly || util.isIE) {\n        e.preventDefault();\n        e.stopPropagation();\n        return false;\n      }\n\n      var dataTransfer = e.dataTransfer;\n      if (!dataTransfer) return true;\n      core.removeNode();\n\n      event._setDropLocationSelection(e);\n\n      return event._dataTransferAction('drop', e, dataTransfer);\n    },\n    _setDropLocationSelection: function _setDropLocationSelection(e) {\n      if (e.rangeParent) {\n        core.setRange(e.rangeParent, e.rangeOffset, e.rangeParent, e.rangeOffset);\n      } else if (core._wd.caretRangeFromPoint) {\n        var r = core._wd.caretRangeFromPoint(e.clientX, e.clientY);\n\n        core.setRange(r.startContainer, r.startOffset, r.endContainer, r.endOffset);\n      } else {\n        var _r3 = core.getRange();\n\n        core.setRange(_r3.startContainer, _r3.startOffset, _r3.endContainer, _r3.endOffset);\n      }\n    },\n    _dataTransferAction: function _dataTransferAction(type, e, data) {\n      var plainText, cleanData;\n\n      if (util.isIE) {\n        plainText = data.getData('Text');\n        var range = core.getRange();\n        var tempDiv = util.createElement('DIV');\n        var tempRange = {\n          sc: range.startContainer,\n          so: range.startOffset,\n          ec: range.endContainer,\n          eo: range.endOffset\n        };\n        tempDiv.setAttribute('contenteditable', true);\n        tempDiv.style.cssText = 'position:absolute; top:0; left:0; width:1px; height:1px; overflow:hidden;';\n        context.element.relative.appendChild(tempDiv);\n        tempDiv.focus();\n\n        _w.setTimeout(function () {\n          cleanData = tempDiv.innerHTML;\n          util.removeItem(tempDiv);\n          core.setRange(tempRange.sc, tempRange.so, tempRange.ec, tempRange.eo);\n\n          event._setClipboardData(type, e, plainText, cleanData, data);\n        });\n\n        return true;\n      } else {\n        plainText = data.getData('text/plain');\n        cleanData = data.getData('text/html');\n\n        if (event._setClipboardData(type, e, plainText, cleanData, data) === false) {\n          e.preventDefault();\n          e.stopPropagation();\n          return false;\n        }\n      }\n    },\n    _setClipboardData: function _setClipboardData(type, e, plainText, cleanData, data) {\n      // MS word, OneNode, Excel\n      var MSData = /class=[\"']*Mso(Normal|List)/i.test(cleanData) || /content=[\"']*Word.Document/i.test(cleanData) || /content=[\"']*OneNote.File/i.test(cleanData) || /content=[\"']*Excel.Sheet/i.test(cleanData);\n      var onlyText = !cleanData;\n\n      if (!onlyText) {\n        if (MSData) {\n          cleanData = cleanData.replace(/\\n/g, ' ');\n          plainText = plainText.replace(/\\n/g, ' ');\n        } else {\n          cleanData = (plainText === cleanData ? plainText : cleanData).replace(/\\n/g, '<br>');\n        }\n\n        cleanData = core.cleanHTML(cleanData, core.pasteTagsWhitelistRegExp, core.pasteTagsBlacklistRegExp);\n      } else {\n        cleanData = util._HTMLConvertor(plainText).replace(/\\n/g, '<br>');\n      }\n\n      var maxCharCount = core._charCount(core._charTypeHTML ? cleanData : plainText); // user event - paste\n\n\n      if (type === 'paste' && typeof functions.onPaste === 'function') {\n        var value = functions.onPaste(e, cleanData, maxCharCount, core);\n        if (!value) return false;\n        if (typeof value === 'string') cleanData = value;\n      } // user event - drop\n\n\n      if (type === 'drop' && typeof functions.onDrop === 'function') {\n        var _value = functions.onDrop(e, cleanData, maxCharCount, core);\n\n        if (!_value) return false;\n        if (typeof _value === 'string') cleanData = _value;\n      } // files\n\n\n      var files = data.files;\n\n      if (files.length > 0 && !MSData) {\n        if (/^image/.test(files[0].type) && core.plugins.image) {\n          functions.insertImage(files);\n        }\n\n        return false;\n      }\n\n      if (!maxCharCount) {\n        return false;\n      }\n\n      if (cleanData) {\n        functions.insertHTML(cleanData, true, false);\n        return false;\n      }\n    },\n    onMouseMove_wysiwyg: function onMouseMove_wysiwyg(e) {\n      if (core.isDisabled || core.isReadOnly) return false;\n      var component = util.getParentElement(e.target, util.isComponent);\n      var lineBreakerStyle = core._lineBreaker.style;\n\n      if (component && !core.currentControllerName) {\n        var ctxEl = context.element;\n        var scrollTop = 0;\n        var el = ctxEl.wysiwyg;\n\n        do {\n          scrollTop += el.scrollTop;\n          el = el.parentElement;\n        } while (el && !/^(BODY|HTML)$/i.test(el.nodeName));\n\n        var wScroll = ctxEl.wysiwyg.scrollTop;\n\n        var offsets = event._getEditorOffsets(null);\n\n        var componentTop = util.getOffset(component, ctxEl.wysiwygFrame).top + wScroll;\n        var y = e.pageY + scrollTop + (options.iframe && !options.toolbarContainer ? ctxEl.toolbar.offsetHeight : 0);\n\n        var _c8 = componentTop + (options.iframe ? scrollTop : offsets.top);\n\n        var isList = util.isListCell(component.parentNode);\n        var dir = '',\n            top = '';\n\n        if ((isList ? !component.previousSibling : !util.isFormatElement(component.previousElementSibling)) && y < _c8 + 20) {\n          top = componentTop;\n          dir = 't';\n        } else if ((isList ? !component.nextSibling : !util.isFormatElement(component.nextElementSibling)) && y > _c8 + component.offsetHeight - 20) {\n          top = componentTop + component.offsetHeight;\n          dir = 'b';\n        } else {\n          lineBreakerStyle.display = 'none';\n          return;\n        }\n\n        core._variable._lineBreakComp = component;\n        core._variable._lineBreakDir = dir;\n        lineBreakerStyle.top = top - wScroll + 'px';\n        core._lineBreakerButton.style.left = util.getOffset(component).left + component.offsetWidth / 2 - 15 + 'px';\n        lineBreakerStyle.display = 'block';\n      } // off line breaker\n      else if (lineBreakerStyle.display !== 'none') {\n        lineBreakerStyle.display = 'none';\n      }\n    },\n    _onMouseDown_lineBreak: function _onMouseDown_lineBreak(e) {\n      e.preventDefault();\n    },\n    _onLineBreak: function _onLineBreak(e) {\n      e.preventDefault();\n      var component = core._variable._lineBreakComp;\n      var dir = !this ? core._variable._lineBreakDir : this;\n      var isList = util.isListCell(component.parentNode);\n      var format = util.createElement(isList ? 'BR' : util.isCell(component.parentNode) ? 'DIV' : options.defaultTag);\n      if (!isList) format.innerHTML = '<br>';\n      if (core._charTypeHTML && !core.checkCharCount(format.outerHTML, 'byte-html')) return;\n      component.parentNode.insertBefore(format, dir === 't' ? component : component.nextSibling);\n      core._lineBreaker.style.display = 'none';\n      core._variable._lineBreakComp = null;\n      var focusEl = isList ? format : format.firstChild;\n      core.setRange(focusEl, 1, focusEl, 1); // history stack\n\n      core.history.push(false);\n    },\n    _resizeObserver: null,\n    _toolbarObserver: null,\n    _addEvent: function _addEvent() {\n      var eventWysiwyg = options.iframe ? core._ww : context.element.wysiwyg;\n\n      if (!util.isIE) {\n        this._resizeObserver = new _w.ResizeObserver(function (entries) {\n          core.__callResizeFunction(-1, entries[0]);\n        });\n      }\n      /** toolbar event */\n\n\n      context.element.toolbar.addEventListener('mousedown', event._buttonsEventHandler, false);\n\n      context.element._menuTray.addEventListener('mousedown', event._buttonsEventHandler, false);\n\n      context.element.toolbar.addEventListener('click', event.onClick_toolbar, false);\n      /** editor area */\n\n      eventWysiwyg.addEventListener('mousedown', event.onMouseDown_wysiwyg, false);\n      eventWysiwyg.addEventListener('click', event.onClick_wysiwyg, false);\n      eventWysiwyg.addEventListener(util.isIE ? 'textinput' : 'input', event.onInput_wysiwyg, false);\n      eventWysiwyg.addEventListener('keydown', event.onKeyDown_wysiwyg, false);\n      eventWysiwyg.addEventListener('keyup', event.onKeyUp_wysiwyg, false);\n      eventWysiwyg.addEventListener('paste', event.onPaste_wysiwyg, false);\n      eventWysiwyg.addEventListener('copy', event.onCopy_wysiwyg, false);\n      eventWysiwyg.addEventListener('cut', event.onCut_wysiwyg, false);\n      eventWysiwyg.addEventListener('drop', event.onDrop_wysiwyg, false);\n      eventWysiwyg.addEventListener('scroll', event.onScroll_wysiwyg, false);\n      eventWysiwyg.addEventListener('focus', event.onFocus_wysiwyg, false);\n      eventWysiwyg.addEventListener('blur', event.onBlur_wysiwyg, false);\n      /** line breaker */\n\n      event._lineBreakerBind = {\n        a: event._onLineBreak.bind(''),\n        t: event._onLineBreak.bind('t'),\n        b: event._onLineBreak.bind('b')\n      };\n      eventWysiwyg.addEventListener('mousemove', event.onMouseMove_wysiwyg, false);\n\n      core._lineBreakerButton.addEventListener('mousedown', event._onMouseDown_lineBreak, false);\n\n      core._lineBreakerButton.addEventListener('click', event._lineBreakerBind.a, false);\n\n      context.element.lineBreaker_t.addEventListener('mousedown', event._lineBreakerBind.t, false);\n      context.element.lineBreaker_b.addEventListener('mousedown', event._lineBreakerBind.b, false);\n      /** Events are registered only when there is a table plugin.  */\n\n      if (core.plugins.table) {\n        eventWysiwyg.addEventListener('touchstart', event.onMouseDown_wysiwyg, {\n          passive: true,\n          useCapture: false\n        });\n      }\n      /** code view area auto line */\n\n\n      if (options.height === 'auto' && !options.codeMirrorEditor) {\n        context.element.code.addEventListener('keydown', event._codeViewAutoHeight, false);\n        context.element.code.addEventListener('keyup', event._codeViewAutoHeight, false);\n        context.element.code.addEventListener('paste', event._codeViewAutoHeight, false);\n      }\n      /** resizingBar */\n\n\n      if (context.element.resizingBar) {\n        if (/\\d+/.test(options.height) && options.resizeEnable) {\n          context.element.resizingBar.addEventListener('mousedown', event.onMouseDown_resizingBar, false);\n        } else {\n          util.addClass(context.element.resizingBar, 'se-resizing-none');\n        }\n      }\n      /** set response toolbar */\n\n\n      event._setResponsiveToolbar();\n      /** responsive toolbar observer */\n\n\n      if (!util.isIE) this._toolbarObserver = new _w.ResizeObserver(core.resetResponsiveToolbar);\n      /** window event */\n\n      _w.addEventListener('resize', event.onResize_window, false);\n\n      if (options.stickyToolbar > -1) {\n        _w.addEventListener('scroll', event.onScroll_window, false);\n      }\n    },\n    _removeEvent: function _removeEvent() {\n      var eventWysiwyg = options.iframe ? core._ww : context.element.wysiwyg;\n      context.element.toolbar.removeEventListener('mousedown', event._buttonsEventHandler);\n\n      context.element._menuTray.removeEventListener('mousedown', event._buttonsEventHandler);\n\n      context.element.toolbar.removeEventListener('click', event.onClick_toolbar);\n      eventWysiwyg.removeEventListener('mousedown', event.onMouseDown_wysiwyg);\n      eventWysiwyg.removeEventListener('click', event.onClick_wysiwyg);\n      eventWysiwyg.removeEventListener(util.isIE ? 'textinput' : 'input', event.onInput_wysiwyg);\n      eventWysiwyg.removeEventListener('keydown', event.onKeyDown_wysiwyg);\n      eventWysiwyg.removeEventListener('keyup', event.onKeyUp_wysiwyg);\n      eventWysiwyg.removeEventListener('paste', event.onPaste_wysiwyg);\n      eventWysiwyg.removeEventListener('copy', event.onCopy_wysiwyg);\n      eventWysiwyg.removeEventListener('cut', event.onCut_wysiwyg);\n      eventWysiwyg.removeEventListener('drop', event.onDrop_wysiwyg);\n      eventWysiwyg.removeEventListener('scroll', event.onScroll_wysiwyg);\n      eventWysiwyg.removeEventListener('mousemove', event.onMouseMove_wysiwyg);\n\n      core._lineBreakerButton.removeEventListener('mousedown', event._onMouseDown_lineBreak);\n\n      core._lineBreakerButton.removeEventListener('click', event._lineBreakerBind.a);\n\n      context.element.lineBreaker_t.removeEventListener('mousedown', event._lineBreakerBind.t);\n      context.element.lineBreaker_b.removeEventListener('mousedown', event._lineBreakerBind.b);\n      event._lineBreakerBind = null;\n      eventWysiwyg.removeEventListener('touchstart', event.onMouseDown_wysiwyg, {\n        passive: true,\n        useCapture: false\n      });\n      eventWysiwyg.removeEventListener('focus', event.onFocus_wysiwyg);\n      eventWysiwyg.removeEventListener('blur', event.onBlur_wysiwyg);\n      context.element.code.removeEventListener('keydown', event._codeViewAutoHeight);\n      context.element.code.removeEventListener('keyup', event._codeViewAutoHeight);\n      context.element.code.removeEventListener('paste', event._codeViewAutoHeight);\n\n      if (context.element.resizingBar) {\n        context.element.resizingBar.removeEventListener('mousedown', event.onMouseDown_resizingBar);\n      }\n\n      if (event._resizeObserver) {\n        event._resizeObserver.unobserve(context.element.wysiwygFrame);\n\n        event._resizeObserver = null;\n      }\n\n      if (event._toolbarObserver) {\n        event._toolbarObserver.unobserve(context.element._toolbarShadow);\n\n        event._toolbarObserver = null;\n      }\n\n      _w.removeEventListener('resize', event.onResize_window);\n\n      _w.removeEventListener('scroll', event.onScroll_window);\n    },\n    _setResponsiveToolbar: function _setResponsiveToolbar() {\n      if (_responsiveButtons.length === 0) {\n        _responsiveButtons = null;\n        return;\n      }\n\n      event._responsiveCurrentSize = 'default';\n      var sizeArray = event._responsiveButtonSize = [];\n      var buttonsObj = event._responsiveButtons = {\n        default: _responsiveButtons[0]\n      };\n\n      for (var i = 1, len = _responsiveButtons.length, size, buttonGroup; i < len; i++) {\n        buttonGroup = _responsiveButtons[i];\n        size = buttonGroup[0] * 1;\n        sizeArray.push(size);\n        buttonsObj[size] = buttonGroup[1];\n      }\n\n      sizeArray.sort(function (a, b) {\n        return a - b;\n      }).unshift('default');\n    }\n  };\n  /** functions */\n\n  var functions = {\n    /**\r\n     * @description Core, Util object\r\n     */\n    core: core,\n    util: util,\n\n    /**\r\n     * @description Event functions\r\n     * @param {Object} e Event Object\r\n     * @param {Object} core Core object\r\n     */\n    onload: null,\n    onScroll: null,\n    onMouseDown: null,\n    onClick: null,\n    onInput: null,\n    onKeyDown: null,\n    onKeyUp: null,\n    onCopy: null,\n    onCut: null,\n    onFocus: null,\n    onBlur: null,\n\n    /**\r\n     * @description Event functions\r\n     * @param {String} contents Current contents\r\n     * @param {Object} core Core object\r\n     */\n    onChange: null,\n\n    /**\r\n    * @description Event functions\r\n    * @param {String} contents Current contents\r\n    * @param {Object} core Core object\r\n    */\n    onSave: null,\n\n    /**\r\n     * @description Event functions (drop, paste)\r\n     * When false is returned, the default behavior is stopped.\r\n     * If the string is returned, the cleanData value is modified to the return value.\r\n     * @param {Object} e Event object.\r\n     * @param {String} cleanData HTML string modified for editor format.\r\n     * @param {Boolean} maxChartCount option (true if max character is exceeded)\r\n     * @param {Object} core Core object\r\n     * @returns {Boolean|String}\r\n     */\n    onDrop: null,\n    onPaste: null,\n\n    /**\r\n     * @description Called just before the inline toolbar is positioned and displayed on the screen.\r\n     * @param {Element} toolbar Toolbar Element\r\n     * @param {Object} context The editor's context object (editor.getContext())\r\n     * @param {Object} core Core object\r\n     */\n    showInline: null,\n\n    /**\r\n     * @description Called just after the controller is positioned and displayed on the screen.\r\n     * controller - editing elements displayed on the screen [image resizing, table editor, link editor..]]\r\n     * @param {String} name The name of the plugin that called the controller\r\n     * @param {Array} controllers Array of Controller elements\r\n     * @param {Object} core Core object\r\n     */\n    showController: null,\n\n    /**\r\n     * @description An event when toggling between code view and wysiwyg view.\r\n     * @param {Boolean} isCodeView Whether the current code view mode\r\n     * @param {Object} core Core object\r\n     */\n    toggleCodeView: null,\n\n    /**\r\n     * @description An event when toggling full screen.\r\n     * @param {Boolean} isFullScreen Whether the current full screen mode\r\n     * @param {Object} core Core object\r\n     */\n    toggleFullScreen: null,\n\n    /**\r\n     * @description It replaces the default callback function of the image upload\r\n     * @param {Object} response Response object\r\n     * @param {Object} info Input information\r\n     * - linkValue: Link url value\r\n     * - linkNewWindow: Open in new window Check Value\r\n     * - inputWidth: Value of width input\r\n     * - inputHeight: Value of height input\r\n     * - align: Align Check Value\r\n     * - isUpdate: Update image if true, create image if false\r\n     * - element: If isUpdate is true, the currently selected image.\r\n     * @param {Object} core Core object\r\n     */\n    imageUploadHandler: null,\n\n    /**\r\n     * @description It replaces the default callback function of the video upload\r\n     * @param xmlHttp xmlHttpRequest object\r\n     * @param info Input information\r\n     * - inputWidth: Value of width input\r\n     * - inputHeight: Value of height input\r\n     * - align: Align Check Value\r\n     * - isUpdate: Update video if true, create video if false\r\n     * - element: If isUpdate is true, the currently selected video.\r\n     * @param core Core object\r\n     */\n    videoUploadHandler: null,\n\n    /**\r\n     * @description It replaces the default callback function of the audio upload\r\n     * @param xmlHttp xmlHttpRequest object\r\n     * @param info Input information\r\n     * - isUpdate: Update audio if true, create audio if false\r\n     * - element: If isUpdate is true, the currently selected audio.\r\n     * @param core Core object\r\n     */\n    audioUploadHandler: null,\n\n    /**\r\n     * @description Called before the image is uploaded\r\n     * If true is returned, the internal upload process runs normally.\r\n     * If false is returned, no image upload is performed.\r\n     * If new fileList are returned,  replaced the previous fileList\r\n     * If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n     * @param {Array} files Files array\r\n     * @param {Object} info info: {\r\n     * - linkValue: Link url value\r\n     * - linkNewWindow: Open in new window Check Value\r\n     * - inputWidth: Value of width input\r\n     * - inputHeight: Value of height input\r\n     * - align: Align Check Value\r\n     * - isUpdate: Update image if true, create image if false\r\n     * - element: If isUpdate is true, the currently selected image.\r\n     * }\r\n     * @param {Object} core Core object\r\n     * @param {Function} uploadHandler If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n     *                \"uploadHandler\" is an upload function with \"core\" and \"info\" bound.\r\n     *                [upload files] : uploadHandler(files or [new File(...),])\r\n     *                [error]        : uploadHandler(\"Error message\")\r\n     *                [Just finish]  : uploadHandler()\r\n     *                [directly register] : uploadHandler(response) // Same format as \"imageUploadUrl\" response\r\n     *                                   ex) {\r\n     *                                      // \"errorMessage\": \"insert error message\",\r\n     *                                      \"result\": [ { \"url\": \"...\", \"name\": \"...\", \"size\": \"999\" }, ]\r\n     *                                   }\r\n     * @returns {Boolean|Array|undefined}\r\n     */\n    onImageUploadBefore: null,\n\n    /**\r\n     * @description Called before the video is uploaded\r\n     * If true is returned, the internal upload process runs normally.\r\n     * If false is returned, no video(iframe, video) upload is performed.\r\n     * If new fileList are returned,  replaced the previous fileList\r\n     * If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n     * @param {Array} files Files array\r\n     * @param {Object} info info: {\r\n     * - inputWidth: Value of width input\r\n     * - inputHeight: Value of height input\r\n     * - align: Align Check Value\r\n     * - isUpdate: Update video if true, create video if false\r\n     * - element: If isUpdate is true, the currently selected video.\r\n     * }\r\n     * @param {Object} core Core object\r\n     * @param {Function} uploadHandler If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n     *                \"uploadHandler\" is an upload function with \"core\" and \"info\" bound.\r\n     *                [upload files] : uploadHandler(files or [new File(...),])\r\n     *                [error]        : uploadHandler(\"Error message\")\r\n     *                [Just finish]  : uploadHandler()\r\n     *                [directly register] : uploadHandler(response) // Same format as \"videoUploadUrl\" response\r\n     *                                   ex) {\r\n     *                                      // \"errorMessage\": \"insert error message\",\r\n     *                                      \"result\": [ { \"url\": \"...\", \"name\": \"...\", \"size\": \"999\" }, ]\r\n     *                                   }\r\n     * @returns {Boolean|Array|undefined}\r\n     */\n    onVideoUploadBefore: null,\n\n    /**\r\n     * @description Called before the audio is uploaded\r\n     * If true is returned, the internal upload process runs normally.\r\n     * If false is returned, no audio upload is performed.\r\n     * If new fileList are returned,  replaced the previous fileList\r\n     * If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n     * @param {Array} files Files array\r\n     * @param {Object} info info: {\r\n     * - isUpdate: Update audio if true, create audio if false\r\n     * - element: If isUpdate is true, the currently selected audio.\r\n     * }\r\n     * @param {Object} core Core object\r\n     * @param {Function} uploadHandler If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n     *                \"uploadHandler\" is an upload function with \"core\" and \"info\" bound.\r\n     *                [upload files] : uploadHandler(files or [new File(...),])\r\n     *                [error]        : uploadHandler(\"Error message\")\r\n     *                [Just finish]  : uploadHandler()\r\n     *                [directly register] : uploadHandler(response) // Same format as \"audioUploadUrl\" response\r\n     *                                   ex) {\r\n     *                                      // \"errorMessage\": \"insert error message\",\r\n     *                                      \"result\": [ { \"url\": \"...\", \"name\": \"...\", \"size\": \"999\" }, ]\r\n     *                                   }\r\n     * @returns {Boolean|Array|undefined}\r\n     */\n    onAudioUploadBefore: null,\n\n    /**\r\n     * @description Called when the image is uploaded, updated, deleted\r\n     * @param {Element} targetElement Target element\r\n     * @param {Number} index Uploaded index\r\n     * @param {String} state Upload status ('create', 'update', 'delete')\r\n     * @param {Object} info Image info object\r\n     * - index: data index\r\n     * - name: file name\r\n     * - size: file size\r\n     * - select: select function\r\n     * - delete: delete function\r\n     * - element: target element\r\n     * - src: src attribute of tag\r\n     * @param {Number} remainingFilesCount Count of remaining files to upload (0 when added as a url)\r\n     * @param {Object} core Core object\r\n     */\n    onImageUpload: null,\n\n    /**\r\n    * @description Called when the video(iframe, video) is is uploaded, updated, deleted\r\n    * -- arguments is same \"onImageUpload\" --\r\n    */\n    onVideoUpload: null,\n\n    /**\r\n    * @description Called when the audio is is uploaded, updated, deleted\r\n    * -- arguments is same \"onImageUpload\" --\r\n    */\n    onAudioUpload: null,\n\n    /**\r\n     * @description Called when the image is upload failed\r\n     * @param {String} errorMessage Error message\r\n     * @param {Object} result Response Object\r\n     * @param {Object} core Core object\r\n     * @returns {Boolean}\r\n     */\n    onImageUploadError: null,\n\n    /**\r\n     * @description Called when the video(iframe, video) upload failed\r\n     * -- arguments is same \"onImageUploadError\" --\r\n     */\n    onVideoUploadError: null,\n\n    /**\r\n     * @description Called when the audio upload failed\r\n     * -- arguments is same \"onImageUploadError\" --\r\n     */\n    onAudioUploadError: null,\n\n    /**\r\n     * @description Called when the editor is resized using the bottom bar\r\n     */\n    onResizeEditor: null,\n\n    /**\r\n     * @description Called after the \"setToolbarButtons\" invocation.\r\n     * Can be used to tweak buttons properties (useful for custom buttons)\r\n     * @param {Array} buttonList Button list \r\n     * @param {Object} core Core object\r\n     */\n    onSetToolbarButtons: null,\n\n    /**\r\n     * @description Reset the buttons on the toolbar. (Editor is not reloaded)\r\n     * You cannot set a new plugin for the button.\r\n     * @param {Array} buttonList Button list \r\n     */\n    setToolbarButtons: function setToolbarButtons(buttonList) {\n      core.submenuOff();\n      core.containerOff();\n      core.moreLayerOff();\n\n      var newToolbar = _Constructor._createToolBar(_d, buttonList, core.plugins, options);\n\n      _responsiveButtons = newToolbar.responsiveButtons;\n\n      event._setResponsiveToolbar();\n\n      context.element.toolbar.replaceChild(newToolbar._buttonTray, context.element._buttonTray);\n\n      var newContext = _Context(context.element.originElement, core._getConstructed(context.element), options);\n\n      context.element = newContext.element;\n      context.tool = newContext.tool;\n      if (options.iframe) context.element.wysiwyg = core._wd.body;\n\n      core._recoverButtonStates();\n\n      core._cachingButtons();\n\n      core.history._resetCachingButton();\n\n      core.effectNode = null;\n      if (core.hasFocus) event._applyTagEffects();\n      if (core.isReadOnly) util.setDisabledButtons(true, core.resizingDisabledButtons);\n      if (typeof functions.onSetToolbarButtons === 'function') functions.onSetToolbarButtons(newToolbar._buttonTray.querySelectorAll('button'), core);\n    },\n\n    /**\r\n     * @description Add or reset option property (Editor is reloaded)\r\n     * @param {Object} _options Options\r\n     */\n    setOptions: function setOptions(_options) {\n      event._removeEvent();\n\n      core._resetComponents();\n\n      util.removeClass(core._styleCommandMap.showBlocks, 'active');\n      util.removeClass(core._styleCommandMap.codeView, 'active');\n      core._variable.isCodeView = false;\n      core._iframeAuto = null;\n      core.plugins = _options.plugins || core.plugins;\n      var mergeOptions = [options, _options].reduce(function (init, option) {\n        for (var key in option) {\n          if (!util.hasOwn(option, key)) continue;\n\n          if (key === 'plugins' && option[key] && init[key]) {\n            (function () {\n              var i = init[key],\n                  o = option[key];\n              i = i.length ? i : _w.Object.keys(i).map(function (name) {\n                return i[name];\n              });\n              o = o.length ? o : _w.Object.keys(o).map(function (name) {\n                return o[name];\n              });\n              init[key] = o.filter(function (val) {\n                return i.indexOf(val) === -1;\n              }).concat(i);\n            })();\n          } else {\n            init[key] = option[key];\n          }\n        }\n\n        return init;\n      }, {});\n      var el = context.element;\n      var _initHTML = el.wysiwyg.innerHTML; // set option\n\n      var cons = _Constructor._setOptions(mergeOptions, context, options);\n\n      if (cons.callButtons) {\n        pluginCallButtons = cons.callButtons;\n        core.initPlugins = {};\n      }\n\n      if (cons.plugins) {\n        core.plugins = plugins = cons.plugins;\n      } // reset context\n\n\n      if (el._menuTray.children.length === 0) this._menuTray = {};\n      _responsiveButtons = cons.toolbar.responsiveButtons;\n      core.options = options = mergeOptions;\n      core.lang = lang = options.lang;\n\n      if (options.iframe) {\n        el.wysiwygFrame.addEventListener('load', function () {\n          util._setIframeDocument(this, options);\n\n          core._setOptionsInit(el, _initHTML);\n        });\n      }\n\n      el.editorArea.appendChild(el.wysiwygFrame);\n\n      if (!options.iframe) {\n        core._setOptionsInit(el, _initHTML);\n      }\n    },\n\n    /**\r\n     * @description Set \"options.defaultStyle\" style.\r\n     * Define the style of the edit area\r\n     * It can also be defined with the \"setOptions\" method, but the \"setDefaultStyle\" method does not render the editor again.\r\n     * @param {String} style Style string\r\n     */\n    setDefaultStyle: function setDefaultStyle(style) {\n      var newStyles = options._editorStyles = util._setDefaultOptionStyle(options, style);\n\n      var el = context.element; // top area\n\n      el.topArea.style.cssText = newStyles.top; // code view\n\n      el.code.style.cssText = options._editorStyles.frame;\n      el.code.style.display = 'none';\n\n      if (options.height === 'auto') {\n        el.code.style.overflow = 'hidden';\n      } else {\n        el.code.style.overflow = '';\n      } // wysiwyg frame\n\n\n      if (!options.iframe) {\n        el.wysiwygFrame.style.cssText = newStyles.frame + newStyles.editor;\n      } else {\n        el.wysiwygFrame.style.cssText = newStyles.frame;\n        el.wysiwyg.style.cssText = newStyles.editor;\n      }\n    },\n\n    /**\r\n     * @description Open a notice area\r\n     * @param {String} message Notice message\r\n     */\n    noticeOpen: function noticeOpen(message) {\n      core.notice.open.call(core, message);\n    },\n\n    /**\r\n     * @description Close a notice area\r\n     */\n    noticeClose: function noticeClose() {\n      core.notice.close.call(core);\n    },\n\n    /**\r\n     * @description Copying the contents of the editor to the original textarea and execute onSave callback\r\n     */\n    save: function save() {\n      var contents = core.getContents(false);\n      context.element.originElement.value = contents;\n      event.onSave_wysiwyg(contents, core);\n    },\n\n    /**\r\n     * @description Gets the suneditor's context object. Contains settings, plugins, and cached element objects\r\n     * @returns {Object}\r\n     */\n    getContext: function getContext() {\n      return context;\n    },\n\n    /**\r\n     * @description Gets the contents of the suneditor\r\n     * @param {Boolean} onlyContents - Return only the contents of the body without headers when the \"fullPage\" option is true\r\n     * @returns {String}\r\n     */\n    getContents: function getContents(onlyContents) {\n      return core.getContents(onlyContents);\n    },\n\n    /**\r\n     * @description Gets only the text of the suneditor contents\r\n     * @returns {String}\r\n     */\n    getText: function getText() {\n      return context.element.wysiwyg.textContent;\n    },\n\n    /**\r\n     * @description Get the editor's number of characters or binary data size.\r\n     * You can use the \"charCounterType\" option format.\r\n     * @param {String|null} charCounterType options - charCounterType ('char', 'byte', 'byte-html')\r\n     * If argument is no value, the currently set \"charCounterType\" option is used.\r\n     * @returns {Number}\r\n     */\n    getCharCount: function getCharCount(charCounterType) {\n      charCounterType = typeof charCounterType === 'string' ? charCounterType : options.charCounterType;\n      return core.getCharLength(core._charTypeHTML ? context.element.wysiwyg.innerHTML : context.element.wysiwyg.textContent, charCounterType);\n    },\n\n    /**\r\n     * @description Gets uploaded images informations\r\n     * - index: data index\r\n     * - name: file name\r\n     * - size: file size\r\n     * - select: select function\r\n     * - delete: delete function\r\n     * - element: target element\r\n     * - src: src attribute of tag\r\n     * @returns {Array}\r\n     */\n    getImagesInfo: function getImagesInfo() {\n      return context.image ? context.image._infoList : [];\n    },\n\n    /**\r\n     * @description Gets uploaded files(plugin using fileManager) information list.\r\n     * image: [img], video: [video, iframe], audio: [audio]\r\n     * When the argument value is 'image', it is the same function as \"getImagesInfo\".\r\n     * - index: data index\r\n     * - name: file name\r\n     * - size: file size\r\n     * - select: select function\r\n     * - delete: delete function\r\n     * - element: target element\r\n     * - src: src attribute of tag\r\n     * @param {String} pluginName Plugin name (image, video, audio)\r\n     * @returns {Array}\r\n     */\n    getFilesInfo: function getFilesInfo(pluginName) {\n      return context[pluginName] ? context[pluginName]._infoList : [];\n    },\n\n    /**\r\n     * @description Upload images using image plugin\r\n     * @param {FileList} files FileList\r\n     */\n    insertImage: function insertImage(files) {\n      if (!core.plugins.image || !files) return;\n      if (!core.initPlugins.image) core.callPlugin('image', core.plugins.image.submitAction.bind(core, files), null);else core.plugins.image.submitAction.call(core, files);\n      core.focus();\n    },\n\n    /**\r\n     * @description Inserts an HTML element or HTML string or plain string at the current cursor position\r\n     * @param {Element|String} html HTML Element or HTML string or plain string\r\n     * @param {Boolean} notCleaningData If true, inserts the HTML string without refining it with core.cleanHTML.\r\n     * @param {Boolean} checkCharCount If true, if \"options.maxCharCount\" is exceeded when \"element\" is added, null is returned without addition.\r\n     * @param {Boolean} rangeSelection If true, range select the inserted node.\r\n     */\n    insertHTML: function insertHTML(html, notCleaningData, checkCharCount, rangeSelection) {\n      if (!context.element.wysiwygFrame.contains(core.getSelection().focusNode)) core.focus();\n\n      if (typeof html === 'string') {\n        if (!notCleaningData) html = core.cleanHTML(html, null, null);\n\n        try {\n          if (util.isListCell(util.getFormatElement(core.getSelectionNode(), null))) {\n            var _dom = _d.createRange().createContextualFragment(html);\n\n            var _domTree = _dom.childNodes;\n            if (core._isFormatData(_domTree)) html = core._convertListCell(_domTree);\n          }\n\n          var dom = _d.createRange().createContextualFragment(html);\n\n          var domTree = dom.childNodes;\n\n          if (checkCharCount) {\n            var type = core._charTypeHTML ? 'outerHTML' : 'textContent';\n            var checkHTML = '';\n\n            for (var i = 0, len = domTree.length; i < len; i++) {\n              checkHTML += domTree[i][type];\n            }\n\n            if (!core.checkCharCount(checkHTML, null)) return;\n          }\n\n          var _c9, a, t, prev, firstCon;\n\n          while (_c9 = domTree[0]) {\n            if (prev && prev.nodeType === 3 && a && a.nodeType === 1 && util.isBreak(_c9)) {\n              prev = _c9;\n              util.removeItem(_c9);\n              continue;\n            }\n\n            t = core.insertNode(_c9, a, false);\n            a = t.container || t;\n            if (!firstCon) firstCon = t;\n            prev = _c9;\n          }\n\n          if (prev.nodeType === 3 && a.nodeType === 1) a = prev;\n          var offset = a.nodeType === 3 ? t.endOffset || a.textContent.length : a.childNodes.length;\n          if (rangeSelection) core.setRange(firstCon.container || firstCon, firstCon.startOffset || 0, a, offset);else core.setRange(a, offset, a, offset);\n        } catch (error) {\n          if (core.isDisabled || core.isReadOnly) return;\n          console.warn('[SUNEDITOR.insertHTML.fail] ' + error);\n          core.execCommand('insertHTML', false, html);\n        }\n      } else {\n        if (util.isComponent(html)) {\n          core.insertComponent(html, false, checkCharCount, false);\n        } else {\n          var afterNode = null;\n\n          if (util.isFormatElement(html) || util.isMedia(html)) {\n            afterNode = util.getFormatElement(core.getSelectionNode(), null);\n          }\n\n          core.insertNode(html, afterNode, checkCharCount);\n        }\n      }\n\n      core.effectNode = null;\n      core.focus(); // history stack\n\n      core.history.push(false);\n    },\n\n    /**\r\n     * @description Change the contents of the suneditor\r\n     * @param {String|undefined} contents Contents to Input\r\n     */\n    setContents: function setContents(contents) {\n      core.setContents(contents);\n    },\n\n    /**\r\n     * @description Add contents to the suneditor\r\n     * @param {String} contents Contents to Input\r\n     */\n    appendContents: function appendContents(contents) {\n      var convertValue = core.convertContentsForEditor(contents);\n\n      if (!core._variable.isCodeView) {\n        var temp = util.createElement('DIV');\n        temp.innerHTML = convertValue;\n        var wysiwyg = context.element.wysiwyg;\n        var children = temp.children;\n\n        for (var i = 0, len = children.length; i < len; i++) {\n          if (children[i]) {\n            wysiwyg.appendChild(children[i]);\n          }\n        }\n      } else {\n        core._setCodeView(core._getCodeView() + '\\n' + core.convertHTMLForCodeView(convertValue, false));\n      } // history stack\n\n\n      core.history.push(false);\n    },\n\n    /**\r\n     * @description Switch to or off \"ReadOnly\" mode.\r\n     * @param {Boolean} value \"readOnly\" boolean value.\r\n     */\n    readOnly: function readOnly(value) {\n      core.isReadOnly = value;\n      util.setDisabledButtons(!!value, core.resizingDisabledButtons);\n\n      if (value) {\n        /** off menus */\n        core.controllersOff();\n        if (core.submenuActiveButton && core.submenuActiveButton.disabled) core.submenuOff();\n        if (core._moreLayerActiveButton && core._moreLayerActiveButton.disabled) core.moreLayerOff();\n        if (core.containerActiveButton && core.containerActiveButton.disabled) core.containerOff();\n        if (core.modalForm) core.plugins.dialog.close.call(core);\n        context.element.code.setAttribute(\"readOnly\", \"true\");\n        util.addClass(context.element.wysiwygFrame, 'se-read-only');\n      } else {\n        context.element.code.removeAttribute(\"readOnly\");\n        util.removeClass(context.element.wysiwygFrame, 'se-read-only');\n      }\n\n      if (options.codeMirrorEditor) options.codeMirrorEditor.setOption('readOnly', !!value);\n    },\n\n    /**\r\n     * @description Disable the suneditor\r\n     */\n    disable: function disable() {\n      this.toolbar.disable();\n      this.wysiwyg.disable();\n    },\n\n    /**\r\n     * @description Provided for backward compatibility and will be removed in 3.0.0 version\r\n     */\n    disabled: function disabled() {\n      this.disable();\n    },\n\n    /**\r\n     * @description Enable the suneditor\r\n     */\n    enable: function enable() {\n      this.toolbar.enable();\n      this.wysiwyg.enable();\n    },\n\n    /**\r\n     * @description Provided for backward compatibility and will be removed in 3.0.0 version\r\n     */\n    enabled: function enabled() {\n      this.enable();\n    },\n\n    /**\r\n     * @description Show the suneditor\r\n     */\n    show: function show() {\n      var topAreaStyle = context.element.topArea.style;\n      if (topAreaStyle.display === 'none') topAreaStyle.display = options.display;\n    },\n\n    /**\r\n     * @description Hide the suneditor\r\n     */\n    hide: function hide() {\n      context.element.topArea.style.display = 'none';\n    },\n\n    /**\r\n     * @description Destroy the suneditor\r\n     */\n    destroy: function destroy() {\n      /** off menus */\n      core.submenuOff();\n      core.containerOff();\n      core.controllersOff();\n      if (core.notice) core.notice.close.call(core);\n      if (core.modalForm) core.plugins.dialog.close.call(core);\n      /** remove history */\n\n      core.history._destroy();\n      /** remove event listeners */\n\n\n      event._removeEvent();\n      /** remove element */\n\n\n      util.removeItem(context.element.toolbar);\n      util.removeItem(context.element.topArea);\n      /** remove object reference */\n\n      for (var k in core.functions) {\n        if (util.hasOwn(core, k)) delete core.functions[k];\n      }\n\n      for (var _k2 in core) {\n        if (util.hasOwn(core, _k2)) delete core[_k2];\n      }\n\n      for (var _k3 in event) {\n        if (util.hasOwn(event, _k3)) delete event[_k3];\n      }\n\n      for (var _k4 in context) {\n        if (util.hasOwn(context, _k4)) delete context[_k4];\n      }\n\n      for (var _k5 in pluginCallButtons) {\n        if (util.hasOwn(pluginCallButtons, _k5)) delete pluginCallButtons[_k5];\n      }\n      /** remove user object */\n\n\n      for (var _k6 in this) {\n        if (util.hasOwn(this, _k6)) delete this[_k6];\n      }\n    },\n\n    /**\r\n     * @description Toolbar methods\r\n     */\n    toolbar: {\n      /**\r\n       * @description Disable the toolbar\r\n       */\n      disable: function disable() {\n        /** off menus */\n        core.submenuOff();\n        core.moreLayerOff();\n        core.containerOff();\n        context.tool.cover.style.display = 'block';\n      },\n\n      /**\r\n       * @description Provided for backward compatibility and will be removed in 3.0.0 version\r\n       */\n      disabled: function disabled() {\n        this.disable();\n      },\n\n      /**\r\n       * @description Enable the toolbar\r\n       */\n      enable: function enable() {\n        context.tool.cover.style.display = 'none';\n      },\n\n      /**\r\n       * @description Provided for backward compatibility and will be removed in 3.0.0 version\r\n       */\n      enabled: function enabled() {\n        this.enable();\n      },\n\n      /**\r\n       * @description Show the toolbar\r\n       */\n      show: function show() {\n        if (core._isInline) {\n          event._showToolbarInline();\n        } else {\n          context.element.toolbar.style.display = '';\n          context.element._stickyDummy.style.display = '';\n        }\n      },\n\n      /**\r\n       * @description Hide the toolbar\r\n       */\n      hide: function hide() {\n        if (core._isInline) {\n          event._hideToolbar();\n        } else {\n          context.element.toolbar.style.display = 'none';\n          context.element._stickyDummy.style.display = 'none';\n        }\n      }\n    },\n\n    /**\r\n     * @description Wysiwyg methods\r\n     */\n    wysiwyg: {\n      /**\r\n       * @description Disable the wysiwyg area\r\n       */\n      disable: function disable() {\n        /** off menus */\n        core.controllersOff();\n        if (core.modalForm) core.plugins.dialog.close.call(core);\n        context.element.wysiwyg.setAttribute('contenteditable', false);\n        core.isDisabled = true;\n\n        if (options.codeMirrorEditor) {\n          options.codeMirrorEditor.setOption('readOnly', true);\n        } else {\n          context.element.code.setAttribute('disabled', 'disabled');\n        }\n      },\n\n      /**\r\n       * @description Enable the wysiwyg area\r\n       */\n      enable: function enable() {\n        context.element.wysiwyg.setAttribute('contenteditable', true);\n        core.isDisabled = false;\n\n        if (options.codeMirrorEditor) {\n          options.codeMirrorEditor.setOption('readOnly', false);\n        } else {\n          context.element.code.removeAttribute('disabled');\n        }\n      }\n    }\n  };\n  /************ Core init ************/\n  // functions\n\n  core.functions = functions;\n  core.options = options; // Create to sibling node\n\n  var contextEl = context.element;\n  var originEl = contextEl.originElement;\n  var topEl = contextEl.topArea;\n  originEl.style.display = 'none';\n  topEl.style.display = 'block'; // init\n\n  if (options.iframe) {\n    contextEl.wysiwygFrame.addEventListener('load', function () {\n      util._setIframeDocument(this, options);\n\n      core._editorInit(false, options.value);\n\n      options.value = null;\n    });\n  } // insert editor element\n\n\n  if (typeof originEl.nextElementSibling === 'object') {\n    originEl.parentNode.insertBefore(topEl, originEl.nextElementSibling);\n  } else {\n    originEl.parentNode.appendChild(topEl);\n  }\n\n  contextEl.editorArea.appendChild(contextEl.wysiwygFrame);\n  contextEl = originEl = topEl = null; // init\n\n  if (!options.iframe) {\n    core._editorInit(false, options.value);\n\n    options.value = null;\n  }\n\n  return functions;\n}","map":{"version":3,"sources":["E:/React/pos-system/main/node_modules/suneditor/src/lib/core.js"],"names":["_Constructor","_Context","_history","_util","_notice","context","pluginCallButtons","plugins","lang","options","_responsiveButtons","_d","element","originElement","ownerDocument","document","_w","defaultView","window","util","icons","core","_parser","DOMParser","_prevRtl","rtl","_editorHeight","_editorHeightPadding","_listCamel","__listCommonStyle","_listKebab","camelToKebabCase","_wd","_ww","_shadowRoot","_shadowRootControllerEventTarget","functions","wwComputedStyle","notice","history","initPlugins","_targetPlugins","_menuTray","effectNode","submenu","container","_submenuName","_bindedSubmenuOff","_bindedContainerOff","submenuActiveButton","containerActiveButton","controllerArray","currentControllerName","currentControllerTarget","currentFileComponentInfo","codeViewDisabledButtons","resizingDisabledButtons","_moreLayerActiveButton","_htmlCheckWhitelistRegExp","_htmlCheckBlacklistRegExp","_disallowedTextTagsRegExp","editorTagsWhitelistRegExp","editorTagsBlacklistRegExp","pasteTagsWhitelistRegExp","pasteTagsBlacklistRegExp","hasFocus","isDisabled","isReadOnly","_attributesWhitelistRegExp","_attributesWhitelistRegExp_all_data","_attributesBlacklistRegExp","_attributesTagsWhitelist","_attributesTagsBlacklist","_bindControllersOff","_isInline","_isBalloon","_isBalloonAlways","_inlineToolbarAttr","top","width","isShow","_notHideToolbar","_sticky","_antiBlur","_lineBreaker","_lineBreakerButton","_componentsInfoInit","_componentsInfoReset","activePlugins","managedTagsInfo","_charTypeHTML","_fileInfoPluginsCheck","_fileInfoPluginsReset","_fileManager","tags","regExp","queryString","pluginRegExp","pluginMap","commandMap","_commandMapStyles","STRONG","U","EM","DEL","_styleCommandMap","_cleanStyleRegExp","span","RegExp","format","_variable","isChanged","isCodeView","isFullScreen","innerHeight_fullScreen","resizeClientY","tabSize","codeIndent","minResizingSize","getNumber","wysiwygFrame","style","minHeight","currentNodes","currentNodesMap","_range","_selectionNode","_originCssText","topArea","cssText","_bodyOverflow","_editorAreaOriginCssText","_wysiwygOriginCssText","_codeOriginCssText","_fullScreenAttrs","sticky","balloon","inline","_lineBreakComp","_lineBreakDir","_saveButtonStates","allCommandButtons","currentButtons","_buttonTray","querySelectorAll","i","command","length","getAttribute","_recoverButtonStates","button","oldButton","parentElement","replaceChild","tool","callPlugin","pluginName","callBackFunction","_target","Error","add","initMenuTarget","active","push","addModule","moduleArray","len","moduleName","name","getGlobalScrollOffset","t","l","el","scrollTop","scrollLeft","host","left","target","menu","appendChild","submenuOn","controllersOff","submenuName","_setMenuPosition","submenuOff","bind","addDocEvent","on","call","removeDocEvent","display","removeClass","moreLayerOff","layer","toolbar","querySelector","containerOn","containerName","_containerName","containerOff","visibility","height","addClass","toolbarW","offsetWidth","toolbarOffset","event","_getEditorOffsets","menuW","offsetLeft","elementW","rtlW","rtlL","overLeft","offsetEl","offsetTop","offsetParent","bt","offsetHeight","toolbarTop","menuHeight","menuHeight_bottom","innerHeight","menuTop","insTop","menuHeight_top","controllersOn","arg","arguments","hasClass","getFileComponent","indexOf","addEventListener","e","preventDefault","stopPropagation","showController","contains","test","type","keyCode","lineBreaker_t","lineBreaker_b","setControllerPosition","controller","referEl","position","addOffset","offset","getOffset","topMargin","controllerW","referElW","allow","firstElementChild","overSize","execCommand","showDefaultUI","value","nativeFocus","__focus","_editorRange","caption","getParentElement","getSelectionNode","focus","wysiwyg","iframe","range","getRange","startContainer","endContainer","isWysiwygDiv","currentNode","commonAncestorContainer","children","startOffset","isFormatElement","isComponent","createElement","defaultTag","br","insertBefore","setRange","endOffset","_applyTagEffects","_toggleToolbarBalloon","focusEdge","focusEl","lastElementChild","fileComponentInfo","selectComponent","getChildElement","current","childNodes","nodeType","textContent","blur","startCon","startOff","endCon","endOff","createRange","setStart","setEnd","error","console","warn","selection","getSelection","removeAllRanges","addRange","_rangeInfo","removeRange","_setKeyEffect","_createDefaultRange","collapsed","isCollapsed","focusNode","rangeCount","getRangeAt","sc","anchorNode","ec","so","anchorOffset","eo","focusOffset","compareValue","compareElements","rightDir","ancestor","result","getRange_addLine","_selectionVoid","op","innerHTML","nextElementSibling","selectionNode","firstChild","extentNode","comm","nodeName","isMediaComponent","_resetRangeToTextNode","tempCon","tempOffset","tempChild","lastChild","isBreak","onlyBreak","nextSibling","getFormatElement","getRangeFormatElement","isCell","parentNode","emptyText","createTextNode","zeroWidthSpace","previousElementSibling","previousSibling","removeItem","getSelectedElements","validation","trim","commonCon","lineNodes","getListChildren","isRangeFormatElement","unshift","startLine","endLine","startIdx","endIdx","onlyTable","isTable","startRangeEl","endRangeEl","isListCell","sameRange","line","slice","getSelectedElementsAndComponents","removeDuplicate","myComponent","selectedLines","component","j","splice","isEdgePoint","dir","nodeValue","_isEdgeFormat","node","cloneNode","showLoading","loading","closeLoading","appendFormatTag","formatNode","currentFormatEl","oFormat","isFreeFormatElement","oFormatName","copyTagAttributes","insertComponent","notHistoryPush","checkCharCount","notSelect","r","removeNode","oNode","formatEl","insertNode","depthFormat","splitElement","getElementDepth","onlyZeroWidthSpace","getEdgeChildNodes","className","toLowerCase","isUneditableComponent","plugin","setTimeout","select","_setComponentLineBreaker","t_style","b_style","resizing","resizeContainer","isList","componentTop","wScroll","w","afterNode","insertListCell","originAfter","tempAfterNode","tempParentNode","freeFormat","isFormats","isMedia","isEdge","prevContainer","sameParent","subList","newCell","formatRange","splitText","c","removeChild","isSameContainer","removedTag","oldParent","rangeCon","fNode","ul","chList","getArrayItem","cItem","isEmptyLine","_setIntoFreeFormat","previous","next","previousText","nextText","newRange","zeroWidth","_isIgnoreNodeChange","oNodeChildren","lastONode","beforeNode","getListChildNodes","startIndex","getArrayIndex","endIndex","startNode","endNode","item","data","undefined","_nodeRemoveListItem","substringData","endUl","startLi","rc","removeItemAllParents","applyRangeFormatElement","rangeElement","rangeLines","linesLoop","nested","fEl","lEl","f","list","last","standTag","beforeTag","pElement","parentDepth","listParent","lineArr","removeItems","parent","origin","before","cc","originParent","depth","nextLine","nextList","p","edge","detachRangeFormatElement","cLen","removeArray","mergeSameTags","mergeNestedTags","splitRange","selectedFormats","newRangeElement","remove","firstNode","lastNode","rangeEl","newList","insertedNew","reset","moveComplete","appendNode","insNode","sibling","originNode","insChildren","first","_notTextNode","originNext","detachRange","detachNestedList","fChildren","lineIndex","insNext","inner","innerChildren","copyFormatAttributes","rangeParent","rangeRight","removeEmptyNode","childEdge","detachList","rangeArr","listFirst","listLast","passComponent","o","lastIndex","nodeChange","styleArray","removeNodeArray","strictRemove","isRemoveNode","isRemoveFormat","isNonEditable","getValues","some","k","wRegExp","newNodeName","sNode","checkCnt","checkAttrs","checkStyles","ckeckClasses","classList","s","classReg","replace","styleCheck","classCheck","match","start","end","newNode","styleRegExp","classRegExp","removeNodeRegExp","wBoolean","Boolean","_removeCheck","v","checkNode","vNode","tagRemove","originStyle","originClasses","classes","removeAttribute","oneLine","endLength","isRemoveAnchor","arr","n","_isMaintainedNode","_isSizeNode","isSizeNode","_getMaintainedNode","_util_getMaintainedNode","_util_isMaintainedNode","_resetCommonListCell","_nodeChange_oneLine","_setCommonListStyle","appliedCommonList","_nodeChange_endLine","_nodeChange_middleLine","_nodeChange_startLine","elStyles","ek","elKeys","refer","removeProperty","sel","appliedEl","_textTagsMap","child","childStyle","elStyle","_defaultCommand","bold","fontWeight","italic","fontStyle","cKeys","ch","_stripRemoveNode","_isRemove","anchor","newInnerNode","parentCon","sameTag","z","nNodeArray","pNode","isSameNode","startPass","endPass","pCurrent","checkCss","recursionFunc","coverNode","prevNode","textNode","a","m","prevAnchorNode","substr","childNode","pop","anchors","concat","afterAnchorNode","aChildren","aLen","ancestorAnchorNode","textNode_s","textNode_e","rChildren","endConReset","newStartOffset","startPath","getNodePath","mergeEndCon","newEndOffset","endPath","newOffsets","getNodeFromPath","_endContainer","passNode","cloneChild","isTopNode","offsets","path","tempNode","newCssText","newClass","noneChange","actionCall","_showToolbarBalloon","_showToolbarInline","arrayIncludes","open","action","commandHandler","info","toggleCodeView","toggleFullScreen","indent","undo","redo","removeFormat","print","preview","toggleDisplayBlocks","setDir","callBackSave","getContents","save","setAttribute","nodesMap","cmd","cells","shift","marginDir","margin","setStyle","editInsideList","toggleClass","showBlocks","_resourcesStateChange","setDisabledButtons","_setCodeDataToEditor","code","codeMirrorEditor","mode","_arrow","_hideToolbar","codeView","_resetCachingButton","_setEditorDataToCodeView","scrollHeight","refresh","_checkPlaceholder","code_html","_getCodeView","fullPage","parseDocument","parseFromString","headChildren","head","tagName","headers","_setIframeCssTags","body","convertContentsForEditor","attrs","attributes","editableClasses","_editableClass","split","codeContents","convertHTMLForCodeView","codeValue","getAttributesToString","outerHTML","_setCodeView","editorArea","_var","wasToolbarHidden","toolbarContainer","relative","maxWidth","zIndex","_stickyDummy","overflow","fullScreenOffset","changeElement","reduction","_iframeAutoHeight","marginTop","fullScreen","_codeViewAutoHeight","stickyToolbar","onScroll_window","expansion","hide","contentsHTML","printTemplate","printDocument","getIframeDocument","wDoc","arrts","_printClass","write","links","getElementsByTagName","styles","linkHTML","isIE_Edge","isChromium","documentMode","StyleMedia","contentWindow","previewTemplate","windowObject","mimeType","changeDir","align","exchangeDir","outdent","marginRight","marginLeft","textAlign","changeTxt","dir_ltr","dir_rtl","setContents","html","convertValue","_resetComponents","setIframeContents","ctx","onlyContents","contents","renderHTML","figcaptions","getFullContents","_makeLine","requireFormat","_disallowedTags","isSpanWithoutAttr","isAnchor","_HTMLConvertor","textArray","tLen","text","_allowHTMLComments","_tagConvertor","_deleteDisallowedTags","_cleanStyle","sv","allowedStyle","kebabToCamelCase","font","fontSize","fontColor","hiliteColor","join","_cleanTags","lowLevelCheck","bAttr","wAttr","toString","h","avw","avh","_editFormat","dom","tempTree","createContextualFragment","_convertListCell","domTree","_isFormatData","isTextStyleElement","cleanHTML","whitelist","blacklist","_consistencyCheckOfHTML","query","textCompList","initMethod","map","htmlRemoveWhiteSpace","createTagsWhitelist","createTagsBlacklist","comp","returnHTML","brReg","isFormat","brChar","indentSize","Array","elementRegTest","elementIndent","lineBR","nodeRegTest","tag","tagIndent","XMLSerializer","serializeToString","listener","useCapture","removeEventListener","_charCount","inputText","maxCharCount","countType","charCounterType","nextCharCount","getCharLength","_setCharCount","over","count","getCharCount","slicePosition","_callCounterBlink","content","getByteLength","resetResponsiveToolbar","responsiveSize","_responsiveButtonSize","toolbarWidth","responsiveWidth","_responsiveCurrentSize","setToolbarButtons","charCounter","charWrapper","_checkComponents","getDoc","setValue","getValue","ignoredList","key","hasOwn","OUTDENT","isImportantDisabled","INDENT","_init","reload","_initHTML","getComputedStyle","getPropertyValue","ShadowRoot","shadowRoot","disallowTextTags","Object","keys","allowTextTags","addTagsWhitelist","filter","getRegList","str","str2","defaultAttr","dataAttr","_editorTagsWhitelist","tagsBlacklist","pasteTagsWhitelist","pasteTagsBlacklist","regEndStr","_wAttr","attributesWhitelist","tagsAttr","allAttr","_bAttr","attributesBlacklist","_cachingButtons","managedClass","filePluginRegExp","checkFileInfo","resetFileInfo","isArray","fileTags","managedTags","method","_placeholder","placeholder","lineBreaker","_onChange_historyStack","contentDocument","_editorStyles","editor","_iframeAuto","_initWysiwygArea","textTags","toUpperCase","underline","strike","sub","subscript","sup","superscript","onChange","isIE","__callResizeFunction","resizeObserverEntry","borderBoxSize","blockSize","contentRect","onResizeEditor","_allowedEmptyNodeList","innerText","_setDefaultFormat","formatName","fileComponent","isNotCheckingNode","_setOptionsInit","_getConstructed","_editorInit","_addEvent","_offStickyToolbar","onResize_window","_resizeObserver","observe","_toolbarObserver","_toolbarShadow","onload","contextEl","_top","_relative","_toolBar","_editorArea","_wysiwygArea","_codeArea","_resizingBar","resizingBar","_navigation","navigation","_charCounter","_charWrapper","_loading","_lineBreaker_t","_lineBreaker_b","_resizeBack","resizeBackground","_IEisComposing","_lineBreakerBind","_directionKeyCode","_nonTextKeyCode","_historyIgnoreKeyCode","_onButtonsCheck","_frontZeroWidthReg","_keyCodeShortcut","_shortcutCommand","keyStr","shortcutsDisable","classOnCheck","commandMapNodes","reverse","showPathLabel","_cancelCaptionEdit","_buttonsEventHandler","onClick_toolbar","disabled","onMouseDown_wysiwyg","onMouseDown","tableCell","tablePlugin","table","_fixedCell","_shift","onTableCellMultiSelect","onClick_wysiwyg","targetElement","href","onClick","figcaption","hideToolbar","oLi","prevLi","_balloonDelay","_showToolbarBalloonDelay","clearTimeout","rangeObj","isDirTop","rects","getClientRects","globalScroll","editorWidth","stickyTop","editorLeft","nodeOffset","right","bottom","noText","arrowMargin","Math","round","toolbarHeight","iframeRects","_setToolbarOffset","editorParent","padding","absoluteLeft","overRight","resetTop","space","_getPageBottomSpace","documentElement","floor","arrow_left","showInline","onInput_wysiwyg","go","getCurrentIndex","onInput","_isUneditableNode","isFront","siblingKey","isElement","siblingNode","_isUneditableNode_getSibling","selectNode","_onShortcutKey","onKeyDown_wysiwyg","shiftKey","ctrl","ctrlKey","metaKey","alt","altKey","onKeyDown","selectRange","fileComponentName","destroy","_hardDelete","isClosureFreeFormatElement","isClosureRangeFormatElement","defaultFormat","prev","prevLast","con","after","detach","ignoreZWS","nextEl","cell","tabDisable","lines","fc","lc","idx","prevIdx","nextIdx","moveCell","tabText","textRange","endChild","freeFormatEl","getFreeFormatElement","enterHTML","formatInners","temp","newFormat","innerNode","lineAttrReset","newEl","isMultiLine","resetAttr","selectionFormat","wSelection","insertHTML","wOffset","focusNext","brPrev","brNext","newListCell","compContext","_container","_element","_ref","isOSX_IOS","nbsp","onKeyUp_wysiwyg","oFormatTag","textKey","zeroWidthRegExp","isComposing","frontZeroWidthCnt","substring","onKeyUp","onScroll_wysiwyg","onScroll","onFocus_wysiwyg","onFocus","onBlur_wysiwyg","onBlur","onMouseDown_resizingBar","clientY","closureFunc","_resize_editor","resizeInterval","fileBrowser","area","maxHeight","header","editorHeight","y","scrollY","editorTop","inlineOffset","_onStickyToolbar","scroll","sCell","eCell","sIsCell","eIsCell","sComp","eComp","onPaste_wysiwyg","clipboardData","_dataTransferAction","_setClipboardComponent","setData","onCopy_wysiwyg","onCopy","onSave_wysiwyg","onSave","onCut_wysiwyg","onCut","onDrop_wysiwyg","dataTransfer","_setDropLocationSelection","rangeOffset","caretRangeFromPoint","clientX","plainText","cleanData","getData","tempDiv","tempRange","_setClipboardData","MSData","onlyText","onPaste","onDrop","files","image","insertImage","onMouseMove_wysiwyg","lineBreakerStyle","ctxEl","pageY","_onMouseDown_lineBreak","_onLineBreak","eventWysiwyg","ResizeObserver","entries","b","passive","resizeEnable","_setResponsiveToolbar","_removeEvent","unobserve","sizeArray","buttonsObj","default","size","buttonGroup","sort","imageUploadHandler","videoUploadHandler","audioUploadHandler","onImageUploadBefore","onVideoUploadBefore","onAudioUploadBefore","onImageUpload","onVideoUpload","onAudioUpload","onImageUploadError","onVideoUploadError","onAudioUploadError","onSetToolbarButtons","buttonList","newToolbar","_createToolBar","responsiveButtons","newContext","setOptions","_options","mergeOptions","reduce","init","option","val","cons","_setOptions","callButtons","_setIframeDocument","setDefaultStyle","newStyles","_setDefaultOptionStyle","frame","noticeOpen","message","noticeClose","close","getContext","getText","getImagesInfo","_infoList","getFilesInfo","submitAction","notCleaningData","rangeSelection","checkHTML","firstCon","appendContents","readOnly","modalForm","dialog","setOption","disable","enable","enabled","show","topAreaStyle","_destroy","cover","originEl","topEl"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,OAAOA,YAAP,MAAyB,eAAzB;AACA,OAAOC,QAAP,MAAqB,WAArB;AACA,OAAOC,QAAP,MAAqB,WAArB;AACA,OAAOC,KAAP,MAAkB,QAAlB;AACA,OAAOC,OAAP,MAAoB,4BAApB;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,eAAe,UAAUC,OAAV,EAAmBC,iBAAnB,EAAsCC,OAAtC,EAA+CC,IAA/C,EAAqDC,OAArD,EAA8DC,kBAA9D,EAAkF;AAC7F,MAAMC,EAAE,GAAGN,OAAO,CAACO,OAAR,CAAgBC,aAAhB,CAA8BC,aAA9B,IAA+CC,QAA1D;;AACA,MAAMC,EAAE,GAAGL,EAAE,CAACM,WAAH,IAAkBC,MAA7B;;AACA,MAAMC,IAAI,GAAGhB,KAAb;AACA,MAAMiB,KAAK,GAAGX,OAAO,CAACW,KAAtB;AAEA;AACJ;AACA;AACA;;AACI,MAAMC,IAAI,GAAG;AACTV,IAAAA,EAAE,EAAEA,EADK;AAETK,IAAAA,EAAE,EAAEA,EAFK;AAGTM,IAAAA,OAAO,EAAE,IAAIN,EAAE,CAACO,SAAP,EAHA;AAITC,IAAAA,QAAQ,EAAEf,OAAO,CAACgB,GAJT;AAKTC,IAAAA,aAAa,EAAE,CALN;AAMTC,IAAAA,oBAAoB,EAAE,CANb;AAOTC,IAAAA,UAAU,EAAEnB,OAAO,CAACoB,iBAPX;AAQTC,IAAAA,UAAU,EAAEX,IAAI,CAACY,gBAAL,CAAsBtB,OAAO,CAACoB,iBAA9B,CARH;;AAUT;AACR;AACA;AACA;AACQG,IAAAA,GAAG,EAAE,IAdI;;AAgBT;AACR;AACA;AACA;AACQC,IAAAA,GAAG,EAAE,IApBI;;AAsBT;AACR;AACA;AACA;AACQC,IAAAA,WAAW,EAAE,IA1BJ;;AA4BT;AACR;AACA;AACA;AACQC,IAAAA,gCAAgC,EAAE,IAhCzB;;AAkCT;AACR;AACA;AACQhB,IAAAA,IAAI,EAAEA,IArCG;;AAuCT;AACR;AACA;AACQiB,IAAAA,SAAS,EAAE,IA1CF;;AA4CT;AACR;AACA;AACQ3B,IAAAA,OAAO,EAAE,IA/CA;;AAiDT;AACR;AACA;AACQ4B,IAAAA,eAAe,EAAE,IApDR;;AAsDT;AACR;AACA;AACQC,IAAAA,MAAM,EAAElC,OAzDC;;AA2DT;AACR;AACA;AACQgB,IAAAA,KAAK,EAAEA,KA9DE;;AAgET;AACR;AACA;AACQmB,IAAAA,OAAO,EAAE,IAnEA;;AAqET;AACR;AACA;AACQlC,IAAAA,OAAO,EAAEA,OAxEA;;AA0ET;AACR;AACA;AACQC,IAAAA,iBAAiB,EAAEA,iBA7EV;;AA+ET;AACR;AACA;AACQC,IAAAA,OAAO,EAAEA,OAAO,IAAI,EAlFX;;AAoFT;AACR;AACA;AACQiC,IAAAA,WAAW,EAAE,EAvFJ;;AAyFT;AACR;AACA;AACA;AACQC,IAAAA,cAAc,EAAE,EA7FP;;AA+FT;AACR;AACA;AACA;AACQC,IAAAA,SAAS,EAAE,EAnGF;;AAqGT;AACR;AACA;AACQlC,IAAAA,IAAI,EAAEA,IAxGG;;AA0GT;AACR;AACA;AACQmC,IAAAA,UAAU,EAAE,IA7GH;;AA+GT;AACR;AACA;AACQC,IAAAA,OAAO,EAAE,IAlHA;;AAoHT;AACR;AACA;AACQC,IAAAA,SAAS,EAAE,IAvHF;;AAyHT;AACR;AACA;AACA;AACQC,IAAAA,YAAY,EAAE,EA7HL;;AA+HT;AACR;AACA;AACA;AACQC,IAAAA,iBAAiB,EAAE,IAnIV;;AAqIT;AACR;AACA;AACA;AACQC,IAAAA,mBAAmB,EAAE,IAzIZ;;AA2IT;AACR;AACA;AACQC,IAAAA,mBAAmB,EAAE,IA9IZ;;AAgJT;AACR;AACA;AACQC,IAAAA,qBAAqB,EAAE,IAnJd;;AAqJT;AACR;AACA;AACQC,IAAAA,eAAe,EAAE,EAxJR;;AA0JT;AACR;AACA;AACQC,IAAAA,qBAAqB,EAAE,EA7Jd;;AA+JT;AACR;AACA;AACQC,IAAAA,uBAAuB,EAAE,IAlKhB;;AAoKT;AACR;AACA;AACQC,IAAAA,wBAAwB,EAAE,IAvKjB;;AAyKT;AACR;AACA;AACQC,IAAAA,uBAAuB,EAAE,EA5KhB;;AA8KT;AACR;AACA;AACQC,IAAAA,uBAAuB,EAAE,EAjLhB;;AAmLT;AACR;AACA;AACA;AACQC,IAAAA,sBAAsB,EAAE,IAvLf;;AAyLT;AACR;AACA;AACA;AACA;AACQC,IAAAA,yBAAyB,EAAE,IA9LlB;;AAgMT;AACR;AACA;AACA;AACSC,IAAAA,yBAAyB,EAAE,IApMnB;;AAsMT;AACR;AACA;AACA;AACQC,IAAAA,yBAAyB,EAAE,IA1MlB;;AA4MT;AACR;AACA;AACA;AACQC,IAAAA,yBAAyB,EAAE,IAhNlB;;AAkNT;AACR;AACA;AACA;AACQC,IAAAA,yBAAyB,EAAE,IAtNlB;;AAwNT;AACR;AACA;AACA;AACQC,IAAAA,wBAAwB,EAAE,IA5NjB;;AA8NT;AACR;AACA;AACA;AACQC,IAAAA,wBAAwB,EAAE,IAlOjB;;AAoOT;AACR;AACA;AACQC,IAAAA,QAAQ,EAAE,KAvOD;;AAyOT;AACR;AACA;AACQC,IAAAA,UAAU,EAAE,KA5OH;;AA8OT;AACR;AACA;AACQC,IAAAA,UAAU,EAAE,KAjPH;;AAmPT;AACR;AACA;AACA;AACQC,IAAAA,0BAA0B,EAAE,IAvPnB;AAwPTC,IAAAA,mCAAmC,EAAE,IAxP5B;;AA0PT;AACR;AACA;AACA;AACQC,IAAAA,0BAA0B,EAAE,IA9PnB;;AAgQT;AACR;AACA;AACA;AACQC,IAAAA,wBAAwB,EAAE,IApQjB;;AAsQT;AACR;AACA;AACA;AACQC,IAAAA,wBAAwB,EAAE,IA1QjB;;AA4QT;AACR;AACA;AACA;AACQC,IAAAA,mBAAmB,EAAE,IAhRZ;;AAkRT;AACR;AACA;AACA;AACQC,IAAAA,SAAS,EAAE,IAtRF;;AAwRT;AACR;AACA;AACA;AACQC,IAAAA,UAAU,EAAE,IA5RH;;AA8RT;AACR;AACA;AACA;AACQC,IAAAA,gBAAgB,EAAE,IAlST;;AAoST;AACR;AACA;AACA;AACQC,IAAAA,kBAAkB,EAAE;AAACC,MAAAA,GAAG,EAAE,EAAN;AAAUC,MAAAA,KAAK,EAAE,EAAjB;AAAqBC,MAAAA,MAAM,EAAE;AAA7B,KAxSX;;AA0ST;AACR;AACA;AACA;AACQC,IAAAA,eAAe,EAAE,KA9SR;;AAgTT;AACR;AACA;AACA;AACQC,IAAAA,OAAO,EAAE,KApTA;;AAsTT;AACR;AACA;AACA;AACQC,IAAAA,SAAS,EAAE,KA1TF;;AA4TT;AACR;AACA;AACA;AACQC,IAAAA,YAAY,EAAE,IAhUL;AAiUTC,IAAAA,kBAAkB,EAAE,IAjUX;;AAmUT;AACR;AACA;AACA;AACQC,IAAAA,mBAAmB,EAAE,IAvUZ;AAwUTC,IAAAA,oBAAoB,EAAE,KAxUb;;AA0UT;AACR;AACA;AACA;AACQC,IAAAA,aAAa,EAAE,IA9UN;;AAgVT;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQC,IAAAA,eAAe,EAAE,IA5WR;;AA8WT;AACR;AACA;AACA;AACQC,IAAAA,aAAa,EAAE,KAlXN;;AAoXT;AACR;AACA;AACA;AACA;AACA;AACA;AACQC,IAAAA,qBAAqB,EAAE,IA3Xd;;AA6XT;AACR;AACA;AACA;AACA;AACA;AACQC,IAAAA,qBAAqB,EAAE,IAnYd;;AAqYT;AACR;AACA;AACA;AACQC,IAAAA,YAAY,EAAE;AACVC,MAAAA,IAAI,EAAE,IADI;AAEVC,MAAAA,MAAM,EAAE,IAFE;AAGVC,MAAAA,WAAW,EAAE,IAHH;AAIVC,MAAAA,YAAY,EAAE,IAJJ;AAKVC,MAAAA,SAAS,EAAE;AALD,KAzYL;;AAiZT;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQC,IAAAA,UAAU,EAAE,IA7ZH;;AA+ZT;AACR;AACA;AACA;AACQC,IAAAA,iBAAiB,EAAE;AACfC,MAAAA,MAAM,EAAE,CAAC,aAAD,CADO;AAEfC,MAAAA,CAAC,EAAE,CAAC,iBAAD,CAFY;AAGfC,MAAAA,EAAE,EAAE,CAAC,YAAD,CAHW;AAIfC,MAAAA,GAAG,EAAE,CAAC,iBAAD;AAJU,KAnaV;;AA0aT;AACR;AACA;AACA;AACA;AACA;AACA;AACQC,IAAAA,gBAAgB,EAAE,IAjbT;;AAmbT;AACR;AACA;AACQC,IAAAA,iBAAiB,EAAE;AACfC,MAAAA,IAAI,EAAE,IAAI3F,EAAE,CAAC4F,MAAP,CAAc,kEAAd,EAAkF,IAAlF,CADS;AAEfC,MAAAA,MAAM,EAAE,IAAI7F,EAAE,CAAC4F,MAAP,CAAc,yDAAd,EAAyE,IAAzE;AAFO,KAtbV;;AA2bT;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQE,IAAAA,SAAS,EAAE;AACPC,MAAAA,SAAS,EAAE,KADJ;AAEPC,MAAAA,UAAU,EAAE,KAFL;AAGPC,MAAAA,YAAY,EAAE,KAHP;AAIPC,MAAAA,sBAAsB,EAAE,CAJjB;AAKPC,MAAAA,aAAa,EAAE,CALR;AAMPC,MAAAA,OAAO,EAAE,CANF;AAOPC,MAAAA,UAAU,EAAE,CAPL;AAQPC,MAAAA,eAAe,EAAEnG,IAAI,CAACoG,SAAL,CAAgBlH,OAAO,CAACO,OAAR,CAAgB4G,YAAhB,CAA6BC,KAA7B,CAAmCC,SAAnC,IAAgD,IAAhE,EAAuE,CAAvE,CARV;AASPC,MAAAA,YAAY,EAAE,EATP;AAUPC,MAAAA,eAAe,EAAE,EAVV;AAWPC,MAAAA,MAAM,EAAE,IAXD;AAYPC,MAAAA,cAAc,EAAE,IAZT;AAaPC,MAAAA,cAAc,EAAE1H,OAAO,CAACO,OAAR,CAAgBoH,OAAhB,CAAwBP,KAAxB,CAA8BQ,OAbvC;AAcPC,MAAAA,aAAa,EAAE,EAdR;AAePC,MAAAA,wBAAwB,EAAE,EAfnB;AAgBPC,MAAAA,qBAAqB,EAAE,EAhBhB;AAiBPC,MAAAA,kBAAkB,EAAE,EAjBb;AAkBPC,MAAAA,gBAAgB,EAAE;AAACC,QAAAA,MAAM,EAAE,KAAT;AAAgBC,QAAAA,OAAO,EAAE,KAAzB;AAAgCC,QAAAA,MAAM,EAAE;AAAxC,OAlBX;AAmBPC,MAAAA,cAAc,EAAE,IAnBT;AAoBPC,MAAAA,aAAa,EAAE;AApBR,KAvcF;;AA8dT;AACR;AACA;AACA;AACSC,IAAAA,iBAAiB,EAAE,6BAAY;AAC5B,UAAI,CAAC,KAAKC,iBAAV,EAA6B,KAAKA,iBAAL,GAAyB,EAAzB;;AAE7B,UAAMC,cAAc,GAAG,KAAKzI,OAAL,CAAaO,OAAb,CAAqBmI,WAArB,CAAiCC,gBAAjC,CAAkD,oCAAlD,CAAvB;;AACA,WAAK,IAAIC,CAAC,GAAG,CAAR,EAAWrI,OAAX,EAAoBsI,OAAzB,EAAkCD,CAAC,GAAGH,cAAc,CAACK,MAArD,EAA6DF,CAAC,EAA9D,EAAkE;AAC9DrI,QAAAA,OAAO,GAAGkI,cAAc,CAACG,CAAD,CAAxB;AACAC,QAAAA,OAAO,GAAGtI,OAAO,CAACwI,YAAR,CAAqB,cAArB,CAAV;AAEA,aAAKP,iBAAL,CAAuBK,OAAvB,IAAkCtI,OAAlC;AACH;AACJ,KA5eQ;;AA8eT;AACR;AACA;AACA;AACQyI,IAAAA,oBAAoB,EAAE,gCAAY;AAC9B,UAAI,KAAKR,iBAAT,EAA4B;AACxB,YAAMC,cAAc,GAAG,KAAKzI,OAAL,CAAaO,OAAb,CAAqBmI,WAArB,CAAiCC,gBAAjC,CAAkD,oCAAlD,CAAvB;;AACA,aAAK,IAAIC,CAAC,GAAG,CAAR,EAAWK,MAAX,EAAmBJ,OAAnB,EAA4BK,SAAjC,EAA4CN,CAAC,GAAGH,cAAc,CAACK,MAA/D,EAAuEF,CAAC,EAAxE,EAA4E;AACxEK,UAAAA,MAAM,GAAGR,cAAc,CAACG,CAAD,CAAvB;AACAC,UAAAA,OAAO,GAAGI,MAAM,CAACF,YAAP,CAAoB,cAApB,CAAV;AAEAG,UAAAA,SAAS,GAAG,KAAKV,iBAAL,CAAuBK,OAAvB,CAAZ;;AACA,cAAIK,SAAJ,EAAe;AACXD,YAAAA,MAAM,CAACE,aAAP,CAAqBC,YAArB,CAAkCF,SAAlC,EAA6CD,MAA7C;AACA,gBAAI,KAAKjJ,OAAL,CAAaqJ,IAAb,CAAkBR,OAAlB,CAAJ,EAAgC,KAAK7I,OAAL,CAAaqJ,IAAb,CAAkBR,OAAlB,IAA6BK,SAA7B;AACnC;AACJ;AACJ;AACJ,KAhgBQ;;AAkgBT;AACR;AACA;AACA;AACA;AACA;AACA;AACQI,IAAAA,UAAU,EAAE,oBAAUC,UAAV,EAAsBC,gBAAtB,EAAwCC,OAAxC,EAAiD;AACzDA,MAAAA,OAAO,GAAGA,OAAO,IAAIxJ,iBAAiB,CAACsJ,UAAD,CAAtC;;AAEA,UAAI,CAAC,KAAKrJ,OAAL,CAAaqJ,UAAb,CAAL,EAA+B;AAC3B,cAAMG,KAAK,CAAC,gHAAgHH,UAAhH,GAA6H,IAA9H,CAAX;AACH,OAFD,MAEO,IAAI,CAAC,KAAKpH,WAAL,CAAiBoH,UAAjB,CAAL,EAAmC;AACtC,aAAKrJ,OAAL,CAAaqJ,UAAb,EAAyBI,GAAzB,CAA6B,IAA7B,EAAmCF,OAAnC;AACA,aAAKtH,WAAL,CAAiBoH,UAAjB,IAA+B,IAA/B;AACH,OAHM,MAGA,IAAI,OAAO,KAAKnH,cAAL,CAAoBmH,UAApB,CAAP,KAA2C,QAA3C,IAAuD,CAAC,CAACE,OAA7D,EAAsE;AACzE,aAAKG,cAAL,CAAoBL,UAApB,EAAgCE,OAAhC,EAAyC,KAAKrH,cAAL,CAAoBmH,UAApB,CAAzC;AACH;;AAED,UAAI,KAAKrJ,OAAL,CAAaqJ,UAAb,EAAyBM,MAAzB,IAAmC,CAAC,KAAK/D,UAAL,CAAgByD,UAAhB,CAApC,IAAmE,CAAC,CAACE,OAAzE,EAAkF;AAC9E,aAAK3D,UAAL,CAAgByD,UAAhB,IAA8BE,OAA9B;AACA,aAAKtE,aAAL,CAAmB2E,IAAnB,CAAwBP,UAAxB;AACH;;AAED,UAAI,OAAOC,gBAAP,KAA4B,UAAhC,EAA4CA,gBAAgB;AAC/D,KA3hBQ;;AA6hBT;AACR;AACA;AACA;AACQO,IAAAA,SAAS,EAAE,mBAAUC,WAAV,EAAuB;AAC9B,WAAK,IAAIpB,CAAC,GAAG,CAAR,EAAWqB,GAAG,GAAGD,WAAW,CAAClB,MAA7B,EAAqCoB,UAA1C,EAAsDtB,CAAC,GAAGqB,GAA1D,EAA+DrB,CAAC,EAAhE,EAAoE;AAChEsB,QAAAA,UAAU,GAAGF,WAAW,CAACpB,CAAD,CAAX,CAAeuB,IAA5B;;AACA,YAAI,CAAC,KAAKjK,OAAL,CAAagK,UAAb,CAAL,EAA+B;AAC3B,eAAKhK,OAAL,CAAagK,UAAb,IAA2BF,WAAW,CAACpB,CAAD,CAAtC;AACH;;AACD,YAAI,CAAC,KAAKzG,WAAL,CAAiB+H,UAAjB,CAAL,EAAmC;AAC/B,eAAK/H,WAAL,CAAiB+H,UAAjB,IAA+B,IAA/B;AACA,cAAI,OAAO,KAAKhK,OAAL,CAAagK,UAAb,EAAyBP,GAAhC,KAAwC,UAA5C,EAAwD,KAAKzJ,OAAL,CAAagK,UAAb,EAAyBP,GAAzB,CAA6B,IAA7B;AAC3D;AACJ;AACJ,KA5iBQ;;AA8iBT;AACR;AACA;AACA;AACQS,IAAAA,qBAAqB,EAAE,iCAAY;AAC/B,UAAIC,CAAC,GAAG,CAAR;AAAA,UAAWC,CAAC,GAAG,CAAf;AACA,UAAIC,EAAE,GAAGvK,OAAO,CAACO,OAAR,CAAgBoH,OAAzB;;AACA,aAAO4C,EAAP,EAAW;AACPF,QAAAA,CAAC,IAAIE,EAAE,CAACC,SAAR;AACAF,QAAAA,CAAC,IAAIC,EAAE,CAACE,UAAR;AACAF,QAAAA,EAAE,GAAGA,EAAE,CAACpB,aAAR;AACH;;AAEDoB,MAAAA,EAAE,GAAG,KAAK1I,WAAL,GAAmB,KAAKA,WAAL,CAAiB6I,IAApC,GAA2C,IAAhD;;AACA,aAAOH,EAAP,EAAW;AACPF,QAAAA,CAAC,IAAIE,EAAE,CAACC,SAAR;AACAF,QAAAA,CAAC,IAAIC,EAAE,CAACE,UAAR;AACAF,QAAAA,EAAE,GAAGA,EAAE,CAACpB,aAAR;AACH;;AAED,aAAO;AACH1E,QAAAA,GAAG,EAAE4F,CADF;AAEHM,QAAAA,IAAI,EAAEL;AAFH,OAAP;AAIH,KAtkBQ;;AAwkBT;AACR;AACA;AACA;AACA;AACA;AACA;AACQV,IAAAA,cAAc,EAAE,wBAAUL,UAAV,EAAsBqB,MAAtB,EAA8BC,IAA9B,EAAoC;AAChD,UAAI,CAACD,MAAL,EAAa;AACT,aAAKxI,cAAL,CAAoBmH,UAApB,IAAkCsB,IAAlC;AACH,OAFD,MAEO;AACH7K,QAAAA,OAAO,CAACO,OAAR,CAAgB8B,SAAhB,CAA0ByI,WAA1B,CAAsCD,IAAtC;;AACA,aAAKzI,cAAL,CAAoBmH,UAApB,IAAkC,IAAlC;AACA,aAAKlH,SAAL,CAAeuI,MAAM,CAAC7B,YAAP,CAAoB,cAApB,CAAf,IAAsD8B,IAAtD;AACH;AACJ,KAvlBQ;;AAylBT;AACR;AACA;AACA;AACQE,IAAAA,SAAS,EAAE,mBAAUxK,OAAV,EAAmB;AAC1B,UAAI,KAAKmC,iBAAT,EAA4B,KAAKA,iBAAL;AAC5B,UAAI,KAAK0B,mBAAT,EAA8B,KAAK4G,cAAL;AAE9B,UAAMC,WAAW,GAAG,KAAKxI,YAAL,GAAoBlC,OAAO,CAACwI,YAAR,CAAqB,cAArB,CAAxC;AACA,UAAM8B,IAAI,GAAG,KAAKtI,OAAL,GAAe,KAAKF,SAAL,CAAe4I,WAAf,CAA5B;AACA,WAAKrI,mBAAL,GAA2BrC,OAA3B;;AACA,WAAK2K,gBAAL,CAAsB3K,OAAtB,EAA+BsK,IAA/B;;AAEA,WAAKnI,iBAAL,GAAyB,KAAKyI,UAAL,CAAgBC,IAAhB,CAAqB,IAArB,CAAzB;AACA,WAAKC,WAAL,CAAiB,WAAjB,EAA8B,KAAK3I,iBAAnC,EAAsD,KAAtD;AAEA,UAAI,KAAKxC,OAAL,CAAa+K,WAAb,EAA0BK,EAA9B,EAAkC,KAAKpL,OAAL,CAAa+K,WAAb,EAA0BK,EAA1B,CAA6BC,IAA7B,CAAkC,IAAlC;AAClC,WAAKzG,SAAL,GAAiB,IAAjB;AACH,KA3mBQ;;AA6mBT;AACR;AACA;AACQqG,IAAAA,UAAU,EAAE,sBAAY;AACpB,WAAKK,cAAL,CAAoB,WAApB,EAAiC,KAAK9I,iBAAtC;AACA,WAAKA,iBAAL,GAAyB,IAAzB;;AAEA,UAAI,KAAKH,OAAT,EAAkB;AACd,aAAKE,YAAL,GAAoB,EAApB;AACA,aAAKF,OAAL,CAAa6E,KAAb,CAAmBqE,OAAnB,GAA6B,MAA7B;AACA,aAAKlJ,OAAL,GAAe,IAAf;AACAzB,QAAAA,IAAI,CAAC4K,WAAL,CAAiB,KAAK9I,mBAAtB,EAA2C,IAA3C;AACA,aAAKA,mBAAL,GAA2B,IAA3B;AACA,aAAKgC,eAAL,GAAuB,KAAvB;AACH;;AAED,WAAKE,SAAL,GAAiB,KAAjB;AACH,KA9nBQ;;AAgoBT;AACR;AACA;AACQ6G,IAAAA,YAAY,EAAE,wBAAW;AACrB,UAAI,KAAKvI,sBAAT,EAAiC;AAC7B,YAAMwI,KAAK,GAAG5L,OAAO,CAACO,OAAR,CAAgBsL,OAAhB,CAAwBC,aAAxB,CAAsC,MAAM,KAAK1I,sBAAL,CAA4B2F,YAA5B,CAAyC,cAAzC,CAA5C,CAAd;AACA6C,QAAAA,KAAK,CAACxE,KAAN,CAAYqE,OAAZ,GAAsB,MAAtB;AACA3K,QAAAA,IAAI,CAAC4K,WAAL,CAAiB,KAAKtI,sBAAtB,EAA8C,IAA9C;AACA,aAAKA,sBAAL,GAA8B,IAA9B;AACH;AACJ,KA1oBQ;;AA4oBT;AACR;AACA;AACA;AACQ2I,IAAAA,WAAW,EAAE,qBAAUxL,OAAV,EAAmB;AAC5B,UAAI,KAAKoC,mBAAT,EAA8B,KAAKA,mBAAL;AAE9B,UAAMqJ,aAAa,GAAG,KAAKC,cAAL,GAAsB1L,OAAO,CAACwI,YAAR,CAAqB,cAArB,CAA5C;AACA,UAAM8B,IAAI,GAAG,KAAKrI,SAAL,GAAiB,KAAKH,SAAL,CAAe2J,aAAf,CAA9B;AACA,WAAKnJ,qBAAL,GAA6BtC,OAA7B;;AACA,WAAK2K,gBAAL,CAAsB3K,OAAtB,EAA+BsK,IAA/B;;AAEA,WAAKlI,mBAAL,GAA2B,KAAKuJ,YAAL,CAAkBd,IAAlB,CAAuB,IAAvB,CAA3B;AACA,WAAKC,WAAL,CAAiB,WAAjB,EAA8B,KAAK1I,mBAAnC,EAAwD,KAAxD;AAEA,UAAI,KAAKzC,OAAL,CAAa8L,aAAb,EAA4BV,EAAhC,EAAoC,KAAKpL,OAAL,CAAa8L,aAAb,EAA4BV,EAA5B,CAA+BC,IAA/B,CAAoC,IAApC;AACpC,WAAKzG,SAAL,GAAiB,IAAjB;AACH,KA7pBQ;;AA+pBT;AACR;AACA;AACQoH,IAAAA,YAAY,EAAE,wBAAY;AACtB,WAAKV,cAAL,CAAoB,WAApB,EAAiC,KAAK7I,mBAAtC;AACA,WAAKA,mBAAL,GAA2B,IAA3B;;AAEA,UAAI,KAAKH,SAAT,EAAoB;AAChB,aAAKyJ,cAAL,GAAsB,EAAtB;AACA,aAAKzJ,SAAL,CAAe4E,KAAf,CAAqBqE,OAArB,GAA+B,MAA/B;AACA,aAAKjJ,SAAL,GAAiB,IAAjB;AACA1B,QAAAA,IAAI,CAAC4K,WAAL,CAAiB,KAAK7I,qBAAtB,EAA6C,IAA7C;AACA,aAAKA,qBAAL,GAA6B,IAA7B;AACA,aAAK+B,eAAL,GAAuB,KAAvB;AACH;;AAED,WAAKE,SAAL,GAAiB,KAAjB;AACH,KAhrBQ;;AAkrBT;AACR;AACA;AACA;AACA;AACA;AACQoG,IAAAA,gBAAgB,EAAE,0BAAU3K,OAAV,EAAmBsK,IAAnB,EAAyB;AACvCA,MAAAA,IAAI,CAACzD,KAAL,CAAW+E,UAAX,GAAwB,QAAxB;AACAtB,MAAAA,IAAI,CAACzD,KAAL,CAAWqE,OAAX,GAAqB,OAArB;AACAZ,MAAAA,IAAI,CAACzD,KAAL,CAAWgF,MAAX,GAAoB,EAApB;AACAtL,MAAAA,IAAI,CAACuL,QAAL,CAAc9L,OAAd,EAAuB,IAAvB;AAEA,UAAMsL,OAAO,GAAG,KAAK7L,OAAL,CAAaO,OAAb,CAAqBsL,OAArC;AACA,UAAMS,QAAQ,GAAGT,OAAO,CAACU,WAAzB;;AACA,UAAMC,aAAa,GAAGC,KAAK,CAACC,iBAAN,CAAwB1M,OAAO,CAACO,OAAR,CAAgBsL,OAAxC,CAAtB;;AACA,UAAMc,KAAK,GAAG9B,IAAI,CAAC0B,WAAnB;AACA,UAAMjC,CAAC,GAAG/J,OAAO,CAAC4I,aAAR,CAAsByD,UAAtB,GAAmC,CAA7C,CAVuC,CAYvC;;AACA,UAAIxM,OAAO,CAACgB,GAAZ,EAAiB;AACb,YAAMyL,QAAQ,GAAGtM,OAAO,CAACgM,WAAzB;AACA,YAAMO,IAAI,GAAGH,KAAK,GAAGE,QAAR,GAAmBF,KAAK,GAAGE,QAA3B,GAAsC,CAAnD;AACA,YAAME,IAAI,GAAGD,IAAI,GAAG,CAAP,GAAW,CAAX,GAAeD,QAAQ,GAAGF,KAAvC;AACA9B,QAAAA,IAAI,CAACzD,KAAL,CAAWuD,IAAX,GAAmBL,CAAC,GAAGwC,IAAJ,GAAWC,IAAZ,GAAoB,IAAtC;;AACA,YAAIP,aAAa,CAAC7B,IAAd,GAAqB8B,KAAK,CAACC,iBAAN,CAAwB7B,IAAxB,EAA8BF,IAAvD,EAA6D;AACzDE,UAAAA,IAAI,CAACzD,KAAL,CAAWuD,IAAX,GAAkB,KAAlB;AACH;AACJ,OARD,MAQO;AACH,YAAMqC,QAAQ,GAAGV,QAAQ,IAAIK,KAAZ,GAAoB,CAApB,GAAwBL,QAAQ,IAAIhC,CAAC,GAAGqC,KAAR,CAAjD;AACA,YAAIK,QAAQ,GAAG,CAAf,EAAkBnC,IAAI,CAACzD,KAAL,CAAWuD,IAAX,GAAmBL,CAAC,GAAG0C,QAAL,GAAiB,IAAnC,CAAlB,KACKnC,IAAI,CAACzD,KAAL,CAAWuD,IAAX,GAAkBL,CAAC,GAAG,IAAtB;AACR,OAzBsC,CA2BvC;;;AACA,UAAID,CAAC,GAAG,CAAR;AACA,UAAI4C,QAAQ,GAAG1M,OAAf;;AACA,aAAO0M,QAAQ,IAAIA,QAAQ,KAAKpB,OAAhC,EAAyC;AACrCxB,QAAAA,CAAC,IAAI4C,QAAQ,CAACC,SAAd;AACAD,QAAAA,QAAQ,GAAGA,QAAQ,CAACE,YAApB;AACH;;AAED,UAAMC,EAAE,GAAG/C,CAAX;;AACA,UAAI,KAAK/F,UAAT,EAAqB;AACjB+F,QAAAA,CAAC,IAAIwB,OAAO,CAACqB,SAAR,GAAoB3M,OAAO,CAAC8M,YAAjC;AACH,OAFD,MAEO;AACHhD,QAAAA,CAAC,IAAI9J,OAAO,CAAC8M,YAAb;AACH,OAxCsC,CA0CvC;;;AACA,UAAMC,UAAU,GAAGd,aAAa,CAAC/H,GAAjC;AACA,UAAM8I,UAAU,GAAG1C,IAAI,CAACwC,YAAxB;AACA,UAAM7C,SAAS,GAAG,KAAKJ,qBAAL,GAA6B3F,GAA/C;AAEA,UAAM+I,iBAAiB,GAAG7M,EAAE,CAAC8M,WAAH,IAAkBH,UAAU,GAAG9C,SAAb,GAAyB4C,EAAzB,GAA8B7M,OAAO,CAAC4I,aAAR,CAAsBkE,YAAtE,CAA1B;;AACA,UAAIG,iBAAiB,GAAGD,UAAxB,EAAoC;AAChC,YAAIG,OAAO,GAAG,CAAC,CAAD,IAAMH,UAAU,GAAGH,EAAb,GAAkB,CAAxB,CAAd;AACA,YAAMO,MAAM,GAAGL,UAAU,GAAG9C,SAAb,GAAyBkD,OAAxC;AACA,YAAME,cAAc,GAAGL,UAAU,IAAII,MAAM,GAAG,CAAT,GAAaA,MAAb,GAAsB,CAA1B,CAAjC;;AAEA,YAAIC,cAAc,GAAGJ,iBAArB,EAAwC;AACpC3C,UAAAA,IAAI,CAACzD,KAAL,CAAWgF,MAAX,GAAoBwB,cAAc,GAAG,IAArC;AACAF,UAAAA,OAAO,GAAG,CAAC,CAAD,IAAME,cAAc,GAAGR,EAAjB,GAAsB,CAA5B,CAAV;AACH,SAHD,MAGO;AACHvC,UAAAA,IAAI,CAACzD,KAAL,CAAWgF,MAAX,GAAoBoB,iBAAiB,GAAG,IAAxC;AACAE,UAAAA,OAAO,GAAGN,EAAE,GAAG7M,OAAO,CAAC4I,aAAR,CAAsBkE,YAArC;AACH;;AAEDxC,QAAAA,IAAI,CAACzD,KAAL,CAAW3C,GAAX,GAAiBiJ,OAAO,GAAG,IAA3B;AACH,OAdD,MAcO;AACH7C,QAAAA,IAAI,CAACzD,KAAL,CAAW3C,GAAX,GAAkB2I,EAAE,GAAG7M,OAAO,CAAC4I,aAAR,CAAsBkE,YAA5B,GAA4C,IAA7D;AACH;;AAEDxC,MAAAA,IAAI,CAACzD,KAAL,CAAW+E,UAAX,GAAwB,EAAxB;AACH,KA3vBQ;;AA6vBT;AACR;AACA;AACA;AACQ0B,IAAAA,aAAa,EAAE,yBAAY;AACvB,UAAI,KAAKzJ,mBAAT,EAA8B,KAAKA,mBAAL;AAC9B,WAAKtB,eAAL,GAAuB,EAAvB;;AAEA,WAAK,IAAI8F,CAAC,GAAG,CAAR,EAAWkF,GAAhB,EAAqBlF,CAAC,GAAGmF,SAAS,CAACjF,MAAnC,EAA2CF,CAAC,EAA5C,EAAgD;AAC5CkF,QAAAA,GAAG,GAAGC,SAAS,CAACnF,CAAD,CAAf;AACA,YAAI,CAACkF,GAAL,EAAU;;AAEV,YAAI,OAAOA,GAAP,KAAe,QAAnB,EAA6B;AACzB,eAAK/K,qBAAL,GAA6B+K,GAA7B;AACA;AACH;;AACD,YAAI,OAAOA,GAAP,KAAe,UAAnB,EAA+B;AAC3B,eAAKhL,eAAL,CAAqBgH,IAArB,CAA0BgE,GAA1B;AACA;AACH;;AACD,YAAI,CAAChN,IAAI,CAACkN,QAAL,CAAcF,GAAd,EAAmB,eAAnB,CAAL,EAA0C;AACtC,eAAK9K,uBAAL,GAA+B8K,GAA/B;AACA,eAAK7K,wBAAL,GAAgC,KAAKgL,gBAAL,CAAsBH,GAAtB,CAAhC;AACA;AACH;;AACD,YAAIA,GAAG,CAAC1G,KAAR,EAAe;AACX0G,UAAAA,GAAG,CAAC1G,KAAJ,CAAUqE,OAAV,GAAoB,OAApB;;AACA,cAAI,KAAK5J,WAAL,IAAoB,KAAKC,gCAAL,CAAsCoM,OAAtC,CAA8CJ,GAA9C,MAAuD,CAAC,CAAhF,EAAmF;AAC/EA,YAAAA,GAAG,CAACK,gBAAJ,CAAqB,WAArB,EAAkC,UAAUC,CAAV,EAAa;AAAEA,cAAAA,CAAC,CAACC,cAAF;AAAoBD,cAAAA,CAAC,CAACE,eAAF;AAAsB,aAA3F;;AACA,iBAAKxM,gCAAL,CAAsCgI,IAAtC,CAA2CgE,GAA3C;AACH;AACJ;;AACD,aAAKhL,eAAL,CAAqBgH,IAArB,CAA0BgE,GAA1B;AACH;;AAED,WAAK1J,mBAAL,GAA2B,KAAK4G,cAAL,CAAoBI,IAApB,CAAyB,IAAzB,CAA3B;AACA,WAAKC,WAAL,CAAiB,WAAjB,EAA8B,KAAKjH,mBAAnC,EAAwD,KAAxD;AACA,WAAKiH,WAAL,CAAiB,SAAjB,EAA4B,KAAKjH,mBAAjC,EAAsD,KAAtD;AACA,WAAKU,SAAL,GAAiB,IAAjB;AAEA,UAAI,OAAO/C,SAAS,CAACwM,cAAjB,KAAoC,UAAxC,EAAoDxM,SAAS,CAACwM,cAAV,CAAyB,KAAKxL,qBAA9B,EAAqD,KAAKD,eAA1D,EAA2E,IAA3E;AACvD,KAtyBQ;;AAwyBT;AACR;AACA;AACA;AACQkI,IAAAA,cAAc,EAAE,wBAAUoD,CAAV,EAAa;AACzB,WAAKrJ,YAAL,CAAkBqC,KAAlB,CAAwBqE,OAAxB,GAAkC,MAAlC;AACA,UAAMxB,GAAG,GAAG,KAAKnH,eAAL,CAAqBgG,MAAjC;;AAEA,UAAIsF,CAAC,IAAIA,CAAC,CAACxD,MAAP,IAAiBX,GAAG,GAAG,CAA3B,EAA8B;AAC1B,aAAK,IAAIrB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGqB,GAApB,EAAyBrB,CAAC,EAA1B,EAA8B;AAC1B,cAAI,OAAO,KAAK9F,eAAL,CAAqB8F,CAArB,EAAwB4F,QAA/B,KAA4C,UAA5C,IAA0D,KAAK1L,eAAL,CAAqB8F,CAArB,EAAwB4F,QAAxB,CAAiCJ,CAAC,CAACxD,MAAnC,CAA9D,EAA0G;AAC7G;AACJ;;AAED,UAAI,KAAKpF,YAAL,CAAkBI,YAAlB,CAA+B6I,IAA/B,CAAoC,KAAK1L,qBAAzC,KAAmEqL,CAAnE,IAAwEA,CAAC,CAACM,IAAF,KAAW,SAAnF,IAAgGN,CAAC,CAACO,OAAF,KAAc,EAAlH,EAAsH;AACtH3O,MAAAA,OAAO,CAACO,OAAR,CAAgBqO,aAAhB,CAA8BxH,KAA9B,CAAoCqE,OAApC,GAA8CzL,OAAO,CAACO,OAAR,CAAgBsO,aAAhB,CAA8BzH,KAA9B,CAAoCqE,OAApC,GAA8C,MAA5F;AACA,WAAKhF,SAAL,CAAe4B,cAAf,GAAgC,IAAhC;AAEA,WAAKtF,qBAAL,GAA6B,EAA7B;AACA,WAAKC,uBAAL,GAA+B,IAA/B;AACA,WAAKC,wBAAL,GAAgC,IAAhC;AACA,WAAKX,UAAL,GAAkB,IAAlB;AACA,UAAI,CAAC,KAAK8B,mBAAV,EAA+B;AAE/B,WAAKoH,cAAL,CAAoB,WAApB,EAAiC,KAAKpH,mBAAtC;AACA,WAAKoH,cAAL,CAAoB,SAApB,EAA+B,KAAKpH,mBAApC;AACA,WAAKA,mBAAL,GAA2B,IAA3B;;AAEA,UAAI6F,GAAG,GAAG,CAAV,EAAa;AACT,aAAK,IAAIrB,EAAC,GAAG,CAAb,EAAgBA,EAAC,GAAGqB,GAApB,EAAyBrB,EAAC,EAA1B,EAA8B;AAC1B,cAAI,OAAO,KAAK9F,eAAL,CAAqB8F,EAArB,CAAP,KAAmC,UAAvC,EAAmD,KAAK9F,eAAL,CAAqB8F,EAArB,IAAnD,KACK,KAAK9F,eAAL,CAAqB8F,EAArB,EAAwBxB,KAAxB,CAA8BqE,OAA9B,GAAwC,MAAxC;AACR;;AAED,aAAK3I,eAAL,GAAuB,EAAvB;AACH;;AAED,WAAKgC,SAAL,GAAiB,KAAjB;AACH,KA90BQ;;AAg1BT;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQgK,IAAAA,qBAAqB,EAAE,+BAAUC,UAAV,EAAsBC,OAAtB,EAA+BC,QAA/B,EAAyCC,SAAzC,EAAoD;AACvE,UAAI9O,OAAO,CAACgB,GAAZ,EAAiB8N,SAAS,CAACvE,IAAV,IAAkB,CAAC,CAAnB;AAEjB,UAAMwE,MAAM,GAAGrO,IAAI,CAACsO,SAAL,CAAeJ,OAAf,EAAwBhP,OAAO,CAACO,OAAR,CAAgB4G,YAAxC,CAAf;AACA4H,MAAAA,UAAU,CAAC3H,KAAX,CAAiB+E,UAAjB,GAA8B,QAA9B;AACA4C,MAAAA,UAAU,CAAC3H,KAAX,CAAiBqE,OAAjB,GAA2B,OAA3B,CALuE,CAOvE;;AACA,UAAM4D,SAAS,GAAGJ,QAAQ,KAAK,KAAb,GAAqB,EAAEF,UAAU,CAAC1B,YAAX,GAA0B,CAA5B,CAArB,GAAuD2B,OAAO,CAAC3B,YAAR,GAAuB,EAAhG;AACA0B,MAAAA,UAAU,CAAC3H,KAAX,CAAiB3C,GAAjB,GAAwB0K,MAAM,CAAC1K,GAAP,GAAa4K,SAAb,GAAyBH,SAAS,CAACzK,GAApC,GAA2C,IAAlE;AAEA,UAAM6F,CAAC,GAAG6E,MAAM,CAACxE,IAAP,GAAc3K,OAAO,CAACO,OAAR,CAAgB4G,YAAhB,CAA6BsD,UAA3C,GAAwDyE,SAAS,CAACvE,IAA5E;AACA,UAAM2E,WAAW,GAAGP,UAAU,CAACxC,WAA/B;AACA,UAAMgD,QAAQ,GAAGP,OAAO,CAACzC,WAAzB;AAEA,UAAMiD,KAAK,GAAG1O,IAAI,CAACkN,QAAL,CAAce,UAAU,CAACU,iBAAzB,EAA4C,UAA5C,IAA0DV,UAAU,CAACU,iBAArE,GAAyF,IAAvG,CAfuE,CAiBvE;;AACA,UAAIrP,OAAO,CAACgB,GAAZ,EAAiB;AACb,YAAM0L,IAAI,GAAIwC,WAAW,GAAGC,QAAf,GAA2BD,WAAW,GAAGC,QAAzC,GAAoD,CAAjE;AACA,YAAMxC,IAAI,GAAGD,IAAI,GAAG,CAAP,GAAW,CAAX,GAAeyC,QAAQ,GAAGD,WAAvC;AACAP,QAAAA,UAAU,CAAC3H,KAAX,CAAiBuD,IAAjB,GAAyBL,CAAC,GAAGwC,IAAJ,GAAWC,IAAZ,GAAoB,IAA5C;;AAEA,YAAID,IAAI,GAAG,CAAX,EAAc;AACV,cAAI0C,KAAJ,EAAWA,KAAK,CAACpI,KAAN,CAAYuD,IAAZ,GAAmB,CAAE2E,WAAW,GAAG,EAAd,GAAmB,KAAKxC,IAAzB,GAAkCwC,WAAW,GAAG,EAAhD,GAAuD,KAAKxC,IAA7D,IAAsE,IAAzF;AACd;;AAED,YAAM4C,QAAQ,GAAG1P,OAAO,CAACO,OAAR,CAAgB4G,YAAhB,CAA6ByF,UAA7B,GAA0CmC,UAAU,CAACnC,UAAtE;;AACA,YAAI8C,QAAQ,GAAG,CAAf,EAAkB;AACdX,UAAAA,UAAU,CAAC3H,KAAX,CAAiBuD,IAAjB,GAAwB,KAAxB;AACA,cAAI6E,KAAJ,EAAWA,KAAK,CAACpI,KAAN,CAAYuD,IAAZ,GAAmB+E,QAAQ,GAAG,IAA9B;AACd;AACJ,OAdD,MAcO;AACHX,QAAAA,UAAU,CAAC3H,KAAX,CAAiBuD,IAAjB,GAAwBL,CAAC,GAAG,IAA5B;;AAEA,YAAMoF,SAAQ,GAAG1P,OAAO,CAACO,OAAR,CAAgB4G,YAAhB,CAA6BoF,WAA7B,IAA4CwC,UAAU,CAACnC,UAAX,GAAwB0C,WAApE,CAAjB;;AACA,YAAII,SAAQ,GAAG,CAAf,EAAkB;AACdX,UAAAA,UAAU,CAAC3H,KAAX,CAAiBuD,IAAjB,GAAyBoE,UAAU,CAACnC,UAAX,GAAwB8C,SAAzB,GAAqC,IAA7D;AACA,cAAIF,KAAJ,EAAWA,KAAK,CAACpI,KAAN,CAAYuD,IAAZ,GAAoB,KAAK+E,SAAN,GAAkB,IAArC;AACd,SAHD,MAGO;AACH,cAAIF,KAAJ,EAAWA,KAAK,CAACpI,KAAN,CAAYuD,IAAZ,GAAmB,MAAnB;AACd;AACJ;;AAEDoE,MAAAA,UAAU,CAAC3H,KAAX,CAAiB+E,UAAjB,GAA8B,EAA9B;AACH,KAz4BQ;;AA24BT;AACR;AACA;AACA;AACA;AACA;AACQwD,IAAAA,WAAW,EAAE,qBAAU9G,OAAV,EAAmB+G,aAAnB,EAAkCC,KAAlC,EAAyC;AAClD,WAAKlO,GAAL,CAASgO,WAAT,CAAqB9G,OAArB,EAA8B+G,aAA9B,EAA8C/G,OAAO,KAAK,aAAZ,GAA4B,MAAMgH,KAAN,GAAc,GAA1C,GAAgDA,KAA9F,EADkD,CAElD;;;AACA,WAAK3N,OAAL,CAAa4H,IAAb,CAAkB,IAAlB;AACH,KAr5BQ;;AAu5BT;AACR;AACA;AACQgG,IAAAA,WAAW,EAAE,uBAAY;AACrB,WAAKC,OAAL;;AACA,WAAKC,YAAL;AACH,KA75BQ;;AA+5BT;AACR;AACA;AACA;AACQD,IAAAA,OAAO,EAAE,mBAAY;AACjB,UAAME,OAAO,GAAGnP,IAAI,CAACoP,gBAAL,CAAsB,KAAKC,gBAAL,EAAtB,EAA+C,YAA/C,CAAhB;;AACA,UAAIF,OAAJ,EAAa;AACTA,QAAAA,OAAO,CAACG,KAAR;AACH,OAFD,MAEO;AACHpQ,QAAAA,OAAO,CAACO,OAAR,CAAgB8P,OAAhB,CAAwBD,KAAxB;AACH;AACJ,KA16BQ;;AA46BT;AACR;AACA;AACQA,IAAAA,KAAK,EAAE,iBAAY;AACf,UAAIpQ,OAAO,CAACO,OAAR,CAAgB4G,YAAhB,CAA6BC,KAA7B,CAAmCqE,OAAnC,KAA+C,MAAnD,EAA2D;;AAE3D,UAAIrL,OAAO,CAACkQ,MAAZ,EAAoB;AAChB,aAAKR,WAAL;AACH,OAFD,MAEO;AACH,YAAI;AACA,cAAMS,KAAK,GAAG,KAAKC,QAAL,EAAd;;AACA,cAAID,KAAK,CAACE,cAAN,KAAyBF,KAAK,CAACG,YAA/B,IAA+C5P,IAAI,CAAC6P,YAAL,CAAkBJ,KAAK,CAACE,cAAxB,CAAnD,EAA4F;AACxF,gBAAMG,WAAW,GAAGL,KAAK,CAACM,uBAAN,CAA8BC,QAA9B,CAAuCP,KAAK,CAACQ,WAA7C,CAApB;;AACA,gBAAI,CAACjQ,IAAI,CAACkQ,eAAL,CAAqBJ,WAArB,CAAD,IAAsC,CAAC9P,IAAI,CAACmQ,WAAL,CAAiBL,WAAjB,CAA3C,EAA0E;AACtE,kBAAMpK,MAAM,GAAG1F,IAAI,CAACoQ,aAAL,CAAmB9Q,OAAO,CAAC+Q,UAA3B,CAAf;AACA,kBAAMC,EAAE,GAAGtQ,IAAI,CAACoQ,aAAL,CAAmB,IAAnB,CAAX;AACA1K,cAAAA,MAAM,CAACsE,WAAP,CAAmBsG,EAAnB;AACApR,cAAAA,OAAO,CAACO,OAAR,CAAgB8P,OAAhB,CAAwBgB,YAAxB,CAAqC7K,MAArC,EAA6CoK,WAA7C;AACA,mBAAKU,QAAL,CAAcF,EAAd,EAAkB,CAAlB,EAAqBA,EAArB,EAAyB,CAAzB;AACA;AACH;AACJ;;AACD,eAAKE,QAAL,CAAcf,KAAK,CAACE,cAApB,EAAoCF,KAAK,CAACQ,WAA1C,EAAuDR,KAAK,CAACG,YAA7D,EAA2EH,KAAK,CAACgB,SAAjF;AACH,SAdD,CAcE,OAAOnD,CAAP,EAAU;AACR,eAAK0B,WAAL;AACH;AACJ;;AAEDrD,MAAAA,KAAK,CAAC+E,gBAAN;;AACA,UAAI,KAAKlN,UAAT,EAAqBmI,KAAK,CAACgF,qBAAN;AACxB,KA18BQ;;AA48BT;AACR;AACA;AACA;AACA;AACQC,IAAAA,SAAS,EAAE,mBAAUC,OAAV,EAAmB;AAC1B,UAAI,CAACA,OAAL,EAAcA,OAAO,GAAG3R,OAAO,CAACO,OAAR,CAAgB8P,OAAhB,CAAwBuB,gBAAlC;AAEd,UAAMC,iBAAiB,GAAG,KAAK5D,gBAAL,CAAsB0D,OAAtB,CAA1B;;AACA,UAAIE,iBAAJ,EAAuB;AACnB,aAAKC,eAAL,CAAqBD,iBAAiB,CAACjH,MAAvC,EAA+CiH,iBAAiB,CAACtI,UAAjE;AACH,OAFD,MAEO,IAAIoI,OAAJ,EAAa;AAChBA,QAAAA,OAAO,GAAG7Q,IAAI,CAACiR,eAAL,CAAqBJ,OAArB,EAA8B,UAAUK,OAAV,EAAmB;AAAE,iBAAOA,OAAO,CAACC,UAAR,CAAmBnJ,MAAnB,KAA8B,CAA9B,IAAmCkJ,OAAO,CAACE,QAAR,KAAqB,CAA/D;AAAmE,SAAtH,EAAwH,IAAxH,CAAV;AACA,YAAI,CAACP,OAAL,EAAc,KAAK7B,WAAL,GAAd,KACK,KAAKwB,QAAL,CAAcK,OAAd,EAAuBA,OAAO,CAACQ,WAAR,CAAoBrJ,MAA3C,EAAmD6I,OAAnD,EAA4DA,OAAO,CAACQ,WAAR,CAAoBrJ,MAAhF;AACR,OAJM,MAIA;AACH,aAAKsH,KAAL;AACH;AACJ,KA99BQ;;AAg+BT;AACR;AACA;AACQgC,IAAAA,IAAI,EAAE,gBAAY;AACd,UAAIhS,OAAO,CAACkQ,MAAZ,EAAoB;AAChBtQ,QAAAA,OAAO,CAACO,OAAR,CAAgB4G,YAAhB,CAA6BiL,IAA7B;AACH,OAFD,MAEO;AACHpS,QAAAA,OAAO,CAACO,OAAR,CAAgB8P,OAAhB,CAAwB+B,IAAxB;AACH;AACJ,KAz+BQ;;AA2+BT;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACQd,IAAAA,QAAQ,EAAE,kBAAUe,QAAV,EAAoBC,QAApB,EAA8BC,MAA9B,EAAsCC,MAAtC,EAA8C;AACpD,UAAI,CAACH,QAAD,IAAa,CAACE,MAAlB,EAA0B;AAC1B,UAAID,QAAQ,GAAGD,QAAQ,CAACF,WAAT,CAAqBrJ,MAApC,EAA4CwJ,QAAQ,GAAGD,QAAQ,CAACF,WAAT,CAAqBrJ,MAAhC;AAC5C,UAAI0J,MAAM,GAAGD,MAAM,CAACJ,WAAP,CAAmBrJ,MAAhC,EAAwC0J,MAAM,GAAGD,MAAM,CAACJ,WAAP,CAAmBrJ,MAA5B;;AACxC,UAAIhI,IAAI,CAACkQ,eAAL,CAAqBqB,QAArB,CAAJ,EAAoC;AAChCA,QAAAA,QAAQ,GAAGA,QAAQ,CAACJ,UAAT,CAAoBK,QAApB,KAAiCD,QAAQ,CAACJ,UAAT,CAAoBK,QAAQ,GAAG,CAA/B,CAAjC,IAAsED,QAAjF;AACAC,QAAAA,QAAQ,GAAGA,QAAQ,GAAG,CAAX,GAAeD,QAAQ,CAACH,QAAT,KAAsB,CAAtB,GAA0B,CAA1B,GAA8BG,QAAQ,CAACF,WAAT,GAAuBE,QAAQ,CAACF,WAAT,CAAqBrJ,MAA5C,GAAqD,CAAlG,GAAsG,CAAjH;AACH;;AACD,UAAIhI,IAAI,CAACkQ,eAAL,CAAqBuB,MAArB,CAAJ,EAAkC;AAC9BA,QAAAA,MAAM,GAAGA,MAAM,CAACN,UAAP,CAAkBO,MAAlB,KAA6BD,MAAM,CAACN,UAAP,CAAkBO,MAAM,GAAG,CAA3B,CAA7B,IAA8DD,MAAvE;AACAC,QAAAA,MAAM,GAAGA,MAAM,GAAG,CAAT,GAAaD,MAAM,CAACL,QAAP,KAAoB,CAApB,GAAwB,CAAxB,GAA4BK,MAAM,CAACJ,WAAP,GAAqBI,MAAM,CAACJ,WAAP,CAAmBrJ,MAAxC,GAAiD,CAA1F,GAA8F,CAAvG;AACH;;AAED,UAAMyH,KAAK,GAAG,KAAK5O,GAAL,CAAS8Q,WAAT,EAAd;;AAEA,UAAI;AACAlC,QAAAA,KAAK,CAACmC,QAAN,CAAeL,QAAf,EAAyBC,QAAzB;AACA/B,QAAAA,KAAK,CAACoC,MAAN,CAAaJ,MAAb,EAAqBC,MAArB;AACH,OAHD,CAGE,OAAOI,KAAP,EAAc;AACZC,QAAAA,OAAO,CAACC,IAAR,CAAa,kCAAkCF,KAA/C;AACA,aAAK9C,WAAL;AACA;AACH;;AAED,UAAMiD,SAAS,GAAG,KAAKC,YAAL,EAAlB;;AAEA,UAAID,SAAS,CAACE,eAAd,EAA+B;AAC3BF,QAAAA,SAAS,CAACE,eAAV;AACH;;AAEDF,MAAAA,SAAS,CAACG,QAAV,CAAmB3C,KAAnB;;AACA,WAAK4C,UAAL,CAAgB5C,KAAhB,EAAuB,KAAKyC,YAAL,EAAvB;;AACA,UAAI5S,OAAO,CAACkQ,MAAZ,EAAoB,KAAKP,OAAL;AAEpB,aAAOQ,KAAP;AACH,KAthCQ;;AAwhCT;AACR;AACA;AACQ6C,IAAAA,WAAW,EAAE,uBAAY;AACrB,WAAK3M,SAAL,CAAee,MAAf,GAAwB,IAAxB;AACA,WAAKf,SAAL,CAAegB,cAAf,GAAgC,IAAhC;AACA,UAAI,KAAK7D,QAAT,EAAmB,KAAKoP,YAAL,GAAoBC,eAApB;;AACnB,WAAKI,aAAL,CAAmB,EAAnB;AACH,KAhiCQ;;AAkiCT;AACR;AACA;AACA;AACQ7C,IAAAA,QAAQ,EAAE,oBAAY;AAClB,UAAMD,KAAK,GAAG,KAAK9J,SAAL,CAAee,MAAf,IAAyB,KAAK8L,mBAAL,EAAvC;;AACA,UAAMP,SAAS,GAAG,KAAKC,YAAL,EAAlB;AACA,UAAIzC,KAAK,CAACgD,SAAN,KAAoBR,SAAS,CAACS,WAA9B,IAA6C,CAACxT,OAAO,CAACO,OAAR,CAAgB8P,OAAhB,CAAwB7B,QAAxB,CAAiCuE,SAAS,CAACU,SAA3C,CAAlD,EAAyG,OAAOlD,KAAP;;AAEzG,UAAIwC,SAAS,CAACW,UAAV,GAAuB,CAA3B,EAA8B;AAC1B,aAAKjN,SAAL,CAAee,MAAf,GAAwBuL,SAAS,CAACY,UAAV,CAAqB,CAArB,CAAxB;AACA,eAAO,KAAKlN,SAAL,CAAee,MAAtB;AACH,OAHD,MAGO;AACH,YAAMoM,EAAE,GAAGb,SAAS,CAACc,UAArB;AAAA,YAAiCC,EAAE,GAAGf,SAAS,CAACU,SAAhD;AAAA,YAA2DM,EAAE,GAAGhB,SAAS,CAACiB,YAA1E;AAAA,YAAwFC,EAAE,GAAGlB,SAAS,CAACmB,WAAvG;AACA,YAAMC,YAAY,GAAGrT,IAAI,CAACsT,eAAL,CAAqBR,EAArB,EAAyBE,EAAzB,CAArB;AACA,YAAMO,QAAQ,GAAGF,YAAY,CAACG,QAAb,KAA0BH,YAAY,CAACI,MAAb,KAAwB,CAAxB,GAA4BR,EAAE,IAAIE,EAAlC,GAAuCE,YAAY,CAACI,MAAb,GAAsB,CAAtB,GAA0B,IAA1B,GAAiC,KAAlG,CAAjB;AACA,eAAO,KAAKjD,QAAL,CACH+C,QAAQ,GAAGT,EAAH,GAAQE,EADb,EAEHO,QAAQ,GAAGN,EAAH,GAAQE,EAFb,EAGHI,QAAQ,GAAGP,EAAH,GAAQF,EAHb,EAIHS,QAAQ,GAAGJ,EAAH,GAAQF,EAJb,CAAP;AAMH;AACJ,KAzjCQ;;AA2jCT;AACR;AACA;AACA;AACA;AACA;AACA;AACQS,IAAAA,gBAAgB,EAAE,0BAAUjE,KAAV,EAAiB/N,SAAjB,EAA4B;AAC1C,UAAI,KAAKiS,cAAL,CAAoBlE,KAApB,CAAJ,EAAgC;AAC5B,YAAMF,OAAO,GAAGrQ,OAAO,CAACO,OAAR,CAAgB8P,OAAhC;AACA,YAAMqE,EAAE,GAAG5T,IAAI,CAACoQ,aAAL,CAAmB9Q,OAAO,CAAC+Q,UAA3B,CAAX;AACAuD,QAAAA,EAAE,CAACC,SAAH,GAAe,MAAf;AACAtE,QAAAA,OAAO,CAACgB,YAAR,CAAqBqD,EAArB,EAAyBlS,SAAS,IAAIA,SAAS,KAAK6N,OAA3B,GAAqC7N,SAAS,CAACoS,kBAA/C,GAAoEvE,OAAO,CAACZ,iBAArG;AACA,aAAK6B,QAAL,CAAcoD,EAAE,CAACjF,iBAAjB,EAAoC,CAApC,EAAuCiF,EAAE,CAACjF,iBAA1C,EAA6D,CAA7D;AACAc,QAAAA,KAAK,GAAG,KAAK9J,SAAL,CAAee,MAAvB;AACH;;AACD,aAAO+I,KAAP;AACH,KA5kCQ;;AA8kCT;AACR;AACA;AACA;AACQyC,IAAAA,YAAY,EAAE,wBAAY;AACtB,aAAO,KAAKnR,WAAL,IAAoB,KAAKA,WAAL,CAAiBmR,YAArC,GAAoD,KAAKnR,WAAL,CAAiBmR,YAAjB,EAApD,GAAsF,KAAKpR,GAAL,CAASoR,YAAT,EAA7F;AACH,KAplCQ;;AAslCT;AACR;AACA;AACA;AACQ7C,IAAAA,gBAAgB,EAAE,4BAAY;AAC1B,UAAI,CAACnQ,OAAO,CAACO,OAAR,CAAgB8P,OAAhB,CAAwB7B,QAAxB,CAAiC,KAAK/H,SAAL,CAAegB,cAAhD,CAAL,EAAsE,KAAKuI,YAAL;;AACtE,UAAI,CAAC,KAAKvJ,SAAL,CAAegB,cAApB,EAAoC;AAChC,YAAMoN,aAAa,GAAG/T,IAAI,CAACiR,eAAL,CAAqB/R,OAAO,CAACO,OAAR,CAAgB8P,OAAhB,CAAwByE,UAA7C,EAAyD,UAAU9C,OAAV,EAAmB;AAAE,iBAAOA,OAAO,CAACC,UAAR,CAAmBnJ,MAAnB,KAA8B,CAA9B,IAAmCkJ,OAAO,CAACE,QAAR,KAAqB,CAA/D;AAAmE,SAAjJ,EAAmJ,KAAnJ,CAAtB;;AACA,YAAI,CAAC2C,aAAL,EAAoB;AAChB,eAAK7E,YAAL;AACH,SAFD,MAEO;AACH,eAAKvJ,SAAL,CAAegB,cAAf,GAAgCoN,aAAhC;AACA,iBAAOA,aAAP;AACH;AACJ;;AACD,aAAO,KAAKpO,SAAL,CAAegB,cAAtB;AACH,KAtmCQ;;AAwmCT;AACR;AACA;AACA;AACQuI,IAAAA,YAAY,EAAE,wBAAY;AACtB,UAAM+C,SAAS,GAAG,KAAKC,YAAL,EAAlB;AACA,UAAI,CAACD,SAAL,EAAgB,OAAO,IAAP;AAChB,UAAIxC,KAAK,GAAG,IAAZ;;AAEA,UAAIwC,SAAS,CAACW,UAAV,GAAuB,CAA3B,EAA8B;AAC1BnD,QAAAA,KAAK,GAAGwC,SAAS,CAACY,UAAV,CAAqB,CAArB,CAAR;AACH,OAFD,MAEO;AACHpD,QAAAA,KAAK,GAAG,KAAK+C,mBAAL,EAAR;AACH;;AAED,UAAIxS,IAAI,CAACkQ,eAAL,CAAqBT,KAAK,CAACG,YAA3B,KAA4CH,KAAK,CAACgB,SAAN,KAAoB,CAApE,EAAuE;AACnEhB,QAAAA,KAAK,GAAG,KAAKe,QAAL,CAAcf,KAAK,CAACE,cAApB,EAAoCF,KAAK,CAACQ,WAA1C,EAAuDR,KAAK,CAACE,cAA7D,EAA6EF,KAAK,CAACE,cAAN,CAAqB3H,MAAlG,CAAR;AACH;;AAED,WAAKqK,UAAL,CAAgB5C,KAAhB,EAAuBwC,SAAvB;AACH,KA5nCQ;;AA8nCT;AACR;AACA;AACA;AACA;AACQI,IAAAA,UAAU,EAAE,oBAAU5C,KAAV,EAAiBwC,SAAjB,EAA4B;AACpC,UAAI8B,aAAa,GAAG,IAApB;AACA,WAAKpO,SAAL,CAAee,MAAf,GAAwB+I,KAAxB;;AAEA,UAAIA,KAAK,CAACgD,SAAV,EAAqB;AACjB,YAAIzS,IAAI,CAAC6P,YAAL,CAAkBJ,KAAK,CAACM,uBAAxB,CAAJ,EAAsDgE,aAAa,GAAGtE,KAAK,CAACM,uBAAN,CAA8BC,QAA9B,CAAuCP,KAAK,CAACQ,WAA7C,KAA6DR,KAAK,CAACM,uBAAnF,CAAtD,KACKgE,aAAa,GAAGtE,KAAK,CAACM,uBAAtB;AACR,OAHD,MAGO;AACHgE,QAAAA,aAAa,GAAG9B,SAAS,CAACgC,UAAV,IAAwBhC,SAAS,CAACc,UAAlD;AACH;;AAED,WAAKpN,SAAL,CAAegB,cAAf,GAAgCoN,aAAhC;AACH,KA/oCQ;;AAipCT;AACR;AACA;AACA;AACA;AACQvB,IAAAA,mBAAmB,EAAE,+BAAY;AAC7B,UAAMjD,OAAO,GAAGrQ,OAAO,CAACO,OAAR,CAAgB8P,OAAhC;AACAA,MAAAA,OAAO,CAACD,KAAR;;AACA,UAAMG,KAAK,GAAG,KAAK5O,GAAL,CAAS8Q,WAAT,EAAd;;AAEA,UAAId,OAAO,GAAGtB,OAAO,CAACZ,iBAAtB;;AACA,UAAI,CAACkC,OAAL,EAAc;AACVA,QAAAA,OAAO,GAAG7Q,IAAI,CAACoQ,aAAL,CAAmB9Q,OAAO,CAAC+Q,UAA3B,CAAV;AACAQ,QAAAA,OAAO,CAACgD,SAAR,GAAoB,MAApB;AACAtE,QAAAA,OAAO,CAACvF,WAAR,CAAoB6G,OAApB;AACH;;AAEDpB,MAAAA,KAAK,CAACmC,QAAN,CAAef,OAAf,EAAwB,CAAxB;AACApB,MAAAA,KAAK,CAACoC,MAAN,CAAahB,OAAb,EAAsB,CAAtB;AAEA,aAAOpB,KAAP;AACH,KAtqCQ;;AAwqCT;AACR;AACA;AACA;AACA;AACA;AACQkE,IAAAA,cAAc,EAAE,wBAAUlE,KAAV,EAAiB;AAC7B,UAAMyE,IAAI,GAAGzE,KAAK,CAACM,uBAAnB;AACA,aAAQ/P,IAAI,CAAC6P,YAAL,CAAkBJ,KAAK,CAACE,cAAxB,KAA2C3P,IAAI,CAAC6P,YAAL,CAAkBJ,KAAK,CAACG,YAAxB,CAA5C,IAAsF,UAAUjC,IAAV,CAAeuG,IAAI,CAACC,QAApB,CAAtF,IAAuH,KAAKzP,YAAL,CAAkBE,MAAlB,CAAyB+I,IAAzB,CAA8BuG,IAAI,CAACC,QAAnC,CAAvH,IAAuKnU,IAAI,CAACoU,gBAAL,CAAsBF,IAAtB,CAA9K;AACH,KAjrCQ;;AAmrCT;AACR;AACA;AACA;AACA;AACQG,IAAAA,qBAAqB,EAAE,iCAAY;AAC/B,UAAM5E,KAAK,GAAG,KAAKC,QAAL,EAAd;AACA,UAAI,KAAKiE,cAAL,CAAoBlE,KAApB,CAAJ,EAAgC,OAAO,KAAP;AAEhC,UAAI8B,QAAQ,GAAG9B,KAAK,CAACE,cAArB;AACA,UAAI6B,QAAQ,GAAG/B,KAAK,CAACQ,WAArB;AACA,UAAIwB,MAAM,GAAGhC,KAAK,CAACG,YAAnB;AACA,UAAI8B,MAAM,GAAGjC,KAAK,CAACgB,SAAnB;AACA,UAAI6D,OAAJ,EAAaC,UAAb,EAAyBC,SAAzB;;AAEA,UAAIxU,IAAI,CAACkQ,eAAL,CAAqBqB,QAArB,CAAJ,EAAoC;AAChC,YAAI,CAACA,QAAQ,CAACJ,UAAT,CAAoBK,QAApB,CAAL,EAAoC;AAChCD,UAAAA,QAAQ,GAAGA,QAAQ,CAACkD,SAAT,IAAsBlD,QAAjC;AACAC,UAAAA,QAAQ,GAAGD,QAAQ,CAACF,WAAT,CAAqBrJ,MAAhC;AACH,SAHD,MAGO;AACHuJ,UAAAA,QAAQ,GAAGA,QAAQ,CAACJ,UAAT,CAAoBK,QAApB,KAAiCD,QAA5C;AACAC,UAAAA,QAAQ,GAAG,CAAX;AACH;;AACD,eAAOD,QAAQ,IAAIA,QAAQ,CAACH,QAAT,KAAsB,CAAlC,IAAuCG,QAAQ,CAACyC,UAAvD,EAAmE;AAC/DzC,UAAAA,QAAQ,GAAGA,QAAQ,CAACyC,UAAT,IAAuBzC,QAAlC;AACAC,UAAAA,QAAQ,GAAG,CAAX;AACH;AACJ;;AACD,UAAIxR,IAAI,CAACkQ,eAAL,CAAqBuB,MAArB,CAAJ,EAAkC;AAC9BA,QAAAA,MAAM,GAAGA,MAAM,CAACN,UAAP,CAAkBO,MAAlB,KAA6BD,MAAM,CAACgD,SAApC,IAAiDhD,MAA1D;;AACA,eAAOA,MAAM,IAAIA,MAAM,CAACL,QAAP,KAAoB,CAA9B,IAAmCK,MAAM,CAACgD,SAAjD,EAA4D;AACxDhD,UAAAA,MAAM,GAAGA,MAAM,CAACgD,SAAhB;AACH;;AACD/C,QAAAA,MAAM,GAAGD,MAAM,CAACJ,WAAP,CAAmBrJ,MAA5B;AACH,OA7B8B,CA+B/B;;;AACAsM,MAAAA,OAAO,GAAGtU,IAAI,CAAC6P,YAAL,CAAkB0B,QAAlB,IAA8BrS,OAAO,CAACO,OAAR,CAAgB8P,OAAhB,CAAwByE,UAAtD,GAAmEzC,QAA7E;AACAgD,MAAAA,UAAU,GAAG/C,QAAb;;AAEA,UAAIxR,IAAI,CAAC0U,OAAL,CAAaJ,OAAb,KAA0BA,OAAO,CAAClD,QAAR,KAAqB,CAArB,IAA0BkD,OAAO,CAACnD,UAAR,CAAmBnJ,MAAnB,GAA4B,CAApF,EAAwF;AACpF,YAAM2M,SAAS,GAAG3U,IAAI,CAAC0U,OAAL,CAAaJ,OAAb,CAAlB;;AACA,YAAI,CAACK,SAAL,EAAgB;AACZ,iBAAOL,OAAO,IAAI,CAACtU,IAAI,CAAC0U,OAAL,CAAaJ,OAAb,CAAZ,IAAqCA,OAAO,CAAClD,QAAR,KAAqB,CAAjE,EAAoE;AAChEkD,YAAAA,OAAO,GAAGA,OAAO,CAACnD,UAAR,CAAmBoD,UAAnB,KAAkCD,OAAO,CAACR,kBAA1C,IAAgEQ,OAAO,CAACM,WAAlF;AACAL,YAAAA,UAAU,GAAG,CAAb;AACH;;AAED,cAAI7O,MAAM,GAAG1F,IAAI,CAAC6U,gBAAL,CAAsBP,OAAtB,EAA+B,IAA/B,CAAb;;AACA,cAAI5O,MAAM,KAAK1F,IAAI,CAAC8U,qBAAL,CAA2BpP,MAA3B,EAAmC,IAAnC,CAAf,EAAyD;AACrDA,YAAAA,MAAM,GAAG1F,IAAI,CAACoQ,aAAL,CAAmBpQ,IAAI,CAACoP,gBAAL,CAAsBkF,OAAtB,EAA+BtU,IAAI,CAAC+U,MAApC,IAA8C,KAA9C,GAAsDzV,OAAO,CAAC+Q,UAAjF,CAAT;AACAiE,YAAAA,OAAO,CAACU,UAAR,CAAmBzE,YAAnB,CAAgC7K,MAAhC,EAAwC4O,OAAxC;AACA5O,YAAAA,MAAM,CAACsE,WAAP,CAAmBsK,OAAnB;AACH;AACJ;;AAED,YAAItU,IAAI,CAAC0U,OAAL,CAAaJ,OAAb,CAAJ,EAA2B;AACvB,cAAMW,SAAS,GAAGjV,IAAI,CAACkV,cAAL,CAAoBlV,IAAI,CAACmV,cAAzB,CAAlB;AACAb,UAAAA,OAAO,CAACU,UAAR,CAAmBzE,YAAnB,CAAgC0E,SAAhC,EAA2CX,OAA3C;AACAA,UAAAA,OAAO,GAAGW,SAAV;;AACA,cAAIN,SAAJ,EAAe;AACX,gBAAIpD,QAAQ,KAAKE,MAAjB,EAAyB;AACrBA,cAAAA,MAAM,GAAG6C,OAAT;AACA5C,cAAAA,MAAM,GAAG,CAAT;AACH;AACJ;AACJ;AACJ,OA9D8B,CAgE/B;;;AACAH,MAAAA,QAAQ,GAAG+C,OAAX;AACA9C,MAAAA,QAAQ,GAAG+C,UAAX,CAlE+B,CAoE/B;;AACAD,MAAAA,OAAO,GAAGtU,IAAI,CAAC6P,YAAL,CAAkB4B,MAAlB,IAA4BvS,OAAO,CAACO,OAAR,CAAgB8P,OAAhB,CAAwBkF,SAApD,GAAgEhD,MAA1E;AACA8C,MAAAA,UAAU,GAAG7C,MAAb;;AAEA,UAAI1R,IAAI,CAAC0U,OAAL,CAAaJ,OAAb,KAA0BA,OAAO,CAAClD,QAAR,KAAqB,CAArB,IAA0BkD,OAAO,CAACnD,UAAR,CAAmBnJ,MAAnB,GAA4B,CAApF,EAAwF;AACpF,YAAM2M,UAAS,GAAG3U,IAAI,CAAC0U,OAAL,CAAaJ,OAAb,CAAlB;;AACA,YAAI,CAACK,UAAL,EAAgB;AACZ,iBAAOL,OAAO,IAAI,CAACtU,IAAI,CAAC0U,OAAL,CAAaJ,OAAb,CAAZ,IAAqCA,OAAO,CAAClD,QAAR,KAAqB,CAAjE,EAAoE;AAChEoD,YAAAA,SAAS,GAAGF,OAAO,CAACnD,UAApB;AACA,gBAAIqD,SAAS,CAACxM,MAAV,KAAqB,CAAzB,EAA4B;AAC5BsM,YAAAA,OAAO,GAAGE,SAAS,CAACD,UAAU,GAAG,CAAb,GAAiBA,UAAU,GAAG,CAA9B,GAAkCA,UAAnC,CAAT,IAA2D,CAAC,UAAU5G,IAAV,CAAe6G,SAAS,CAAC,CAAD,CAAT,CAAaL,QAA5B,CAA5D,GAAoGK,SAAS,CAAC,CAAD,CAA7G,GAAoHF,OAAO,CAACc,sBAAR,IAAkCd,OAAO,CAACe,eAA1C,IAA6D9D,QAA3L;AACAgD,YAAAA,UAAU,GAAGA,UAAU,GAAG,CAAb,GAAiBD,OAAO,CAACjD,WAAR,CAAoBrJ,MAArC,GAA8CuM,UAA3D;AACH;;AAED,cAAI7O,OAAM,GAAG1F,IAAI,CAAC6U,gBAAL,CAAsBP,OAAtB,EAA+B,IAA/B,CAAb;;AACA,cAAI5O,OAAM,KAAK1F,IAAI,CAAC8U,qBAAL,CAA2BpP,OAA3B,EAAmC,IAAnC,CAAf,EAAyD;AACrDA,YAAAA,OAAM,GAAG1F,IAAI,CAACoQ,aAAL,CAAmBpQ,IAAI,CAAC+U,MAAL,CAAYrP,OAAZ,IAAsB,KAAtB,GAA8BpG,OAAO,CAAC+Q,UAAzD,CAAT;AACAiE,YAAAA,OAAO,CAACU,UAAR,CAAmBzE,YAAnB,CAAgC7K,OAAhC,EAAwC4O,OAAxC;;AACA5O,YAAAA,OAAM,CAACsE,WAAP,CAAmBsK,OAAnB;AACH;AACJ;;AAED,YAAItU,IAAI,CAAC0U,OAAL,CAAaJ,OAAb,CAAJ,EAA2B;AACvB,cAAMW,UAAS,GAAGjV,IAAI,CAACkV,cAAL,CAAoBlV,IAAI,CAACmV,cAAzB,CAAlB;;AACAb,UAAAA,OAAO,CAACU,UAAR,CAAmBzE,YAAnB,CAAgC0E,UAAhC,EAA2CX,OAA3C;AACAA,UAAAA,OAAO,GAAGW,UAAV;AACAV,UAAAA,UAAU,GAAG,CAAb;;AACA,cAAII,UAAS,IAAI,CAACL,OAAO,CAACe,eAA1B,EAA2C;AACvCrV,YAAAA,IAAI,CAACsV,UAAL,CAAgB7D,MAAhB;AACH;AACJ;AACJ,OAnG8B,CAqG/B;;;AACAA,MAAAA,MAAM,GAAG6C,OAAT;AACA5C,MAAAA,MAAM,GAAG6C,UAAT,CAvG+B,CAyG/B;;AACA,WAAK/D,QAAL,CAAce,QAAd,EAAwBC,QAAxB,EAAkCC,MAAlC,EAA0CC,MAA1C;AACA,aAAO,IAAP;AACH,KApyCQ;;AAsyCT;AACR;AACA;AACA;AACA;AACQ6D,IAAAA,mBAAmB,EAAE,6BAAUC,UAAV,EAAsB;AACvC,UAAI,CAAC,KAAKnB,qBAAL,EAAL,EAAmC,OAAO,EAAP;AACnC,UAAI5E,KAAK,GAAG,KAAKC,QAAL,EAAZ;;AAEA,UAAI1P,IAAI,CAAC6P,YAAL,CAAkBJ,KAAK,CAACE,cAAxB,CAAJ,EAA6C;AACzC,YAAMK,QAAQ,GAAG9Q,OAAO,CAACO,OAAR,CAAgB8P,OAAhB,CAAwBS,QAAzC;AACA,YAAIA,QAAQ,CAAChI,MAAT,KAAoB,CAAxB,EAA2B,OAAO,EAAP;AAC3B,aAAKwI,QAAL,CAAcR,QAAQ,CAAC,CAAD,CAAtB,EAA2B,CAA3B,EAA8BA,QAAQ,CAACA,QAAQ,CAAChI,MAAT,GAAkB,CAAnB,CAAtC,EAA6DgI,QAAQ,CAACA,QAAQ,CAAChI,MAAT,GAAkB,CAAnB,CAAR,CAA8BqJ,WAA9B,CAA0CoE,IAA1C,GAAiDzN,MAA9G;AACAyH,QAAAA,KAAK,GAAG,KAAKC,QAAL,EAAR;AACH;;AAED,UAAM6B,QAAQ,GAAG9B,KAAK,CAACE,cAAvB;AACA,UAAM8B,MAAM,GAAGhC,KAAK,CAACG,YAArB;AACA,UAAM8F,SAAS,GAAGjG,KAAK,CAACM,uBAAxB,CAbuC,CAevC;;AACA,UAAM4F,SAAS,GAAG3V,IAAI,CAAC4V,eAAL,CAAqBF,SAArB,EAAgC,UAAUxE,OAAV,EAAmB;AACjE,eAAOsE,UAAU,GAAGA,UAAU,CAACtE,OAAD,CAAb,GAAyBlR,IAAI,CAACkQ,eAAL,CAAqBgB,OAArB,CAA1C;AACH,OAFiB,CAAlB;AAIA,UAAI,CAAClR,IAAI,CAAC6P,YAAL,CAAkB6F,SAAlB,CAAD,IAAiC,CAAC1V,IAAI,CAAC6V,oBAAL,CAA0BH,SAA1B,CAAtC,EAA4EC,SAAS,CAACG,OAAV,CAAkB9V,IAAI,CAAC6U,gBAAL,CAAsBa,SAAtB,EAAiC,IAAjC,CAAlB;AAC5E,UAAInE,QAAQ,KAAKE,MAAb,IAAuBkE,SAAS,CAAC3N,MAAV,KAAqB,CAAhD,EAAmD,OAAO2N,SAAP;AAEnD,UAAII,SAAS,GAAG/V,IAAI,CAAC6U,gBAAL,CAAsBtD,QAAtB,EAAgC,IAAhC,CAAhB;AACA,UAAIyE,OAAO,GAAGhW,IAAI,CAAC6U,gBAAL,CAAsBpD,MAAtB,EAA8B,IAA9B,CAAd;AACA,UAAIwE,QAAQ,GAAG,IAAf;AACA,UAAIC,MAAM,GAAG,IAAb;;AAEA,UAAMC,SAAS,GAAG,SAAZA,SAAY,CAAUjF,OAAV,EAAmB;AACjC,eAAOlR,IAAI,CAACoW,OAAL,CAAalF,OAAb,IAAwB,WAAWvD,IAAX,CAAgBuD,OAAO,CAACiD,QAAxB,CAAxB,GAA4D,IAAnE;AACH,OAFD;;AAIA,UAAIkC,YAAY,GAAGrW,IAAI,CAAC8U,qBAAL,CAA2BiB,SAA3B,EAAsCI,SAAtC,CAAnB;AACA,UAAIG,UAAU,GAAGtW,IAAI,CAAC8U,qBAAL,CAA2BkB,OAA3B,EAAoCG,SAApC,CAAjB;AACA,UAAInW,IAAI,CAACoW,OAAL,CAAaC,YAAb,KAA8BrW,IAAI,CAACuW,UAAL,CAAgBF,YAAY,CAACrB,UAA7B,CAAlC,EAA4EqB,YAAY,GAAGA,YAAY,CAACrB,UAA5B;AAC5E,UAAIhV,IAAI,CAACoW,OAAL,CAAaE,UAAb,KAA4BtW,IAAI,CAACuW,UAAL,CAAgBD,UAAU,CAACtB,UAA3B,CAAhC,EAAwEsB,UAAU,GAAGA,UAAU,CAACtB,UAAxB;AAExE,UAAMwB,SAAS,GAAGH,YAAY,KAAKC,UAAnC;;AACA,WAAK,IAAIxO,CAAC,GAAG,CAAR,EAAWqB,GAAG,GAAGwM,SAAS,CAAC3N,MAA3B,EAAmCyO,IAAxC,EAA8C3O,CAAC,GAAGqB,GAAlD,EAAuDrB,CAAC,EAAxD,EAA4D;AACxD2O,QAAAA,IAAI,GAAGd,SAAS,CAAC7N,CAAD,CAAhB;;AAEA,YAAIiO,SAAS,KAAKU,IAAd,IAAuB,CAACD,SAAD,IAAcC,IAAI,KAAKJ,YAAlD,EAAiE;AAC7DJ,UAAAA,QAAQ,GAAGnO,CAAX;AACA;AACH;;AAED,YAAIkO,OAAO,KAAKS,IAAZ,IAAqB,CAACD,SAAD,IAAcC,IAAI,KAAKH,UAAhD,EAA6D;AACzDJ,UAAAA,MAAM,GAAGpO,CAAT;AACA;AACH;AACJ;;AAED,UAAImO,QAAQ,KAAK,IAAjB,EAAuBA,QAAQ,GAAG,CAAX;AACvB,UAAIC,MAAM,KAAK,IAAf,EAAqBA,MAAM,GAAGP,SAAS,CAAC3N,MAAV,GAAmB,CAA5B;AAErB,aAAO2N,SAAS,CAACe,KAAV,CAAgBT,QAAhB,EAA0BC,MAAM,GAAG,CAAnC,CAAP;AACH,KAn2CQ;;AAq2CT;AACR;AACA;AACA;AACA;AACA;AACQS,IAAAA,gCAAgC,EAAE,0CAAUC,eAAV,EAA2B;AACzD,UAAMlB,SAAS,GAAG,KAAKhG,QAAL,GAAgBK,uBAAlC;AACA,UAAM8G,WAAW,GAAG7W,IAAI,CAACoP,gBAAL,CAAsBsG,SAAtB,EAAiC1V,IAAI,CAACmQ,WAAtC,CAApB;AACA,UAAM2G,aAAa,GAAG9W,IAAI,CAACoW,OAAL,CAAaV,SAAb,IAClB,KAAKH,mBAAL,CAAyB,IAAzB,CADkB,GAElB,KAAKA,mBAAL,CAAyB,UAAUrE,OAAV,EAAmB;AACxC,YAAM6F,SAAS,GAAG,KAAK3H,gBAAL,CAAsB8B,OAAtB,EAA+B,KAAKf,WAApC,CAAlB;AACA,eAAQ,KAAKD,eAAL,CAAqBgB,OAArB,MAAkC,CAAC6F,SAAD,IAAcA,SAAS,KAAKF,WAA9D,CAAD,IAAiF,KAAK1G,WAAL,CAAiBe,OAAjB,KAA6B,CAAC,KAAK2D,gBAAL,CAAsB3D,OAAtB,CAAtH;AACH,OAHwB,CAGvB5G,IAHuB,CAGlBtK,IAHkB,CAAzB,CAFJ;;AAOA,UAAI4W,eAAJ,EAAqB;AACjB,aAAK,IAAI9O,CAAC,GAAG,CAAR,EAAWqB,GAAG,GAAG2N,aAAa,CAAC9O,MAApC,EAA4CF,CAAC,GAAGqB,GAAhD,EAAqDrB,CAAC,EAAtD,EAA0D;AACtD,eAAK,IAAIkP,CAAC,GAAGlP,CAAC,GAAG,CAAjB,EAAoBkP,CAAC,IAAI,CAAzB,EAA4BA,CAAC,EAA7B,EAAiC;AAC7B,gBAAIF,aAAa,CAACE,CAAD,CAAb,CAAiBtJ,QAAjB,CAA0BoJ,aAAa,CAAChP,CAAD,CAAvC,CAAJ,EAAiD;AAC7CgP,cAAAA,aAAa,CAACG,MAAd,CAAqBnP,CAArB,EAAwB,CAAxB;AACAA,cAAAA,CAAC;AAAIqB,cAAAA,GAAG;AACR;AACH;AACJ;AACJ;AACJ;;AAED,aAAO2N,aAAP;AACH,KAl4CQ;;AAo4CT;AACR;AACA;AACA;AACA;AACA;AACA;AACQI,IAAAA,WAAW,EAAE,qBAAUxV,SAAV,EAAqB2M,MAArB,EAA6B8I,GAA7B,EAAkC;AAC3C,aAAQA,GAAG,KAAK,KAAR,IAAiB9I,MAAM,KAAK,CAA7B,IAAoC,CAAC,CAAC8I,GAAD,IAAQA,GAAG,KAAK,OAAjB,KAA6B,CAACzV,SAAS,CAAC0V,SAAxC,IAAqD/I,MAAM,KAAK,CAApG,IAA2G,CAAC,CAAC8I,GAAD,IAAQA,GAAG,KAAK,KAAjB,KAA2B,CAAC,CAACzV,SAAS,CAAC0V,SAAvC,IAAoD/I,MAAM,KAAK3M,SAAS,CAAC0V,SAAV,CAAoBpP,MAArM;AACH,KA74CQ;;AA+4CT;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACQqP,IAAAA,aAAa,EAAE,uBAAUC,IAAV,EAAgBjJ,MAAhB,EAAwB8I,GAAxB,EAA6B;AACxC,UAAI,CAAC,KAAKD,WAAL,CAAiBI,IAAjB,EAAuBjJ,MAAvB,EAA+B8I,GAA/B,CAAL,EAA0C,OAAO,KAAP;AAE1C,UAAM1D,MAAM,GAAG,EAAf;AACA0D,MAAAA,GAAG,GAAGA,GAAG,KAAK,OAAR,GAAkB,iBAAlB,GAAsC,aAA5C;;AACA,aAAOG,IAAI,IAAI,CAACtX,IAAI,CAACkQ,eAAL,CAAqBoH,IAArB,CAAT,IAAuC,CAACtX,IAAI,CAAC6P,YAAL,CAAkByH,IAAlB,CAA/C,EAAwE;AACpE,YAAI,CAACA,IAAI,CAACH,GAAD,CAAL,IAAenX,IAAI,CAAC0U,OAAL,CAAa4C,IAAI,CAACH,GAAD,CAAjB,KAA2B,CAACG,IAAI,CAACH,GAAD,CAAJ,CAAUA,GAAV,CAA/C,EAAgE;AAC5D,cAAIG,IAAI,CAAClG,QAAL,KAAkB,CAAtB,EAAyBqC,MAAM,CAACzK,IAAP,CAAYsO,IAAI,CAACC,SAAL,CAAe,KAAf,CAAZ;AACzBD,UAAAA,IAAI,GAAGA,IAAI,CAACtC,UAAZ;AACH,SAHD,MAGO;AACH,iBAAO,IAAP;AACH;AACJ;;AAED,aAAOvB,MAAP;AACH,KAt6CQ;;AAw6CT;AACR;AACA;AACQ+D,IAAAA,WAAW,EAAE,uBAAY;AACrBtY,MAAAA,OAAO,CAACO,OAAR,CAAgBgY,OAAhB,CAAwBnR,KAAxB,CAA8BqE,OAA9B,GAAwC,OAAxC;AACH,KA76CQ;;AA+6CT;AACR;AACA;AACQ+M,IAAAA,YAAY,EAAE,wBAAY;AACtBxY,MAAAA,OAAO,CAACO,OAAR,CAAgBgY,OAAhB,CAAwBnR,KAAxB,CAA8BqE,OAA9B,GAAwC,MAAxC;AACH,KAp7CQ;;AAs7CT;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACQgN,IAAAA,eAAe,EAAE,yBAAUlY,OAAV,EAAmBmY,UAAnB,EAA+B;AAC5C,UAAI,CAACnY,OAAD,IAAY,CAACA,OAAO,CAACuV,UAAzB,EAAqC,OAAO,IAAP;AAErC,UAAM6C,eAAe,GAAG7X,IAAI,CAAC6U,gBAAL,CAAsB,KAAKxF,gBAAL,EAAtB,EAA+C,IAA/C,CAAxB;AACA,UAAIyI,OAAO,GAAG,IAAd;;AACA,UAAI,CAAC9X,IAAI,CAACkQ,eAAL,CAAqBzQ,OAArB,CAAD,IAAkCO,IAAI,CAAC+X,mBAAL,CAAyBF,eAAe,IAAIpY,OAAO,CAACuV,UAApD,CAAtC,EAAuG;AACnG8C,QAAAA,OAAO,GAAG9X,IAAI,CAACoQ,aAAL,CAAmB,IAAnB,CAAV;AACH,OAFD,MAEO;AACH,YAAM4H,WAAW,GAAGJ,UAAU,GAAI,OAAOA,UAAP,KAAsB,QAAtB,GAAiCA,UAAjC,GAA8CA,UAAU,CAACzD,QAA7D,GAA0EnU,IAAI,CAACkQ,eAAL,CAAqB2H,eAArB,KAAyC,CAAC7X,IAAI,CAAC6V,oBAAL,CAA0BgC,eAA1B,CAA1C,IAAwF,CAAC7X,IAAI,CAAC+X,mBAAL,CAAyBF,eAAzB,CAA1F,GAAuIA,eAAe,CAAC1D,QAAvJ,GAAkK7U,OAAO,CAAC+Q,UAAjR;AACAyH,QAAAA,OAAO,GAAG9X,IAAI,CAACoQ,aAAL,CAAmB4H,WAAnB,CAAV;AACAF,QAAAA,OAAO,CAACjE,SAAR,GAAoB,MAApB;;AACA,YAAK+D,UAAU,IAAI,OAAOA,UAAP,KAAsB,QAArC,IAAmD,CAACA,UAAD,IAAe5X,IAAI,CAACkQ,eAAL,CAAqB2H,eAArB,CAAtE,EAA8G;AAC1G7X,UAAAA,IAAI,CAACiY,iBAAL,CAAuBH,OAAvB,EAAgCF,UAAU,IAAIC,eAA9C;AACH;AACJ;;AAED,UAAI7X,IAAI,CAAC+U,MAAL,CAAYtV,OAAZ,CAAJ,EAA0BA,OAAO,CAAC8Q,YAAR,CAAqBuH,OAArB,EAA8BrY,OAAO,CAACqU,kBAAtC,EAA1B,KACKrU,OAAO,CAACuV,UAAR,CAAmBzE,YAAnB,CAAgCuH,OAAhC,EAAyCrY,OAAO,CAACqU,kBAAjD;AAEL,aAAOgE,OAAP;AACH,KAl9CQ;;AAo9CT;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQI,IAAAA,eAAe,EAAE,yBAAUzY,OAAV,EAAmB0Y,cAAnB,EAAmCC,cAAnC,EAAmDC,SAAnD,EAA8D;AAC3E,UAAI,KAAKrV,UAAL,IAAoBoV,cAAc,IAAI,CAAC,KAAKA,cAAL,CAAoB3Y,OAApB,EAA6B,IAA7B,CAA3C,EAAgF;AAC5E,eAAO,IAAP;AACH;;AAED,UAAM6Y,CAAC,GAAG,KAAKC,UAAL,EAAV;AACA,WAAK7E,gBAAL,CAAsB,KAAKhE,QAAL,EAAtB,EAAuC4I,CAAC,CAAC5W,SAAzC;AACA,UAAI8W,KAAK,GAAG,IAAZ;AACA,UAAIzE,aAAa,GAAG,KAAK1E,gBAAL,EAApB;AACA,UAAIoJ,QAAQ,GAAGzY,IAAI,CAAC6U,gBAAL,CAAsBd,aAAtB,EAAqC,IAArC,CAAf;;AAEA,UAAI/T,IAAI,CAACuW,UAAL,CAAgBkC,QAAhB,CAAJ,EAA+B;AAC3B,aAAKC,UAAL,CAAgBjZ,OAAhB,EAAyBsU,aAAa,KAAK0E,QAAlB,GAA6B,IAA7B,GAAoCH,CAAC,CAAC5W,SAAF,CAAYkT,WAAzE,EAAsF,KAAtF;AACA,YAAI,CAACnV,OAAO,CAACmV,WAAb,EAA0BnV,OAAO,CAACuV,UAAR,CAAmBhL,WAAnB,CAA+BhK,IAAI,CAACoQ,aAAL,CAAmB,IAAnB,CAA/B;AAC7B,OAHD,MAGO;AACH,YAAI,KAAKV,QAAL,GAAgB+C,SAAhB,KAA8B6F,CAAC,CAAC5W,SAAF,CAAY0P,QAAZ,KAAyB,CAAzB,IAA8BpR,IAAI,CAAC0U,OAAL,CAAa4D,CAAC,CAAC5W,SAAf,CAA5D,CAAJ,EAA4F;AACxF,cAAMiX,WAAW,GAAG3Y,IAAI,CAACoP,gBAAL,CAAsBkJ,CAAC,CAAC5W,SAAxB,EAAmC,UAAUwP,OAAV,EAAmB;AAAE,mBAAO,KAAK2E,oBAAL,CAA0B3E,OAA1B,CAAP;AAA4C,WAAjE,CAAkE5G,IAAlE,CAAuEtK,IAAvE,CAAnC,CAApB;AACAwY,UAAAA,KAAK,GAAGxY,IAAI,CAAC4Y,YAAL,CAAkBN,CAAC,CAAC5W,SAApB,EAA+B4W,CAAC,CAACjK,MAAjC,EAAyC,CAACsK,WAAD,GAAe,CAAf,GAAmB3Y,IAAI,CAAC6Y,eAAL,CAAqBF,WAArB,IAAoC,CAAhG,CAAR;AACA,cAAIH,KAAJ,EAAWC,QAAQ,GAAGD,KAAK,CAACnD,eAAjB;AACd;;AACD,aAAKqD,UAAL,CAAgBjZ,OAAhB,EAAyBO,IAAI,CAAC6V,oBAAL,CAA0B4C,QAA1B,IAAsC,IAAtC,GAA6CA,QAAtE,EAAgF,KAAhF;AACA,YAAIA,QAAQ,IAAIzY,IAAI,CAAC8Y,kBAAL,CAAwBL,QAAxB,CAAhB,EAAmDzY,IAAI,CAACsV,UAAL,CAAgBmD,QAAhB;AACtD;;AAED,UAAI,CAACJ,SAAL,EAAgB;AACZ,aAAK7H,QAAL,CAAc/Q,OAAd,EAAuB,CAAvB,EAA0BA,OAA1B,EAAmC,CAAnC;AAEA,YAAMsR,iBAAiB,GAAG,KAAK5D,gBAAL,CAAsB1N,OAAtB,CAA1B;;AACA,YAAIsR,iBAAJ,EAAuB;AACnB,eAAKC,eAAL,CAAqBD,iBAAiB,CAACjH,MAAvC,EAA+CiH,iBAAiB,CAACtI,UAAjE;AACH,SAFD,MAEO,IAAI+P,KAAJ,EAAW;AACdA,UAAAA,KAAK,GAAGxY,IAAI,CAAC+Y,iBAAL,CAAuBP,KAAvB,EAA8B,IAA9B,EAAoC1F,EAApC,IAA0C0F,KAAlD;AACA,eAAKhI,QAAL,CAAcgI,KAAd,EAAqB,CAArB,EAAwBA,KAAxB,EAA+B,CAA/B;AACH;AACJ,OAlC0E,CAoC3E;;;AACA,UAAI,CAACL,cAAL,EAAqB,KAAK/W,OAAL,CAAa4H,IAAb,CAAkB,CAAlB;AAErB,aAAOwP,KAAK,IAAI/Y,OAAhB;AACH,KArgDQ;;AAugDT;AACR;AACA;AACA;AACA;AACA;AACQ0N,IAAAA,gBAAgB,EAAE,0BAAU1N,OAAV,EAAmB;AACjC,UAAI,CAAC,KAAKiF,YAAL,CAAkBG,WAAnB,IAAkC,CAACpF,OAAvC,EAAgD,OAAO,IAAP;AAEhD,UAAIqK,MAAJ,EAAYrB,UAAZ;;AACA,UAAI,YAAYkF,IAAZ,CAAiBlO,OAAO,CAAC0U,QAAzB,KAAsC,eAAexG,IAAf,CAAoBlO,OAAO,CAACuZ,SAA5B,CAA1C,EAAkF;AAC9ElP,QAAAA,MAAM,GAAGrK,OAAO,CAACuL,aAAR,CAAsB,KAAKtG,YAAL,CAAkBG,WAAxC,CAAT;AACH;;AACD,UAAI,CAACiF,MAAD,IAAWrK,OAAO,CAAC0U,QAAnB,IAA+B,KAAKzP,YAAL,CAAkBE,MAAlB,CAAyB+I,IAAzB,CAA8BlO,OAAO,CAAC0U,QAAtC,CAAnC,EAAoF;AAChFrK,QAAAA,MAAM,GAAGrK,OAAT;AACH;;AAED,UAAIqK,MAAJ,EAAY;AACRrB,QAAAA,UAAU,GAAG,KAAK/D,YAAL,CAAkBK,SAAlB,CAA4B+E,MAAM,CAACqK,QAAP,CAAgB8E,WAAhB,EAA5B,CAAb;;AACA,YAAIxQ,UAAJ,EAAgB;AACZ,iBAAO;AACHqB,YAAAA,MAAM,EAAEA,MADL;AAEHiN,YAAAA,SAAS,EAAE/W,IAAI,CAACoP,gBAAL,CAAsBtF,MAAtB,EAA8B9J,IAAI,CAACmQ,WAAnC,CAFR;AAGH1H,YAAAA,UAAU,EAAEA;AAHT,WAAP;AAKH;AACJ;;AAED,aAAO,IAAP;AACH,KApiDQ;;AAsiDT;AACR;AACA;AACA;AACA;AACQuI,IAAAA,eAAe,EAAE,yBAAUvR,OAAV,EAAmBgJ,UAAnB,EAA+B;AAC5C,UAAIzI,IAAI,CAACkZ,qBAAL,CAA2BlZ,IAAI,CAACoP,gBAAL,CAAsB3P,OAAtB,EAA+BO,IAAI,CAACmQ,WAApC,CAA3B,KAAgFnQ,IAAI,CAACkZ,qBAAL,CAA2BzZ,OAA3B,CAApF,EAAyH,OAAO,KAAP;AACzH,UAAI,CAAC,KAAKqD,QAAV,EAAoB,KAAKwM,KAAL;AACpB,UAAM6J,MAAM,GAAG,KAAK/Z,OAAL,CAAaqJ,UAAb,CAAf;AACA,UAAI,CAAC0Q,MAAL,EAAa;;AACbtZ,MAAAA,EAAE,CAACuZ,UAAH,CAAc,YAAY;AACtB,YAAI,OAAOD,MAAM,CAACE,MAAd,KAAyB,UAA7B,EAAyC,KAAK7Q,UAAL,CAAgBC,UAAhB,EAA4B0Q,MAAM,CAACE,MAAP,CAAc/O,IAAd,CAAmB,IAAnB,EAAyB7K,OAAzB,CAA5B,EAA+D,IAA/D;;AACzC,aAAK6Z,wBAAL,CAA8B7Z,OAA9B;AACH,OAHa,CAGZ6K,IAHY,CAGP,IAHO,CAAd;AAIH,KApjDQ;;AAsjDT;AACR;AACA;AACA;AACA;AACQgP,IAAAA,wBAAwB,EAAE,kCAAU7Z,OAAV,EAAmB;AACzC;AACA,WAAKwE,YAAL,CAAkBqC,KAAlB,CAAwBqE,OAAxB,GAAkC,MAAlC;AACA,UAAMjJ,SAAS,GAAG1B,IAAI,CAACoP,gBAAL,CAAsB3P,OAAtB,EAA+BO,IAAI,CAACmQ,WAApC,CAAlB;AACA,UAAMoJ,OAAO,GAAGra,OAAO,CAACO,OAAR,CAAgBqO,aAAhB,CAA8BxH,KAA9C;AACA,UAAMkT,OAAO,GAAGta,OAAO,CAACO,OAAR,CAAgBsO,aAAhB,CAA8BzH,KAA9C;AACA,UAAMwD,MAAM,GAAG,KAAK5K,OAAL,CAAaua,QAAb,CAAsBC,eAAtB,CAAsCpT,KAAtC,CAA4CqE,OAA5C,KAAwD,OAAxD,GAAkE,KAAKzL,OAAL,CAAaua,QAAb,CAAsBC,eAAxF,GAA0Gja,OAAzH;AAEA,UAAMka,MAAM,GAAG3Z,IAAI,CAACuW,UAAL,CAAgB7U,SAAS,CAACsT,UAA1B,CAAf;AACA,UAAI4E,YAAJ,EAAkBC,OAAlB,EAA2BC,CAA3B,CATyC,CAUzC;;AACA,UAAIH,MAAM,GAAG,CAACjY,SAAS,CAAC2T,eAAd,GAAgC,CAACrV,IAAI,CAACkQ,eAAL,CAAqBxO,SAAS,CAAC0T,sBAA/B,CAA3C,EAAmG;AAC/F,aAAKzP,SAAL,CAAe4B,cAAf,GAAgC7F,SAAhC;AACAmY,QAAAA,OAAO,GAAG3a,OAAO,CAACO,OAAR,CAAgB8P,OAAhB,CAAwB7F,SAAlC;AACAkQ,QAAAA,YAAY,GAAG5Z,IAAI,CAACsO,SAAL,CAAe7O,OAAf,EAAwBP,OAAO,CAACO,OAAR,CAAgB4G,YAAxC,EAAsD1C,GAAtD,GAA4DkW,OAA3E;AACAC,QAAAA,CAAC,GAAIhQ,MAAM,CAAC2B,WAAP,GAAqB,CAAtB,GAA2B,CAA/B;AAEA8N,QAAAA,OAAO,CAAC5V,GAAR,GAAeiW,YAAY,GAAGC,OAAf,GAAyB,EAA1B,GAAgC,IAA9C;AACAN,QAAAA,OAAO,CAAC1P,IAAR,GAAgB7J,IAAI,CAACsO,SAAL,CAAexE,MAAf,EAAuBD,IAAvB,GAA8BiQ,CAA/B,GAAoC,IAAnD;AACAP,QAAAA,OAAO,CAAC5O,OAAR,GAAkB,OAAlB;AACH,OATD,MASO;AACH4O,QAAAA,OAAO,CAAC5O,OAAR,GAAkB,MAAlB;AACH,OAtBwC,CAuBzC;;;AACA,UAAIgP,MAAM,GAAG,CAACjY,SAAS,CAACkT,WAAd,GAA4B,CAAC5U,IAAI,CAACkQ,eAAL,CAAqBxO,SAAS,CAACoS,kBAA/B,CAAvC,EAA2F;AACvF,YAAI,CAAC8F,YAAL,EAAmB;AACf,eAAKjU,SAAL,CAAe4B,cAAf,GAAgC7F,SAAhC;AACAmY,UAAAA,OAAO,GAAG3a,OAAO,CAACO,OAAR,CAAgB8P,OAAhB,CAAwB7F,SAAlC;AACAkQ,UAAAA,YAAY,GAAG5Z,IAAI,CAACsO,SAAL,CAAe7O,OAAf,EAAwBP,OAAO,CAACO,OAAR,CAAgB4G,YAAxC,EAAsD1C,GAAtD,GAA4DkW,OAA3E;AACAC,UAAAA,CAAC,GAAIhQ,MAAM,CAAC2B,WAAP,GAAqB,CAAtB,GAA2B,CAA/B;AACH;;AAED+N,QAAAA,OAAO,CAAC7V,GAAR,GAAeiW,YAAY,GAAG9P,MAAM,CAACyC,YAAtB,GAAqCsN,OAArC,GAA+C,EAAhD,GAAsD,IAApE;AACAL,QAAAA,OAAO,CAAC3P,IAAR,GAAgB7J,IAAI,CAACsO,SAAL,CAAexE,MAAf,EAAuBD,IAAvB,GAA8BC,MAAM,CAAC2B,WAArC,GAAmDqO,CAAnD,GAAuD,EAAxD,GAA8D,IAA7E;AACAN,QAAAA,OAAO,CAAC7O,OAAR,GAAkB,OAAlB;AACH,OAXD,MAWO;AACH6O,QAAAA,OAAO,CAAC7O,OAAR,GAAkB,MAAlB;AACH;AACJ,KAjmDQ;;AAmmDT;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQ+N,IAAAA,UAAU,EAAE,oBAAUF,KAAV,EAAiBuB,SAAjB,EAA4B3B,cAA5B,EAA4C;AACpD,UAAI,KAAKpV,UAAL,IAAoBoV,cAAc,IAAI,CAAC,KAAKA,cAAL,CAAoBI,KAApB,EAA2B,IAA3B,CAA3C,EAA8E;AAC1E,eAAO,IAAP;AACH;;AAED,UAAI/I,KAAK,GAAG,KAAKC,QAAL,EAAZ;AACA,UAAI+G,IAAI,GAAGzW,IAAI,CAACuW,UAAL,CAAgB9G,KAAK,CAACM,uBAAtB,IAAiDN,KAAK,CAACM,uBAAvD,GAAiF/P,IAAI,CAAC6U,gBAAL,CAAsB,KAAKxF,gBAAL,EAAtB,EAA+C,IAA/C,CAA5F;AACA,UAAI2K,cAAc,GAAGha,IAAI,CAACuW,UAAL,CAAgBE,IAAhB,MAA0BzW,IAAI,CAACuW,UAAL,CAAgBiC,KAAhB,KAA0BxY,IAAI,CAAC2Z,MAAL,CAAYnB,KAAZ,CAApD,CAArB;AAEA,UAAIxD,UAAJ;AAAA,UAAgBiF,WAAhB;AAAA,UAA6BC,aAA7B;AAAA,UAA4CC,cAAc,GAAG,IAA7D;AACA,UAAMC,UAAU,GAAGpa,IAAI,CAAC+X,mBAAL,CAAyBtB,IAAzB,CAAnB;AACA,UAAM4D,SAAS,GAAI,CAACD,UAAD,KAAgBpa,IAAI,CAACkQ,eAAL,CAAqBsI,KAArB,KAA+BxY,IAAI,CAAC6V,oBAAL,CAA0B2C,KAA1B,CAA/C,CAAD,IAAsFxY,IAAI,CAACmQ,WAAL,CAAiBqI,KAAjB,CAAxG;;AAEA,UAAIwB,cAAJ,EAAoB;AAChBE,QAAAA,aAAa,GAAGH,SAAS,IAAI/Z,IAAI,CAAC2Z,MAAL,CAAYnB,KAAZ,CAAb,GAAkC/B,IAAI,CAAChC,SAAvC,GAAmDgC,IAAI,CAAC3C,kBAAxE;AACAqG,QAAAA,cAAc,GAAGna,IAAI,CAAC2Z,MAAL,CAAYnB,KAAZ,IAAqB/B,IAArB,GAA4B,CAACyD,aAAa,IAAIzD,IAAlB,EAAwBzB,UAArE;AACH;;AAED,UAAI,CAAC+E,SAAD,KAAeM,SAAS,IAAIra,IAAI,CAACmQ,WAAL,CAAiBqI,KAAjB,CAAb,IAAwCxY,IAAI,CAACsa,OAAL,CAAa9B,KAAb,CAAvD,CAAJ,EAAiF;AAC7E,YAAM+B,MAAM,GAAG,KAAKrD,WAAL,CAAiBzH,KAAK,CAACG,YAAvB,EAAqCH,KAAK,CAACgB,SAA3C,EAAsD,KAAtD,CAAf;AACA,YAAM6H,CAAC,GAAG,KAAKC,UAAL,EAAV;AACA,YAAM7W,SAAS,GAAG4W,CAAC,CAAC5W,SAApB;AACA,YAAM8Y,aAAa,GAAI9Y,SAAS,KAAK4W,CAAC,CAACkC,aAAhB,IAAiC/K,KAAK,CAACgD,SAAxC,GAAqD,IAArD,GAA4D6F,CAAC,CAACkC,aAApF;;AAEA,YAAIR,cAAc,IAAIQ,aAAtB,EAAqC;AACjCL,UAAAA,cAAc,GAAGK,aAAa,CAACpJ,QAAd,KAA2B,CAA3B,GAA+BoJ,aAAa,CAACxF,UAA7C,GAA0DwF,aAA3E;;AACA,cAAIL,cAAc,CAACzM,QAAf,CAAwBhM,SAAxB,CAAJ,EAAwC;AACpC,gBAAI+Y,UAAU,GAAG,IAAjB;AACAP,YAAAA,aAAa,GAAGxY,SAAhB;;AACA,mBAAOwY,aAAa,CAAClF,UAAd,IAA4BkF,aAAa,CAAClF,UAAd,KAA6BmF,cAAhE,EAAgF;AAC5ED,cAAAA,aAAa,GAAGA,aAAa,CAAClF,UAA9B;AACAyF,cAAAA,UAAU,GAAG,KAAb;AACH;;AACD,gBAAIA,UAAU,IAAI/Y,SAAS,KAAK8Y,aAAhC,EAA+CN,aAAa,GAAGA,aAAa,CAACtF,WAA9B;AAClD,WARD,MAQO;AACHsF,YAAAA,aAAa,GAAG,IAAhB;AACH;AACJ,SAbD,MAaO,IAAIF,cAAc,IAAIha,IAAI,CAACuW,UAAL,CAAgB7U,SAAhB,CAAlB,IAAgD,CAAC+U,IAAI,CAACpO,aAA1D,EAAyE;AAC5EoO,UAAAA,IAAI,GAAGzW,IAAI,CAACoQ,aAAL,CAAmB,IAAnB,CAAP;AACA+J,UAAAA,cAAc,CAACnQ,WAAf,CAA2ByM,IAA3B;AACA/U,UAAAA,SAAS,CAACsI,WAAV,CAAsBmQ,cAAtB;AACAD,UAAAA,aAAa,GAAG,IAAhB;AACH,SALM,MAKA,IAAIxY,SAAS,CAAC0P,QAAV,KAAuB,CAAvB,IAA4BpR,IAAI,CAAC0U,OAAL,CAAahT,SAAb,CAA5B,IAAuDsY,cAA3D,EAA2E;AAC9E,cAAMrB,WAAW,GAAG3Y,IAAI,CAACoP,gBAAL,CAAsB1N,SAAtB,EAAiC,UAAUwP,OAAV,EAAmB;AAAE,mBAAO,KAAK2E,oBAAL,CAA0B3E,OAA1B,KAAsC,KAAKqF,UAAL,CAAgBrF,OAAhB,CAA7C;AAAwE,WAA7F,CAA8F5G,IAA9F,CAAmGtK,IAAnG,CAAjC,CAApB;AACA+Z,UAAAA,SAAS,GAAG/Z,IAAI,CAAC4Y,YAAL,CAAkBlX,SAAlB,EAA6B4W,CAAC,CAACjK,MAA/B,EAAuC,CAACsK,WAAD,GAAe,CAAf,GAAmB3Y,IAAI,CAAC6Y,eAAL,CAAqBF,WAArB,IAAoC,CAA9F,CAAZ;;AACA,cAAIoB,SAAJ,EAAe;AACX,gBAAIC,cAAJ,EAAoB;AAChB,kBAAIvD,IAAI,CAAC/I,QAAL,CAAchM,SAAd,CAAJ,EAA8B;AAC1B,oBAAMgZ,OAAO,GAAG1a,IAAI,CAAC2Z,MAAL,CAAYlD,IAAI,CAAC3F,gBAAjB,CAAhB;AACA,oBAAI6J,OAAO,GAAG,IAAd;;AACA,oBAAI,CAACJ,MAAL,EAAa;AACTI,kBAAAA,OAAO,GAAGlE,IAAI,CAACc,SAAL,CAAe,KAAf,CAAV;AACAoD,kBAAAA,OAAO,CAAC3Q,WAAR,CAAoB+P,SAAS,CAAC1I,WAAV,CAAsBoE,IAAtB,KAA+BsE,SAA/B,GAA2C/Z,IAAI,CAACkV,cAAL,CAAoBlV,IAAI,CAACmV,cAAzB,CAA/D;AACH;;AACD,oBAAIuF,OAAJ,EAAa;AACT,sBAAI,CAACC,OAAL,EAAc;AACVA,oBAAAA,OAAO,GAAGlE,IAAI,CAACc,SAAL,CAAe,KAAf,CAAV;AACAoD,oBAAAA,OAAO,CAAC3Q,WAAR,CAAoBhK,IAAI,CAACkV,cAAL,CAAoBlV,IAAI,CAACmV,cAAzB,CAApB;AACH;;AACDwF,kBAAAA,OAAO,CAAC3Q,WAAR,CAAoByM,IAAI,CAAC3F,gBAAzB;AACH;;AACD,oBAAI6J,OAAJ,EAAa;AACTlE,kBAAAA,IAAI,CAACzB,UAAL,CAAgBzE,YAAhB,CAA6BoK,OAA7B,EAAsClE,IAAI,CAAC3C,kBAA3C;AACAoG,kBAAAA,aAAa,GAAGH,SAAS,GAAGY,OAA5B;AACH;AACJ;AACJ,aApBD,MAoBO;AACHZ,cAAAA,SAAS,GAAGA,SAAS,CAAC1E,eAAtB;AACH;AACJ;AACJ;AACJ;;AAED5F,MAAAA,KAAK,GAAI,CAACsK,SAAD,IAAc,CAACM,SAAhB,GAA6B,KAAK3G,gBAAL,CAAsB,KAAKhE,QAAL,EAAtB,EAAuC,IAAvC,CAA7B,GAA4E,KAAKA,QAAL,EAApF;AACA,UAAMgG,SAAS,GAAGjG,KAAK,CAACM,uBAAxB;AACA,UAAMyB,QAAQ,GAAG/B,KAAK,CAACQ,WAAvB;AACA,UAAMyB,MAAM,GAAGjC,KAAK,CAACgB,SAArB;AACA,UAAMmK,WAAW,GAAGnL,KAAK,CAACE,cAAN,KAAyB+F,SAAzB,IAAsC1V,IAAI,CAACkQ,eAAL,CAAqBwF,SAArB,CAA1D;AACA,UAAMnE,QAAQ,GAAGqJ,WAAW,GAAIlF,SAAS,CAACvE,UAAV,CAAqBK,QAArB,KAAkCkE,SAAS,CAACvE,UAAV,CAAqB,CAArB,CAAlC,IAA6D1B,KAAK,CAACE,cAAvE,GAAyFF,KAAK,CAACE,cAA3H;AACA,UAAM8B,MAAM,GAAGmJ,WAAW,GAAIlF,SAAS,CAACvE,UAAV,CAAqBO,MAArB,KAAgCgE,SAAS,CAACvE,UAAV,CAAqBuE,SAAS,CAACvE,UAAV,CAAqBnJ,MAArB,GAA8B,CAAnD,CAAhC,IAAyFyH,KAAK,CAACG,YAAnG,GAAmHH,KAAK,CAACG,YAAnJ;;AAEA,UAAI,CAACoK,cAAL,EAAqB;AACjB,YAAI,CAACD,SAAL,EAAgB;AACZ/E,UAAAA,UAAU,GAAGzD,QAAb;;AACA,cAAIA,QAAQ,CAACH,QAAT,KAAsB,CAA1B,EAA6B;AACzB4D,YAAAA,UAAU,GAAGzD,QAAQ,CAACyD,UAAtB;AACH;AAED;;;AACA,cAAIvF,KAAK,CAACgD,SAAV,EAAqB;AACjB,gBAAIiD,SAAS,CAACtE,QAAV,KAAuB,CAA3B,EAA8B;AAC1B,kBAAIsE,SAAS,CAACrE,WAAV,CAAsBrJ,MAAtB,GAA+B0J,MAAnC,EAA2CqI,SAAS,GAAGrE,SAAS,CAACmF,SAAV,CAAoBnJ,MAApB,CAAZ,CAA3C,KACKqI,SAAS,GAAGrE,SAAS,CAACd,WAAtB;AACR,aAHD,MAGO;AACH,kBAAI,CAAC5U,IAAI,CAAC0U,OAAL,CAAaM,UAAb,CAAL,EAA+B;AAC3B,oBAAI8F,CAAC,GAAG9F,UAAU,CAAC7D,UAAX,CAAsBK,QAAtB,CAAR;AACA,oBAAMmB,SAAS,GAAImI,CAAC,IAAIA,CAAC,CAAC1J,QAAF,KAAe,CAApB,IAAyBpR,IAAI,CAAC8Y,kBAAL,CAAwBgC,CAAxB,CAAzB,IAAuD9a,IAAI,CAAC0U,OAAL,CAAaoG,CAAC,CAAClG,WAAf,CAAxD,GAAuFkG,CAAC,CAAClG,WAAzF,GAAuGkG,CAAzH;;AACA,oBAAInI,SAAJ,EAAe;AACX,sBAAI,CAACA,SAAS,CAACiC,WAAf,EAA4B;AACxBI,oBAAAA,UAAU,CAAC+F,WAAX,CAAuBpI,SAAvB;AACAoH,oBAAAA,SAAS,GAAG,IAAZ;AACH,mBAHD,MAGO;AACHA,oBAAAA,SAAS,GAAI/Z,IAAI,CAAC0U,OAAL,CAAa/B,SAAb,KAA2B,CAAC3S,IAAI,CAAC0U,OAAL,CAAa8D,KAAb,CAA7B,GAAoD7F,SAApD,GAAgEA,SAAS,CAACiC,WAAtF;AACH;AACJ,iBAPD,MAOO;AACHmF,kBAAAA,SAAS,GAAG,IAAZ;AACH;AACJ,eAbD,MAaO;AACHA,gBAAAA,SAAS,GAAG/E,UAAZ;AACAA,gBAAAA,UAAU,GAAGA,UAAU,CAACA,UAAxB;AACH;AACJ;AACJ,WAvBD,MAuBO;AAAE;AACL,gBAAMgG,eAAe,GAAGzJ,QAAQ,KAAKE,MAArC;;AAEA,gBAAIuJ,eAAJ,EAAqB;AACjB,kBAAI,KAAK9D,WAAL,CAAiBzF,MAAjB,EAAyBC,MAAzB,CAAJ,EAAsCqI,SAAS,GAAGtI,MAAM,CAACmD,WAAnB,CAAtC,KACKmF,SAAS,GAAGtI,MAAM,CAACoJ,SAAP,CAAiBnJ,MAAjB,CAAZ;AAEL,kBAAI6G,UAAU,GAAGhH,QAAjB;AACA,kBAAI,CAAC,KAAK2F,WAAL,CAAiB3F,QAAjB,EAA2BC,QAA3B,CAAL,EAA2C+G,UAAU,GAAGhH,QAAQ,CAACsJ,SAAT,CAAmBrJ,QAAnB,CAAb;AAE3CwD,cAAAA,UAAU,CAAC+F,WAAX,CAAuBxC,UAAvB;;AACA,kBAAIvD,UAAU,CAAC7D,UAAX,CAAsBnJ,MAAtB,KAAiC,CAAjC,IAAsCqS,SAA1C,EAAqD;AACjDrF,gBAAAA,UAAU,CAACnB,SAAX,GAAuB,MAAvB;AACH;AACJ,aAXD,MAYK;AACD,kBAAMoH,UAAU,GAAG,KAAK1C,UAAL,EAAnB;AACA,kBAAM7W,UAAS,GAAGuZ,UAAU,CAACvZ,SAA7B;AACA,kBAAM8Y,cAAa,GAAGS,UAAU,CAACT,aAAjC;;AAEA,kBAAI9Y,UAAS,IAAIA,UAAS,CAACyP,UAAV,CAAqBnJ,MAArB,KAAgC,CAA7C,IAAkDqS,SAAtD,EAAiE;AAC7D,oBAAIra,IAAI,CAACkQ,eAAL,CAAqBxO,UAArB,CAAJ,EAAqC;AACjCA,kBAAAA,UAAS,CAACmS,SAAV,GAAsB,MAAtB;AACH,iBAFD,MAEO,IAAI7T,IAAI,CAAC6V,oBAAL,CAA0BnU,UAA1B,CAAJ,EAA0C;AAC7CA,kBAAAA,UAAS,CAACmS,SAAV,GAAsB,MAAMvU,OAAO,CAAC+Q,UAAd,GAA2B,SAA3B,GAAuC/Q,OAAO,CAAC+Q,UAA/C,GAA4D,GAAlF;AACH;AACJ;;AAED,kBAAIrQ,IAAI,CAACuW,UAAL,CAAgB7U,UAAhB,KAA8B8W,KAAK,CAACpH,QAAN,KAAmB,CAArD,EAAwD;AACpD4D,gBAAAA,UAAU,GAAGtT,UAAb;AACAqY,gBAAAA,SAAS,GAAG,IAAZ;AACH,eAHD,MAGO,IAAI,CAACM,SAAD,IAAcG,cAAlB,EAAiC;AACpCxF,gBAAAA,UAAU,GAAGwF,cAAa,CAACpJ,QAAd,KAA2B,CAA3B,GAA+BoJ,cAAa,CAACxF,UAA7C,GAA0DwF,cAAvE;;AACA,oBAAIxF,UAAU,CAACtH,QAAX,CAAoBhM,UAApB,CAAJ,EAAoC;AAChC,sBAAI+Y,WAAU,GAAG,IAAjB;AACAV,kBAAAA,SAAS,GAAGrY,UAAZ;;AACA,yBAAOqY,SAAS,CAAC/E,UAAV,IAAwB+E,SAAS,CAAC/E,UAAV,KAAyBA,UAAxD,EAAoE;AAChE+E,oBAAAA,SAAS,GAAGA,SAAS,CAAC/E,UAAtB;AACAyF,oBAAAA,WAAU,GAAG,KAAb;AACH;;AACD,sBAAIA,WAAU,IAAI/Y,UAAS,KAAK8Y,cAAhC,EAA+CT,SAAS,GAAGA,SAAS,CAACnF,WAAtB;AAClD,iBARD,MAQO;AACHmF,kBAAAA,SAAS,GAAG,IAAZ;AACH;AACJ,eAbM,MAaA;AACHA,gBAAAA,SAAS,GAAGM,SAAS,GAAG5I,MAAH,GAAY/P,UAAS,KAAK8Y,cAAd,GAA8B9Y,UAAS,CAACkT,WAAxC,GAAsDlT,UAAvF;AACAsT,gBAAAA,UAAU,GAAI,CAAC+E,SAAD,IAAc,CAACA,SAAS,CAAC/E,UAA1B,GAAwCU,SAAxC,GAAoDqE,SAAS,CAAC/E,UAA3E;AACH;;AAED,qBAAO+E,SAAS,IAAI,CAAC/Z,IAAI,CAACkQ,eAAL,CAAqB6J,SAArB,CAAd,IAAiDA,SAAS,CAAC/E,UAAV,KAAyBU,SAAjF,EAA4F;AACxFqE,gBAAAA,SAAS,GAAGA,SAAS,CAAC/E,UAAtB;AACH;AACJ;AACJ;AACJ,SApFD,MAoFO;AAAE;AACLA,UAAAA,UAAU,GAAG+E,SAAS,CAAC/E,UAAvB;AACA+E,UAAAA,SAAS,GAAGA,SAAS,CAACnF,WAAtB;AACAqF,UAAAA,WAAW,GAAG,IAAd;AACH;AACJ;;AAED,UAAI;AACA;AACA,YAAI,CAACD,cAAL,EAAqB;AACjB,cAAIha,IAAI,CAAC6P,YAAL,CAAkBkK,SAAlB,KAAgC/E,UAAU,KAAK9V,OAAO,CAACO,OAAR,CAAgB8P,OAAhB,CAAwByF,UAA3E,EAAuF;AACnFA,YAAAA,UAAU,GAAG9V,OAAO,CAACO,OAAR,CAAgB8P,OAA7B;AACAwK,YAAAA,SAAS,GAAG,IAAZ;AACH;;AAED,cAAI/Z,IAAI,CAACkQ,eAAL,CAAqBsI,KAArB,KAA+BxY,IAAI,CAAC6V,oBAAL,CAA0B2C,KAA1B,CAA/B,IAAoE,CAACxY,IAAI,CAACuW,UAAL,CAAgBvB,UAAhB,CAAD,IAAgChV,IAAI,CAACmQ,WAAL,CAAiBqI,KAAjB,CAAxG,EAAkI;AAC9H,gBAAM0C,SAAS,GAAGlG,UAAlB;;AACA,gBAAIhV,IAAI,CAAC2Z,MAAL,CAAYI,SAAZ,CAAJ,EAA4B;AACxB/E,cAAAA,UAAU,GAAG+E,SAAb;AACAA,cAAAA,SAAS,GAAG,IAAZ;AACH,aAHD,MAGO,IAAI/Z,IAAI,CAACuW,UAAL,CAAgBwD,SAAhB,CAAJ,EAAgC;AACnC/E,cAAAA,UAAU,GAAG+E,SAAS,CAAC3E,sBAAV,IAAoC2E,SAAjD;AACH,aAFM,MAEA,IAAI,CAACE,WAAD,IAAgB,CAACF,SAArB,EAAgC;AACnC,kBAAMzB,EAAC,GAAG,KAAKC,UAAL,EAAV;;AACA,kBAAM7W,WAAS,GAAG4W,EAAC,CAAC5W,SAAF,CAAY0P,QAAZ,KAAyB,CAAzB,GAA8BpR,IAAI,CAACuW,UAAL,CAAgBvW,IAAI,CAAC6U,gBAAL,CAAsByD,EAAC,CAAC5W,SAAxB,EAAmC,IAAnC,CAAhB,IAA4D4W,EAAC,CAAC5W,SAA9D,GAA2E1B,IAAI,CAAC6U,gBAAL,CAAsByD,EAAC,CAAC5W,SAAxB,EAAmC,IAAnC,KAA4C4W,EAAC,CAAC5W,SAAF,CAAYsT,UAAjK,GAAgLsD,EAAC,CAAC5W,SAApM;;AACA,kBAAMyZ,QAAQ,GAAGnb,IAAI,CAAC6P,YAAL,CAAkBnO,WAAlB,KAAgC1B,IAAI,CAAC6V,oBAAL,CAA0BnU,WAA1B,CAAjD;AACAsT,cAAAA,UAAU,GAAGmG,QAAQ,GAAGzZ,WAAH,GAAeA,WAAS,CAACsT,UAA9C;AACA+E,cAAAA,SAAS,GAAGoB,QAAQ,GAAG,IAAH,GAAUzZ,WAAS,CAACkT,WAAxC;AACH;;AAED,gBAAIsG,SAAS,CAAC/J,UAAV,CAAqBnJ,MAArB,KAAgC,CAAhC,IAAqCgN,UAAU,KAAKkG,SAAxD,EAAmElb,IAAI,CAACsV,UAAL,CAAgB4F,SAAhB;AACtE;;AAED,cAAIb,SAAS,IAAI,CAACD,UAAd,IAA4B,CAACpa,IAAI,CAAC6V,oBAAL,CAA0Bb,UAA1B,CAA7B,IAAsE,CAAChV,IAAI,CAACuW,UAAL,CAAgBvB,UAAhB,CAAvE,IAAsG,CAAChV,IAAI,CAAC6P,YAAL,CAAkBmF,UAAlB,CAA3G,EAA0I;AACtI+E,YAAAA,SAAS,GAAG/E,UAAU,CAAClB,kBAAvB;AACAkB,YAAAA,UAAU,GAAGA,UAAU,CAACA,UAAxB;AACH;;AAED,cAAIhV,IAAI,CAAC6P,YAAL,CAAkBmF,UAAlB,MAAkCwD,KAAK,CAACpH,QAAN,KAAmB,CAAnB,IAAwBpR,IAAI,CAAC0U,OAAL,CAAa8D,KAAb,CAA1D,CAAJ,EAAoF;AAChF,gBAAM4C,KAAK,GAAGpb,IAAI,CAACoQ,aAAL,CAAmB9Q,OAAO,CAAC+Q,UAA3B,CAAd;AACA+K,YAAAA,KAAK,CAACpR,WAAN,CAAkBwO,KAAlB;AACAA,YAAAA,KAAK,GAAG4C,KAAR;AACH;AACJ,SApCD,CAsCA;;;AACA,YAAIpB,cAAJ,EAAoB;AAChB,cAAI,CAACG,cAAc,CAACnF,UAApB,EAAgC;AAC5BA,YAAAA,UAAU,GAAG9V,OAAO,CAACO,OAAR,CAAgB8P,OAA7B;AACAwK,YAAAA,SAAS,GAAG,IAAZ;AACH,WAHD,MAGO;AACH/E,YAAAA,UAAU,GAAGmF,cAAb;AACAJ,YAAAA,SAAS,GAAGG,aAAZ;AACH;AACJ,SARD,MAQO;AACHH,UAAAA,SAAS,GAAG/E,UAAU,KAAK+E,SAAf,GAA2B/E,UAAU,CAACP,SAAtC,GAAkDsF,SAA9D;AACH;;AAED,YAAI/Z,IAAI,CAACuW,UAAL,CAAgBiC,KAAhB,KAA0B,CAACxY,IAAI,CAAC2Z,MAAL,CAAY3E,UAAZ,CAA/B,EAAwD;AACpD,cAAIhV,IAAI,CAACuW,UAAL,CAAgBvB,UAAhB,CAAJ,EAAiC;AAC7B+E,YAAAA,SAAS,GAAG/E,UAAU,CAAClB,kBAAvB;AACAkB,YAAAA,UAAU,GAAGA,UAAU,CAACA,UAAxB;AACH,WAHD,MAGO;AACH,gBAAMqG,EAAE,GAAGrb,IAAI,CAACoQ,aAAL,CAAmB,IAAnB,CAAX;AACA4E,YAAAA,UAAU,CAACzE,YAAX,CAAwB8K,EAAxB,EAA4BtB,SAA5B;AACA/E,YAAAA,UAAU,GAAGqG,EAAb;AACAtB,YAAAA,SAAS,GAAG,IAAZ;AACH;;AACDC,UAAAA,cAAc,GAAG,IAAjB;AACH;;AAEDhF,QAAAA,UAAU,CAACzE,YAAX,CAAwBiI,KAAxB,EAA+BuB,SAA/B;;AAEA,YAAIC,cAAJ,EAAoB;AAChB,cAAIha,IAAI,CAAC8Y,kBAAL,CAAwBrC,IAAI,CAACpF,WAAL,CAAiBoE,IAAjB,EAAxB,CAAJ,EAAsD;AAClDzV,YAAAA,IAAI,CAACsV,UAAL,CAAgBmB,IAAhB;AACA+B,YAAAA,KAAK,GAAGA,KAAK,CAAC/D,SAAd;AACH,WAHD,MAGO;AACH,gBAAM6G,MAAM,GAAGtb,IAAI,CAACub,YAAL,CAAkB9E,IAAI,CAACzG,QAAvB,EAAiChQ,IAAI,CAAC2Z,MAAtC,CAAf;;AACA,gBAAI2B,MAAJ,EAAY;AACR,kBAAI9C,KAAK,KAAK8C,MAAd,EAAsB;AAClB9C,gBAAAA,KAAK,CAACxO,WAAN,CAAkBsR,MAAlB;AACA9C,gBAAAA,KAAK,GAAG8C,MAAM,CAACjG,eAAf;AACH,eAHD,MAGO;AACHL,gBAAAA,UAAU,CAAChL,WAAX,CAAuBwO,KAAvB;AACAA,gBAAAA,KAAK,GAAGxD,UAAR;AACH;;AAED,kBAAIhV,IAAI,CAAC8Y,kBAAL,CAAwBrC,IAAI,CAACpF,WAAL,CAAiBoE,IAAjB,EAAxB,CAAJ,EAAsD;AAClDzV,gBAAAA,IAAI,CAACsV,UAAL,CAAgBmB,IAAhB;AACH;AACJ;AACJ;AACJ;AACJ,OAvFD,CAuFE,OAAOnJ,CAAP,EAAU;AACR0H,QAAAA,UAAU,CAAChL,WAAX,CAAuBwO,KAAvB;AACH,OAzFD,SAyFU;AACN,YAAI,CAACxY,IAAI,CAACkQ,eAAL,CAAqBsI,KAArB,KAA+BxY,IAAI,CAACmQ,WAAL,CAAiBqI,KAAjB,CAAhC,KAA4DjH,QAAQ,KAAKE,MAA7E,EAAqF;AACjF,cAAM+J,KAAK,GAAGxb,IAAI,CAAC6U,gBAAL,CAAsBa,SAAtB,EAAiC,IAAjC,CAAd;;AACA,cAAI8F,KAAK,IAAIA,KAAK,CAACpK,QAAN,KAAmB,CAA5B,IAAiCpR,IAAI,CAACyb,WAAL,CAAiBD,KAAjB,CAArC,EAA8D;AAC1Dxb,YAAAA,IAAI,CAACsV,UAAL,CAAgBkG,KAAhB;AACH;AACJ;;AAED,YAAIpB,UAAU,KAAKpa,IAAI,CAACkQ,eAAL,CAAqBsI,KAArB,KAA+BxY,IAAI,CAAC6V,oBAAL,CAA0B2C,KAA1B,CAApC,CAAd,EAAqF;AACjFA,UAAAA,KAAK,GAAG,KAAKkD,kBAAL,CAAwBlD,KAAxB,CAAR;AACH;;AAED,YAAI,CAACxY,IAAI,CAACmQ,WAAL,CAAiBqI,KAAjB,CAAL,EAA8B;AAC1B,cAAInK,MAAM,GAAG,CAAb;;AACA,cAAImK,KAAK,CAACpH,QAAN,KAAmB,CAAvB,EAA0B;AACtB,gBAAMuK,QAAQ,GAAGnD,KAAK,CAACnD,eAAvB;AACA,gBAAMuG,IAAI,GAAGpD,KAAK,CAAC5D,WAAnB;AACA,gBAAMiH,YAAY,GAAI,CAACF,QAAD,IAAcA,QAAQ,CAACvK,QAAT,KAAsB,CAApC,IAAyCpR,IAAI,CAAC8Y,kBAAL,CAAwB6C,QAAxB,CAA1C,GAA+E,EAA/E,GAAoFA,QAAQ,CAACtK,WAAlH;AACA,gBAAMyK,QAAQ,GAAI,CAACF,IAAD,IAASA,IAAI,CAACxK,QAAL,KAAkB,CAA3B,IAAgCpR,IAAI,CAAC8Y,kBAAL,CAAwB8C,IAAxB,CAAjC,GAAkE,EAAlE,GAAuEA,IAAI,CAACvK,WAA7F;;AAEA,gBAAIsK,QAAQ,IAAIE,YAAY,CAAC7T,MAAb,GAAsB,CAAtC,EAAyC;AACrCwQ,cAAAA,KAAK,CAACnH,WAAN,GAAoBwK,YAAY,GAAGrD,KAAK,CAACnH,WAAzC;AACArR,cAAAA,IAAI,CAACsV,UAAL,CAAgBqG,QAAhB;AACH;;AAED,gBAAIC,IAAI,IAAIA,IAAI,CAAC5T,MAAL,GAAc,CAA1B,EAA6B;AACzBwQ,cAAAA,KAAK,CAACnH,WAAN,IAAqByK,QAArB;AACA9b,cAAAA,IAAI,CAACsV,UAAL,CAAgBsG,IAAhB;AACH;;AAED,gBAAMG,QAAQ,GAAG;AACbra,cAAAA,SAAS,EAAE8W,KADE;AAEbvI,cAAAA,WAAW,EAAE4L,YAAY,CAAC7T,MAFb;AAGbyI,cAAAA,SAAS,EAAE+H,KAAK,CAACnH,WAAN,CAAkBrJ,MAAlB,GAA2B8T,QAAQ,CAAC9T;AAHlC,aAAjB;AAMA,iBAAKwI,QAAL,CAAcgI,KAAd,EAAqBuD,QAAQ,CAAC9L,WAA9B,EAA2CuI,KAA3C,EAAkDuD,QAAQ,CAACtL,SAA3D;AAEA,mBAAOsL,QAAP;AACH,WAzBD,MAyBO,IAAI,CAAC/b,IAAI,CAAC0U,OAAL,CAAa8D,KAAb,CAAD,IAAwB,CAACxY,IAAI,CAACuW,UAAL,CAAgBiC,KAAhB,CAAzB,IAAmDxY,IAAI,CAACkQ,eAAL,CAAqB8E,UAArB,CAAvD,EAAyF;AAC5F,gBAAIgH,SAAS,GAAG,IAAhB;;AACA,gBAAI,CAACxD,KAAK,CAACnD,eAAP,IAA0BrV,IAAI,CAAC0U,OAAL,CAAa8D,KAAK,CAACnD,eAAnB,CAA9B,EAAmE;AAC/D2G,cAAAA,SAAS,GAAGhc,IAAI,CAACkV,cAAL,CAAoBlV,IAAI,CAACmV,cAAzB,CAAZ;AACAqD,cAAAA,KAAK,CAACxD,UAAN,CAAiBzE,YAAjB,CAA8ByL,SAA9B,EAAyCxD,KAAzC;AACH;;AAED,gBAAI,CAACA,KAAK,CAAC5D,WAAP,IAAsB5U,IAAI,CAAC0U,OAAL,CAAa8D,KAAK,CAAC5D,WAAnB,CAA1B,EAA2D;AACvDoH,cAAAA,SAAS,GAAGhc,IAAI,CAACkV,cAAL,CAAoBlV,IAAI,CAACmV,cAAzB,CAAZ;AACAqD,cAAAA,KAAK,CAACxD,UAAN,CAAiBzE,YAAjB,CAA8ByL,SAA9B,EAAyCxD,KAAK,CAAC5D,WAA/C;AACH;;AAED,gBAAI5U,IAAI,CAACic,mBAAL,CAAyBzD,KAAzB,CAAJ,EAAqC;AACjCA,cAAAA,KAAK,GAAGA,KAAK,CAAC5D,WAAd;AACAvG,cAAAA,MAAM,GAAG,CAAT;AACH;AACJ;;AAED,eAAKmC,QAAL,CAAcgI,KAAd,EAAqBnK,MAArB,EAA6BmK,KAA7B,EAAoCnK,MAApC;AACH,SA1DK,CA4DN;;;AACA,aAAKjN,OAAL,CAAa4H,IAAb,CAAkB,IAAlB;AAEA,eAAOwP,KAAP;AACH;AACJ,KAn7DQ;AAq7DTkD,IAAAA,kBAAkB,EAAE,4BAAUlD,KAAV,EAAiB;AACjC,UAAMxD,UAAU,GAAGwD,KAAK,CAACxD,UAAzB;AACA,UAAIkH,aAAJ,EAAmBC,SAAnB;;AAEA,aAAOnc,IAAI,CAACkQ,eAAL,CAAqBsI,KAArB,KAA+BxY,IAAI,CAAC6V,oBAAL,CAA0B2C,KAA1B,CAAtC,EAAwE;AACpE0D,QAAAA,aAAa,GAAG1D,KAAK,CAACrH,UAAtB;AACAgL,QAAAA,SAAS,GAAG,IAAZ;;AAEA,eAAOD,aAAa,CAAC,CAAD,CAApB,EAAyB;AACrBC,UAAAA,SAAS,GAAGD,aAAa,CAAC,CAAD,CAAzB;;AACA,cAAIlc,IAAI,CAACkQ,eAAL,CAAqBiM,SAArB,KAAmCnc,IAAI,CAAC6V,oBAAL,CAA0BsG,SAA1B,CAAvC,EAA6E;AACzE,iBAAKT,kBAAL,CAAwBS,SAAxB;;AACA,gBAAI,CAAC3D,KAAK,CAACxD,UAAX,EAAuB;AACvBkH,YAAAA,aAAa,GAAG1D,KAAK,CAACrH,UAAtB;AACA;AACH;;AAED6D,UAAAA,UAAU,CAACzE,YAAX,CAAwB4L,SAAxB,EAAmC3D,KAAnC;AACH;;AAED,YAAIA,KAAK,CAACrH,UAAN,CAAiBnJ,MAAjB,KAA4B,CAAhC,EAAmChI,IAAI,CAACsV,UAAL,CAAgBkD,KAAhB;AACnCA,QAAAA,KAAK,GAAGxY,IAAI,CAACoQ,aAAL,CAAmB,IAAnB,CAAR;AACA4E,QAAAA,UAAU,CAACzE,YAAX,CAAwBiI,KAAxB,EAA+B2D,SAAS,CAACvH,WAAzC;AACH;;AAED,aAAO4D,KAAP;AACH,KA/8DQ;;AAi9DT;AACR;AACA;AACA;AACA;AACQD,IAAAA,UAAU,EAAE,sBAAY;AACpB,WAAKlE,qBAAL;;AAEA,UAAM5E,KAAK,GAAG,KAAKC,QAAL,EAAd;AACA,UAAIhO,SAAJ;AAAA,UAAe2M,MAAM,GAAG,CAAxB;AACA,UAAIkD,QAAQ,GAAG9B,KAAK,CAACE,cAArB;AACA,UAAI8B,MAAM,GAAGhC,KAAK,CAACG,YAAnB;AACA,UAAI4B,QAAQ,GAAG/B,KAAK,CAACQ,WAArB;AACA,UAAIyB,MAAM,GAAGjC,KAAK,CAACgB,SAAnB;AACA,UAAMiF,SAAS,GAAIjG,KAAK,CAACM,uBAAN,CAA8BqB,QAA9B,KAA2C,CAA3C,IAAgD3B,KAAK,CAACM,uBAAN,CAA8BiF,UAA9B,KAA6CzD,QAAQ,CAACyD,UAAvG,GAAqHzD,QAAQ,CAACyD,UAA9H,GAA2IvF,KAAK,CAACM,uBAAnK;;AACA,UAAI2F,SAAS,KAAKnE,QAAd,IAA0BmE,SAAS,KAAKjE,MAA5C,EAAoD;AAChDF,QAAAA,QAAQ,GAAGmE,SAAS,CAAC1F,QAAV,CAAmBwB,QAAnB,CAAX;AACAC,QAAAA,MAAM,GAAGiE,SAAS,CAAC1F,QAAV,CAAmB0B,MAAnB,CAAT;AACAF,QAAAA,QAAQ,GAAGE,MAAM,GAAG,CAApB;AACH;;AAED,UAAI0K,UAAU,GAAG,IAAjB;AACA,UAAIrC,SAAS,GAAG,IAAhB;AAEA,UAAM5I,UAAU,GAAGnR,IAAI,CAACqc,iBAAL,CAAuB3G,SAAvB,EAAkC,IAAlC,CAAnB;AACA,UAAI4G,UAAU,GAAGtc,IAAI,CAACuc,aAAL,CAAmBpL,UAAnB,EAA+BI,QAA/B,CAAjB;AACA,UAAIiL,QAAQ,GAAGxc,IAAI,CAACuc,aAAL,CAAmBpL,UAAnB,EAA+BM,MAA/B,CAAf;;AAEA,UAAIN,UAAU,CAACnJ,MAAX,GAAoB,CAApB,IAAyBsU,UAAU,GAAG,CAAC,CAAvC,IAA4CE,QAAQ,GAAG,CAAC,CAA5D,EAA+D;AAC3D,aAAK,IAAI1U,CAAC,GAAGwU,UAAU,GAAG,CAArB,EAAwBG,SAAS,GAAGlL,QAAzC,EAAmDzJ,CAAC,IAAI,CAAxD,EAA2DA,CAAC,EAA5D,EAAgE;AAC5D,cAAIqJ,UAAU,CAACrJ,CAAD,CAAV,KAAkB2U,SAAS,CAACzH,UAA5B,IAA0C7D,UAAU,CAACrJ,CAAD,CAAV,CAAckM,UAAd,KAA6ByI,SAAvE,IAAoFjL,QAAQ,KAAK,CAArG,EAAwG;AACpG8K,YAAAA,UAAU,GAAGxU,CAAb;AACA2U,YAAAA,SAAS,GAAGA,SAAS,CAACzH,UAAtB;AACH;AACJ;;AAED,aAAK,IAAIlN,GAAC,GAAG0U,QAAQ,GAAG,CAAnB,EAAsBE,OAAO,GAAGjL,MAArC,EAA6C3J,GAAC,GAAGwU,UAAjD,EAA6DxU,GAAC,EAA9D,EAAkE;AAC9D,cAAIqJ,UAAU,CAACrJ,GAAD,CAAV,KAAkB4U,OAAO,CAAC1H,UAA1B,IAAwC7D,UAAU,CAACrJ,GAAD,CAAV,CAAcsJ,QAAd,KAA2B,CAAvE,EAA0E;AACtED,YAAAA,UAAU,CAAC8F,MAAX,CAAkBnP,GAAlB,EAAqB,CAArB;AACA4U,YAAAA,OAAO,GAAGA,OAAO,CAAC1H,UAAlB;AACA,cAAEwH,QAAF;AACH;AACJ;AACJ,OAfD,MAeO;AACH,YAAIrL,UAAU,CAACnJ,MAAX,KAAsB,CAA1B,EAA6B;AACzB,cAAIhI,IAAI,CAACkQ,eAAL,CAAqBwF,SAArB,KAAmC1V,IAAI,CAAC6V,oBAAL,CAA0BH,SAA1B,CAAnC,IAA2E1V,IAAI,CAAC6P,YAAL,CAAkB6F,SAAlB,CAA3E,IAA2G1V,IAAI,CAAC0U,OAAL,CAAagB,SAAb,CAA3G,IAAsI1V,IAAI,CAACsa,OAAL,CAAa5E,SAAb,CAA1I,EAAmK;AAC/J,mBAAO;AACHhU,cAAAA,SAAS,EAAEgU,SADR;AAEHrH,cAAAA,MAAM,EAAE;AAFL,aAAP;AAIH,WALD,MAKO,IAAIqH,SAAS,CAACtE,QAAV,KAAuB,CAA3B,EAA8B;AACjC,mBAAO;AACH1P,cAAAA,SAAS,EAAEgU,SADR;AAEHrH,cAAAA,MAAM,EAAEqD;AAFL,aAAP;AAIH;;AACDP,UAAAA,UAAU,CAACnI,IAAX,CAAgB0M,SAAhB;AACAnE,UAAAA,QAAQ,GAAGE,MAAM,GAAGiE,SAApB;AACH,SAdD,MAcO;AACHnE,UAAAA,QAAQ,GAAGE,MAAM,GAAGN,UAAU,CAAC,CAAD,CAA9B;;AACA,cAAInR,IAAI,CAAC0U,OAAL,CAAanD,QAAb,KAA0BvR,IAAI,CAAC8Y,kBAAL,CAAwBvH,QAAxB,CAA9B,EAAiE;AAC7D,mBAAO;AACH7P,cAAAA,SAAS,EAAE1B,IAAI,CAACsa,OAAL,CAAa5E,SAAb,IAA0BA,SAA1B,GAAsCnE,QAD9C;AAEHlD,cAAAA,MAAM,EAAE;AAFL,aAAP;AAIH;AACJ;;AAEDiO,QAAAA,UAAU,GAAGE,QAAQ,GAAG,CAAxB;AACH;;AAED,WAAK,IAAI1U,GAAC,GAAGwU,UAAb,EAAyBxU,GAAC,IAAI0U,QAA9B,EAAwC1U,GAAC,EAAzC,EAA6C;AACzC,YAAM6U,IAAI,GAAGxL,UAAU,CAACrJ,GAAD,CAAvB;;AAEA,YAAI6U,IAAI,CAAC3U,MAAL,KAAgB,CAAhB,IAAsB2U,IAAI,CAACvL,QAAL,KAAkB,CAAlB,IAAuBuL,IAAI,CAACC,IAAL,KAAcC,SAA/D,EAA2E;AACvE,eAAKC,mBAAL,CAAyBH,IAAzB;;AACA;AACH;;AAED,YAAIA,IAAI,KAAKpL,QAAb,EAAuB;AACnB,cAAIA,QAAQ,CAACH,QAAT,KAAsB,CAA1B,EAA6B;AACzB,gBAAIpR,IAAI,CAACmQ,WAAL,CAAiBoB,QAAjB,CAAJ,EAAgC,SAAhC,KACK6K,UAAU,GAAGpc,IAAI,CAACkV,cAAL,CAAoB3D,QAAQ,CAACF,WAA7B,CAAb;AACR,WAHD,MAGO;AACH,gBAAIsL,IAAI,KAAKlL,MAAb,EAAqB;AACjB2K,cAAAA,UAAU,GAAGpc,IAAI,CAACkV,cAAL,CAAoB3D,QAAQ,CAACwL,aAAT,CAAuB,CAAvB,EAA0BvL,QAA1B,IAAsCC,MAAM,CAACsL,aAAP,CAAqBrL,MAArB,EAA8BD,MAAM,CAACzJ,MAAP,GAAgB0J,MAA9C,CAA1D,CAAb;AACArD,cAAAA,MAAM,GAAGmD,QAAT;AACH,aAHD,MAGO;AACH4K,cAAAA,UAAU,GAAGpc,IAAI,CAACkV,cAAL,CAAoB3D,QAAQ,CAACwL,aAAT,CAAuB,CAAvB,EAA0BvL,QAA1B,CAApB,CAAb;AACH;AACJ;;AAED,cAAI4K,UAAU,CAACpU,MAAX,GAAoB,CAAxB,EAA2B;AACvBuJ,YAAAA,QAAQ,CAACqL,IAAT,GAAgBR,UAAU,CAACQ,IAA3B;AACH,WAFD,MAEO;AACH,iBAAKE,mBAAL,CAAyBvL,QAAzB;AACH;;AAED,cAAIoL,IAAI,KAAKlL,MAAb,EAAqB;AACrB;AACH;;AAED,YAAIkL,IAAI,KAAKlL,MAAb,EAAqB;AACjB,cAAIA,MAAM,CAACL,QAAP,KAAoB,CAAxB,EAA2B;AACvB,gBAAIpR,IAAI,CAACmQ,WAAL,CAAiBsB,MAAjB,CAAJ,EAA8B,SAA9B,KACKsI,SAAS,GAAG/Z,IAAI,CAACkV,cAAL,CAAoBzD,MAAM,CAACJ,WAA3B,CAAZ;AACR,WAHD,MAGO;AACH0I,YAAAA,SAAS,GAAG/Z,IAAI,CAACkV,cAAL,CAAoBzD,MAAM,CAACsL,aAAP,CAAqBrL,MAArB,EAA8BD,MAAM,CAACzJ,MAAP,GAAgB0J,MAA9C,CAApB,CAAZ;AACH;;AAED,cAAIqI,SAAS,CAAC/R,MAAV,GAAmB,CAAvB,EAA0B;AACtByJ,YAAAA,MAAM,CAACmL,IAAP,GAAc7C,SAAS,CAAC6C,IAAxB;AACH,WAFD,MAEO;AACH,iBAAKE,mBAAL,CAAyBrL,MAAzB;AACH;;AAED;AACH;;AAED,aAAKqL,mBAAL,CAAyBH,IAAzB;AACH;;AAED,UAAMK,KAAK,GAAGhd,IAAI,CAACoP,gBAAL,CAAsBqC,MAAtB,EAA8B,IAA9B,CAAd;AACA,UAAMwL,OAAO,GAAGjd,IAAI,CAACoP,gBAAL,CAAsBmC,QAAtB,EAAgC,IAAhC,CAAhB;;AACA,UAAIyL,KAAK,IAAIC,OAAT,IAAoBA,OAAO,CAACvP,QAAR,CAAiBsP,KAAjB,CAAxB,EAAiD;AAC7Ctb,QAAAA,SAAS,GAAGsb,KAAK,CAAC3H,eAAlB;AACAhH,QAAAA,MAAM,GAAG3M,SAAS,CAAC2P,WAAV,CAAsBrJ,MAA/B;AACH,OAHD,MAGO;AACHtG,QAAAA,SAAS,GAAG+P,MAAM,IAAIA,MAAM,CAACuD,UAAjB,GAA8BvD,MAA9B,GAAuCF,QAAQ,IAAIA,QAAQ,CAACyD,UAArB,GAAkCzD,QAAlC,GAA8C9B,KAAK,CAACG,YAAN,IAAsBH,KAAK,CAACE,cAA7H;AACH;;AAED,UAAI,CAAC3P,IAAI,CAAC6P,YAAL,CAAkBnO,SAAlB,CAAD,IAAiCA,SAAS,CAACyP,UAAV,CAAqBnJ,MAArB,KAAgC,CAArE,EAAwE;AACpE,YAAMkV,EAAE,GAAGld,IAAI,CAACmd,oBAAL,CAA0Bzb,SAA1B,EAAqC,IAArC,EAA2C,IAA3C,CAAX;AACA,YAAIwb,EAAJ,EAAQxb,SAAS,GAAGwb,EAAE,CAACpK,EAAH,IAASoK,EAAE,CAAClK,EAAZ,IAAkB9T,OAAO,CAACO,OAAR,CAAgB8P,OAA9C;AACX,OAjImB,CAmIpB;;;AACA,WAAKiB,QAAL,CAAc9O,SAAd,EAAyB2M,MAAzB,EAAiC3M,SAAjC,EAA4C2M,MAA5C,EApIoB,CAqIpB;;AACA,WAAKjN,OAAL,CAAa4H,IAAb,CAAkB,IAAlB;AAEA,aAAO;AACHtH,QAAAA,SAAS,EAAEA,SADR;AAEH2M,QAAAA,MAAM,EAAEA,MAFL;AAGHmM,QAAAA,aAAa,EAAEjJ,QAAQ,IAAIA,QAAQ,CAACyD,UAArB,GAAkCzD,QAAlC,GAA6C;AAHzD,OAAP;AAKH,KAnmEQ;AAqmETuL,IAAAA,mBAAmB,EAAE,6BAAUH,IAAV,EAAgB;AACjC,UAAMjX,MAAM,GAAG1F,IAAI,CAAC6U,gBAAL,CAAsB8H,IAAtB,EAA4B,IAA5B,CAAf;AACA3c,MAAAA,IAAI,CAACsV,UAAL,CAAgBqH,IAAhB;AAEA,UAAG,CAAC3c,IAAI,CAACuW,UAAL,CAAgB7Q,MAAhB,CAAJ,EAA6B;AAE7B1F,MAAAA,IAAI,CAACmd,oBAAL,CAA0BzX,MAA1B,EAAkC,IAAlC,EAAwC,IAAxC;;AAEA,UAAIA,MAAM,IAAI1F,IAAI,CAAC2Z,MAAL,CAAYjU,MAAM,CAACsO,UAAnB,CAAd,EAA8C;AAC1CtO,QAAAA,MAAM,CAAC6K,YAAP,CAAoBvQ,IAAI,CAACkV,cAAL,CAAoBlV,IAAI,CAACmV,cAAzB,CAApB,EAA8DzP,MAAM,CAACsO,UAArE;AACH;AACJ,KAhnEQ;;AAknET;AACR;AACA;AACA;AACQoJ,IAAAA,uBAAuB,EAAE,iCAAUC,YAAV,EAAwB;AAC7C,WAAK3J,gBAAL,CAAsB,KAAKhE,QAAL,EAAtB,EAAuC,IAAvC;AACA,UAAM4N,UAAU,GAAG,KAAK3G,gCAAL,CAAsC,KAAtC,CAAnB;AACA,UAAI,CAAC2G,UAAD,IAAeA,UAAU,CAACtV,MAAX,KAAsB,CAAzC,EAA4C;;AAE5CuV,MAAAA,SAAS,EACT,KAAK,IAAIzV,CAAC,GAAG,CAAR,EAAWqB,GAAG,GAAGmU,UAAU,CAACtV,MAA5B,EAAoCyO,IAApC,EAA0C+G,MAA1C,EAAkDC,GAAlD,EAAuDC,GAAvD,EAA4DC,CAA5D,EAA+DnU,CAApE,EAAuE1B,CAAC,GAAGqB,GAA3E,EAAgFrB,CAAC,EAAjF,EAAqF;AACjF2O,QAAAA,IAAI,GAAG6G,UAAU,CAACxV,CAAD,CAAjB;AACA,YAAI,CAAC9H,IAAI,CAACuW,UAAL,CAAgBE,IAAhB,CAAL,EAA4B;AAE5B+G,QAAAA,MAAM,GAAG/G,IAAI,CAAC3F,gBAAd;;AACA,YAAI0M,MAAM,IAAIxd,IAAI,CAACuW,UAAL,CAAgBE,IAAI,CAAC3C,kBAArB,CAAV,IAAsDwJ,UAAU,CAAClQ,OAAX,CAAmBqJ,IAAI,CAAC3C,kBAAxB,IAA8C,CAAC,CAAzG,EAA4G;AACxG4J,UAAAA,GAAG,GAAGF,MAAM,CAAC1M,gBAAb;;AACA,cAAIwM,UAAU,CAAClQ,OAAX,CAAmBsQ,GAAnB,IAA0B,CAAC,CAA/B,EAAkC;AAC9B,gBAAIE,IAAI,GAAG,IAAX;;AACA,mBAAQA,IAAI,GAAGF,GAAG,CAAC5M,gBAAnB,EAAsC;AAClC,kBAAI9Q,IAAI,CAAC2Z,MAAL,CAAYiE,IAAZ,CAAJ,EAAuB;AACnB,oBAAIN,UAAU,CAAClQ,OAAX,CAAmBwQ,IAAI,CAAC9M,gBAAxB,IAA4C,CAAC,CAAjD,EAAoD;AAChD4M,kBAAAA,GAAG,GAAGE,IAAI,CAAC9M,gBAAX;AACH,iBAFD,MAEO;AACH,2BAASyM,SAAT;AACH;AACJ;AACJ;;AAEDE,YAAAA,GAAG,GAAGD,MAAM,CAAC7O,iBAAb;AACAgP,YAAAA,CAAC,GAAGL,UAAU,CAAClQ,OAAX,CAAmBqQ,GAAnB,CAAJ;AACAjU,YAAAA,CAAC,GAAG8T,UAAU,CAAClQ,OAAX,CAAmBsQ,GAAnB,CAAJ;AACAJ,YAAAA,UAAU,CAACrG,MAAX,CAAkB0G,CAAlB,EAAsBnU,CAAC,GAAGmU,CAAL,GAAU,CAA/B;AACAxU,YAAAA,GAAG,GAAGmU,UAAU,CAACtV,MAAjB;AACA;AACH;AACJ;AACJ;;AAED,UAAI6V,IAAI,GAAIP,UAAU,CAACA,UAAU,CAACtV,MAAX,GAAoB,CAArB,CAAtB;AACA,UAAI8V,QAAJ,EAAcC,SAAd,EAAyBC,QAAzB;;AAEA,UAAIhe,IAAI,CAAC6V,oBAAL,CAA0BgI,IAA1B,KAAmC7d,IAAI,CAACkQ,eAAL,CAAqB2N,IAArB,CAAvC,EAAmE;AAC/DC,QAAAA,QAAQ,GAAGD,IAAX;AACH,OAFD,MAEO;AACHC,QAAAA,QAAQ,GAAG9d,IAAI,CAAC8U,qBAAL,CAA2B+I,IAA3B,EAAiC,IAAjC,KAA0C7d,IAAI,CAAC6U,gBAAL,CAAsBgJ,IAAtB,EAA4B,IAA5B,CAArD;AACH;;AAED,UAAI7d,IAAI,CAAC+U,MAAL,CAAY+I,QAAZ,CAAJ,EAA2B;AACvBC,QAAAA,SAAS,GAAG,IAAZ;AACAC,QAAAA,QAAQ,GAAGF,QAAX;AACH,OAHD,MAGO;AACHC,QAAAA,SAAS,GAAGD,QAAQ,CAAClJ,WAArB;AACAoJ,QAAAA,QAAQ,GAAGF,QAAQ,CAAC9I,UAApB;AACH;;AAED,UAAIiJ,WAAW,GAAGje,IAAI,CAAC6Y,eAAL,CAAqBiF,QAArB,CAAlB;AACA,UAAII,UAAU,GAAG,IAAjB;AACA,UAAMC,OAAO,GAAG,EAAhB;;AACA,UAAMC,WAAW,GAAG,SAAdA,WAAc,CAAUC,MAAV,EAAkBC,MAAlB,EAA0BC,MAA1B,EAAkC;AAClD,YAAIC,EAAE,GAAG,IAAT;;AACA,YAAIH,MAAM,KAAKC,MAAX,IAAqB,CAACte,IAAI,CAACoW,OAAL,CAAakI,MAAb,CAA1B,EAAgD;AAC5C,cAAIA,MAAM,IAAIte,IAAI,CAAC6Y,eAAL,CAAqBwF,MAArB,MAAiCre,IAAI,CAAC6Y,eAAL,CAAqByF,MAArB,CAA/C,EAA6E,OAAOC,MAAP;AAC7EC,UAAAA,EAAE,GAAGxe,IAAI,CAACmd,oBAAL,CAA0BmB,MAA1B,EAAkC,IAAlC,EAAwCD,MAAxC,CAAL;AACH;;AAED,eAAOG,EAAE,GAAGA,EAAE,CAACxL,EAAN,GAAWuL,MAApB;AACH,OARD;;AAUA,WAAK,IAAIzW,GAAC,GAAG,CAAR,EAAWqB,IAAG,GAAGmU,UAAU,CAACtV,MAA5B,EAAoCyO,KAApC,EAA0CgI,YAA1C,EAAwDC,KAAxD,EAA+DH,MAA/D,EAAuEI,QAAvE,EAAiFC,QAAjF,EAA2FpB,OAAhG,EAAwG1V,GAAC,GAAGqB,IAA5G,EAAiHrB,GAAC,EAAlH,EAAsH;AAClH2O,QAAAA,KAAI,GAAG6G,UAAU,CAACxV,GAAD,CAAjB;AACA2W,QAAAA,YAAY,GAAGhI,KAAI,CAACzB,UAApB;AACA,YAAI,CAACyJ,YAAD,IAAiBpB,YAAY,CAAC3P,QAAb,CAAsB+Q,YAAtB,CAArB,EAA0D;AAE1DC,QAAAA,KAAK,GAAG1e,IAAI,CAAC6Y,eAAL,CAAqBpC,KAArB,CAAR;;AAEA,YAAIzW,IAAI,CAAC2Z,MAAL,CAAY8E,YAAZ,CAAJ,EAA+B;AAC3B,cAAIP,UAAU,KAAK,IAAnB,EAAyB;AACrB,gBAAIU,QAAJ,EAAc;AACVV,cAAAA,UAAU,GAAGU,QAAb;AACApB,cAAAA,OAAM,GAAG,IAAT;AACAoB,cAAAA,QAAQ,GAAG,IAAX;AACH,aAJD,MAIO;AACHV,cAAAA,UAAU,GAAGO,YAAY,CAAClH,SAAb,CAAuB,KAAvB,CAAb;AACH;AACJ;;AAED4G,UAAAA,OAAO,CAACnV,IAAR,CAAayN,KAAb;AACAkI,UAAAA,QAAQ,GAAGrB,UAAU,CAACxV,GAAC,GAAG,CAAL,CAArB;;AAEA,cAAIA,GAAC,KAAKqB,IAAG,GAAG,CAAZ,IAAkBwV,QAAQ,IAAIA,QAAQ,CAAC3J,UAAT,KAAwByJ,YAA1D,EAAyE;AACrE;AACA,gBAAIE,QAAQ,IAAIlI,KAAI,CAAC/I,QAAL,CAAciR,QAAQ,CAAC3J,UAAvB,CAAhB,EAAoD;AAChD4J,cAAAA,QAAQ,GAAGD,QAAQ,CAAC3J,UAAT,CAAoBuC,SAApB,CAA8B,KAA9B,CAAX;AACH;;AAED,gBAAIqG,KAAI,GAAGa,YAAY,CAACzJ,UAAxB;AAAA,gBAAoC6J,CAAC,SAArC;;AACA,mBAAO7e,IAAI,CAAC2Z,MAAL,CAAYiE,KAAZ,CAAP,EAA0B;AACtBiB,cAAAA,CAAC,GAAG7e,IAAI,CAACoQ,aAAL,CAAmBwN,KAAI,CAACzJ,QAAxB,CAAJ;AACA0K,cAAAA,CAAC,CAAC7U,WAAF,CAAckU,UAAd;AACAA,cAAAA,UAAU,GAAGW,CAAb;AACAjB,cAAAA,KAAI,GAAGA,KAAI,CAAC5I,UAAZ;AACH;;AAED,gBAAM8J,KAAI,GAAG,KAAKC,wBAAL,CAA8BN,YAA9B,EAA4CN,OAA5C,EAAqD,IAArD,EAA2D,IAA3D,EAAiE,IAAjE,CAAb;;AAEA,gBAAIF,WAAW,IAAIS,KAAnB,EAA0B;AACtBT,cAAAA,WAAW,GAAGS,KAAd;AACAV,cAAAA,QAAQ,GAAGc,KAAI,CAACN,EAAhB;AACAT,cAAAA,SAAS,GAAGK,WAAW,CAACJ,QAAD,EAAWS,YAAX,EAAyBK,KAAI,CAAC9L,EAA9B,CAAvB;AACA,kBAAI+K,SAAJ,EAAeC,QAAQ,GAAGD,SAAS,CAAC/I,UAArB;AAClB,aALD,MAKO,IAAIgJ,QAAQ,KAAKc,KAAI,CAACN,EAAtB,EAA0B;AAC7BT,cAAAA,SAAS,GAAGe,KAAI,CAAC9L,EAAjB;AACH;;AAED,gBAAIgL,QAAQ,KAAKc,KAAI,CAACN,EAAtB,EAA0B;AACtBD,cAAAA,MAAM,GAAGH,WAAW,CAACJ,QAAD,EAAWc,KAAI,CAACN,EAAhB,EAAoBD,MAApB,CAApB;AACA,kBAAIA,MAAM,KAAK1B,SAAf,EAA0BkB,SAAS,GAAGQ,MAAZ,CAA1B,KACKR,SAAS,GAAGe,KAAI,CAACN,EAAjB;AACR;;AAED,iBAAK,IAAI1D,CAAC,GAAG,CAAR,EAAWkE,IAAI,GAAGF,KAAI,CAACG,WAAL,CAAiBjX,MAAxC,EAAgD8S,CAAC,GAAGkE,IAApD,EAA0DlE,CAAC,EAA3D,EAA+D;AAC3DoD,cAAAA,UAAU,CAAClU,WAAX,CAAuB8U,KAAI,CAACG,WAAL,CAAiBnE,CAAjB,CAAvB;AACH;;AAED,gBAAI,CAAC0C,OAAL,EAAaH,YAAY,CAACrT,WAAb,CAAyBkU,UAAzB;AACb,gBAAIU,QAAJ,EAAcE,KAAI,CAACG,WAAL,CAAiBH,KAAI,CAACG,WAAL,CAAiBjX,MAAjB,GAA0B,CAA3C,EAA8CgC,WAA9C,CAA0D4U,QAA1D;AACdV,YAAAA,UAAU,GAAG,IAAb;AACAV,YAAAA,OAAM,GAAG,KAAT;AACH;AACJ,SAtDD,MAsDO;AACH,cAAIS,WAAW,IAAIS,KAAnB,EAA0B;AACtBT,YAAAA,WAAW,GAAGS,KAAd;AACAV,YAAAA,QAAQ,GAAGS,YAAX;AACAV,YAAAA,SAAS,GAAGtH,KAAI,CAAC7B,WAAjB;AACH;;AAEDyI,UAAAA,YAAY,CAACrT,WAAb,CAAyByM,KAAzB;;AAEA,cAAIuH,QAAQ,KAAKS,YAAjB,EAA+B;AAC3BF,YAAAA,MAAM,GAAGH,WAAW,CAACJ,QAAD,EAAWS,YAAX,CAApB;AACA,gBAAIF,MAAM,KAAK1B,SAAf,EAA0BkB,SAAS,GAAGQ,MAAZ;AAC7B;AACJ;AACJ;;AAED,WAAK/c,UAAL,GAAkB,IAAlB;AACAxB,MAAAA,IAAI,CAACkf,aAAL,CAAmB7B,YAAnB,EAAiC,IAAjC,EAAuC,KAAvC;AACArd,MAAAA,IAAI,CAACmf,eAAL,CAAqB9B,YAArB,EAAmC,UAAUnM,OAAV,EAAmB;AAAE,eAAO,KAAKyI,MAAL,CAAYzI,OAAZ,CAAP;AAA8B,OAAnD,CAAoD5G,IAApD,CAAyDtK,IAAzD,CAAnC,EAhJ6C,CAkJ7C;;AACA,UAAI+d,SAAS,IAAI/d,IAAI,CAAC6Y,eAAL,CAAqBkF,SAArB,IAAkC,CAA/C,KAAqD/d,IAAI,CAAC2Z,MAAL,CAAYoE,SAAS,CAAC/I,UAAtB,KAAqChV,IAAI,CAAC2Z,MAAL,CAAYoE,SAAS,CAAC/I,UAAV,CAAqBA,UAAjC,CAA1F,CAAJ,EAA6I;AACzI,YAAM2D,WAAW,GAAG3Y,IAAI,CAACoP,gBAAL,CAAsB2O,SAAtB,EAAiC,UAAU7M,OAAV,EAAmB;AAAE,iBAAO,KAAK2E,oBAAL,CAA0B3E,OAA1B,KAAsC,CAAC,KAAKyI,MAAL,CAAYzI,OAAZ,CAA9C;AAAqE,SAA1F,CAA2F5G,IAA3F,CAAgGtK,IAAhG,CAAjC,CAApB;AACA,YAAMof,UAAU,GAAGpf,IAAI,CAAC4Y,YAAL,CAAkBmF,SAAlB,EAA6B,IAA7B,EAAmC,CAACpF,WAAD,GAAe,CAAf,GAAmB3Y,IAAI,CAAC6Y,eAAL,CAAqBF,WAArB,IAAoC,CAA1F,CAAnB;AACAyG,QAAAA,UAAU,CAACpK,UAAX,CAAsBzE,YAAtB,CAAmC8M,YAAnC,EAAiD+B,UAAjD;AACH,OAJD,MAIO;AAAE;AACLpB,QAAAA,QAAQ,CAACzN,YAAT,CAAsB8M,YAAtB,EAAoCU,SAApC;AACAK,QAAAA,WAAW,CAACf,YAAD,EAAeU,SAAf,CAAX;AACH;;AAED,UAAMe,IAAI,GAAG9e,IAAI,CAAC+Y,iBAAL,CAAuBsE,YAAY,CAAC1O,iBAApC,EAAuD0O,YAAY,CAACvM,gBAApE,CAAb;;AACA,UAAIwM,UAAU,CAACtV,MAAX,GAAoB,CAAxB,EAA2B;AACvB,aAAKwI,QAAL,CAAcsO,IAAI,CAAChM,EAAnB,EAAuB,CAAvB,EAA0BgM,IAAI,CAAC9L,EAA/B,EAAmC8L,IAAI,CAAC9L,EAAL,CAAQ3B,WAAR,CAAoBrJ,MAAvD;AACH,OAFD,MAEO;AACH,aAAKwI,QAAL,CAAcsO,IAAI,CAAC9L,EAAnB,EAAuB8L,IAAI,CAAC9L,EAAL,CAAQ3B,WAAR,CAAoBrJ,MAA3C,EAAmD8W,IAAI,CAAC9L,EAAxD,EAA4D8L,IAAI,CAAC9L,EAAL,CAAQ3B,WAAR,CAAoBrJ,MAAhF;AACH,OAjK4C,CAmK7C;;;AACA,WAAK5G,OAAL,CAAa4H,IAAb,CAAkB,KAAlB;AACH,KA3xEQ;;AA6xET;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQ+V,IAAAA,wBAAwB,EAAE,kCAAU1B,YAAV,EAAwBgC,eAAxB,EAAyCC,eAAzC,EAA0DC,MAA1D,EAAkEpH,cAAlE,EAAkF;AACxG,UAAM1I,KAAK,GAAG,KAAKC,QAAL,EAAd;AACA,UAAMuD,EAAE,GAAGxD,KAAK,CAACQ,WAAjB;AACA,UAAMkD,EAAE,GAAG1D,KAAK,CAACgB,SAAjB;AAEA,UAAIT,QAAQ,GAAGhQ,IAAI,CAACqc,iBAAL,CAAuBgB,YAAvB,EAAqC,UAAUnM,OAAV,EAAmB;AAAE,eAAOA,OAAO,CAAC8D,UAAR,KAAuBqI,YAA9B;AAA6C,OAAvG,CAAf;AACA,UAAIgB,MAAM,GAAGhB,YAAY,CAACrI,UAA1B;AACA,UAAIwK,SAAS,GAAG,IAAhB;AACA,UAAIC,QAAQ,GAAG,IAAf;AACA,UAAIC,OAAO,GAAGrC,YAAY,CAAC9F,SAAb,CAAuB,KAAvB,CAAd;AAEA,UAAM0H,WAAW,GAAG,EAApB;AACA,UAAMU,OAAO,GAAG3f,IAAI,CAAC2Z,MAAL,CAAY2F,eAAZ,CAAhB;AACA,UAAIM,WAAW,GAAG,KAAlB;AACA,UAAIC,KAAK,GAAG,KAAZ;AACA,UAAIC,YAAY,GAAG,KAAnB;;AAEA,eAASC,UAAT,CAAqB1B,MAArB,EAA6B2B,OAA7B,EAAsCC,OAAtC,EAA+CC,UAA/C,EAA2D;AACvD,YAAIlgB,IAAI,CAAC8Y,kBAAL,CAAwBkH,OAAxB,CAAJ,EAAsCA,OAAO,CAACnM,SAAR,GAAoB7T,IAAI,CAACmV,cAAzB;;AAEtC,YAAI6K,OAAO,CAAC5O,QAAR,KAAqB,CAAzB,EAA4B;AACxBiN,UAAAA,MAAM,CAAC9N,YAAP,CAAoByP,OAApB,EAA6BC,OAA7B;AACA,iBAAOD,OAAP;AACH;;AAED,YAAMG,WAAW,GAAG,CAACL,YAAY,GAAGE,OAAH,GAAaE,UAA1B,EAAsC/O,UAA1D;AACA,YAAIzL,MAAM,GAAGsa,OAAO,CAACzI,SAAR,CAAkB,KAAlB,CAAb;AACA,YAAI6I,KAAK,GAAG,IAAZ;AACA,YAAItF,CAAC,GAAG,IAAR;;AAEA,eAAOqF,WAAW,CAAC,CAAD,CAAlB,EAAuB;AACnBrF,UAAAA,CAAC,GAAGqF,WAAW,CAAC,CAAD,CAAf;;AACA,cAAIngB,IAAI,CAACqgB,YAAL,CAAkBvF,CAAlB,KAAwB,CAAC9a,IAAI,CAAC0U,OAAL,CAAaoG,CAAb,CAAzB,IAA4C,CAAC9a,IAAI,CAACuW,UAAL,CAAgB7Q,MAAhB,CAAjD,EAA0E;AACtE,gBAAIA,MAAM,CAACyL,UAAP,CAAkBnJ,MAAlB,GAA2B,CAA/B,EAAkC;AAC9B,kBAAI,CAACoY,KAAL,EAAYA,KAAK,GAAG1a,MAAR;AACZ2Y,cAAAA,MAAM,CAAC9N,YAAP,CAAoB7K,MAApB,EAA4Bua,OAA5B;AACAva,cAAAA,MAAM,GAAGsa,OAAO,CAACzI,SAAR,CAAkB,KAAlB,CAAT;AACH;;AACD8G,YAAAA,MAAM,CAAC9N,YAAP,CAAoBuK,CAApB,EAAuBmF,OAAvB;AACA,gBAAI,CAACG,KAAL,EAAYA,KAAK,GAAGtF,CAAR;AACf,WARD,MAQO;AACHpV,YAAAA,MAAM,CAACsE,WAAP,CAAmB8Q,CAAnB;AACH;AACJ;;AAED,YAAIpV,MAAM,CAACyL,UAAP,CAAkBnJ,MAAlB,GAA2B,CAA/B,EAAkC;AAC9B,cAAIhI,IAAI,CAACuW,UAAL,CAAgB8H,MAAhB,KAA2Bre,IAAI,CAACuW,UAAL,CAAgB7Q,MAAhB,CAA3B,IAAsD1F,IAAI,CAAC2Z,MAAL,CAAYsG,OAAZ,CAA1D,EAAgF;AAC5E,gBAAIN,OAAJ,EAAa;AACTS,cAAAA,KAAK,GAAGH,OAAR;;AACA,qBAAMA,OAAN,EAAe;AACXva,gBAAAA,MAAM,CAACsE,WAAP,CAAmBiW,OAAnB;AACAA,gBAAAA,OAAO,GAAGA,OAAO,CAACrL,WAAlB;AACH;;AACDyJ,cAAAA,MAAM,CAACrJ,UAAP,CAAkBzE,YAAlB,CAA+B7K,MAA/B,EAAuC2Y,MAAM,CAACvK,kBAA9C;AACH,aAPD,MAOO;AACH,kBAAMwM,UAAU,GAAGJ,UAAU,CAACpM,kBAA9B;AACA,kBAAMyM,WAAW,GAAGvgB,IAAI,CAACwgB,gBAAL,CAAsBN,UAAtB,EAAkC,KAAlC,CAApB;;AACA,kBAAK7C,YAAY,KAAKkD,WAAlB,IAAmCD,UAAU,KAAKJ,UAAU,CAACpM,kBAAjE,EAAsF;AAClF,oBAAM2M,SAAS,GAAG/a,MAAM,CAACyL,UAAzB;;AACA,uBAAOsP,SAAS,CAAC,CAAD,CAAhB,EAAqB;AACjBP,kBAAAA,UAAU,CAAClW,WAAX,CAAuByW,SAAS,CAAC,CAAD,CAAhC;AACH;;AAEDpD,gBAAAA,YAAY,GAAGkD,WAAf;AACAV,gBAAAA,KAAK,GAAG,IAAR;AACH;AACJ;AACJ,WArBD,MAqBO;AACHxB,YAAAA,MAAM,CAAC9N,YAAP,CAAoB7K,MAApB,EAA4Bua,OAA5B;AACH;;AAED,cAAI,CAACG,KAAL,EAAYA,KAAK,GAAG1a,MAAR;AACf;;AAED,eAAO0a,KAAP;AACH,OA3EuG,CA6ExG;;;AACA,WAAK,IAAItY,CAAC,GAAG,CAAR,EAAWqB,GAAG,GAAG6G,QAAQ,CAAChI,MAA1B,EAAkCgY,OAAlC,EAA2CU,SAA3C,EAAsD9E,IAA3D,EAAiE9T,CAAC,GAAGqB,GAArE,EAA0ErB,CAAC,EAA3E,EAA+E;AAC3EkY,QAAAA,OAAO,GAAGhQ,QAAQ,CAAClI,CAAD,CAAlB;AACA,YAAIkY,OAAO,CAAC5O,QAAR,KAAqB,CAArB,IAA0BpR,IAAI,CAAC2Z,MAAL,CAAY+F,OAAZ,CAA9B,EAAoD;AAEpDI,QAAAA,YAAY,GAAG,KAAf;;AACA,YAAIP,MAAM,IAAIzX,CAAC,KAAK,CAApB,EAAuB;AACnB,cAAI,CAACuX,eAAD,IAAoBA,eAAe,CAACrX,MAAhB,KAA2BmB,GAA/C,IAAsDkW,eAAe,CAAC,CAAD,CAAf,KAAuBW,OAAjF,EAA0F;AACtFR,YAAAA,SAAS,GAAGnC,YAAY,CAAChI,eAAzB;AACH,WAFD,MAEO;AACHmK,YAAAA,SAAS,GAAGE,OAAZ;AACH;AACJ;;AAED,YAAIL,eAAJ,EAAqBqB,SAAS,GAAGrB,eAAe,CAACjS,OAAhB,CAAwB4S,OAAxB,CAAZ;;AACrB,YAAIX,eAAe,IAAIqB,SAAS,KAAK,CAAC,CAAtC,EAAyC;AACrC,cAAI,CAAChB,OAAL,EAAcA,OAAO,GAAGrC,YAAY,CAAC9F,SAAb,CAAuB,KAAvB,CAAV;AACdmI,UAAAA,OAAO,CAAC1V,WAAR,CAAoBgW,OAApB;AACH,SAHD,MAGO;AACH,cAAIX,eAAJ,EAAqBzD,IAAI,GAAGyD,eAAe,CAACqB,SAAS,GAAG,CAAb,CAAtB;;AACrB,cAAIhB,OAAO,IAAIA,OAAO,CAAC1P,QAAR,CAAiBhI,MAAjB,GAA0B,CAAzC,EAA4C;AACxCqW,YAAAA,MAAM,CAAC9N,YAAP,CAAoBmP,OAApB,EAA6BrC,YAA7B;AACAqC,YAAAA,OAAO,GAAG,IAAV;AACH;;AAED,cAAI,CAACC,OAAD,IAAY3f,IAAI,CAACuW,UAAL,CAAgByJ,OAAhB,CAAhB,EAA0C;AACtC,gBAAIpE,IAAI,IAAI5b,IAAI,CAAC6Y,eAAL,CAAqBmH,OAArB,MAAkChgB,IAAI,CAAC6Y,eAAL,CAAqB+C,IAArB,CAA1C,KAAyE5b,IAAI,CAACuW,UAAL,CAAgB8H,MAAhB,KAA2Bre,IAAI,CAACub,YAAL,CAAkByE,OAAO,CAAChQ,QAA1B,EAAoChQ,IAAI,CAAC2Z,MAAzC,EAAiD,KAAjD,CAApG,CAAJ,EAAkK;AAC9J,kBAAMgH,OAAO,GAAGX,OAAO,CAAClM,kBAAxB;AACA,kBAAMyM,WAAW,GAAGvgB,IAAI,CAACwgB,gBAAL,CAAsBR,OAAtB,EAA+B,KAA/B,CAApB;;AACA,kBAAK3C,YAAY,KAAKkD,WAAlB,IAAkCI,OAAO,KAAKX,OAAO,CAAClM,kBAA1D,EAA8E;AAC1EuJ,gBAAAA,YAAY,GAAGkD,WAAf;AACAV,gBAAAA,KAAK,GAAG,IAAR;AACH;AACJ,aAPD,MAOO;AACH,kBAAMe,KAAK,GAAGZ,OAAd;AACAA,cAAAA,OAAO,GAAGhgB,IAAI,CAACoQ,aAAL,CAAmBmP,MAAM,GAAGqB,KAAK,CAACzM,QAAT,GAAqBnU,IAAI,CAAC2Z,MAAL,CAAY0D,YAAY,CAACrI,UAAzB,KAAwChV,IAAI,CAACuW,UAAL,CAAgB8G,YAAY,CAACrI,UAA7B,CAAzC,GAAqF,IAArF,GAA4FhV,IAAI,CAAC+U,MAAL,CAAYsI,YAAY,CAACrI,UAAzB,IAAuC,KAAvC,GAA+C1V,OAAO,CAAC+Q,UAAhM,CAAV;AACA,kBAAM0E,MAAM,GAAG/U,IAAI,CAACuW,UAAL,CAAgByJ,OAAhB,CAAf;AACA,kBAAMa,aAAa,GAAGD,KAAK,CAACzP,UAA5B;;AACA,qBAAO0P,aAAa,CAAC,CAAD,CAApB,EAAyB;AACrB,oBAAI7gB,IAAI,CAAC2Z,MAAL,CAAYkH,aAAa,CAAC,CAAD,CAAzB,KAAiC,CAAC9L,MAAtC,EAA8C;AAC9CiL,gBAAAA,OAAO,CAAChW,WAAR,CAAoB6W,aAAa,CAAC,CAAD,CAAjC;AACH;;AACD7gB,cAAAA,IAAI,CAAC8gB,oBAAL,CAA0Bd,OAA1B,EAAmCY,KAAnC;AACAd,cAAAA,YAAY,GAAG,IAAf;AACH;AACJ,WApBD,MAoBO;AACHE,YAAAA,OAAO,GAAGA,OAAO,CAACzI,SAAR,CAAkB,KAAlB,CAAV;AACH;;AAED,cAAI,CAACsI,KAAL,EAAY;AACR,gBAAI,CAACN,MAAL,EAAa;AACT,kBAAID,eAAJ,EAAqB;AACjB,oBAAI,CAACM,WAAL,EAAkB;AACdvB,kBAAAA,MAAM,CAAC9N,YAAP,CAAoB+O,eAApB,EAAqCjC,YAArC;AACAuC,kBAAAA,WAAW,GAAG,IAAd;AACH;;AACDI,gBAAAA,OAAO,GAAGD,UAAU,CAACT,eAAD,EAAkBU,OAAlB,EAA2B,IAA3B,EAAiChQ,QAAQ,CAAClI,CAAD,CAAzC,CAApB;AACH,eAND,MAMO;AACHkY,gBAAAA,OAAO,GAAGD,UAAU,CAAC1B,MAAD,EAAS2B,OAAT,EAAkB3C,YAAlB,EAAgCrN,QAAQ,CAAClI,CAAD,CAAxC,CAApB;AACH;;AAED,kBAAI,CAAC+X,KAAL,EAAY;AACR,oBAAIR,eAAJ,EAAqB;AACjBI,kBAAAA,QAAQ,GAAGO,OAAX;;AACA,sBAAI,CAACR,SAAL,EAAgB;AACZA,oBAAAA,SAAS,GAAGQ,OAAZ;AACH;AACJ,iBALD,MAKO,IAAI,CAACR,SAAL,EAAgB;AACnBA,kBAAAA,SAAS,GAAGC,QAAQ,GAAGO,OAAvB;AACH;AACJ;AACJ,aArBD,MAqBO;AACHf,cAAAA,WAAW,CAACjW,IAAZ,CAAiBgX,OAAjB;AACAhgB,cAAAA,IAAI,CAACsV,UAAL,CAAgBtF,QAAQ,CAAClI,CAAD,CAAxB;AACH;;AAED,gBAAI+X,KAAJ,EAAW;AACPA,cAAAA,KAAK,GAAGC,YAAY,GAAG,KAAvB;AACA9P,cAAAA,QAAQ,GAAGhQ,IAAI,CAACqc,iBAAL,CAAuBgB,YAAvB,EAAqC,UAAUnM,OAAV,EAAmB;AAAE,uBAAOA,OAAO,CAAC8D,UAAR,KAAuBqI,YAA9B;AAA6C,eAAvG,CAAX;AACAqC,cAAAA,OAAO,GAAGrC,YAAY,CAAC9F,SAAb,CAAuB,KAAvB,CAAV;AACA8G,cAAAA,MAAM,GAAGhB,YAAY,CAACrI,UAAtB;AACAlN,cAAAA,CAAC,GAAG,CAAC,CAAL;AACAqB,cAAAA,GAAG,GAAG6G,QAAQ,CAAChI,MAAf;AACA;AACH;AACJ;AACJ;AACJ;;AAED,UAAM+Y,WAAW,GAAG1D,YAAY,CAACrI,UAAjC;AACA,UAAIgM,UAAU,GAAG3D,YAAY,CAACzI,WAA9B;;AACA,UAAI8K,OAAO,IAAIA,OAAO,CAAC1P,QAAR,CAAiBhI,MAAjB,GAA0B,CAAzC,EAA4C;AACxC+Y,QAAAA,WAAW,CAACxQ,YAAZ,CAAyBmP,OAAzB,EAAkCsB,UAAlC;AACH;;AAED,UAAI1B,eAAJ,EAAqBE,SAAS,GAAGF,eAAe,CAACjK,eAA5B,CAArB,KACK,IAAI,CAACmK,SAAL,EAAgBA,SAAS,GAAGnC,YAAY,CAAChI,eAAzB;AACrB2L,MAAAA,UAAU,GAAG3D,YAAY,CAACzI,WAAb,KAA6B8K,OAA7B,GAAuCrC,YAAY,CAACzI,WAApD,GAAkE8K,OAAO,GAAGA,OAAO,CAAC9K,WAAX,GAAyB,IAA/G;;AAEA,UAAIyI,YAAY,CAACrN,QAAb,CAAsBhI,MAAtB,KAAiC,CAAjC,IAAsCqV,YAAY,CAAChM,WAAb,CAAyBrJ,MAAzB,KAAoC,CAA9E,EAAiF;AAC7EhI,QAAAA,IAAI,CAACsV,UAAL,CAAgB+H,YAAhB;AACH,OAFD,MAEO;AACHrd,QAAAA,IAAI,CAACihB,eAAL,CAAqB5D,YAArB,EAAmC,IAAnC;AACH;;AAED,UAAIyB,IAAI,GAAG,IAAX;;AACA,UAAIS,MAAJ,EAAY;AACRT,QAAAA,IAAI,GAAG;AACHN,UAAAA,EAAE,EAAEuC,WADD;AAEHjO,UAAAA,EAAE,EAAE0M,SAFD;AAGHxM,UAAAA,EAAE,EAAEgO,UAHD;AAIH/B,UAAAA,WAAW,EAAEA;AAJV,SAAP;AAMH,OAPD,MAOO;AACH,YAAI,CAACO,SAAL,EAAgBA,SAAS,GAAGC,QAAZ;AAChB,YAAI,CAACA,QAAL,EAAeA,QAAQ,GAAGD,SAAX;AACf,YAAM0B,SAAS,GAAGlhB,IAAI,CAAC+Y,iBAAL,CAAuByG,SAAvB,EAAmCC,QAAQ,CAACzK,UAAT,GAAsBwK,SAAtB,GAAkCC,QAArE,CAAlB;AACAX,QAAAA,IAAI,GAAG;AACHN,UAAAA,EAAE,EAAE,CAAC0C,SAAS,CAACpO,EAAV,IAAgBoO,SAAS,CAAClO,EAA3B,EAA+BgC,UADhC;AAEHlC,UAAAA,EAAE,EAAEoO,SAAS,CAACpO,EAFX;AAGHE,UAAAA,EAAE,EAAEkO,SAAS,CAAClO;AAHX,SAAP;AAKH;;AAED,WAAKxR,UAAL,GAAkB,IAAlB;AACA,UAAI2W,cAAJ,EAAoB,OAAO2G,IAAP;;AAEpB,UAAI,CAACS,MAAD,IAAWT,IAAf,EAAqB;AACjB,YAAI,CAACO,eAAL,EAAsB;AAClB,eAAK7O,QAAL,CAAcsO,IAAI,CAAChM,EAAnB,EAAuB,CAAvB,EAA0BgM,IAAI,CAAChM,EAA/B,EAAmC,CAAnC;AACH,SAFD,MAEO;AACH,eAAKtC,QAAL,CAAcsO,IAAI,CAAChM,EAAnB,EAAuBG,EAAvB,EAA2B6L,IAAI,CAAC9L,EAAhC,EAAoCG,EAApC;AACH;AACJ,OAlNuG,CAoNxG;;;AACA,WAAK/R,OAAL,CAAa4H,IAAb,CAAkB,KAAlB;AACH,KA9/EQ;;AAggFT;AACR;AACA;AACA;AACA;AACA;AACA;AACQmY,IAAAA,UAAU,EAAE,oBAAU9B,eAAV,EAA2BE,MAA3B,EAAmC;AAC3C,UAAI6B,QAAQ,GAAG,EAAf;AACA,UAAIC,SAAS,GAAG,KAAhB;AACA,UAAIC,QAAQ,GAAG,KAAf;AACA,UAAIlB,KAAK,GAAG,IAAZ;AACA,UAAIvC,IAAI,GAAG,IAAX;;AACA,UAAM0D,aAAa,GAAG,UAAUrQ,OAAV,EAAmB;AAAE,eAAO,CAAC,KAAKf,WAAL,CAAiBe,OAAjB,CAAR;AAAoC,OAAzD,CAA0D5G,IAA1D,CAA+DtK,IAA/D,CAAtB;;AAEA,WAAK,IAAI8H,CAAC,GAAG,CAAR,EAAWqB,GAAG,GAAGkW,eAAe,CAACrX,MAAjC,EAAyCsQ,CAAzC,EAA4CkJ,CAA5C,EAA+CC,SAA/C,EAA0D9H,MAA/D,EAAuE7R,CAAC,GAAGqB,GAA3E,EAAgFrB,CAAC,EAAjF,EAAqF;AACjF2Z,QAAAA,SAAS,GAAG3Z,CAAC,KAAKqB,GAAG,GAAG,CAAxB;AACAqY,QAAAA,CAAC,GAAGxhB,IAAI,CAAC8U,qBAAL,CAA2BuK,eAAe,CAACvX,CAAD,CAA1C,EAA+CyZ,aAA/C,CAAJ;AACA5H,QAAAA,MAAM,GAAG3Z,IAAI,CAAC2Z,MAAL,CAAY6H,CAAZ,CAAT;;AACA,YAAI,CAAClJ,CAAD,IAAMqB,MAAV,EAAkB;AACdrB,UAAAA,CAAC,GAAGkJ,CAAJ;AACAJ,UAAAA,QAAQ,GAAG;AAAC9I,YAAAA,CAAC,EAAEA,CAAJ;AAAOqF,YAAAA,CAAC,EAAE,CAAC3d,IAAI,CAACoP,gBAAL,CAAsBiQ,eAAe,CAACvX,CAAD,CAArC,EAA0C,IAA1C,CAAD;AAAV,WAAX;AACA,cAAIA,CAAC,KAAK,CAAV,EAAauZ,SAAS,GAAG,IAAZ;AAChB,SAJD,MAIO,IAAI/I,CAAC,IAAIqB,MAAT,EAAiB;AACpB,cAAIrB,CAAC,KAAKkJ,CAAV,EAAa;AACT,gBAAM1C,IAAI,GAAG,KAAKC,wBAAL,CAA8BqC,QAAQ,CAACzD,CAAT,CAAW,CAAX,EAAc3I,UAA5C,EAAwDoM,QAAQ,CAACzD,CAAjE,EAAoE,IAApE,EAA0E4B,MAA1E,EAAkF,IAAlF,CAAb;AACAiC,YAAAA,CAAC,GAAGnC,eAAe,CAACvX,CAAD,CAAf,CAAmBkN,UAAvB;;AACA,gBAAIqM,SAAJ,EAAe;AACXjB,cAAAA,KAAK,GAAGtB,IAAI,CAAChM,EAAb;AACAuO,cAAAA,SAAS,GAAG,KAAZ;AACH;;AACD,gBAAII,SAAJ,EAAe5D,IAAI,GAAGiB,IAAI,CAAC9L,EAAZ;;AAEf,gBAAI2G,MAAJ,EAAY;AACRrB,cAAAA,CAAC,GAAGkJ,CAAJ;AACAJ,cAAAA,QAAQ,GAAG;AAAC9I,gBAAAA,CAAC,EAAEA,CAAJ;AAAOqF,gBAAAA,CAAC,EAAE,CAAC3d,IAAI,CAACoP,gBAAL,CAAsBiQ,eAAe,CAACvX,CAAD,CAArC,EAA0C,IAA1C,CAAD;AAAV,eAAX;AACA,kBAAI2Z,SAAJ,EAAeH,QAAQ,GAAG,IAAX;AAClB,aAJD,MAIO;AACHhJ,cAAAA,CAAC,GAAG,IAAJ;AACH;AACJ,WAhBD,MAgBO;AACH8I,YAAAA,QAAQ,CAACzD,CAAT,CAAW3U,IAAX,CAAgBhJ,IAAI,CAACoP,gBAAL,CAAsBiQ,eAAe,CAACvX,CAAD,CAArC,EAA0C,IAA1C,CAAhB;AACA,gBAAI2Z,SAAJ,EAAeH,QAAQ,GAAG,IAAX;AAClB;AACJ;;AAED,YAAIG,SAAS,IAAIzhB,IAAI,CAAC2Z,MAAL,CAAYrB,CAAZ,CAAjB,EAAiC;AAC7B,cAAMwG,MAAI,GAAG,KAAKC,wBAAL,CAA8BqC,QAAQ,CAACzD,CAAT,CAAW,CAAX,EAAc3I,UAA5C,EAAwDoM,QAAQ,CAACzD,CAAjE,EAAoE,IAApE,EAA0E4B,MAA1E,EAAkF,IAAlF,CAAb;;AACA,cAAI+B,QAAQ,IAAInY,GAAG,KAAK,CAAxB,EAA2B0U,IAAI,GAAGiB,MAAI,CAAC9L,EAAZ;AAC3B,cAAIqO,SAAJ,EAAejB,KAAK,GAAGtB,MAAI,CAAChM,EAAL,IAAW+K,IAAnB;AAClB;AACJ;;AAED,aAAO;AACH/K,QAAAA,EAAE,EAAEsN,KADD;AAEHpN,QAAAA,EAAE,EAAE6K;AAFD,OAAP;AAIH,KAzjFQ;;AA2jFT;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQ6D,IAAAA,UAAU,EAAE,oBAAU3B,UAAV,EAAsB4B,UAAtB,EAAkCC,eAAlC,EAAmDC,YAAnD,EAAiE;AACzE,WAAKxN,qBAAL;;AACA,UAAI5E,KAAK,GAAG,KAAKiE,gBAAL,CAAsB,KAAKhE,QAAL,EAAtB,EAAuC,IAAvC,CAAZ;AACAiS,MAAAA,UAAU,GAAGA,UAAU,IAAIA,UAAU,CAAC3Z,MAAX,GAAoB,CAAlC,GAAsC2Z,UAAtC,GAAmD,KAAhE;AACAC,MAAAA,eAAe,GAAGA,eAAe,IAAIA,eAAe,CAAC5Z,MAAhB,GAAyB,CAA5C,GAAgD4Z,eAAhD,GAAkE,KAApF;AAEA,UAAME,YAAY,GAAG,CAAC/B,UAAtB;AACA,UAAMgC,cAAc,GAAGD,YAAY,IAAI,CAACF,eAAjB,IAAoC,CAACD,UAA5D;AACA,UAAIpQ,QAAQ,GAAG9B,KAAK,CAACE,cAArB;AACA,UAAI6B,QAAQ,GAAG/B,KAAK,CAACQ,WAArB;AACA,UAAIwB,MAAM,GAAGhC,KAAK,CAACG,YAAnB;AACA,UAAI8B,MAAM,GAAGjC,KAAK,CAACgB,SAAnB;;AAEA,UAAKsR,cAAc,IAAItS,KAAK,CAACgD,SAAxB,IAAqCzS,IAAI,CAACkQ,eAAL,CAAqBqB,QAAQ,CAACyD,UAA9B,CAAtC,IAAqFzD,QAAQ,KAAKE,MAAb,IAAuBF,QAAQ,CAACH,QAAT,KAAsB,CAA7C,IAAkDpR,IAAI,CAACgiB,aAAL,CAAmBzQ,QAAnB,CAA3I,EAA0K;AACtK,YAAM7L,MAAM,GAAG6L,QAAQ,CAACyD,UAAxB;AACA,YAAI,CAAChV,IAAI,CAACuW,UAAL,CAAgB7Q,MAAhB,CAAD,IAA4B,CAAC1F,IAAI,CAACiiB,SAAL,CAAevc,MAAM,CAACY,KAAtB,EAA6B4b,IAA7B,CAAkC,UAASC,CAAT,EAAY;AAAE,iBAAO,KAAKxhB,UAAL,CAAgByM,OAAhB,CAAwB+U,CAAxB,IAA6B,CAAC,CAArC;AAAyC,SAAvD,CAAwD7X,IAAxD,CAA6D,IAA7D,CAAlC,CAAjC,EAAwI;AAC3I;;AAED,UAAImF,KAAK,CAACgD,SAAN,IAAmB,CAACsP,cAAxB,EAAwC;AACpC,YAAIxQ,QAAQ,CAACH,QAAT,KAAsB,CAAtB,IAA2B,CAACpR,IAAI,CAAC0U,OAAL,CAAanD,QAAb,CAA5B,IAAsD,CAACvR,IAAI,CAACmQ,WAAL,CAAiBoB,QAAjB,CAA3D,EAAuF;AACnF,cAAIwI,SAAS,GAAG,IAAhB;AACA,cAAMpH,SAAS,GAAGpB,QAAQ,CAACJ,UAAT,CAAoBK,QAApB,CAAlB;;AAEA,cAAImB,SAAJ,EAAe;AACX,gBAAI,CAACA,SAAS,CAACiC,WAAf,EAA4B;AACxBmF,cAAAA,SAAS,GAAG,IAAZ;AACH,aAFD,MAEO;AACHA,cAAAA,SAAS,GAAG/Z,IAAI,CAAC0U,OAAL,CAAa/B,SAAb,IAA0BA,SAA1B,GAAsCA,SAAS,CAACiC,WAA5D;AACH;AACJ;;AAED,cAAMoH,SAAS,GAAGhc,IAAI,CAACkV,cAAL,CAAoBlV,IAAI,CAACmV,cAAzB,CAAlB;AACA5D,UAAAA,QAAQ,CAAChB,YAAT,CAAsByL,SAAtB,EAAiCjC,SAAjC;AACA,eAAKvJ,QAAL,CAAcwL,SAAd,EAAyB,CAAzB,EAA4BA,SAA5B,EAAuC,CAAvC;AAEAvM,UAAAA,KAAK,GAAG,KAAKC,QAAL,EAAR;AACA6B,UAAAA,QAAQ,GAAG9B,KAAK,CAACE,cAAjB;AACA6B,UAAAA,QAAQ,GAAG/B,KAAK,CAACQ,WAAjB;AACAwB,UAAAA,MAAM,GAAGhC,KAAK,CAACG,YAAf;AACA8B,UAAAA,MAAM,GAAGjC,KAAK,CAACgB,SAAf;AACH;AACJ;;AAED,UAAIzQ,IAAI,CAACkQ,eAAL,CAAqBqB,QAArB,CAAJ,EAAoC;AAChCA,QAAAA,QAAQ,GAAGA,QAAQ,CAACJ,UAAT,CAAoBK,QAApB,KAAiCD,QAAQ,CAACyC,UAArD;AACAxC,QAAAA,QAAQ,GAAG,CAAX;AACH;;AACD,UAAIxR,IAAI,CAACkQ,eAAL,CAAqBuB,MAArB,CAAJ,EAAkC;AAC9BA,QAAAA,MAAM,GAAGA,MAAM,CAACN,UAAP,CAAkBO,MAAlB,KAA6BD,MAAM,CAACgD,SAA7C;AACA/C,QAAAA,MAAM,GAAGD,MAAM,CAACJ,WAAP,CAAmBrJ,MAA5B;AACH;;AAED,UAAI8Z,YAAJ,EAAkB;AACd/B,QAAAA,UAAU,GAAG/f,IAAI,CAACoQ,aAAL,CAAmB,KAAnB,CAAb;AACH;;AAED,UAAMgS,OAAO,GAAGviB,EAAE,CAAC4F,MAAnB;AACA,UAAM4c,WAAW,GAAGtC,UAAU,CAAC5L,QAA/B;AAEA;;AACA,UAAI,CAAC4N,cAAD,IAAmBxQ,QAAQ,KAAKE,MAAhC,IAA0C,CAACmQ,eAA3C,IAA8D7B,UAAlE,EAA8E;AAC1E,YAAIuC,KAAK,GAAG/Q,QAAZ;AACA,YAAIgR,QAAQ,GAAG,CAAf;AACA,YAAMC,UAAU,GAAG,EAAnB;AAEA,YAAMC,WAAW,GAAG1C,UAAU,CAACzZ,KAA/B;;AACA,aAAK,IAAIwB,CAAC,GAAG,CAAR,EAAWqB,GAAG,GAAGsZ,WAAW,CAACza,MAAlC,EAA0CF,CAAC,GAAGqB,GAA9C,EAAmDrB,CAAC,EAApD,EAAwD;AACpD0a,UAAAA,UAAU,CAACxZ,IAAX,CAAgByZ,WAAW,CAAC3a,CAAD,CAA3B;AACH;;AAED,YAAM4a,YAAY,GAAG3C,UAAU,CAAC4C,SAAhC;;AACA,aAAK,IAAI7a,GAAC,GAAG,CAAR,EAAWqB,KAAG,GAAGuZ,YAAY,CAAC1a,MAAnC,EAA2CF,GAAC,GAAGqB,KAA/C,EAAoDrB,GAAC,EAArD,EAAyD;AACrD0a,UAAAA,UAAU,CAACxZ,IAAX,CAAgB,MAAM0Z,YAAY,CAAC5a,GAAD,CAAlC;AACH;;AAED,YAAI0a,UAAU,CAACxa,MAAX,GAAoB,CAAxB,EAA2B;AACvB,iBAAM,CAAChI,IAAI,CAACkQ,eAAL,CAAqBoS,KAArB,CAAD,IAAgC,CAACtiB,IAAI,CAAC6P,YAAL,CAAkByS,KAAlB,CAAvC,EAAiE;AAC7D,iBAAK,IAAIxa,GAAC,GAAG,CAAb,EAAgBA,GAAC,GAAG0a,UAAU,CAACxa,MAA/B,EAAuCF,GAAC,EAAxC,EAA4C;AACxC,kBAAIwa,KAAK,CAAClR,QAAN,KAAmB,CAAvB,EAA0B;AACtB,oBAAMwR,CAAC,GAAGJ,UAAU,CAAC1a,GAAD,CAApB;AACA,oBAAM+a,QAAQ,GAAG,MAAMlV,IAAN,CAAWiV,CAAX,IAAgB,IAAIR,OAAJ,CAAY,SAASQ,CAAC,CAACE,OAAF,CAAU,KAAV,EAAiB,EAAjB,CAAT,GAAgC,UAA5C,EAAwD,IAAxD,CAAhB,GAAgF,KAAjG;AAEA,oBAAMC,UAAU,GAAGjB,YAAY,GAAG,CAAC,CAACQ,KAAK,CAAChc,KAAN,CAAYsc,CAAZ,CAAL,GAAuB,CAAC,CAACN,KAAK,CAAChc,KAAN,CAAYsc,CAAZ,CAAF,IAAoB,CAAC,CAAC7C,UAAU,CAACzZ,KAAX,CAAiBsc,CAAjB,CAAtB,IAA6CN,KAAK,CAAChc,KAAN,CAAYsc,CAAZ,MAAmB7C,UAAU,CAACzZ,KAAX,CAAiBsc,CAAjB,CAAtH;AACA,oBAAMI,UAAU,GAAGH,QAAQ,KAAK,KAAb,GAAqB,KAArB,GAA6Bf,YAAY,GAAG,CAAC,CAACQ,KAAK,CAACtJ,SAAN,CAAgBiK,KAAhB,CAAsBJ,QAAtB,CAAL,GAAuC,CAAC,CAACP,KAAK,CAACtJ,SAAN,CAAgBiK,KAAhB,CAAsBJ,QAAtB,CAAF,IAAqC,CAAC,CAAC9C,UAAU,CAAC/G,SAAX,CAAqBiK,KAArB,CAA2BJ,QAA3B,CAA1I;;AACA,oBAAIE,UAAU,IAAIC,UAAlB,EAA8B;AAC1BT,kBAAAA,QAAQ;AACX;AACJ;AACJ;;AACDD,YAAAA,KAAK,GAAGA,KAAK,CAACtN,UAAd;AACH;;AAED,cAAIuN,QAAQ,IAAIC,UAAU,CAACxa,MAA3B,EAAmC;AACtC;AACJ;;AAED,UAAIkb,KAAK,GAAG,EAAZ;AAAA,UAAgBC,GAAG,GAAG,EAAtB;AACA,UAAIC,OAAJ;AAAA,UAAaC,WAAW,GAAG,EAA3B;AAAA,UAA+BC,WAAW,GAAG,EAA7C;AAAA,UAAiDC,gBAAgB,GAAG,EAApE;;AAEA,UAAI5B,UAAJ,EAAgB;AACZ,aAAK,IAAI7Z,GAAC,GAAG,CAAR,EAAWqB,KAAG,GAAGwY,UAAU,CAAC3Z,MAA5B,EAAoC4a,EAAzC,EAA4C9a,GAAC,GAAGqB,KAAhD,EAAqDrB,GAAC,EAAtD,EAA0D;AACtD8a,UAAAA,EAAC,GAAGjB,UAAU,CAAC7Z,GAAD,CAAd;;AACA,cAAI,MAAM6F,IAAN,CAAWiV,EAAX,CAAJ,EAAmB;AACfU,YAAAA,WAAW,IAAI,CAACA,WAAW,GAAG,GAAH,GAAS,SAArB,IAAkCV,EAAC,CAACE,OAAF,CAAU,KAAV,EAAiB,EAAjB,CAAjD;AACH,WAFD,MAEO;AACHO,YAAAA,WAAW,IAAI,CAACA,WAAW,GAAG,GAAH,GAAS,gBAArB,IAAyCT,EAAxD;AACH;AACJ;;AAED,YAAIS,WAAJ,EAAiB;AACbA,UAAAA,WAAW,IAAI,wBAAf;AACAA,UAAAA,WAAW,GAAG,IAAIjB,OAAJ,CAAYiB,WAAZ,EAAyB,IAAzB,CAAd;AACH;;AAED,YAAIC,WAAJ,EAAiB;AACbA,UAAAA,WAAW,IAAI,aAAf;AACAA,UAAAA,WAAW,GAAG,IAAIlB,OAAJ,CAAYkB,WAAZ,EAAyB,IAAzB,CAAd;AACH;AACJ;;AAED,UAAI1B,eAAJ,EAAqB;AACjB2B,QAAAA,gBAAgB,GAAG,SAAS3B,eAAe,CAAC,CAAD,CAA3C;;AACA,aAAK,IAAI9Z,GAAC,GAAG,CAAb,EAAgBA,GAAC,GAAG8Z,eAAe,CAAC5Z,MAApC,EAA4CF,GAAC,EAA7C,EAAiD;AAC7Cyb,UAAAA,gBAAgB,IAAI,MAAM3B,eAAe,CAAC9Z,GAAD,CAAzC;AACH;;AACDyb,QAAAA,gBAAgB,IAAI,IAApB;AACAA,QAAAA,gBAAgB,GAAG,IAAInB,OAAJ,CAAYmB,gBAAZ,EAA8B,GAA9B,CAAnB;AACH;AAED;;;AACA,UAAMC,QAAQ,GAAG3jB,EAAE,CAAC4jB,OAApB;AACA,UAAMC,YAAY,GAAG;AAACC,QAAAA,CAAC,EAAE;AAAJ,OAArB;;AACA,UAAMnO,UAAU,GAAG,SAAbA,UAAa,CAAUoO,SAAV,EAAqB;AACpC,YAAMC,KAAK,GAAGD,SAAS,CAACrM,SAAV,CAAoB,KAApB,CAAd,CADoC,CAGpC;;AACA,YAAIsM,KAAK,CAACzS,QAAN,KAAmB,CAAnB,IAAwBpR,IAAI,CAAC0U,OAAL,CAAamP,KAAb,CAA5B,EAAiD,OAAOA,KAAP,CAJb,CAKpC;;AACA,YAAI9B,cAAJ,EAAoB,OAAO,IAAP,CANgB,CAQpC;;AACA,YAAM+B,SAAS,GAAI,CAACP,gBAAD,IAAqBzB,YAAtB,IAAwCyB,gBAAgB,IAAIA,gBAAgB,CAAC5V,IAAjB,CAAsBkW,KAAK,CAAC1P,QAA5B,CAA9E,CAToC,CAWpC;;AACA,YAAI2P,SAAS,IAAI,CAACjC,YAAlB,EAAgC;AAC5B6B,UAAAA,YAAY,CAACC,CAAb,GAAiB,IAAjB;AACA,iBAAO,IAAP;AACH,SAfmC,CAiBpC;;;AACA,YAAMI,WAAW,GAAGF,KAAK,CAACvd,KAAN,CAAYQ,OAAhC;AACA,YAAIR,KAAK,GAAG,EAAZ;;AACA,YAAI+c,WAAW,IAAIU,WAAW,CAAC/b,MAAZ,GAAqB,CAAxC,EAA2C;AACvC1B,UAAAA,KAAK,GAAGyd,WAAW,CAACjB,OAAZ,CAAoBO,WAApB,EAAiC,EAAjC,EAAqC5N,IAArC,EAAR;AACA,cAAInP,KAAK,KAAKyd,WAAd,EAA2BL,YAAY,CAACC,CAAb,GAAiB,IAAjB;AAC9B,SAvBmC,CAyBpC;;;AACA,YAAMK,aAAa,GAAGH,KAAK,CAAC7K,SAA5B;AACA,YAAIiL,OAAO,GAAG,EAAd;;AACA,YAAIX,WAAW,IAAIU,aAAa,CAAChc,MAAd,GAAuB,CAA1C,EAA6C;AACzCic,UAAAA,OAAO,GAAGD,aAAa,CAAClB,OAAd,CAAsBQ,WAAtB,EAAmC,EAAnC,EAAuC7N,IAAvC,EAAV;AACA,cAAIwO,OAAO,KAAKD,aAAhB,EAA+BN,YAAY,CAACC,CAAb,GAAiB,IAAjB;AAClC,SA/BmC,CAiCpC;;;AACA,YAAI7B,YAAJ,EAAkB;AACd,cAAI,CAACwB,WAAW,IAAI,CAACU,aAAjB,MAAoCX,WAAW,IAAI,CAACU,WAApD,KAAoE,CAACzd,KAArE,IAA8E,CAAC2d,OAA/E,IAA0FH,SAA9F,EAAyG;AACrGJ,YAAAA,YAAY,CAACC,CAAb,GAAiB,IAAjB;AACA,mBAAO,IAAP;AACH;AACJ,SAvCmC,CAyCpC;;;AACA,YAAIrd,KAAK,IAAI2d,OAAT,IAAoBJ,KAAK,CAAC1P,QAAN,KAAmBkO,WAAvC,IAAuDmB,QAAQ,CAACH,WAAD,CAAR,KAA0BG,QAAQ,CAACO,WAAD,CAAzF,IAA4GP,QAAQ,CAACF,WAAD,CAAR,KAA0BE,QAAQ,CAACQ,aAAD,CAAlJ,EAAoK;AAChK,cAAIX,WAAW,IAAIU,WAAW,CAAC/b,MAAZ,GAAqB,CAAxC,EAA2C6b,KAAK,CAACvd,KAAN,CAAYQ,OAAZ,GAAsBR,KAAtB;;AAC3C,cAAI,CAACud,KAAK,CAACvd,KAAN,CAAYQ,OAAjB,EAA0B;AACtB+c,YAAAA,KAAK,CAACK,eAAN,CAAsB,OAAtB;AACH;;AAED,cAAIZ,WAAW,IAAIU,aAAa,CAAChc,MAAd,GAAuB,CAA1C,EAA6C6b,KAAK,CAAC7K,SAAN,GAAkBiL,OAAO,CAACxO,IAAR,EAAlB;;AAC7C,cAAI,CAACoO,KAAK,CAAC7K,SAAN,CAAgBvD,IAAhB,EAAL,EAA6B;AACzBoO,YAAAA,KAAK,CAACK,eAAN,CAAsB,OAAtB;AACH;;AAED,cAAI,CAACL,KAAK,CAACvd,KAAN,CAAYQ,OAAb,IAAwB,CAAC+c,KAAK,CAAC7K,SAA/B,KAA6C6K,KAAK,CAAC1P,QAAN,KAAmBkO,WAAnB,IAAkCyB,SAA/E,CAAJ,EAA+F;AAC3FJ,YAAAA,YAAY,CAACC,CAAb,GAAiB,IAAjB;AACA,mBAAO,IAAP;AACH;;AAED,iBAAOE,KAAP;AACH;;AAEDH,QAAAA,YAAY,CAACC,CAAb,GAAiB,IAAjB;AACA,eAAO,IAAP;AACH,OA/DD,CApIyE,CAqMzE;;;AACA,UAAMhO,SAAS,GAAG,KAAKJ,mBAAL,CAAyB,IAAzB,CAAlB;AACA9F,MAAAA,KAAK,GAAG,KAAKC,QAAL,EAAR;AACA6B,MAAAA,QAAQ,GAAG9B,KAAK,CAACE,cAAjB;AACA6B,MAAAA,QAAQ,GAAG/B,KAAK,CAACQ,WAAjB;AACAwB,MAAAA,MAAM,GAAGhC,KAAK,CAACG,YAAf;AACA8B,MAAAA,MAAM,GAAGjC,KAAK,CAACgB,SAAf;;AAEA,UAAI,CAACzQ,IAAI,CAAC6U,gBAAL,CAAsBtD,QAAtB,EAAgC,IAAhC,CAAL,EAA4C;AACxCA,QAAAA,QAAQ,GAAGvR,IAAI,CAACiR,eAAL,CAAqB0E,SAAS,CAAC,CAAD,CAA9B,EAAmC,UAAUzE,OAAV,EAAmB;AAAE,iBAAOA,OAAO,CAACE,QAAR,KAAqB,CAA5B;AAAgC,SAAxF,EAA0F,KAA1F,CAAX;AACAI,QAAAA,QAAQ,GAAG,CAAX;AACH;;AAED,UAAI,CAACxR,IAAI,CAAC6U,gBAAL,CAAsBpD,MAAtB,EAA8B,IAA9B,CAAL,EAA0C;AACtCA,QAAAA,MAAM,GAAGzR,IAAI,CAACiR,eAAL,CAAqB0E,SAAS,CAACA,SAAS,CAAC3N,MAAV,GAAmB,CAApB,CAA9B,EAAsD,UAAUkJ,OAAV,EAAmB;AAAE,iBAAOA,OAAO,CAACE,QAAR,KAAqB,CAA5B;AAAgC,SAA3G,EAA6G,KAA7G,CAAT;AACAM,QAAAA,MAAM,GAAGD,MAAM,CAACJ,WAAP,CAAmBrJ,MAA5B;AACH;;AAGD,UAAMmc,OAAO,GAAGnkB,IAAI,CAAC6U,gBAAL,CAAsBtD,QAAtB,EAAgC,IAAhC,MAA0CvR,IAAI,CAAC6U,gBAAL,CAAsBpD,MAAtB,EAA8B,IAA9B,CAA1D;AACA,UAAM2S,SAAS,GAAGzO,SAAS,CAAC3N,MAAV,IAAoBmc,OAAO,GAAG,CAAH,GAAO,CAAlC,CAAlB,CAzNyE,CA2NzE;;AACAf,MAAAA,OAAO,GAAGrD,UAAU,CAACxI,SAAX,CAAqB,KAArB,CAAV;;AAEA,UAAM8M,cAAc,GAAGtC,cAAc,IAAKD,YAAY,IAAK,UAAUwC,GAAV,EAAe;AACtE,aAAK,IAAIC,CAAC,GAAG,CAAR,EAAWpb,KAAG,GAAGmb,GAAG,CAACtc,MAA1B,EAAkCuc,CAAC,GAAGpb,KAAtC,EAA2Cob,CAAC,EAA5C,EAAgD;AAC5C,cAAIvkB,IAAI,CAACwkB,iBAAL,CAAuBF,GAAG,CAACC,CAAD,CAA1B,KAAkCvkB,IAAI,CAACykB,WAAL,CAAiBH,GAAG,CAACC,CAAD,CAApB,CAAtC,EAAgE,OAAO,IAAP;AACnE;;AACD,eAAO,KAAP;AACH,OALyD,CAKvD3C,eALuD,CAA1D;;AAOA,UAAM8C,UAAU,GAAG5C,YAAY,IAAI9hB,IAAI,CAACykB,WAAL,CAAiBrB,OAAjB,CAAnC;;AACA,UAAMuB,kBAAkB,GAAG,KAAKC,uBAAL,CAA6Bta,IAA7B,CAAkCtK,IAAlC,EAAwCqkB,cAAxC,EAAwDK,UAAxD,CAA3B;;AACA,UAAMF,iBAAiB,GAAG,KAAKK,sBAAL,CAA4Bva,IAA5B,CAAiCtK,IAAjC,EAAuCqkB,cAAvC,EAAuDK,UAAvD,CAA1B,CAvOyE,CAyOzE;;;AACA,UAAIP,OAAJ,EAAa;AACT,YAAI,KAAKW,oBAAL,CAA0BnP,SAAS,CAAC,CAAD,CAAnC,EAAwCgM,UAAxC,CAAJ,EAAyDlS,KAAK,GAAG,KAAKe,QAAL,CAAce,QAAd,EAAwBC,QAAxB,EAAkCC,MAAlC,EAA0CC,MAA1C,CAAR;;AAEzD,YAAMqK,QAAQ,GAAG,KAAKgJ,mBAAL,CAAyBpP,SAAS,CAAC,CAAD,CAAlC,EAAuCyN,OAAvC,EAAgD5N,UAAhD,EAA4DjE,QAA5D,EAAsEC,QAAtE,EAAgFC,MAAhF,EAAwFC,MAAxF,EAAgGqQ,cAAhG,EAAgHD,YAAhH,EAA8HrS,KAAK,CAACgD,SAApI,EAA+IiR,YAA/I,EAA6JiB,kBAA7J,EAAiLH,iBAAjL,CAAjB;;AACAtB,QAAAA,KAAK,CAACxhB,SAAN,GAAkBqa,QAAQ,CAACpM,cAA3B;AACAuT,QAAAA,KAAK,CAAC7U,MAAN,GAAe0N,QAAQ,CAAC9L,WAAxB;AACAkT,QAAAA,GAAG,CAACzhB,SAAJ,GAAgBqa,QAAQ,CAACnM,YAAzB;AACAuT,QAAAA,GAAG,CAAC9U,MAAJ,GAAa0N,QAAQ,CAACtL,SAAtB;;AAEA,YAAIyS,KAAK,CAACxhB,SAAN,KAAoByhB,GAAG,CAACzhB,SAAxB,IAAqC1B,IAAI,CAAC8Y,kBAAL,CAAwBoK,KAAK,CAACxhB,SAA9B,CAAzC,EAAmF;AAC/EwhB,UAAAA,KAAK,CAAC7U,MAAN,GAAe8U,GAAG,CAAC9U,MAAJ,GAAa,CAA5B;AACH;;AACD,aAAK2W,mBAAL,CAAyBjJ,QAAQ,CAACvI,QAAlC,EAA4C,IAA5C;AACH,OAbD,MAaO;AAAE;AACL,YAAIyR,iBAAiB,GAAG,KAAxB;AACA,YAAIb,SAAS,GAAG,CAAZ,IAAiB,KAAKU,oBAAL,CAA0BnP,SAAS,CAACyO,SAAD,CAAnC,EAAgDzC,UAAhD,CAArB,EAAkFsD,iBAAiB,GAAG,IAApB;AAClF,YAAI,KAAKH,oBAAL,CAA0BnP,SAAS,CAAC,CAAD,CAAnC,EAAwCgM,UAAxC,CAAJ,EAAyDsD,iBAAiB,GAAG,IAApB;AACzD,YAAIA,iBAAJ,EAAuB,KAAKzU,QAAL,CAAce,QAAd,EAAwBC,QAAxB,EAAkCC,MAAlC,EAA0CC,MAA1C,EAJpB,CAMH;;AACA,YAAI0S,SAAS,GAAG,CAAhB,EAAmB;AACfhB,UAAAA,OAAO,GAAGrD,UAAU,CAACxI,SAAX,CAAqB,KAArB,CAAV;AACA4L,UAAAA,GAAG,GAAG,KAAK+B,mBAAL,CAAyBvP,SAAS,CAACyO,SAAD,CAAlC,EAA+ChB,OAA/C,EAAwD5N,UAAxD,EAAoE/D,MAApE,EAA4EC,MAA5E,EAAoFqQ,cAApF,EAAoGD,YAApG,EAAkH4B,YAAlH,EAAgIiB,kBAAhI,EAAoJH,iBAApJ,CAAN;AACH,SAVE,CAYH;;;AACA,aAAK,IAAI1c,GAAC,GAAGsc,SAAS,GAAG,CAApB,EAAuBrI,SAA5B,EAAsCjU,GAAC,GAAG,CAA1C,EAA6CA,GAAC,EAA9C,EAAkD;AAC9C,eAAKgd,oBAAL,CAA0BnP,SAAS,CAAC7N,GAAD,CAAnC,EAAwC6Z,UAAxC;;AACAyB,UAAAA,OAAO,GAAGrD,UAAU,CAACxI,SAAX,CAAqB,KAArB,CAAV;AACAwE,UAAAA,SAAQ,GAAG,KAAKoJ,sBAAL,CAA4BxP,SAAS,CAAC7N,GAAD,CAArC,EAA0Csb,OAA1C,EAAmD5N,UAAnD,EAA+DuM,cAA/D,EAA+ED,YAA/E,EAA6F4B,YAA7F,EAA2GP,GAAG,CAACzhB,SAA/G,CAAX;;AACA,cAAIqa,SAAQ,CAACnM,YAAT,IAAyBmM,SAAQ,CAACvI,QAAT,CAAkB9F,QAAlB,CAA2BqO,SAAQ,CAACnM,YAApC,CAA7B,EAAgF;AAC5EuT,YAAAA,GAAG,CAAC3P,QAAJ,GAAe,IAAf;AACA2P,YAAAA,GAAG,CAACzhB,SAAJ,GAAgBqa,SAAQ,CAACnM,YAAzB;AACH;;AACD,eAAKoV,mBAAL,CAAyBjJ,SAAQ,CAACvI,QAAlC,EAA4C,IAA5C;AACH,SAtBE,CAwBH;;;AACA4P,QAAAA,OAAO,GAAGrD,UAAU,CAACxI,SAAX,CAAqB,KAArB,CAAV;AACA2L,QAAAA,KAAK,GAAG,KAAKkC,qBAAL,CAA2BzP,SAAS,CAAC,CAAD,CAApC,EAAyCyN,OAAzC,EAAkD5N,UAAlD,EAA8DjE,QAA9D,EAAwEC,QAAxE,EAAkFuQ,cAAlF,EAAkGD,YAAlG,EAAgH4B,YAAhH,EAA8HiB,kBAA9H,EAAkJH,iBAAlJ,EAAqKrB,GAAG,CAACzhB,SAAzK,CAAR;;AAEA,YAAIwhB,KAAK,CAACtT,YAAV,EAAwB;AACpBuT,UAAAA,GAAG,CAAC3P,QAAJ,GAAe,IAAf;AACA2P,UAAAA,GAAG,CAACzhB,SAAJ,GAAgBwhB,KAAK,CAACtT,YAAtB;AACH;;AAED,YAAIwU,SAAS,IAAI,CAAjB,EAAoB;AAChBjB,UAAAA,GAAG,GAAGD,KAAN;AACH,SAFD,MAEO,IAAI,CAACC,GAAG,CAACzhB,SAAT,EAAoB;AACvByhB,UAAAA,GAAG,CAAC3P,QAAJ,GAAe,IAAf;AACA2P,UAAAA,GAAG,CAACzhB,SAAJ,GAAgBwhB,KAAK,CAACxhB,SAAtB;AACAyhB,UAAAA,GAAG,CAAC9U,MAAJ,GAAa6U,KAAK,CAACxhB,SAAN,CAAgB2P,WAAhB,CAA4BrJ,MAAzC;AACH;;AAED,aAAKgd,mBAAL,CAAyB9B,KAAK,CAAC1P,QAA/B,EAAyC,IAAzC;;AACA,aAAKwR,mBAAL,CAAyB7B,GAAG,CAAC3P,QAAJ,IAAgBxT,IAAI,CAAC6U,gBAAL,CAAsBsO,GAAG,CAACzhB,SAA1B,CAAzC,EAA+E,IAA/E;AACH,OAlSwE,CAoSzE;;;AACA,WAAKwI,cAAL;AACA,WAAKsG,QAAL,CAAc0S,KAAK,CAACxhB,SAApB,EAA+BwhB,KAAK,CAAC7U,MAArC,EAA6C8U,GAAG,CAACzhB,SAAjD,EAA4DyhB,GAAG,CAAC9U,MAAhE,EAtSyE,CAwSzE;;AACA,WAAKjN,OAAL,CAAa4H,IAAb,CAAkB,KAAlB;AACH,KAz3FQ;;AA23FT;AACR;AACA;AACA;AACA;AACA;AACQ8b,IAAAA,oBAAoB,EAAE,8BAAUrb,EAAV,EAAckY,UAAd,EAA0B;AAC5C,UAAI,CAAC3hB,IAAI,CAACuW,UAAL,CAAgB9M,EAAhB,CAAL,EAA0B;AAC1B,UAAI,CAACkY,UAAL,EAAiBA,UAAU,GAAG,KAAKhhB,UAAlB;AAEjB,UAAMqP,QAAQ,GAAGhQ,IAAI,CAACub,YAAL,CAAmB9R,EAAD,CAAK0H,UAAvB,EAAmC,UAAUD,OAAV,EAAmB;AAAE,eAAO,CAAClR,IAAI,CAAC0U,OAAL,CAAaxD,OAAb,CAAR;AAAgC,OAAxF,EAA0F,IAA1F,CAAjB;AACA,UAAMmU,QAAQ,GAAG5b,EAAE,CAACnD,KAApB;AAEA,UAAM0M,EAAE,GAAG,EAAX;AAAA,UAAesS,EAAE,GAAG,EAApB;AAAA,UAAwBC,MAAM,GAAGvlB,IAAI,CAACiiB,SAAL,CAAeoD,QAAf,CAAjC;;AACA,WAAK,IAAIvd,CAAC,GAAG,CAAR,EAAWqB,GAAG,GAAG,KAAKxI,UAAL,CAAgBqH,MAAtC,EAA8CF,CAAC,GAAGqB,GAAlD,EAAuDrB,CAAC,EAAxD,EAA4D;AACxD,YAAIyd,MAAM,CAACnY,OAAP,CAAe,KAAKzM,UAAL,CAAgBmH,CAAhB,CAAf,IAAqC,CAAC,CAAtC,IAA2C6Z,UAAU,CAACvU,OAAX,CAAmB,KAAKzM,UAAL,CAAgBmH,CAAhB,CAAnB,IAAyC,CAAC,CAAzF,EAA4F;AACxFkL,UAAAA,EAAE,CAAChK,IAAH,CAAQ,KAAKvI,UAAL,CAAgBqH,CAAhB,CAAR;AACAwd,UAAAA,EAAE,CAACtc,IAAH,CAAQ,KAAKrI,UAAL,CAAgBmH,CAAhB,CAAR;AACH;AACJ;;AAED,UAAI,CAACkL,EAAE,CAAChL,MAAR,EAAgB,OAf4B,CAiB5C;;AACA,UAAMwd,KAAK,GAAGxlB,IAAI,CAACoQ,aAAL,CAAmB,MAAnB,CAAd;;AACA,WAAK,IAAItI,IAAC,GAAG,CAAR,EAAWqB,KAAG,GAAG6J,EAAE,CAAChL,MAAzB,EAAiCF,IAAC,GAAGqB,KAArC,EAA0CrB,IAAC,EAA3C,EAA+C;AAC3C0d,QAAAA,KAAK,CAAClf,KAAN,CAAY0M,EAAE,CAAClL,IAAD,CAAd,IAAqBud,QAAQ,CAACC,EAAE,CAACxd,IAAD,CAAH,CAA7B;AACAud,QAAAA,QAAQ,CAACI,cAAT,CAAwBH,EAAE,CAACxd,IAAD,CAA1B;AACH;;AAED,UAAI4d,GAAG,GAAGF,KAAK,CAACjO,SAAN,CAAgB,KAAhB,CAAV;AACA,UAAIe,CAAC,GAAG,IAAR;AAAA,UAAcqN,SAAS,GAAG,KAA1B;;AAzB4C,0CA0BnC7d,IA1BmC,EA0B5BqB,KA1B4B;AA2BxC2R,QAAAA,EAAC,GAAG9K,QAAQ,CAAClI,IAAD,CAAZ;;AACA,YAAIxI,OAAO,CAACsmB,YAAR,CAAqB9K,EAAC,CAAC3G,QAAF,CAAW8E,WAAX,EAArB,CAAJ;AAAA;AAAA;AAAA;AAAoD;AAApD;AAAA;;AAEA2J,QAAAA,GAAC,GAAG5iB,IAAI,CAACiiB,SAAL,CAAenH,EAAC,CAACxU,KAAjB,CAAJ;;AACA,YAAIsc,GAAC,CAAC5a,MAAF,KAAa,CAAb,IAAmBgL,EAAE,CAACkP,IAAH,CAAQ,UAAUC,CAAV,EAAa;AAAA;AAAA;AAAC,iBAAOS,GAAC,CAACxV,OAAF,CAAU+U,CAAV,MAAiB,CAAC,CAAzB;AAA4B,SAAlD,KAAuDS,GAAC,CAACV,IAAF,CAAO,UAASC,CAAT,EAAY;AAACnP,UAAAA,EAAE,CAAC5F,OAAH,CAAW+U,CAAX,IAAgB,CAAC,CAAjB;AAAoB,SAAxC,CAA9E,EAA0H;AACtH7J,UAAAA,CAAC,GAAGwC,EAAC,CAAClG,WAAN;AACA8Q,UAAAA,GAAG,CAAC1b,WAAJ,CAAgB8Q,EAAhB;AACH,SAHD,MAGO,IAAI4K,GAAG,CAACvU,UAAJ,CAAenJ,MAAf,GAAwB,CAA5B,EAA+B;AAClCyB,UAAAA,EAAE,CAAC8G,YAAH,CAAgBmV,GAAhB,EAAqBpN,CAArB;AACAoN,UAAAA,GAAG,GAAGF,KAAK,CAACjO,SAAN,CAAgB,KAAhB,CAAN;AACAe,UAAAA,CAAC,GAAG,IAAJ;AACAqN,UAAAA,SAAS,GAAG,IAAZ;AACH;;AAvCuC;AAAA;AAAA;;AA0B5C,WAAK,IAAI7d,IAAC,GAAG,CAAR,EAAWqB,KAAG,GAAG6G,QAAQ,CAAChI,MAA1B,EAAkC8S,CAAlC,EAAqC8H,CAA1C,EAA6C9a,IAAC,GAAGqB,KAAjD,EAAsDrB,IAAC,EAAvD,EAA2D;AAAA,yBAApBgT,CAAoB,EAAjB8H,CAAiB,EAAlD9a,IAAkD,EAA3CqB,KAA2C;;AAAA,iCAEH;AAYvD;;AAED,UAAIuc,GAAG,CAACvU,UAAJ,CAAenJ,MAAf,GAAwB,CAA5B,EAA+B;AAC3ByB,QAAAA,EAAE,CAAC8G,YAAH,CAAgBmV,GAAhB,EAAqBpN,CAArB;AACAqN,QAAAA,SAAS,GAAG,IAAZ;AACH;;AACD,UAAI,CAACN,QAAQ,CAACrd,MAAd,EAAsB;AAClByB,QAAAA,EAAE,CAACya,eAAH,CAAmB,OAAnB;AACH;;AAED,aAAOyB,SAAP;AACH,KAp7FQ;;AAs7FT;AACR;AACA;AACA;AACA;AACA;AACQX,IAAAA,mBAAmB,EAAE,6BAAUvb,EAAV,EAAcoc,KAAd,EAAqB;AACtC,UAAI,CAAC7lB,IAAI,CAACuW,UAAL,CAAgB9M,EAAhB,CAAL,EAA0B;AAE1B,UAAMuG,QAAQ,GAAGhQ,IAAI,CAACub,YAAL,CAAkB,CAACsK,KAAK,IAAIpc,EAAV,EAAc0H,UAAhC,EAA4C,UAAUD,OAAV,EAAmB;AAAE,eAAO,CAAClR,IAAI,CAAC0U,OAAL,CAAaxD,OAAb,CAAR;AAAgC,OAAjG,EAAmG,IAAnG,CAAjB;AACA2U,MAAAA,KAAK,GAAG7V,QAAQ,CAAC,CAAD,CAAhB;AAEA,UAAI,CAAC6V,KAAD,IAAU7V,QAAQ,CAAChI,MAAT,GAAkB,CAA5B,IAAiC6d,KAAK,CAACzU,QAAN,KAAmB,CAAxD,EAA2D,OANrB,CAQtC;;AACA,UAAM0U,UAAU,GAAGD,KAAK,CAACvf,KAAzB;AACA,UAAMyf,OAAO,GAAGtc,EAAE,CAACnD,KAAnB;AACA,UAAM6N,QAAQ,GAAG0R,KAAK,CAAC1R,QAAN,CAAe8E,WAAf,EAAjB;AACA,UAAI0M,SAAS,GAAG,KAAhB,CAZsC,CActC;;AACA,UAAIrmB,OAAO,CAACsmB,YAAR,CAAqBzR,QAArB,MAAmC7U,OAAO,CAAC0mB,eAAR,CAAwBC,IAAxB,CAA6BhN,WAA7B,EAAvC,EAAmF8M,OAAO,CAACG,UAAR,GAAqB,MAArB;AACnF,UAAI5mB,OAAO,CAACsmB,YAAR,CAAqBzR,QAArB,MAAmC7U,OAAO,CAAC0mB,eAAR,CAAwBG,MAAxB,CAA+BlN,WAA/B,EAAvC,EAAqF8M,OAAO,CAACK,SAAR,GAAoB,QAApB,CAhB/C,CAkBtC;;AACA,UAAMC,KAAK,GAAGrmB,IAAI,CAACiiB,SAAL,CAAe6D,UAAf,CAAd;;AACA,UAAIO,KAAK,CAACre,MAAN,GAAe,CAAnB,EAAsB;AAClB,aAAK,IAAIF,CAAC,GAAG,CAAR,EAAWqB,GAAG,GAAG,KAAK1I,UAAL,CAAgBuH,MAAtC,EAA8CF,CAAC,GAAGqB,GAAlD,EAAuDrB,CAAC,EAAxD,EAA4D;AACxD,cAAIue,KAAK,CAACjZ,OAAN,CAAc,KAAKzM,UAAL,CAAgBmH,CAAhB,CAAd,IAAoC,CAAC,CAAzC,EAA4C;AACxCie,YAAAA,OAAO,CAAC,KAAKtlB,UAAL,CAAgBqH,CAAhB,CAAD,CAAP,GAA8Bge,UAAU,CAAC,KAAKrlB,UAAL,CAAgBqH,CAAhB,CAAD,CAAxC;AACAge,YAAAA,UAAU,CAACL,cAAX,CAA0B,KAAK9kB,UAAL,CAAgBmH,CAAhB,CAA1B;AACA6d,YAAAA,SAAS,GAAG,IAAZ;AACH;AACJ;AACJ;;AAED,WAAKX,mBAAL,CAAyBvb,EAAzB,EAA6Boc,KAA7B;;AACA,UAAI,CAACF,SAAL,EAAgB,OA/BsB,CAiCtC;;AACA,UAAI,CAACG,UAAU,CAAC9d,MAAhB,EAAwB;AACpB,YAAMse,EAAE,GAAGT,KAAK,CAAC1U,UAAjB;AACA,YAAM0N,CAAC,GAAGgH,KAAK,CAAC7Q,UAAhB;AACA,YAAMuP,CAAC,GAAGsB,KAAK,CAACjR,WAAhB;;AACA,eAAO0R,EAAE,CAACte,MAAH,GAAY,CAAnB,EAAsB;AAClB6W,UAAAA,CAAC,CAACtO,YAAF,CAAe+V,EAAE,CAAC,CAAD,CAAjB,EAAsB/B,CAAtB;AACH;;AACDvkB,QAAAA,IAAI,CAACsV,UAAL,CAAgBuQ,KAAhB;AACH;AACJ,KAv+FQ;;AAy+FT;AACR;AACA;AACA;AACA;AACQU,IAAAA,gBAAgB,EAAE,0BAAUhO,UAAV,EAAsB;AACpC,UAAM9Y,OAAO,GAAG8Y,UAAU,CAACvD,UAA3B;AACA,UAAI,CAACuD,UAAD,IAAeA,UAAU,CAACnH,QAAX,KAAwB,CAAvC,IAA4C,CAAC3R,OAAjD,EAA0D;AAE1D,UAAMuQ,QAAQ,GAAGuI,UAAU,CAACpH,UAA5B;;AACA,aAAOnB,QAAQ,CAAC,CAAD,CAAf,EAAoB;AAChBvQ,QAAAA,OAAO,CAAC8Q,YAAR,CAAqBP,QAAQ,CAAC,CAAD,CAA7B,EAAkCuI,UAAlC;AACH;;AAED9Y,MAAAA,OAAO,CAACsb,WAAR,CAAoBxC,UAApB;AACH,KAx/FQ;;AA0/FT;AACR;AACA;AACA;AACA;AACA;AACQqM,IAAAA,uBAAuB,EAAE,iCAAU4B,SAAV,EAAqB/B,WAArB,EAAkChlB,OAAlC,EAA2C;AAChE,UAAI,CAACA,OAAD,IAAY+mB,SAAhB,EAA2B,OAAO,IAAP;AAC3B,aAAO,KAAKpX,gBAAL,CAAsB3P,OAAtB,EAA+B,KAAK+kB,iBAAL,CAAuBla,IAAvB,CAA4B,IAA5B,CAA/B,MAAsE,CAACma,WAAD,GAAe,KAAKrV,gBAAL,CAAsB3P,OAAtB,EAA+B,KAAKglB,WAAL,CAAiBna,IAAjB,CAAsB,IAAtB,CAA/B,CAAf,GAA6E,IAAnJ,CAAP;AACH,KAngGQ;;AAqgGT;AACR;AACA;AACA;AACA;AACA;AACQua,IAAAA,sBAAsB,EAAE,gCAAU2B,SAAV,EAAqB/B,WAArB,EAAkChlB,OAAlC,EAA2C;AAC/D,UAAI,CAACA,OAAD,IAAY+mB,SAAZ,IAAyB/mB,OAAO,CAAC2R,QAAR,KAAqB,CAAlD,EAAqD,OAAO,KAAP;;AACrD,UAAMqV,MAAM,GAAG,KAAKjC,iBAAL,CAAuB/kB,OAAvB,CAAf;;AACA,aAAO,KAAK2P,gBAAL,CAAsB3P,OAAtB,EAA+B,KAAK+kB,iBAAL,CAAuBla,IAAvB,CAA4B,IAA5B,CAA/B,IAAoEmc,MAApE,GAA8EA,MAAM,KAAK,CAAChC,WAAD,GAAe,KAAKA,WAAL,CAAiBhlB,OAAjB,CAAf,GAA2C,KAAhD,CAA3F;AACH,KA/gGQ;;AAihGT;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQslB,IAAAA,mBAAmB,EAAE,6BAAUtlB,OAAV,EAAmBinB,YAAnB,EAAiClR,UAAjC,EAA6CjE,QAA7C,EAAuDC,QAAvD,EAAiEC,MAAjE,EAAyEC,MAAzE,EAAiFqQ,cAAjF,EAAiGD,YAAjG,EAA+GrP,SAA/G,EAA0HiR,YAA1H,EAAwIiB,kBAAxI,EAA4JH,iBAA5J,EAA+K;AAChM;AACA,UAAImC,SAAS,GAAGpV,QAAQ,CAACyD,UAAzB;;AACA,aAAO,CAAC2R,SAAS,CAAC/R,WAAX,IAA0B,CAAC+R,SAAS,CAACtR,eAArC,IAAwD,CAACrV,IAAI,CAACkQ,eAAL,CAAqByW,SAAS,CAAC3R,UAA/B,CAAzD,IAAuG,CAAChV,IAAI,CAAC6P,YAAL,CAAkB8W,SAAS,CAAC3R,UAA5B,CAA/G,EAAwJ;AACpJ,YAAI2R,SAAS,CAACxS,QAAV,KAAuBuS,YAAY,CAACvS,QAAxC,EAAkD;AAClDwS,QAAAA,SAAS,GAAGA,SAAS,CAAC3R,UAAtB;AACH;;AAED,UAAI,CAAC8M,YAAD,IAAiB6E,SAAS,KAAKlV,MAAM,CAACuD,UAAtC,IAAoD2R,SAAS,CAACxS,QAAV,KAAuBuS,YAAY,CAACvS,QAA5F,EAAsG;AAClG,YAAInU,IAAI,CAAC8Y,kBAAL,CAAwBvH,QAAQ,CAACF,WAAT,CAAqBqF,KAArB,CAA2B,CAA3B,EAA8BlF,QAA9B,CAAxB,KAAoExR,IAAI,CAAC8Y,kBAAL,CAAwBrH,MAAM,CAACJ,WAAP,CAAmBqF,KAAnB,CAAyBhF,MAAzB,CAAxB,CAAxE,EAAmI;AAC/H,cAAM1B,QAAQ,GAAG2W,SAAS,CAACxV,UAA3B;AACA,cAAIyV,OAAO,GAAG,IAAd;;AAEA,eAAK,IAAI9e,CAAC,GAAG,CAAR,EAAWqB,GAAG,GAAG6G,QAAQ,CAAChI,MAA1B,EAAkC8S,GAAlC,EAAqC8H,GAArC,EAAwCtV,CAAxC,EAA2CuZ,CAAhD,EAAmD/e,CAAC,GAAGqB,GAAvD,EAA4DrB,CAAC,EAA7D,EAAiE;AAC7DgT,YAAAA,GAAC,GAAG9K,QAAQ,CAAClI,CAAD,CAAZ;AACA+e,YAAAA,CAAC,GAAG,CAAC7mB,IAAI,CAAC8Y,kBAAL,CAAwBgC,GAAxB,CAAL;;AACA,gBAAIA,GAAC,KAAKvJ,QAAV,EAAoB;AAChBqR,cAAAA,GAAC,GAAG,IAAJ;AACA;AACH;;AACD,gBAAI9H,GAAC,KAAKrJ,MAAV,EAAkB;AACdnE,cAAAA,CAAC,GAAG,IAAJ;AACA;AACH;;AACD,gBAAK,CAACsV,GAAD,IAAMiE,CAAP,IAAcjE,GAAC,IAAItV,CAAL,IAAUuZ,CAA5B,EAAgC;AAC5BD,cAAAA,OAAO,GAAG,KAAV;AACA;AACH;AACJ;;AAED,cAAIA,OAAJ,EAAa;AACT5mB,YAAAA,IAAI,CAACiY,iBAAL,CAAuB0O,SAAvB,EAAkCD,YAAlC;AAEA,mBAAO;AACHlT,cAAAA,QAAQ,EAAE/T,OADP;AAEHkQ,cAAAA,cAAc,EAAE4B,QAFb;AAGHtB,cAAAA,WAAW,EAAEuB,QAHV;AAIH5B,cAAAA,YAAY,EAAE6B,MAJX;AAKHhB,cAAAA,SAAS,EAAEiB;AALR,aAAP;AAOH;AACJ;AACJ,OA1C+L,CA4ChM;;;AACAgS,MAAAA,YAAY,CAACC,CAAb,GAAiB,KAAjB;AACA,UAAMla,EAAE,GAAGhK,OAAX;AACA,UAAMqnB,UAAU,GAAG,CAACJ,YAAD,CAAnB;AACA,UAAMK,KAAK,GAAGtnB,OAAO,CAAC8X,SAAR,CAAkB,KAAlB,CAAd;AACA,UAAMyP,UAAU,GAAGzV,QAAQ,KAAKE,MAAhC;AACA,UAAI9B,cAAc,GAAG4B,QAArB;AACA,UAAItB,WAAW,GAAGuB,QAAlB;AACA,UAAI5B,YAAY,GAAG6B,MAAnB;AACA,UAAIhB,SAAS,GAAGiB,MAAhB;AACA,UAAIuV,SAAS,GAAG,KAAhB;AACA,UAAIC,OAAO,GAAG,KAAd;AACA,UAAIC,QAAJ,EAAc/D,OAAd,EAAuBrD,UAAvB,EAAmCjZ,OAAnC,EAA4CiM,UAA5C;AAEA,UAAMqP,OAAO,GAAGviB,EAAE,CAAC4F,MAAnB;;AACA,eAAS2hB,QAAT,CAAmBvD,KAAnB,EAA0B;AACtB,YAAMjf,MAAM,GAAG,IAAIwd,OAAJ,CAAY,mBAAmBtb,OAAnB,GAA6B,4BAAzC,EAAuE,IAAvE,CAAf;AACA,YAAIR,KAAK,GAAG,EAAZ;;AAEA,YAAI1B,MAAM,IAAIif,KAAK,CAACvd,KAAN,CAAYQ,OAAZ,CAAoBkB,MAApB,GAA6B,CAA3C,EAA8C;AAC1C1B,UAAAA,KAAK,GAAG1B,MAAM,CAAC+I,IAAP,CAAYkW,KAAK,CAACvd,KAAN,CAAYQ,OAAxB,CAAR;AACH;;AAED,eAAO,CAACR,KAAR;AACH;;AAED,OAAC,SAAS+gB,aAAT,CAAuBnW,OAAvB,EAAgCsC,QAAhC,EAA0C;AACvC,YAAMrC,UAAU,GAAGD,OAAO,CAACC,UAA3B;;AAEA,aAAK,IAAIrJ,IAAC,GAAG,CAAR,EAAWqB,KAAG,GAAGgI,UAAU,CAACnJ,MAA5B,EAAoC6b,KAAzC,EAAgD/b,IAAC,GAAGqB,KAApD,EAAyDrB,IAAC,EAA1D,EAA8D;AAC1D,cAAI+d,KAAK,GAAG1U,UAAU,CAACrJ,IAAD,CAAtB;AACA,cAAI,CAAC+d,KAAL,EAAY;AACZ,cAAIyB,SAAS,GAAG9T,QAAhB;AACA,cAAI+D,SAAS,SAAb,CAJ0D,CAM1D;;AACA,cAAI,CAAC0P,SAAD,IAAcpB,KAAK,KAAKlW,cAA5B,EAA4C;AACxC,gBAAI8G,IAAI,GAAGsQ,KAAX;AACAhU,YAAAA,UAAU,GAAG4R,kBAAkB,CAACkB,KAAD,CAA/B;AACA,gBAAM0B,QAAQ,GAAGvnB,IAAI,CAACkV,cAAL,CAAoBvF,cAAc,CAACyB,QAAf,KAA4B,CAA5B,GAAgC,EAAhC,GAAqCzB,cAAc,CAACoN,aAAf,CAA6B,CAA7B,EAAgC9M,WAAhC,CAAzD,CAAjB;AACA,gBAAMuX,QAAQ,GAAGxnB,IAAI,CAACkV,cAAL,CAAoBvF,cAAc,CAACyB,QAAf,KAA4B,CAA5B,GAAgC,EAAhC,GAAqCzB,cAAc,CAACoN,aAAf,CAA6B9M,WAA7B,EAClE+W,UAAU,GACTvW,SAAS,IAAIR,WAAb,GAA2BQ,SAAS,GAAGR,WAAvC,GAAqDN,cAAc,CAACiN,IAAf,CAAoB5U,MAApB,GAA6BiI,WADzE,GAEVN,cAAc,CAACiN,IAAf,CAAoB5U,MAApB,GAA6BiI,WAHqC,CAAzD,CAAjB;;AAMA,gBAAI8C,UAAJ,EAAgB;AACZ,kBAAM0U,CAAC,GAAG9C,kBAAkB,CAACnR,QAAD,CAA5B;;AACA,kBAAIiU,CAAC,IAAIA,CAAC,CAACzS,UAAF,KAAiByB,IAA1B,EAAgC;AAC5B,oBAAIiR,CAAC,GAAGD,CAAR;AACA,oBAAI5I,CAAC,GAAG,IAAR;;AACA,uBAAO6I,CAAC,CAAC1S,UAAF,KAAiByB,IAAxB,EAA8B;AAC1BjD,kBAAAA,QAAQ,GAAGqL,CAAC,GAAG6I,CAAC,CAAC1S,UAAF,CAAauC,SAAb,CAAuB,KAAvB,CAAf;;AACA,yBAAMmQ,CAAC,CAACvW,UAAF,CAAa,CAAb,CAAN,EAAuB;AACnB0N,oBAAAA,CAAC,CAAC7U,WAAF,CAAc0d,CAAC,CAACvW,UAAF,CAAa,CAAb,CAAd;AACH;;AACDuW,kBAAAA,CAAC,CAAC1d,WAAF,CAAc6U,CAAd;AACA6I,kBAAAA,CAAC,GAAGA,CAAC,CAAC1S,UAAN;AACH;;AACD0S,gBAAAA,CAAC,CAAC1S,UAAF,CAAahL,WAAb,CAAyByd,CAAzB;AACH;;AACD1U,cAAAA,UAAU,GAAGA,UAAU,CAACwE,SAAX,CAAqB,KAArB,CAAb;AACH;;AAED,gBAAI,CAACvX,IAAI,CAAC8Y,kBAAL,CAAwByO,QAAxB,CAAL,EAAwC;AACpC/T,cAAAA,QAAQ,CAACxJ,WAAT,CAAqBud,QAArB;AACH;;AAED,gBAAMI,cAAc,GAAGhD,kBAAkB,CAACnR,QAAD,CAAzC;;AACA,gBAAI,CAAC,CAACmU,cAAN,EAAsB5U,UAAU,GAAG4U,cAAb;AACtB,gBAAI5U,UAAJ,EAAgB0D,IAAI,GAAG1D,UAAP;AAEhBqQ,YAAAA,OAAO,GAAGyC,KAAV;AACAsB,YAAAA,QAAQ,GAAG,EAAX;AACArgB,YAAAA,OAAO,GAAG,EAAV;;AACA,mBAAOsc,OAAO,KAAK3M,IAAZ,IAAoB2M,OAAO,KAAK3Z,EAAhC,IAAsC2Z,OAAO,KAAK,IAAzD,EAA+D;AAC3DS,cAAAA,KAAK,GAAGW,iBAAiB,CAACpB,OAAD,CAAjB,GAA6B,IAA7B,GAAoC5N,UAAU,CAAC4N,OAAD,CAAtD;;AACA,kBAAIS,KAAK,IAAIT,OAAO,CAAChS,QAAR,KAAqB,CAA9B,IAAmCgW,QAAQ,CAAChE,OAAD,CAA/C,EAA0D;AACtD+D,gBAAAA,QAAQ,CAACne,IAAT,CAAc6a,KAAd;AACA/c,gBAAAA,OAAO,IAAIsc,OAAO,CAAC9c,KAAR,CAAcQ,OAAd,CAAsB8gB,MAAtB,CAA6B,CAA7B,EAAgCxE,OAAO,CAAC9c,KAAR,CAAcQ,OAAd,CAAsBsG,OAAtB,CAA8B,GAA9B,CAAhC,IAAsE,GAAjF;AACH;;AACDgW,cAAAA,OAAO,GAAGA,OAAO,CAACpO,UAAlB;AACH;;AAED,gBAAM6S,SAAS,GAAGV,QAAQ,CAACW,GAAT,MAAkBN,QAApC;AACAzH,YAAAA,UAAU,GAAGqD,OAAO,GAAGyE,SAAvB;;AACA,mBAAOV,QAAQ,CAACnf,MAAT,GAAkB,CAAzB,EAA4B;AACxBob,cAAAA,OAAO,GAAG+D,QAAQ,CAACW,GAAT,EAAV;AACA/H,cAAAA,UAAU,CAAC/V,WAAX,CAAuBoZ,OAAvB;AACArD,cAAAA,UAAU,GAAGqD,OAAb;AACH;;AAEDsD,YAAAA,YAAY,CAAC1c,WAAb,CAAyB6d,SAAzB;AACApR,YAAAA,IAAI,CAACzM,WAAL,CAAiB0c,YAAjB;;AAEA,gBAAI3T,UAAU,IAAI,CAAC4R,kBAAkB,CAAC/U,YAAD,CAArC,EAAqD;AACjD8W,cAAAA,YAAY,GAAGA,YAAY,CAACnP,SAAb,CAAuB,KAAvB,CAAf;AACAwP,cAAAA,KAAK,CAAC/c,WAAN,CAAkB0c,YAAlB;AACAI,cAAAA,UAAU,CAAC9d,IAAX,CAAgB0d,YAAhB;AACH;;AAED/W,YAAAA,cAAc,GAAG6X,QAAjB;AACAvX,YAAAA,WAAW,GAAG,CAAd;AACAgX,YAAAA,SAAS,GAAG,IAAZ;AAEA,gBAAI7D,OAAO,KAAKoE,QAAhB,EAA0BpE,OAAO,CAACpZ,WAAR,CAAoB2F,cAApB;AAC1B,gBAAI,CAACqX,UAAL,EAAiB;AACpB,WA9EyD,CAgF1D;;;AACA,cAAI,CAACE,OAAD,IAAYrB,KAAK,KAAKjW,YAA1B,EAAwC;AACpCmD,YAAAA,UAAU,GAAG4R,kBAAkB,CAACkB,KAAD,CAA/B;AACA,gBAAM9L,SAAS,GAAG/Z,IAAI,CAACkV,cAAL,CAAoBtF,YAAY,CAACwB,QAAb,KAA0B,CAA1B,GAA8B,EAA9B,GAAmCxB,YAAY,CAACmN,aAAb,CAA2BtM,SAA3B,EAAuCb,YAAY,CAAC5H,MAAb,GAAsByI,SAA7D,CAAvD,CAAlB;;AACA,gBAAM+W,SAAQ,GAAGxnB,IAAI,CAACkV,cAAL,CAAoB8R,UAAU,IAAIpX,YAAY,CAACwB,QAAb,KAA0B,CAAxC,GAA4C,EAA5C,GAAiDxB,YAAY,CAACmN,aAAb,CAA2B,CAA3B,EAA8BtM,SAA9B,CAArE,CAAjB;;AAEA,gBAAIsC,UAAJ,EAAgB;AACZA,cAAAA,UAAU,GAAGA,UAAU,CAACwE,SAAX,CAAqB,KAArB,CAAb;AACH,aAFD,MAEO,IAAIiN,iBAAiB,CAACkC,YAAY,CAAC1R,UAAd,CAAjB,IAA8C,CAACjC,UAAnD,EAA+D;AAClE2T,cAAAA,YAAY,GAAGA,YAAY,CAACnP,SAAb,CAAuB,KAAvB,CAAf;AACAwP,cAAAA,KAAK,CAAC/c,WAAN,CAAkB0c,YAAlB;AACAI,cAAAA,UAAU,CAAC9d,IAAX,CAAgB0d,YAAhB;AACH;;AAED,gBAAI,CAAC1mB,IAAI,CAAC8Y,kBAAL,CAAwBiB,SAAxB,CAAL,EAAyC;AACrCqJ,cAAAA,OAAO,GAAGyC,KAAV;AACA/e,cAAAA,OAAO,GAAG,EAAV;AACAqgB,cAAAA,QAAQ,GAAG,EAAX;AACA,kBAAMY,OAAO,GAAG,EAAhB;;AACA,qBAAO3E,OAAO,KAAK2D,KAAZ,IAAqB3D,OAAO,KAAK3Z,EAAjC,IAAuC2Z,OAAO,KAAK,IAA1D,EAAgE;AAC5D,oBAAIA,OAAO,CAAChS,QAAR,KAAqB,CAArB,IAA0BgW,QAAQ,CAAChE,OAAD,CAAtC,EAAiD;AAC7C,sBAAIoB,iBAAiB,CAACpB,OAAD,CAArB,EAAgC2E,OAAO,CAAC/e,IAAR,CAAaoa,OAAO,CAAC7L,SAAR,CAAkB,KAAlB,CAAb,EAAhC,KACK4P,QAAQ,CAACne,IAAT,CAAcoa,OAAO,CAAC7L,SAAR,CAAkB,KAAlB,CAAd;AACLzQ,kBAAAA,OAAO,IAAIsc,OAAO,CAAC9c,KAAR,CAAcQ,OAAd,CAAsB8gB,MAAtB,CAA6B,CAA7B,EAAgCxE,OAAO,CAAC9c,KAAR,CAAcQ,OAAd,CAAsBsG,OAAtB,CAA8B,GAA9B,CAAhC,IAAsE,GAAjF;AACH;;AACDgW,gBAAAA,OAAO,GAAGA,OAAO,CAACpO,UAAlB;AACH;;AACDmS,cAAAA,QAAQ,GAAGA,QAAQ,CAACa,MAAT,CAAgBD,OAAhB,CAAX;AAEAxQ,cAAAA,SAAS,GAAGwI,UAAU,GAAGqD,OAAO,GAAG+D,QAAQ,CAACW,GAAT,MAAkB/N,SAArD;;AACA,qBAAOoN,QAAQ,CAACnf,MAAT,GAAkB,CAAzB,EAA4B;AACxBob,gBAAAA,OAAO,GAAG+D,QAAQ,CAACW,GAAT,EAAV;AACA/H,gBAAAA,UAAU,CAAC/V,WAAX,CAAuBoZ,OAAvB;AACArD,gBAAAA,UAAU,GAAGqD,OAAb;AACH;;AAED2D,cAAAA,KAAK,CAAC/c,WAAN,CAAkBuN,SAAlB;AACA6L,cAAAA,OAAO,CAAC/R,WAAR,GAAsB0I,SAAS,CAAC6C,IAAhC;AACH;;AAED,gBAAI7J,UAAU,IAAIwE,SAAlB,EAA6B;AACzB,kBAAM0Q,eAAe,GAAGtD,kBAAkB,CAACpN,SAAD,CAA1C;;AACA,kBAAI0Q,eAAJ,EAAqB;AACjBlV,gBAAAA,UAAU,GAAGkV,eAAb;AACH;AACJ;;AAED7E,YAAAA,OAAO,GAAGyC,KAAV;AACAsB,YAAAA,QAAQ,GAAG,EAAX;AACArgB,YAAAA,OAAO,GAAG,EAAV;;AACA,mBAAOsc,OAAO,KAAK2D,KAAZ,IAAqB3D,OAAO,KAAK3Z,EAAjC,IAAuC2Z,OAAO,KAAK,IAA1D,EAAgE;AAC5DS,cAAAA,KAAK,GAAGW,iBAAiB,CAACpB,OAAD,CAAjB,GAA6B,IAA7B,GAAoC5N,UAAU,CAAC4N,OAAD,CAAtD;;AACA,kBAAIS,KAAK,IAAIT,OAAO,CAAChS,QAAR,KAAqB,CAA9B,IAAmCgW,QAAQ,CAAChE,OAAD,CAA/C,EAA0D;AACtD+D,gBAAAA,QAAQ,CAACne,IAAT,CAAc6a,KAAd;AACA/c,gBAAAA,OAAO,IAAIsc,OAAO,CAAC9c,KAAR,CAAcQ,OAAd,CAAsB8gB,MAAtB,CAA6B,CAA7B,EAAgCxE,OAAO,CAAC9c,KAAR,CAAcQ,OAAd,CAAsBsG,OAAtB,CAA8B,GAA9B,CAAhC,IAAsE,GAAjF;AACH;;AACDgW,cAAAA,OAAO,GAAGA,OAAO,CAACpO,UAAlB;AACH;;AAED,gBAAM6S,UAAS,GAAGV,QAAQ,CAACW,GAAT,MAAkBN,SAApC;;AACAzH,YAAAA,UAAU,GAAGqD,OAAO,GAAGyE,UAAvB;;AACA,mBAAOV,QAAQ,CAACnf,MAAT,GAAkB,CAAzB,EAA4B;AACxBob,cAAAA,OAAO,GAAG+D,QAAQ,CAACW,GAAT,EAAV;AACA/H,cAAAA,UAAU,CAAC/V,WAAX,CAAuBoZ,OAAvB;AACArD,cAAAA,UAAU,GAAGqD,OAAb;AACH;;AAED,gBAAIrQ,UAAJ,EAAgB;AACZ2T,cAAAA,YAAY,GAAGA,YAAY,CAACnP,SAAb,CAAuB,KAAvB,CAAf;AACAmP,cAAAA,YAAY,CAAC1c,WAAb,CAAyB6d,UAAzB;AACA9U,cAAAA,UAAU,CAACxC,YAAX,CAAwBmW,YAAxB,EAAsC3T,UAAU,CAACiB,UAAjD;AACA+S,cAAAA,KAAK,CAAC/c,WAAN,CAAkB+I,UAAlB;AACA+T,cAAAA,UAAU,CAAC9d,IAAX,CAAgB0d,YAAhB;AACA3T,cAAAA,UAAU,GAAG,IAAb;AACH,aAPD,MAOO;AACH2T,cAAAA,YAAY,CAAC1c,WAAb,CAAyB6d,UAAzB;AACH;;AAEDjY,YAAAA,YAAY,GAAG4X,SAAf;AACA/W,YAAAA,SAAS,GAAG+W,SAAQ,CAAC5K,IAAT,CAAc5U,MAA1B;AACAkf,YAAAA,OAAO,GAAG,IAAV;;AAEA,gBAAI,CAACnF,cAAD,IAAmBtP,SAAvB,EAAkC;AAC9BiU,cAAAA,YAAY,GAAGc,SAAf;AACAA,cAAAA,SAAQ,CAACnW,WAAT,GAAuBrR,IAAI,CAACmV,cAA5B;AACH;;AAED,gBAAIiO,OAAO,KAAKoE,SAAhB,EAA0BpE,OAAO,CAACpZ,WAAR,CAAoB4F,YAApB;AAC1B;AACH,WAzKyD,CA2K1D;;;AACA,cAAIqX,SAAJ,EAAe;AACX,gBAAIpB,KAAK,CAACzU,QAAN,KAAmB,CAAnB,IAAwB,CAACpR,IAAI,CAAC0U,OAAL,CAAamR,KAAb,CAA7B,EAAkD;AAC9C,kBAAI7lB,IAAI,CAACic,mBAAL,CAAyB4J,KAAzB,CAAJ,EAAqC;AACjCkB,gBAAAA,KAAK,CAAC/c,WAAN,CAAkB6b,KAAK,CAACtO,SAAN,CAAgB,IAAhB,CAAlB;;AACA,oBAAI,CAAC9E,SAAL,EAAgB;AACZiU,kBAAAA,YAAY,GAAGA,YAAY,CAACnP,SAAb,CAAuB,KAAvB,CAAf;AACAwP,kBAAAA,KAAK,CAAC/c,WAAN,CAAkB0c,YAAlB;AACAI,kBAAAA,UAAU,CAAC9d,IAAX,CAAgB0d,YAAhB;AACH;AACJ,eAPD,MAOO;AACHW,gBAAAA,aAAa,CAACxB,KAAD,EAAQA,KAAR,CAAb;AACH;;AACD;AACH;;AAEDzC,YAAAA,OAAO,GAAGyC,KAAV;AACAsB,YAAAA,QAAQ,GAAG,EAAX;AACArgB,YAAAA,OAAO,GAAG,EAAV;AACA,gBAAMihB,QAAO,GAAG,EAAhB;;AACA,mBAAO3E,OAAO,CAACpO,UAAR,KAAuB,IAAvB,IAA+BoO,OAAO,KAAK3Z,EAA3C,IAAiD2Z,OAAO,KAAKsD,YAApE,EAAkF;AAC9E7C,cAAAA,KAAK,GAAGqD,OAAO,GAAG9D,OAAO,CAAC7L,SAAR,CAAkB,KAAlB,CAAH,GAA8B/B,UAAU,CAAC4N,OAAD,CAAvD;;AACA,kBAAIA,OAAO,CAAChS,QAAR,KAAqB,CAArB,IAA0B,CAACpR,IAAI,CAAC0U,OAAL,CAAamR,KAAb,CAA3B,IAAkDhC,KAAlD,IAA2DuD,QAAQ,CAAChE,OAAD,CAAvE,EAAkF;AAC9E,oBAAIoB,iBAAiB,CAACpB,OAAD,CAArB,EAAgC;AAC5B,sBAAI,CAACrQ,UAAL,EAAiBgV,QAAO,CAAC/e,IAAR,CAAa6a,KAAb;AACpB,iBAFD,MAEO;AACHsD,kBAAAA,QAAQ,CAACne,IAAT,CAAc6a,KAAd;AACH;;AACD/c,gBAAAA,OAAO,IAAIsc,OAAO,CAAC9c,KAAR,CAAcQ,OAAd,CAAsB8gB,MAAtB,CAA6B,CAA7B,EAAgCxE,OAAO,CAAC9c,KAAR,CAAcQ,OAAd,CAAsBsG,OAAtB,CAA8B,GAA9B,CAAhC,IAAsE,GAAjF;AACH;;AACDgW,cAAAA,OAAO,GAAGA,OAAO,CAACpO,UAAlB;AACH;;AACDmS,YAAAA,QAAQ,GAAGA,QAAQ,CAACa,MAAT,CAAgBD,QAAhB,CAAX;;AAEA,gBAAMF,WAAS,GAAGV,QAAQ,CAACW,GAAT,MAAkBjC,KAApC;;AACA9F,YAAAA,UAAU,GAAGqD,OAAO,GAAGyE,WAAvB;;AACA,mBAAOV,QAAQ,CAACnf,MAAT,GAAkB,CAAzB,EAA4B;AACxBob,cAAAA,OAAO,GAAG+D,QAAQ,CAACW,GAAT,EAAV;AACA/H,cAAAA,UAAU,CAAC/V,WAAX,CAAuBoZ,OAAvB;AACArD,cAAAA,UAAU,GAAGqD,OAAb;AACH;;AAED,gBAAIoB,iBAAiB,CAACkC,YAAY,CAAC1R,UAAd,CAAjB,IAA8C,CAACwP,iBAAiB,CAACqD,WAAD,CAAhE,IAA+E,CAAC7nB,IAAI,CAAC8Y,kBAAL,CAAwB4N,YAAxB,CAApF,EAA2H;AACvHA,cAAAA,YAAY,GAAGA,YAAY,CAACnP,SAAb,CAAuB,KAAvB,CAAf;AACAwP,cAAAA,KAAK,CAAC/c,WAAN,CAAkB0c,YAAlB;AACAI,cAAAA,UAAU,CAAC9d,IAAX,CAAgB0d,YAAhB;AACH;;AAED,gBAAI,CAACQ,OAAD,IAAY,CAACnU,UAAb,IAA2ByR,iBAAiB,CAACqD,WAAD,CAAhD,EAA6D;AACzDnB,cAAAA,YAAY,GAAGA,YAAY,CAACnP,SAAb,CAAuB,KAAvB,CAAf;AACA,kBAAM2Q,SAAS,GAAGL,WAAS,CAAC1W,UAA5B;;AACA,mBAAK,IAAIsW,EAAC,GAAG,CAAR,EAAWU,IAAI,GAAGD,SAAS,CAAClgB,MAAjC,EAAyCyf,EAAC,GAAGU,IAA7C,EAAmDV,EAAC,EAApD,EAAwD;AACpDf,gBAAAA,YAAY,CAAC1c,WAAb,CAAyBke,SAAS,CAACT,EAAD,CAAlC;AACH;;AACDI,cAAAA,WAAS,CAAC7d,WAAV,CAAsB0c,YAAtB;;AACAK,cAAAA,KAAK,CAAC/c,WAAN,CAAkB6d,WAAlB;AACAf,cAAAA,UAAU,CAAC9d,IAAX,CAAgB0d,YAAhB;AACA,kBAAIA,YAAY,CAAC1W,QAAb,CAAsBhI,MAAtB,GAA+B,CAAnC,EAAsCwL,QAAQ,GAAG4P,OAAX,CAAtC,KACK5P,QAAQ,GAAGkT,YAAX;AACR,aAXD,MAWO,IAAImB,WAAS,KAAKhC,KAAlB,EAAyB;AAC5B,kBAAI,CAACqB,OAAL,EAAc1T,QAAQ,GAAGkT,YAAX,CAAd,KACKlT,QAAQ,GAAGuT,KAAX;AACR,aAHM,MAGA,IAAIG,OAAJ,EAAa;AAChBH,cAAAA,KAAK,CAAC/c,WAAN,CAAkB6d,WAAlB;AACArU,cAAAA,QAAQ,GAAG4P,OAAX;AACH,aAHM,MAGA;AACHsD,cAAAA,YAAY,CAAC1c,WAAb,CAAyB6d,WAAzB;AACArU,cAAAA,QAAQ,GAAG4P,OAAX;AACH;;AAED,gBAAIrQ,UAAU,IAAI8S,KAAK,CAACzU,QAAN,KAAmB,CAArC,EAAwC;AACpC,kBAAIuT,kBAAkB,CAACkB,KAAD,CAAtB,EAA+B;AAC3B,oBAAMuC,kBAAkB,GAAGpoB,IAAI,CAACoP,gBAAL,CAAsBoE,QAAtB,EAAgC,UAAUtC,OAAV,EAAmB;AAAC,yBAAO,KAAKsT,iBAAL,CAAuBtT,OAAO,CAAC8D,UAA/B,KAA8C9D,OAAO,CAAC8D,UAAR,KAAuB+R,KAA5E;AAAmF,iBAAvG,CAAwGzc,IAAxG,CAA6GtK,IAA7G,CAAhC,CAA3B;AACA+S,gBAAAA,UAAU,CAAC/I,WAAX,CAAuBoe,kBAAvB;AACA1B,gBAAAA,YAAY,GAAG0B,kBAAkB,CAAC7Q,SAAnB,CAA6B,KAA7B,CAAf;AACAuP,gBAAAA,UAAU,CAAC9d,IAAX,CAAgB0d,YAAhB;AACAK,gBAAAA,KAAK,CAAC/c,WAAN,CAAkB0c,YAAlB;AACH,eAND,MAMO;AACH3T,gBAAAA,UAAU,GAAG,IAAb;AACH;AACJ;AACJ;;AAEDwE,UAAAA,SAAS,GAAGsO,KAAK,CAACtO,SAAN,CAAgB,KAAhB,CAAZ;AACA/D,UAAAA,QAAQ,CAACxJ,WAAT,CAAqBuN,SAArB;AACA,cAAIsO,KAAK,CAACzU,QAAN,KAAmB,CAAnB,IAAwB,CAACpR,IAAI,CAAC0U,OAAL,CAAamR,KAAb,CAA7B,EAAkDyB,SAAS,GAAG/P,SAAZ;AAElD8P,UAAAA,aAAa,CAACxB,KAAD,EAAQyB,SAAR,CAAb;AACH;AACJ,OAvQD,EAuQG7nB,OAvQH,EAuQYsnB,KAvQZ,EAtEgM,CA+UhM;;;AACA,UAAIjF,YAAY,IAAI,CAACC,cAAjB,IAAmC,CAAC2B,YAAY,CAACC,CAArD,EAAwD;AACpD,eAAO;AACHnQ,UAAAA,QAAQ,EAAE/T,OADP;AAEHkQ,UAAAA,cAAc,EAAE4B,QAFb;AAGHtB,UAAAA,WAAW,EAAEuB,QAHV;AAIH5B,UAAAA,YAAY,EAAE6B,MAJX;AAKHhB,UAAAA,SAAS,EAAEiB;AALR,SAAP;AAOH;;AAEDqQ,MAAAA,cAAc,GAAGA,cAAc,IAAID,YAAnC;;AAEA,UAAIC,cAAJ,EAAoB;AAChB,aAAK,IAAIja,IAAC,GAAG,CAAb,EAAgBA,IAAC,GAAGgf,UAAU,CAAC9e,MAA/B,EAAuCF,IAAC,EAAxC,EAA4C;AACxC,cAAIyQ,UAAU,GAAGuO,UAAU,CAAChf,IAAD,CAA3B;AACA,cAAI0f,QAAQ,SAAZ;AAAA,cAAca,UAAU,SAAxB;AAAA,cAA0BC,UAAU,SAApC;;AAEA,cAAI7V,SAAJ,EAAe;AACX+U,YAAAA,QAAQ,GAAGxnB,IAAI,CAACkV,cAAL,CAAoBlV,IAAI,CAACmV,cAAzB,CAAX;AACA4R,YAAAA,KAAK,CAACze,YAAN,CAAmBkf,QAAnB,EAA6BjP,UAA7B;AACH,WAHD,MAGO;AACH,gBAAMgQ,SAAS,GAAGhQ,UAAU,CAACpH,UAA7B;AACAkX,YAAAA,UAAU,GAAGE,SAAS,CAAC,CAAD,CAAtB;;AACA,mBAAOA,SAAS,CAAC,CAAD,CAAhB,EAAqB;AACjBD,cAAAA,UAAU,GAAGC,SAAS,CAAC,CAAD,CAAtB;AACAxB,cAAAA,KAAK,CAACxW,YAAN,CAAmB+X,UAAnB,EAA+B/P,UAA/B;AACH;;AACDvY,YAAAA,IAAI,CAACsV,UAAL,CAAgBiD,UAAhB;AACH;;AAED,cAAIzQ,IAAC,KAAK,CAAV,EAAa;AACT,gBAAI2K,SAAJ,EAAe;AACX9C,cAAAA,cAAc,GAAGC,YAAY,GAAG4X,QAAhC;AACH,aAFD,MAEO;AACH7X,cAAAA,cAAc,GAAG0Y,UAAjB;AACAzY,cAAAA,YAAY,GAAG0Y,UAAf;AACH;AACJ;AACJ;AACJ,OA3BD,MA2BO;AACH,YAAIxG,YAAJ,EAAkB;AACd,eAAK,IAAIha,IAAC,GAAG,CAAb,EAAgBA,IAAC,GAAGgf,UAAU,CAAC9e,MAA/B,EAAuCF,IAAC,EAAxC,EAA4C;AACxC,iBAAKye,gBAAL,CAAsBO,UAAU,CAAChf,IAAD,CAAhC;AACH;AACJ;;AAED,YAAI2K,SAAJ,EAAe;AACX9C,UAAAA,cAAc,GAAGC,YAAY,GAAG8W,YAAhC;AACH;AACJ;;AAED1mB,MAAAA,IAAI,CAACihB,eAAL,CAAqB8F,KAArB,EAA4BL,YAA5B;;AAEA,UAAIjU,SAAJ,EAAe;AACXxC,QAAAA,WAAW,GAAGN,cAAc,CAAC0B,WAAf,CAA2BrJ,MAAzC;AACAyI,QAAAA,SAAS,GAAGb,YAAY,CAACyB,WAAb,CAAyBrJ,MAArC;AACH,OAxY+L,CA0YhM;;;AACA,UAAMwgB,WAAW,GAAGzG,cAAc,IAAInS,YAAY,CAACyB,WAAb,CAAyBrJ,MAAzB,KAAoC,CAA1E;;AAEA,UAAI,CAAChI,IAAI,CAAC0U,OAAL,CAAa9E,YAAb,CAAD,IAA+BA,YAAY,CAACyB,WAAb,CAAyBrJ,MAAzB,KAAoC,CAAvE,EAA0E;AACtEhI,QAAAA,IAAI,CAACsV,UAAL,CAAgB1F,YAAhB;AACAA,QAAAA,YAAY,GAAGD,cAAf;AACH;;AACDc,MAAAA,SAAS,GAAG+X,WAAW,GAAG5Y,YAAY,CAACyB,WAAb,CAAyBrJ,MAA5B,GAAqCyI,SAA5D,CAjZgM,CAmZhM;;AACA,UAAMgY,cAAc,GAAG;AAAC7F,QAAAA,CAAC,EAAE,CAAJ;AAAOtV,QAAAA,CAAC,EAAE;AAAV,OAAvB;AACA,UAAMob,SAAS,GAAG1oB,IAAI,CAAC2oB,WAAL,CAAiBhZ,cAAjB,EAAiCoX,KAAjC,EAAwC0B,cAAxC,CAAlB;AAEA,UAAMG,WAAW,GAAG,CAAChZ,YAAY,CAACoF,UAAlC;AACA,UAAI4T,WAAJ,EAAiBhZ,YAAY,GAAGD,cAAf;AACjB,UAAMkZ,YAAY,GAAG;AAACjG,QAAAA,CAAC,EAAE,CAAJ;AAAOtV,QAAAA,CAAC,EAAE;AAAV,OAArB;AACA,UAAMwb,OAAO,GAAG9oB,IAAI,CAAC2oB,WAAL,CAAiB/Y,YAAjB,EAAgCmX,KAAhC,EAAwC,CAAC6B,WAAD,IAAgB,CAACJ,WAAlB,GAAiCK,YAAjC,GAAgD,IAAvF,CAAhB;AAEA5Y,MAAAA,WAAW,IAAIwY,cAAc,CAAC7F,CAA9B;AACAnS,MAAAA,SAAS,GAAIgC,SAAS,GAAGxC,WAAH,GAAiB2Y,WAAW,GAAGjZ,cAAc,CAAC0B,WAAf,CAA2BrJ,MAA9B,GAAuCwgB,WAAW,GAAG/X,SAAS,GAAGgY,cAAc,CAAC7F,CAA9B,GAAkCnS,SAAS,GAAGoY,YAAY,CAACjG,CAA/J,CA7ZgM,CA+ZhM;;AACA,UAAMmG,UAAU,GAAG/oB,IAAI,CAACkf,aAAL,CAAmB6H,KAAnB,EAA0B,CAAC2B,SAAD,EAAYI,OAAZ,CAA1B,EAAgD,IAAhD,CAAnB;AAEArpB,MAAAA,OAAO,CAACuV,UAAR,CAAmB1M,YAAnB,CAAgCye,KAAhC,EAAuCtnB,OAAvC;AAEAkQ,MAAAA,cAAc,GAAG3P,IAAI,CAACgpB,eAAL,CAAqBN,SAArB,EAAgC3B,KAAhC,CAAjB;AACAnX,MAAAA,YAAY,GAAG5P,IAAI,CAACgpB,eAAL,CAAqBF,OAArB,EAA8B/B,KAA9B,CAAf;AAEA,aAAO;AACHvT,QAAAA,QAAQ,EAAEuT,KADP;AAEHpX,QAAAA,cAAc,EAAEA,cAFb;AAGHM,QAAAA,WAAW,EAAEA,WAAW,GAAG8Y,UAAU,CAAC,CAAD,CAHlC;AAIHnZ,QAAAA,YAAY,EAAEA,YAJX;AAKHa,QAAAA,SAAS,EAAEA,SAAS,GAAGsY,UAAU,CAAC,CAAD;AAL9B,OAAP;AAOH,KA98GQ;;AAg9GT;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQ3D,IAAAA,qBAAqB,EAAE,+BAAU3lB,OAAV,EAAmBinB,YAAnB,EAAiClR,UAAjC,EAA6CjE,QAA7C,EAAuDC,QAAvD,EAAiEuQ,cAAjE,EAAiFD,YAAjF,EAA+F4B,YAA/F,EAA6GiB,kBAA7G,EAAiIH,iBAAjI,EAAoJyE,aAApJ,EAAmK;AACtL;AACA,UAAItC,SAAS,GAAGpV,QAAQ,CAACyD,UAAzB;;AACA,aAAO,CAAC2R,SAAS,CAAC/R,WAAX,IAA0B,CAAC+R,SAAS,CAACtR,eAArC,IAAwD,CAACrV,IAAI,CAACkQ,eAAL,CAAqByW,SAAS,CAAC3R,UAA/B,CAAzD,IAAuG,CAAChV,IAAI,CAAC6P,YAAL,CAAkB8W,SAAS,CAAC3R,UAA5B,CAA/G,EAAwJ;AACpJ,YAAI2R,SAAS,CAACxS,QAAV,KAAuBuS,YAAY,CAACvS,QAAxC,EAAkD;AAClDwS,QAAAA,SAAS,GAAGA,SAAS,CAAC3R,UAAtB;AACH;;AAED,UAAI,CAAC8M,YAAD,IAAiB6E,SAAS,CAACxS,QAAV,KAAuBuS,YAAY,CAACvS,QAArD,IAAiE,CAACnU,IAAI,CAACkQ,eAAL,CAAqByW,SAArB,CAAlE,IAAqG,CAACA,SAAS,CAAC/R,WAAhH,IAA+H5U,IAAI,CAAC8Y,kBAAL,CAAwBvH,QAAQ,CAACF,WAAT,CAAqBqF,KAArB,CAA2B,CAA3B,EAA8BlF,QAA9B,CAAxB,CAAnI,EAAqM;AACjM,YAAIoV,OAAO,GAAG,IAAd;AACA,YAAIhE,GAAC,GAAGrR,QAAQ,CAAC8D,eAAjB;;AACA,eAAOuN,GAAP,EAAU;AACN,cAAI,CAAC5iB,IAAI,CAAC8Y,kBAAL,CAAwB8J,GAAxB,CAAL,EAAiC;AAC7BgE,YAAAA,OAAO,GAAG,KAAV;AACA;AACH;;AACDhE,UAAAA,GAAC,GAAGA,GAAC,CAACvN,eAAN;AACH;;AAED,YAAIuR,OAAJ,EAAa;AACT5mB,UAAAA,IAAI,CAACiY,iBAAL,CAAuB0O,SAAvB,EAAkCD,YAAlC;AAEA,iBAAO;AACHlT,YAAAA,QAAQ,EAAE/T,OADP;AAEHiC,YAAAA,SAAS,EAAE6P,QAFR;AAGHlD,YAAAA,MAAM,EAAEmD;AAHL,WAAP;AAKH;AACJ,OA5BqL,CA8BtL;;;AACAkS,MAAAA,YAAY,CAACC,CAAb,GAAiB,KAAjB;AACA,UAAMla,EAAE,GAAGhK,OAAX;AACA,UAAMqnB,UAAU,GAAG,CAACJ,YAAD,CAAnB;AACA,UAAMK,KAAK,GAAGtnB,OAAO,CAAC8X,SAAR,CAAkB,KAAlB,CAAd;AAEA,UAAI7V,SAAS,GAAG6P,QAAhB;AACA,UAAIlD,MAAM,GAAGmD,QAAb;AACA,UAAI0X,QAAQ,GAAG,KAAf;AACA,UAAI/B,QAAJ,EAAc/D,OAAd,EAAuBrD,UAAvB,EAAmChN,UAAnC;;AAEA,OAAC,SAASsU,aAAT,CAAuBnW,OAAvB,EAAgCsC,QAAhC,EAA0C;AACvC,YAAMrC,UAAU,GAAGD,OAAO,CAACC,UAA3B;;AAEA,aAAK,IAAIrJ,CAAC,GAAG,CAAR,EAAWqB,GAAG,GAAGgI,UAAU,CAACnJ,MAA5B,EAAoC6b,KAApC,EAA2CsF,UAAhD,EAA4DrhB,CAAC,GAAGqB,GAAhE,EAAqErB,CAAC,EAAtE,EAA0E;AACtE,cAAM+d,KAAK,GAAG1U,UAAU,CAACrJ,CAAD,CAAxB;AACA,cAAI,CAAC+d,KAAL,EAAY;AACZ,cAAIyB,SAAS,GAAG9T,QAAhB;;AAEA,cAAI0V,QAAQ,IAAI,CAAClpB,IAAI,CAAC0U,OAAL,CAAamR,KAAb,CAAjB,EAAsC;AAClC,gBAAIA,KAAK,CAACzU,QAAN,KAAmB,CAAvB,EAA0B;AACtB,kBAAIpR,IAAI,CAACic,mBAAL,CAAyB4J,KAAzB,CAAJ,EAAqC;AACjCa,gBAAAA,YAAY,GAAGA,YAAY,CAACnP,SAAb,CAAuB,KAAvB,CAAf;AACA4R,gBAAAA,UAAU,GAAGtD,KAAK,CAACtO,SAAN,CAAgB,IAAhB,CAAb;AACAwP,gBAAAA,KAAK,CAAC/c,WAAN,CAAkBmf,UAAlB;AACApC,gBAAAA,KAAK,CAAC/c,WAAN,CAAkB0c,YAAlB;AACAI,gBAAAA,UAAU,CAAC9d,IAAX,CAAgB0d,YAAhB,EALiC,CAOjC;;AACA,oBAAIuC,aAAa,IAAIpD,KAAK,CAACnY,QAAN,CAAeub,aAAf,CAArB,EAAoD;AAChD,sBAAMH,OAAO,GAAG9oB,IAAI,CAAC2oB,WAAL,CAAiBM,aAAjB,EAAgCpD,KAAhC,CAAhB;AACAoD,kBAAAA,aAAa,GAAGjpB,IAAI,CAACgpB,eAAL,CAAqBF,OAArB,EAA8BK,UAA9B,CAAhB;AACH;AACJ,eAZD,MAYO;AACH9B,gBAAAA,aAAa,CAACxB,KAAD,EAAQA,KAAR,CAAb;AACH;;AACD;AACH;;AAEDzC,YAAAA,OAAO,GAAGyC,KAAV;AACAsB,YAAAA,QAAQ,GAAG,EAAX;AACA,gBAAMY,OAAO,GAAG,EAAhB;;AACA,mBAAO3E,OAAO,CAACpO,UAAR,KAAuB,IAAvB,IAA+BoO,OAAO,KAAK3Z,EAA3C,IAAiD2Z,OAAO,KAAKsD,YAApE,EAAkF;AAC9E7C,cAAAA,KAAK,GAAGrO,UAAU,CAAC4N,OAAD,CAAlB;;AACA,kBAAIA,OAAO,CAAChS,QAAR,KAAqB,CAArB,IAA0ByS,KAA9B,EAAqC;AACjC,oBAAIW,iBAAiB,CAACpB,OAAD,CAArB,EAAgC;AAC5B,sBAAI,CAACrQ,UAAL,EAAiBgV,OAAO,CAAC/e,IAAR,CAAa6a,KAAb;AACpB,iBAFD,MAEO;AACHsD,kBAAAA,QAAQ,CAACne,IAAT,CAAc6a,KAAd;AACH;AACJ;;AACDT,cAAAA,OAAO,GAAGA,OAAO,CAACpO,UAAlB;AACH;;AACDmS,YAAAA,QAAQ,GAAGA,QAAQ,CAACa,MAAT,CAAgBD,OAAhB,CAAX;AAEA,gBAAMqB,SAAS,GAAGjC,QAAQ,CAACnf,MAAT,GAAkB,CAApC;AACA,gBAAM6f,SAAS,GAAGV,QAAQ,CAACW,GAAT,MAAkBjC,KAApC;AACA9F,YAAAA,UAAU,GAAGqD,OAAO,GAAGyE,SAAvB;;AACA,mBAAOV,QAAQ,CAACnf,MAAT,GAAkB,CAAzB,EAA4B;AACxBob,cAAAA,OAAO,GAAG+D,QAAQ,CAACW,GAAT,EAAV;AACA/H,cAAAA,UAAU,CAAC/V,WAAX,CAAuBoZ,OAAvB;AACArD,cAAAA,UAAU,GAAGqD,OAAb;AACH;;AAED,gBAAIoB,iBAAiB,CAACkC,YAAY,CAAC1R,UAAd,CAAjB,IAA8C,CAACwP,iBAAiB,CAACqD,SAAD,CAApE,EAAiF;AAC7EnB,cAAAA,YAAY,GAAGA,YAAY,CAACnP,SAAb,CAAuB,KAAvB,CAAf;AACAwP,cAAAA,KAAK,CAAC/c,WAAN,CAAkB0c,YAAlB;AACAI,cAAAA,UAAU,CAAC9d,IAAX,CAAgB0d,YAAhB;AACH;;AAED,gBAAI,CAAC3T,UAAD,IAAeyR,iBAAiB,CAACqD,SAAD,CAApC,EAAiD;AAC7CnB,cAAAA,YAAY,GAAGA,YAAY,CAACnP,SAAb,CAAuB,KAAvB,CAAf;AACA,kBAAM2Q,SAAS,GAAGL,SAAS,CAAC1W,UAA5B;;AACA,mBAAK,IAAIsW,CAAC,GAAG,CAAR,EAAWU,IAAI,GAAGD,SAAS,CAAClgB,MAAjC,EAAyCyf,CAAC,GAAGU,IAA7C,EAAmDV,CAAC,EAApD,EAAwD;AACpDf,gBAAAA,YAAY,CAAC1c,WAAb,CAAyBke,SAAS,CAACT,CAAD,CAAlC;AACH;;AACDI,cAAAA,SAAS,CAAC7d,WAAV,CAAsB0c,YAAtB;AACAK,cAAAA,KAAK,CAAC/c,WAAN,CAAkB6d,SAAlB;AACArU,cAAAA,QAAQ,GAAG,CAACgR,iBAAiB,CAACpB,OAAD,CAAlB,GAA8BA,OAA9B,GAAwCsD,YAAnD;AACAI,cAAAA,UAAU,CAAC9d,IAAX,CAAgB0d,YAAhB;AACH,aAVD,MAUO,IAAI0C,SAAJ,EAAe;AAClB1C,cAAAA,YAAY,CAAC1c,WAAb,CAAyB6d,SAAzB;AACArU,cAAAA,QAAQ,GAAG4P,OAAX;AACH,aAHM,MAGA;AACH5P,cAAAA,QAAQ,GAAGkT,YAAX;AACH;;AAED,gBAAI3T,UAAU,IAAI8S,KAAK,CAACzU,QAAN,KAAmB,CAArC,EAAwC;AACpC,kBAAIuT,kBAAkB,CAACkB,KAAD,CAAtB,EAA+B;AAC3B,oBAAMuC,kBAAkB,GAAGpoB,IAAI,CAACoP,gBAAL,CAAsBoE,QAAtB,EAAgC,UAAUtC,OAAV,EAAmB;AAAC,yBAAO,KAAKsT,iBAAL,CAAuBtT,OAAO,CAAC8D,UAA/B,KAA8C9D,OAAO,CAAC8D,UAAR,KAAuB+R,KAA5E;AAAmF,iBAAvG,CAAwGzc,IAAxG,CAA6GtK,IAA7G,CAAhC,CAA3B;AACA+S,gBAAAA,UAAU,CAAC/I,WAAX,CAAuBoe,kBAAvB;AACA1B,gBAAAA,YAAY,GAAG0B,kBAAkB,CAAC7Q,SAAnB,CAA6B,KAA7B,CAAf;AACAuP,gBAAAA,UAAU,CAAC9d,IAAX,CAAgB0d,YAAhB;AACAK,gBAAAA,KAAK,CAAC/c,WAAN,CAAkB0c,YAAlB;AACH,eAND,MAMO;AACH3T,gBAAAA,UAAU,GAAG,IAAb;AACH;AACJ;AACJ,WApFqE,CAsFtE;;;AACA,cAAI,CAACmW,QAAD,IAAarD,KAAK,KAAKnkB,SAA3B,EAAsC;AAClC,gBAAI+U,IAAI,GAAGsQ,KAAX;AACAhU,YAAAA,UAAU,GAAG4R,kBAAkB,CAACkB,KAAD,CAA/B;AACA,gBAAM0B,QAAQ,GAAGvnB,IAAI,CAACkV,cAAL,CAAoBxT,SAAS,CAAC0P,QAAV,KAAuB,CAAvB,GAA2B,EAA3B,GAAgC1P,SAAS,CAACqb,aAAV,CAAwB,CAAxB,EAA2B1O,MAA3B,CAApD,CAAjB;AACA,gBAAMmZ,QAAQ,GAAGxnB,IAAI,CAACkV,cAAL,CAAoBxT,SAAS,CAAC0P,QAAV,KAAuB,CAAvB,GAA2B,EAA3B,GAAgC1P,SAAS,CAACqb,aAAV,CAAwB1O,MAAxB,EAAiC3M,SAAS,CAACsG,MAAV,GAAmBqG,MAApD,CAApD,CAAjB;;AAEA,gBAAI0E,UAAJ,EAAgB;AACZ,kBAAM0U,GAAC,GAAG9C,kBAAkB,CAACnR,QAAD,CAA5B;;AACA,kBAAIiU,GAAC,IAAIA,GAAC,CAACzS,UAAF,KAAiByB,IAA1B,EAAgC;AAC5B,oBAAIiR,CAAC,GAAGD,GAAR;AACA,oBAAI5I,CAAC,GAAG,IAAR;;AACA,uBAAO6I,CAAC,CAAC1S,UAAF,KAAiByB,IAAxB,EAA8B;AAC1BjD,kBAAAA,QAAQ,GAAGqL,CAAC,GAAG6I,CAAC,CAAC1S,UAAF,CAAauC,SAAb,CAAuB,KAAvB,CAAf;;AACA,yBAAMmQ,CAAC,CAACvW,UAAF,CAAa,CAAb,CAAN,EAAuB;AACnB0N,oBAAAA,CAAC,CAAC7U,WAAF,CAAc0d,CAAC,CAACvW,UAAF,CAAa,CAAb,CAAd;AACH;;AACDuW,kBAAAA,CAAC,CAAC1d,WAAF,CAAc6U,CAAd;AACA6I,kBAAAA,CAAC,GAAGA,CAAC,CAAC1S,UAAN;AACH;;AACD0S,gBAAAA,CAAC,CAAC1S,UAAF,CAAahL,WAAb,CAAyByd,GAAzB;AACH;;AACD1U,cAAAA,UAAU,GAAGA,UAAU,CAACwE,SAAX,CAAqB,KAArB,CAAb;AACH;;AAED,gBAAI,CAACvX,IAAI,CAAC8Y,kBAAL,CAAwByO,QAAxB,CAAL,EAAwC;AACpC/T,cAAAA,QAAQ,CAACxJ,WAAT,CAAqBud,QAArB;AACH;;AAED,gBAAMI,cAAc,GAAGhD,kBAAkB,CAACnR,QAAD,CAAzC;;AACA,gBAAI,CAAC,CAACmU,cAAN,EAAsB5U,UAAU,GAAG4U,cAAb;AACtB,gBAAI5U,UAAJ,EAAgB0D,IAAI,GAAG1D,UAAP;AAEhBqQ,YAAAA,OAAO,GAAG5P,QAAV;AACA2T,YAAAA,QAAQ,GAAG,EAAX;;AACA,mBAAO/D,OAAO,KAAK3M,IAAZ,IAAoB2M,OAAO,KAAK,IAAvC,EAA6C;AACzCS,cAAAA,KAAK,GAAGrO,UAAU,CAAC4N,OAAD,CAAlB;;AACA,kBAAIA,OAAO,CAAChS,QAAR,KAAqB,CAArB,IAA0ByS,KAA9B,EAAqC;AACjCsD,gBAAAA,QAAQ,CAACne,IAAT,CAAc6a,KAAd;AACH;;AACDT,cAAAA,OAAO,GAAGA,OAAO,CAACpO,UAAlB;AACH;;AAED,gBAAM6S,WAAS,GAAGV,QAAQ,CAACW,GAAT,MAAkBtU,QAApC;;AACAuM,YAAAA,UAAU,GAAGqD,OAAO,GAAGyE,WAAvB;;AACA,mBAAOV,QAAQ,CAACnf,MAAT,GAAkB,CAAzB,EAA4B;AACxBob,cAAAA,OAAO,GAAG+D,QAAQ,CAACW,GAAT,EAAV;AACA/H,cAAAA,UAAU,CAAC/V,WAAX,CAAuBoZ,OAAvB;AACArD,cAAAA,UAAU,GAAGqD,OAAb;AACH;;AAED,gBAAIyE,WAAS,KAAKrU,QAAlB,EAA4B;AACxBkT,cAAAA,YAAY,CAAC1c,WAAb,CAAyB6d,WAAzB;AACArU,cAAAA,QAAQ,GAAG4P,OAAX;AACH,aAHD,MAGO;AACH5P,cAAAA,QAAQ,GAAGkT,YAAX;AACH;;AAED,gBAAI1mB,IAAI,CAAC0U,OAAL,CAAamR,KAAb,CAAJ,EAAyBa,YAAY,CAAC1c,WAAb,CAAyB6b,KAAK,CAACtO,SAAN,CAAgB,KAAhB,CAAzB;AACzBd,YAAAA,IAAI,CAACzM,WAAL,CAAiB0c,YAAjB;AAEAhlB,YAAAA,SAAS,GAAG8lB,QAAZ;AACAnZ,YAAAA,MAAM,GAAG,CAAT;AACA6a,YAAAA,QAAQ,GAAG,IAAX;AAEA1V,YAAAA,QAAQ,CAACxJ,WAAT,CAAqBtI,SAArB;AACA;AACH;;AAEDmiB,UAAAA,KAAK,GAAG,CAACqF,QAAD,GAAYrD,KAAK,CAACtO,SAAN,CAAgB,KAAhB,CAAZ,GAAqC/B,UAAU,CAACqQ,KAAD,CAAvD;;AACA,cAAIhC,KAAJ,EAAW;AACPrQ,YAAAA,QAAQ,CAACxJ,WAAT,CAAqB6Z,KAArB;AACA,gBAAIgC,KAAK,CAACzU,QAAN,KAAmB,CAAnB,IAAwB,CAACpR,IAAI,CAAC0U,OAAL,CAAamR,KAAb,CAA7B,EAAkDyB,SAAS,GAAGzD,KAAZ;AACrD;;AAEDwD,UAAAA,aAAa,CAACxB,KAAD,EAAQyB,SAAR,CAAb;AACH;AACJ,OAtKD,EAsKG7nB,OAtKH,EAsKYsnB,KAtKZ,EAzCsL,CAiNtL;;;AACA,UAAIjF,YAAY,IAAI,CAACC,cAAjB,IAAmC,CAAC2B,YAAY,CAACC,CAArD,EAAwD;AACpD,eAAO;AACHnQ,UAAAA,QAAQ,EAAE/T,OADP;AAEHiC,UAAAA,SAAS,EAAE6P,QAFR;AAGHlD,UAAAA,MAAM,EAAEmD,QAHL;AAIH5B,UAAAA,YAAY,EAAEqZ;AAJX,SAAP;AAMH;;AAEDlH,MAAAA,cAAc,GAAGA,cAAc,IAAID,YAAnC;;AAEA,UAAIC,cAAJ,EAAoB;AAChB,aAAK,IAAIja,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGgf,UAAU,CAAC9e,MAA/B,EAAuCF,CAAC,EAAxC,EAA4C;AACxC,cAAIyQ,UAAU,GAAGuO,UAAU,CAAChf,CAAD,CAA3B;AAEA,cAAMygB,SAAS,GAAGhQ,UAAU,CAACpH,UAA7B;AACA,cAAMqW,QAAQ,GAAGe,SAAS,CAAC,CAAD,CAA1B;;AACA,iBAAOA,SAAS,CAAC,CAAD,CAAhB,EAAqB;AACjBxB,YAAAA,KAAK,CAACxW,YAAN,CAAmBgY,SAAS,CAAC,CAAD,CAA5B,EAAiChQ,UAAjC;AACH;;AACDvY,UAAAA,IAAI,CAACsV,UAAL,CAAgBiD,UAAhB;AAEA,cAAIzQ,CAAC,KAAK,CAAV,EAAapG,SAAS,GAAG8lB,QAAZ;AAChB;AACJ,OAbD,MAaO,IAAI1F,YAAJ,EAAkB;AACrB4E,QAAAA,YAAY,GAAGA,YAAY,CAAC1S,UAA5B;;AACA,aAAK,IAAIlM,IAAC,GAAG,CAAb,EAAgBA,IAAC,GAAGgf,UAAU,CAAC9e,MAA/B,EAAuCF,IAAC,EAAxC,EAA4C;AACxC,eAAKye,gBAAL,CAAsBO,UAAU,CAAChf,IAAD,CAAhC;AACH;AACJ;;AAED,UAAI,CAACia,cAAD,IAAmBgF,KAAK,CAAC5V,UAAN,CAAiBnJ,MAAjB,KAA4B,CAAnD,EAAsD;AAClD,YAAIvI,OAAO,CAAC0R,UAAZ,EAAwB;AACpBzP,UAAAA,SAAS,GAAGjC,OAAO,CAAC0R,UAAR,CAAmB,CAAnB,CAAZ;AACH,SAFD,MAEO;AACHzP,UAAAA,SAAS,GAAG1B,IAAI,CAACkV,cAAL,CAAoBlV,IAAI,CAACmV,cAAzB,CAAZ;AACA1V,UAAAA,OAAO,CAACuK,WAAR,CAAoBtI,SAApB;AACH;AACJ,OAPD,MAOO;AACH1B,QAAAA,IAAI,CAACihB,eAAL,CAAqB8F,KAArB,EAA4BL,YAA5B;;AAEA,YAAI1mB,IAAI,CAAC8Y,kBAAL,CAAwBiO,KAAK,CAAC1V,WAA9B,CAAJ,EAAgD;AAC5C3P,UAAAA,SAAS,GAAGqlB,KAAK,CAAC/S,UAAlB;AACA3F,UAAAA,MAAM,GAAG,CAAT;AACH,SANE,CAQH;;;AACA,YAAMgb,OAAO,GAAG;AAACzG,UAAAA,CAAC,EAAE,CAAJ;AAAOtV,UAAAA,CAAC,EAAE;AAAV,SAAhB;AACA,YAAMgc,IAAI,GAAGtpB,IAAI,CAAC2oB,WAAL,CAAiBjnB,SAAjB,EAA4BqlB,KAA5B,EAAmCsC,OAAnC,CAAb;AACAhb,QAAAA,MAAM,IAAIgb,OAAO,CAACzG,CAAlB,CAXG,CAaH;;AACA,YAAMmG,UAAU,GAAG/oB,IAAI,CAACkf,aAAL,CAAmB6H,KAAnB,EAA0B,CAACuC,IAAD,CAA1B,EAAkC,IAAlC,CAAnB;AAEA7pB,QAAAA,OAAO,CAACuV,UAAR,CAAmB1M,YAAnB,CAAgCye,KAAhC,EAAuCtnB,OAAvC;AAEAiC,QAAAA,SAAS,GAAG1B,IAAI,CAACgpB,eAAL,CAAqBM,IAArB,EAA2BvC,KAA3B,CAAZ;AACA1Y,QAAAA,MAAM,IAAI0a,UAAU,CAAC,CAAD,CAApB;AACH;;AAED,aAAO;AACHvV,QAAAA,QAAQ,EAAEuT,KADP;AAEHrlB,QAAAA,SAAS,EAAEA,SAFR;AAGH2M,QAAAA,MAAM,EAAEA,MAHL;AAIHuB,QAAAA,YAAY,EAAEqZ;AAJX,OAAP;AAMH,KAjvHQ;;AAmvHT;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQ9D,IAAAA,sBAAsB,EAAE,gCAAU1lB,OAAV,EAAmBinB,YAAnB,EAAiClR,UAAjC,EAA6CuM,cAA7C,EAA6DD,YAA7D,EAA2E4B,YAA3E,EAAyFuF,aAAzF,EAAwG;AAC5H;AACA,UAAI,CAACnH,YAAL,EAAmB;AACf;AACA,YAAIgH,OAAO,GAAG,IAAd;AACA,YAAIG,aAAa,IAAIxpB,OAAO,CAACiO,QAAR,CAAiBub,aAAjB,CAArB,EAAsDH,OAAO,GAAG9oB,IAAI,CAAC2oB,WAAL,CAAiBM,aAAjB,EAAgCxpB,OAAhC,CAAV;AAEtD,YAAM8pB,QAAQ,GAAG9pB,OAAO,CAAC8X,SAAR,CAAkB,IAAlB,CAAjB;AACA,YAAM8K,WAAW,GAAGqE,YAAY,CAACvS,QAAjC;AACA,YAAMqV,UAAU,GAAG9C,YAAY,CAACpgB,KAAb,CAAmBQ,OAAtC;AACA,YAAM2iB,QAAQ,GAAG/C,YAAY,CAAC1N,SAA9B;AAEA,YAAIhJ,QAAQ,GAAGuZ,QAAQ,CAACpY,UAAxB;AACA,YAAIrJ,CAAC,GAAG,CAAR;AAAA,YAAWqB,GAAG,GAAG6G,QAAQ,CAAChI,MAA1B;;AACA,aAAK,IAAI6d,KAAT,EAAgB/d,CAAC,GAAGqB,GAApB,EAAyBrB,CAAC,EAA1B,EAA8B;AAC1B+d,UAAAA,KAAK,GAAG7V,QAAQ,CAAClI,CAAD,CAAhB;AACA,cAAI+d,KAAK,CAACzU,QAAN,KAAmB,CAAvB,EAA0B;;AAC1B,cAAIyU,KAAK,CAAC1R,QAAN,KAAmBkO,WAAvB,EAAoC;AAChCwD,YAAAA,KAAK,CAACvf,KAAN,CAAYQ,OAAZ,IAAuB0iB,UAAvB;AACAxpB,YAAAA,IAAI,CAACuL,QAAL,CAAcsa,KAAd,EAAqB4D,QAArB;AACH,WAHD,MAGO,IAAI,CAACzpB,IAAI,CAAC0U,OAAL,CAAamR,KAAb,CAAD,IAAwB7lB,IAAI,CAACic,mBAAL,CAAyB4J,KAAzB,CAA5B,EAA6D;AAChE;AACH,WAFM,MAEA,IAAI1c,GAAG,KAAK,CAAZ,EAAe;AAClB6G,YAAAA,QAAQ,GAAG6V,KAAK,CAAC1U,UAAjB;AACAhI,YAAAA,GAAG,GAAG6G,QAAQ,CAAChI,MAAf;AACAF,YAAAA,CAAC,GAAG,CAAC,CAAL;AACA;AACH,WALM,MAKA;AACH;AACH;AACJ;;AAED,YAAIqB,GAAG,GAAG,CAAN,IAAWrB,CAAC,KAAKqB,GAArB,EAA0B;AACtB1J,UAAAA,OAAO,CAACoU,SAAR,GAAoB0V,QAAQ,CAAC1V,SAA7B;AACA,iBAAO;AACHL,YAAAA,QAAQ,EAAE/T,OADP;AAEHmQ,YAAAA,YAAY,EAAEkZ,OAAO,GAAG9oB,IAAI,CAACgpB,eAAL,CAAqBF,OAArB,EAA8BrpB,OAA9B,CAAH,GAA4C;AAF9D,WAAP;AAIH;AACJ,OAvC2H,CAyC5H;;;AACAikB,MAAAA,YAAY,CAACC,CAAb,GAAiB,KAAjB;AACA,UAAMoD,KAAK,GAAGtnB,OAAO,CAAC8X,SAAR,CAAkB,KAAlB,CAAd;AACA,UAAMuP,UAAU,GAAG,CAACJ,YAAD,CAAnB;AACA,UAAIgD,UAAU,GAAG,IAAjB;;AAEA,OAAC,SAASrC,aAAT,CAAuBnW,OAAvB,EAAgCsC,QAAhC,EAA0C;AACvC,YAAMrC,UAAU,GAAGD,OAAO,CAACC,UAA3B;;AAEA,aAAK,IAAIrJ,IAAC,GAAG,CAAR,EAAWqB,KAAG,GAAGgI,UAAU,CAACnJ,MAA5B,EAAoC6b,KAApC,EAA2CsF,UAAhD,EAA4DrhB,IAAC,GAAGqB,KAAhE,EAAqErB,IAAC,EAAtE,EAA0E;AACtE,cAAI+d,MAAK,GAAG1U,UAAU,CAACrJ,IAAD,CAAtB;AACA,cAAI,CAAC+d,MAAL,EAAY;AACZ,cAAIyB,SAAS,GAAG9T,QAAhB;;AAEA,cAAI,CAACxT,IAAI,CAAC0U,OAAL,CAAamR,MAAb,CAAD,IAAwB7lB,IAAI,CAACic,mBAAL,CAAyB4J,MAAzB,CAA5B,EAA6D;AACzD,gBAAIa,YAAY,CAACvV,UAAb,CAAwBnJ,MAAxB,GAAiC,CAArC,EAAwC;AACpC+e,cAAAA,KAAK,CAAC/c,WAAN,CAAkB0c,YAAlB;AACAA,cAAAA,YAAY,GAAGA,YAAY,CAACnP,SAAb,CAAuB,KAAvB,CAAf;AACH;;AAED4R,YAAAA,UAAU,GAAGtD,MAAK,CAACtO,SAAN,CAAgB,IAAhB,CAAb;AACAwP,YAAAA,KAAK,CAAC/c,WAAN,CAAkBmf,UAAlB;AACApC,YAAAA,KAAK,CAAC/c,WAAN,CAAkB0c,YAAlB;AACAI,YAAAA,UAAU,CAAC9d,IAAX,CAAgB0d,YAAhB;AACAlT,YAAAA,QAAQ,GAAGkT,YAAX,CAVyD,CAYzD;;AACA,gBAAIuC,aAAa,IAAIpD,MAAK,CAACnY,QAAN,CAAeub,aAAf,CAArB,EAAoD;AAChD,kBAAMH,QAAO,GAAG9oB,IAAI,CAAC2oB,WAAL,CAAiBM,aAAjB,EAAgCpD,MAAhC,CAAhB;;AACAoD,cAAAA,aAAa,GAAGjpB,IAAI,CAACgpB,eAAL,CAAqBF,QAArB,EAA8BK,UAA9B,CAAhB;AACH;;AAED;AACH,WAnBD,MAmBO;AACHtF,YAAAA,KAAK,GAAGrO,UAAU,CAACqQ,MAAD,CAAlB;;AACA,gBAAIhC,KAAJ,EAAW;AACP6F,cAAAA,UAAU,GAAG,KAAb;AACAlW,cAAAA,QAAQ,CAACxJ,WAAT,CAAqB6Z,KAArB;AACA,kBAAIgC,MAAK,CAACzU,QAAN,KAAmB,CAAvB,EAA0BkW,SAAS,GAAGzD,KAAZ;AAC7B;AACJ;;AAED,cAAI,CAAC7jB,IAAI,CAAC0U,OAAL,CAAamR,MAAb,CAAL,EAA0BwB,aAAa,CAACxB,MAAD,EAAQyB,SAAR,CAAb;AAC7B;AACJ,OAtCD,EAsCG7nB,OAtCH,EAsCYinB,YAtCZ,EA/C4H,CAuF5H;;;AACA,UAAIgD,UAAU,IAAK5H,YAAY,IAAI,CAACC,cAAjB,IAAmC,CAAC2B,YAAY,CAACC,CAApE,EAAwE,OAAO;AAAEnQ,QAAAA,QAAQ,EAAE/T,OAAZ;AAAqBmQ,QAAAA,YAAY,EAAEqZ;AAAnC,OAAP;AAExElC,MAAAA,KAAK,CAAC/c,WAAN,CAAkB0c,YAAlB;;AAEA,UAAI3E,cAAc,IAAID,YAAtB,EAAoC;AAChC,aAAK,IAAIha,IAAC,GAAG,CAAb,EAAgBA,IAAC,GAAGgf,UAAU,CAAC9e,MAA/B,EAAuCF,IAAC,EAAxC,EAA4C;AACxC,cAAIyQ,UAAU,GAAGuO,UAAU,CAAChf,IAAD,CAA3B;AAEA,cAAMygB,SAAS,GAAGhQ,UAAU,CAACpH,UAA7B;;AACA,iBAAOoX,SAAS,CAAC,CAAD,CAAhB,EAAqB;AACjBxB,YAAAA,KAAK,CAACxW,YAAN,CAAmBgY,SAAS,CAAC,CAAD,CAA5B,EAAiChQ,UAAjC;AACH;;AACDvY,UAAAA,IAAI,CAACsV,UAAL,CAAgBiD,UAAhB;AACH;AACJ,OAVD,MAUO,IAAIuJ,YAAJ,EAAkB;AACrB4E,QAAAA,YAAY,GAAGA,YAAY,CAAC1S,UAA5B;;AACA,aAAK,IAAIlM,IAAC,GAAG,CAAb,EAAgBA,IAAC,GAAGgf,UAAU,CAAC9e,MAA/B,EAAuCF,IAAC,EAAxC,EAA4C;AACxC,eAAKye,gBAAL,CAAsBO,UAAU,CAAChf,IAAD,CAAhC;AACH;AACJ;;AAED9H,MAAAA,IAAI,CAACihB,eAAL,CAAqB8F,KAArB,EAA4BL,YAA5B;AACA1mB,MAAAA,IAAI,CAACkf,aAAL,CAAmB6H,KAAnB,EAA0B,IAA1B,EAAgC,IAAhC,EA9G4H,CAgH5H;;AACAtnB,MAAAA,OAAO,CAACuV,UAAR,CAAmB1M,YAAnB,CAAgCye,KAAhC,EAAuCtnB,OAAvC;AACA,aAAO;AAAE+T,QAAAA,QAAQ,EAAEuT,KAAZ;AAAmBnX,QAAAA,YAAY,EAAEqZ;AAAjC,OAAP;AACH,KAj3HQ;;AAm3HT;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQ/D,IAAAA,mBAAmB,EAAE,6BAAUzlB,OAAV,EAAmBinB,YAAnB,EAAiClR,UAAjC,EAA6C/D,MAA7C,EAAqDC,MAArD,EAA6DqQ,cAA7D,EAA6ED,YAA7E,EAA2F4B,YAA3F,EAAyGiB,kBAAzG,EAA6HH,iBAA7H,EAAgJ;AACjK;AACA,UAAImC,SAAS,GAAGlV,MAAM,CAACuD,UAAvB;;AACA,aAAO,CAAC2R,SAAS,CAAC/R,WAAX,IAA0B,CAAC+R,SAAS,CAACtR,eAArC,IAAwD,CAACrV,IAAI,CAACkQ,eAAL,CAAqByW,SAAS,CAAC3R,UAA/B,CAAzD,IAAuG,CAAChV,IAAI,CAAC6P,YAAL,CAAkB8W,SAAS,CAAC3R,UAA5B,CAA/G,EAAwJ;AACpJ,YAAI2R,SAAS,CAACxS,QAAV,KAAuBuS,YAAY,CAACvS,QAAxC,EAAkD;AAClDwS,QAAAA,SAAS,GAAGA,SAAS,CAAC3R,UAAtB;AACH;;AAED,UAAI,CAAC8M,YAAD,IAAiB6E,SAAS,CAACxS,QAAV,KAAuBuS,YAAY,CAACvS,QAArD,IAAiE,CAACnU,IAAI,CAACkQ,eAAL,CAAqByW,SAArB,CAAlE,IAAqG,CAACA,SAAS,CAACtR,eAAhH,IAAmIrV,IAAI,CAAC8Y,kBAAL,CAAwBrH,MAAM,CAACJ,WAAP,CAAmBqF,KAAnB,CAAyBhF,MAAzB,CAAxB,CAAvI,EAAkM;AAC9L,YAAIkV,OAAO,GAAG,IAAd;AACA,YAAItZ,CAAC,GAAGmE,MAAM,CAACmD,WAAf;;AACA,eAAOtH,CAAP,EAAU;AACN,cAAI,CAACtN,IAAI,CAAC8Y,kBAAL,CAAwBxL,CAAxB,CAAL,EAAiC;AAC7BsZ,YAAAA,OAAO,GAAG,KAAV;AACA;AACH;;AACDtZ,UAAAA,CAAC,GAAGA,CAAC,CAACsH,WAAN;AACH;;AAED,YAAIgS,OAAJ,EAAa;AACT5mB,UAAAA,IAAI,CAACiY,iBAAL,CAAuB0O,SAAvB,EAAkCD,YAAlC;AAEA,iBAAO;AACHlT,YAAAA,QAAQ,EAAE/T,OADP;AAEHiC,YAAAA,SAAS,EAAE+P,MAFR;AAGHpD,YAAAA,MAAM,EAAEqD;AAHL,WAAP;AAKH;AACJ,OA5BgK,CA8BjK;;;AACAgS,MAAAA,YAAY,CAACC,CAAb,GAAiB,KAAjB;AACA,UAAMla,EAAE,GAAGhK,OAAX;AACA,UAAMqnB,UAAU,GAAG,CAACJ,YAAD,CAAnB;AACA,UAAMK,KAAK,GAAGtnB,OAAO,CAAC8X,SAAR,CAAkB,KAAlB,CAAd;AAEA,UAAI7V,SAAS,GAAG+P,MAAhB;AACA,UAAIpD,MAAM,GAAGqD,MAAb;AACA,UAAIwX,QAAQ,GAAG,KAAf;AACA,UAAI/B,QAAJ,EAAc/D,OAAd,EAAuBrD,UAAvB,EAAmChN,UAAnC;;AAEA,OAAC,SAASsU,aAAT,CAAuBnW,OAAvB,EAAgCsC,QAAhC,EAA0C;AACvC,YAAMrC,UAAU,GAAGD,OAAO,CAACC,UAA3B;;AAEA,aAAK,IAAIrJ,CAAC,GAAGqJ,UAAU,CAACnJ,MAAX,GAAoB,CAA5B,EAA+B6b,KAApC,EAA2C,KAAK/b,CAAhD,EAAmDA,CAAC,EAApD,EAAwD;AACpD,cAAM+d,KAAK,GAAG1U,UAAU,CAACrJ,CAAD,CAAxB;AACA,cAAI,CAAC+d,KAAL,EAAY;AACZ,cAAIyB,SAAS,GAAG9T,QAAhB;;AAEA,cAAI0V,QAAQ,IAAI,CAAClpB,IAAI,CAAC0U,OAAL,CAAamR,KAAb,CAAjB,EAAsC;AAClC,gBAAIA,KAAK,CAACzU,QAAN,KAAmB,CAAvB,EAA0B;AACtB,kBAAIpR,IAAI,CAACic,mBAAL,CAAyB4J,KAAzB,CAAJ,EAAqC;AACjCa,gBAAAA,YAAY,GAAGA,YAAY,CAACnP,SAAb,CAAuB,KAAvB,CAAf;AACA,oBAAM4R,UAAU,GAAGtD,KAAK,CAACtO,SAAN,CAAgB,IAAhB,CAAnB;AACAwP,gBAAAA,KAAK,CAACxW,YAAN,CAAmB4Y,UAAnB,EAA+B3V,QAA/B;AACAuT,gBAAAA,KAAK,CAACxW,YAAN,CAAmBmW,YAAnB,EAAiCyC,UAAjC;AACArC,gBAAAA,UAAU,CAAC9d,IAAX,CAAgB0d,YAAhB;AACH,eAND,MAMO;AACHW,gBAAAA,aAAa,CAACxB,KAAD,EAAQA,KAAR,CAAb;AACH;;AACD;AACH;;AAEDzC,YAAAA,OAAO,GAAGyC,KAAV;AACAsB,YAAAA,QAAQ,GAAG,EAAX;AACA,gBAAMY,OAAO,GAAG,EAAhB;;AACA,mBAAO3E,OAAO,CAACpO,UAAR,KAAuB,IAAvB,IAA+BoO,OAAO,KAAK3Z,EAA3C,IAAiD2Z,OAAO,KAAKsD,YAApE,EAAkF;AAC9E7C,cAAAA,KAAK,GAAGrO,UAAU,CAAC4N,OAAD,CAAlB;;AACA,kBAAIS,KAAK,IAAIT,OAAO,CAAChS,QAAR,KAAqB,CAAlC,EAAqC;AACjC,oBAAIoT,iBAAiB,CAACpB,OAAD,CAArB,EAAgC;AAC5B,sBAAI,CAACrQ,UAAL,EAAiBgV,OAAO,CAAC/e,IAAR,CAAa6a,KAAb;AACpB,iBAFD,MAEO;AACHsD,kBAAAA,QAAQ,CAACne,IAAT,CAAc6a,KAAd;AACH;AACJ;;AACDT,cAAAA,OAAO,GAAGA,OAAO,CAACpO,UAAlB;AACH;;AACDmS,YAAAA,QAAQ,GAAGA,QAAQ,CAACa,MAAT,CAAgBD,OAAhB,CAAX;AAEA,gBAAMqB,SAAS,GAAGjC,QAAQ,CAACnf,MAAT,GAAkB,CAApC;AACA,gBAAM6f,SAAS,GAAGV,QAAQ,CAACW,GAAT,MAAkBjC,KAApC;AACA9F,YAAAA,UAAU,GAAGqD,OAAO,GAAGyE,SAAvB;;AACA,mBAAOV,QAAQ,CAACnf,MAAT,GAAkB,CAAzB,EAA4B;AACxBob,cAAAA,OAAO,GAAG+D,QAAQ,CAACW,GAAT,EAAV;AACA/H,cAAAA,UAAU,CAAC/V,WAAX,CAAuBoZ,OAAvB;AACArD,cAAAA,UAAU,GAAGqD,OAAb;AACH;;AAED,gBAAIoB,iBAAiB,CAACkC,YAAY,CAAC1R,UAAd,CAAjB,IAA8C,CAACwP,iBAAiB,CAACqD,SAAD,CAApE,EAAiF;AAC7EnB,cAAAA,YAAY,GAAGA,YAAY,CAACnP,SAAb,CAAuB,KAAvB,CAAf;AACAwP,cAAAA,KAAK,CAACxW,YAAN,CAAmBmW,YAAnB,EAAiCK,KAAK,CAAC/S,UAAvC;AACA8S,cAAAA,UAAU,CAAC9d,IAAX,CAAgB0d,YAAhB;AACH;;AAED,gBAAI,CAAC3T,UAAD,IAAeyR,iBAAiB,CAACqD,SAAD,CAApC,EAAiD;AAC7CnB,cAAAA,YAAY,GAAGA,YAAY,CAACnP,SAAb,CAAuB,KAAvB,CAAf;AACA,kBAAM2Q,SAAS,GAAGL,SAAS,CAAC1W,UAA5B;;AACA,mBAAK,IAAIsW,CAAC,GAAG,CAAR,EAAWU,IAAI,GAAGD,SAAS,CAAClgB,MAAjC,EAAyCyf,CAAC,GAAGU,IAA7C,EAAmDV,CAAC,EAApD,EAAwD;AACpDf,gBAAAA,YAAY,CAAC1c,WAAb,CAAyBke,SAAS,CAACT,CAAD,CAAlC;AACH;;AACDI,cAAAA,SAAS,CAAC7d,WAAV,CAAsB0c,YAAtB;AACAK,cAAAA,KAAK,CAACxW,YAAN,CAAmBsX,SAAnB,EAA8Bd,KAAK,CAAC/S,UAApC;AACA8S,cAAAA,UAAU,CAAC9d,IAAX,CAAgB0d,YAAhB;AACA,kBAAIA,YAAY,CAAC1W,QAAb,CAAsBhI,MAAtB,GAA+B,CAAnC,EAAsCwL,QAAQ,GAAG4P,OAAX,CAAtC,KACK5P,QAAQ,GAAGkT,YAAX;AACR,aAXD,MAWO,IAAI0C,SAAJ,EAAe;AAClB1C,cAAAA,YAAY,CAACnW,YAAb,CAA0BsX,SAA1B,EAAqCnB,YAAY,CAAC1S,UAAlD;AACAR,cAAAA,QAAQ,GAAG4P,OAAX;AACH,aAHM,MAGA;AACH5P,cAAAA,QAAQ,GAAGkT,YAAX;AACH;;AAED,gBAAI3T,UAAU,IAAI8S,KAAK,CAACzU,QAAN,KAAmB,CAArC,EAAwC;AACpC,kBAAIuT,kBAAkB,CAACkB,KAAD,CAAtB,EAA+B;AAC3B,oBAAMuC,kBAAkB,GAAGpoB,IAAI,CAACoP,gBAAL,CAAsBoE,QAAtB,EAAgC,UAAUtC,OAAV,EAAmB;AAAC,yBAAO,KAAKsT,iBAAL,CAAuBtT,OAAO,CAAC8D,UAA/B,KAA8C9D,OAAO,CAAC8D,UAAR,KAAuB+R,KAA5E;AAAmF,iBAAvG,CAAwGzc,IAAxG,CAA6GtK,IAA7G,CAAhC,CAA3B;AACA+S,gBAAAA,UAAU,CAAC/I,WAAX,CAAuBoe,kBAAvB;AACA1B,gBAAAA,YAAY,GAAG0B,kBAAkB,CAAC7Q,SAAnB,CAA6B,KAA7B,CAAf;AACAuP,gBAAAA,UAAU,CAAC9d,IAAX,CAAgB0d,YAAhB;AACAK,gBAAAA,KAAK,CAACxW,YAAN,CAAmBmW,YAAnB,EAAiCK,KAAK,CAAC/S,UAAvC;AACH,eAND,MAMO;AACHjB,gBAAAA,UAAU,GAAG,IAAb;AACH;AACJ;AACJ,WA/EmD,CAiFpD;;;AACA,cAAI,CAACmW,QAAD,IAAarD,KAAK,KAAKnkB,SAA3B,EAAsC;AAClCqR,YAAAA,UAAU,GAAG4R,kBAAkB,CAACkB,KAAD,CAA/B;AACA,gBAAM9L,SAAS,GAAG/Z,IAAI,CAACkV,cAAL,CAAoBxT,SAAS,CAAC0P,QAAV,KAAuB,CAAvB,GAA2B,EAA3B,GAAgC1P,SAAS,CAACqb,aAAV,CAAwB1O,MAAxB,EAAiC3M,SAAS,CAACsG,MAAV,GAAmBqG,MAApD,CAApD,CAAlB;AACA,gBAAMmZ,QAAQ,GAAGxnB,IAAI,CAACkV,cAAL,CAAoBxT,SAAS,CAAC0P,QAAV,KAAuB,CAAvB,GAA2B,EAA3B,GAAgC1P,SAAS,CAACqb,aAAV,CAAwB,CAAxB,EAA2B1O,MAA3B,CAApD,CAAjB;;AAEA,gBAAI0E,UAAJ,EAAgB;AACZA,cAAAA,UAAU,GAAGA,UAAU,CAACwE,SAAX,CAAqB,KAArB,CAAb;;AACA,kBAAMkQ,GAAC,GAAG9C,kBAAkB,CAACnR,QAAD,CAA5B;;AACA,kBAAIiU,GAAC,IAAIA,GAAC,CAACzS,UAAF,KAAiB+R,KAA1B,EAAiC;AAC7B,oBAAIW,CAAC,GAAGD,GAAR;AACA,oBAAI5I,CAAC,GAAG,IAAR;;AACA,uBAAO6I,CAAC,CAAC1S,UAAF,KAAiB+R,KAAxB,EAA+B;AAC3BvT,kBAAAA,QAAQ,GAAGqL,CAAC,GAAG6I,CAAC,CAAC1S,UAAF,CAAauC,SAAb,CAAuB,KAAvB,CAAf;;AACA,yBAAMmQ,CAAC,CAACvW,UAAF,CAAa,CAAb,CAAN,EAAuB;AACnB0N,oBAAAA,CAAC,CAAC7U,WAAF,CAAc0d,CAAC,CAACvW,UAAF,CAAa,CAAb,CAAd;AACH;;AACDuW,kBAAAA,CAAC,CAAC1d,WAAF,CAAc6U,CAAd;AACA6I,kBAAAA,CAAC,GAAGA,CAAC,CAAC1S,UAAN;AACH;;AACD0S,gBAAAA,CAAC,CAAC1S,UAAF,CAAazE,YAAb,CAA0BkX,GAA1B,EAA6BC,CAAC,CAAC1S,UAAF,CAAahB,UAA1C;AACH;;AACDjB,cAAAA,UAAU,GAAGA,UAAU,CAACwE,SAAX,CAAqB,KAArB,CAAb;AACH,aAjBD,MAiBO,IAAIiN,iBAAiB,CAACkC,YAAY,CAAC1R,UAAd,CAAjB,IAA8C,CAACjC,UAAnD,EAA+D;AAClE2T,cAAAA,YAAY,GAAGA,YAAY,CAACnP,SAAb,CAAuB,KAAvB,CAAf;AACAwP,cAAAA,KAAK,CAAC/c,WAAN,CAAkB0c,YAAlB;AACAI,cAAAA,UAAU,CAAC9d,IAAX,CAAgB0d,YAAhB;AACH;;AAED,gBAAI,CAAC1mB,IAAI,CAAC8Y,kBAAL,CAAwBiB,SAAxB,CAAL,EAAyC;AACrCvG,cAAAA,QAAQ,CAACjD,YAAT,CAAsBwJ,SAAtB,EAAiCvG,QAAQ,CAACQ,UAA1C;AACH;;AAEDoP,YAAAA,OAAO,GAAG5P,QAAV;AACA2T,YAAAA,QAAQ,GAAG,EAAX;;AACA,mBAAO/D,OAAO,KAAK2D,KAAZ,IAAqB3D,OAAO,KAAK,IAAxC,EAA8C;AAC1CS,cAAAA,KAAK,GAAGW,iBAAiB,CAACpB,OAAD,CAAjB,GAA6B,IAA7B,GAAoC5N,UAAU,CAAC4N,OAAD,CAAtD;;AACA,kBAAIS,KAAK,IAAIT,OAAO,CAAChS,QAAR,KAAqB,CAAlC,EAAqC;AACjC+V,gBAAAA,QAAQ,CAACne,IAAT,CAAc6a,KAAd;AACH;;AACDT,cAAAA,OAAO,GAAGA,OAAO,CAACpO,UAAlB;AACH;;AAED,gBAAM6S,WAAS,GAAGV,QAAQ,CAACW,GAAT,MAAkBtU,QAApC;;AACAuM,YAAAA,UAAU,GAAGqD,OAAO,GAAGyE,WAAvB;;AACA,mBAAOV,QAAQ,CAACnf,MAAT,GAAkB,CAAzB,EAA4B;AACxBob,cAAAA,OAAO,GAAG+D,QAAQ,CAACW,GAAT,EAAV;AACA/H,cAAAA,UAAU,CAAC/V,WAAX,CAAuBoZ,OAAvB;AACArD,cAAAA,UAAU,GAAGqD,OAAb;AACH;;AAED,gBAAIyE,WAAS,KAAKrU,QAAlB,EAA4B;AACxBkT,cAAAA,YAAY,CAACnW,YAAb,CAA0BsX,WAA1B,EAAqCnB,YAAY,CAAC1S,UAAlD;AACAR,cAAAA,QAAQ,GAAG4P,OAAX;AACH,aAHD,MAGO;AACH5P,cAAAA,QAAQ,GAAGkT,YAAX;AACH;;AAED,gBAAI1mB,IAAI,CAAC0U,OAAL,CAAamR,KAAb,CAAJ,EAAyBa,YAAY,CAAC1c,WAAb,CAAyB6b,KAAK,CAACtO,SAAN,CAAgB,KAAhB,CAAzB;;AAEzB,gBAAIxE,UAAJ,EAAgB;AACZA,cAAAA,UAAU,CAACxC,YAAX,CAAwBmW,YAAxB,EAAsC3T,UAAU,CAACiB,UAAjD;AACA+S,cAAAA,KAAK,CAACxW,YAAN,CAAmBwC,UAAnB,EAA+BgU,KAAK,CAAC/S,UAArC;AACAjB,cAAAA,UAAU,GAAG,IAAb;AACH,aAJD,MAIO;AACHgU,cAAAA,KAAK,CAACxW,YAAN,CAAmBmW,YAAnB,EAAiCK,KAAK,CAAC/S,UAAvC;AACH;;AAEDtS,YAAAA,SAAS,GAAG8lB,QAAZ;AACAnZ,YAAAA,MAAM,GAAGmZ,QAAQ,CAAC5K,IAAT,CAAc5U,MAAvB;AACAkhB,YAAAA,QAAQ,GAAG,IAAX;AAEA1V,YAAAA,QAAQ,CAACjD,YAAT,CAAsB7O,SAAtB,EAAiC8R,QAAQ,CAACQ,UAA1C;AACA;AACH;;AAED6P,UAAAA,KAAK,GAAG,CAACqF,QAAD,GAAYrD,KAAK,CAACtO,SAAN,CAAgB,KAAhB,CAAZ,GAAqC/B,UAAU,CAACqQ,KAAD,CAAvD;;AACA,cAAIhC,KAAJ,EAAW;AACPrQ,YAAAA,QAAQ,CAACjD,YAAT,CAAsBsT,KAAtB,EAA6BrQ,QAAQ,CAACQ,UAAtC;AACA,gBAAI6R,KAAK,CAACzU,QAAN,KAAmB,CAAnB,IAAwB,CAACpR,IAAI,CAAC0U,OAAL,CAAamR,KAAb,CAA7B,EAAkDyB,SAAS,GAAGzD,KAAZ;AACrD;;AAEDwD,UAAAA,aAAa,CAACxB,KAAD,EAAQyB,SAAR,CAAb;AACH;AACJ,OAxKD,EAwKG7nB,OAxKH,EAwKYsnB,KAxKZ,EAzCiK,CAmNjK;;;AACA,UAAIjF,YAAY,IAAI,CAACC,cAAjB,IAAmC,CAAC2B,YAAY,CAACC,CAArD,EAAwD;AACpD,eAAO;AACHnQ,UAAAA,QAAQ,EAAE/T,OADP;AAEHiC,UAAAA,SAAS,EAAE+P,MAFR;AAGHpD,UAAAA,MAAM,EAAEqD;AAHL,SAAP;AAKH;;AAEDqQ,MAAAA,cAAc,GAAGA,cAAc,IAAID,YAAnC;;AAEA,UAAIC,cAAJ,EAAoB;AAChB,aAAK,IAAIja,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGgf,UAAU,CAAC9e,MAA/B,EAAuCF,CAAC,EAAxC,EAA4C;AACxC,cAAIyQ,UAAU,GAAGuO,UAAU,CAAChf,CAAD,CAA3B;AAEA,cAAMygB,SAAS,GAAGhQ,UAAU,CAACpH,UAA7B;AACA,cAAIqW,QAAQ,GAAG,IAAf;;AACA,iBAAOe,SAAS,CAAC,CAAD,CAAhB,EAAqB;AACjBf,YAAAA,QAAQ,GAAGe,SAAS,CAAC,CAAD,CAApB;AACAxB,YAAAA,KAAK,CAACxW,YAAN,CAAmBiX,QAAnB,EAA6BjP,UAA7B;AACH;;AACDvY,UAAAA,IAAI,CAACsV,UAAL,CAAgBiD,UAAhB;;AAEA,cAAIzQ,CAAC,KAAKgf,UAAU,CAAC9e,MAAX,GAAoB,CAA9B,EAAiC;AAC7BtG,YAAAA,SAAS,GAAG8lB,QAAZ;AACAnZ,YAAAA,MAAM,GAAGmZ,QAAQ,CAACnW,WAAT,CAAqBrJ,MAA9B;AACH;AACJ;AACJ,OAjBD,MAiBO,IAAI8Z,YAAJ,EAAkB;AACrB4E,QAAAA,YAAY,GAAGA,YAAY,CAAC1S,UAA5B;;AACA,aAAK,IAAIlM,IAAC,GAAG,CAAb,EAAgBA,IAAC,GAAGgf,UAAU,CAAC9e,MAA/B,EAAuCF,IAAC,EAAxC,EAA4C;AACxC,eAAKye,gBAAL,CAAsBO,UAAU,CAAChf,IAAD,CAAhC;AACH;AACJ;;AAED,UAAI,CAACia,cAAD,IAAmBgF,KAAK,CAAC5V,UAAN,CAAiBnJ,MAAjB,KAA4B,CAAnD,EAAsD;AAClD,YAAIvI,OAAO,CAAC0R,UAAZ,EAAwB;AACpBzP,UAAAA,SAAS,GAAGjC,OAAO,CAAC0R,UAAR,CAAmB,CAAnB,CAAZ;AACH,SAFD,MAEO;AACHzP,UAAAA,SAAS,GAAG1B,IAAI,CAACkV,cAAL,CAAoBlV,IAAI,CAACmV,cAAzB,CAAZ;AACA1V,UAAAA,OAAO,CAACuK,WAAR,CAAoBtI,SAApB;AACH;AACJ,OAPD,MAOO;AACH,YAAI,CAACogB,YAAD,IAAiB4E,YAAY,CAACrV,WAAb,CAAyBrJ,MAAzB,KAAoC,CAAzD,EAA4D;AACxDhI,UAAAA,IAAI,CAACihB,eAAL,CAAqB8F,KAArB,EAA4B,IAA5B;AACA,iBAAO;AACHvT,YAAAA,QAAQ,EAAE,IADP;AAEH9R,YAAAA,SAAS,EAAE,IAFR;AAGH2M,YAAAA,MAAM,EAAE;AAHL,WAAP;AAKH;;AAEDrO,QAAAA,IAAI,CAACihB,eAAL,CAAqB8F,KAArB,EAA4BL,YAA5B;;AAEA,YAAI1mB,IAAI,CAAC8Y,kBAAL,CAAwBiO,KAAK,CAAC1V,WAA9B,CAAJ,EAAgD;AAC5C3P,UAAAA,SAAS,GAAGqlB,KAAK,CAAC/S,UAAlB;AACA3F,UAAAA,MAAM,GAAG3M,SAAS,CAAC2P,WAAV,CAAsBrJ,MAA/B;AACH,SAHD,MAGO,IAAIhI,IAAI,CAAC8Y,kBAAL,CAAwBpX,SAAxB,CAAJ,EAAwC;AAC3CA,UAAAA,SAAS,GAAGglB,YAAZ;AACArY,UAAAA,MAAM,GAAG,CAAT;AACH,SAlBE,CAoBH;;;AACA,YAAMgb,OAAO,GAAG;AAACzG,UAAAA,CAAC,EAAE,CAAJ;AAAOtV,UAAAA,CAAC,EAAE;AAAV,SAAhB;AACA,YAAMgc,IAAI,GAAGtpB,IAAI,CAAC2oB,WAAL,CAAiBjnB,SAAjB,EAA4BqlB,KAA5B,EAAmCsC,OAAnC,CAAb;AACAhb,QAAAA,MAAM,IAAIgb,OAAO,CAACzG,CAAlB,CAvBG,CAyBH;;AACA,YAAMmG,UAAU,GAAG/oB,IAAI,CAACkf,aAAL,CAAmB6H,KAAnB,EAA0B,CAACuC,IAAD,CAA1B,EAAkC,IAAlC,CAAnB;AAEA7pB,QAAAA,OAAO,CAACuV,UAAR,CAAmB1M,YAAnB,CAAgCye,KAAhC,EAAuCtnB,OAAvC;AAEAiC,QAAAA,SAAS,GAAG1B,IAAI,CAACgpB,eAAL,CAAqBM,IAArB,EAA2BvC,KAA3B,CAAZ;AACA1Y,QAAAA,MAAM,IAAI0a,UAAU,CAAC,CAAD,CAApB;AACH;;AAED,aAAO;AACHvV,QAAAA,QAAQ,EAAEuT,KADP;AAEHrlB,QAAAA,SAAS,EAAEA,SAFR;AAGH2M,QAAAA,MAAM,EAAE3M,SAAS,CAAC0P,QAAV,KAAuB,CAAvB,IAA4B/C,MAAM,KAAK,CAAvC,GAA2C3M,SAAS,CAACyP,UAAV,CAAqBnJ,MAAhE,GAAyEqG;AAH9E,OAAP;AAKH,KAnqIQ;;AAqqIT;AACR;AACA;AACA;AACA;AACA;AACQsb,IAAAA,UAAU,EAAE,oBAAU5hB,OAAV,EAAmB4C,OAAnB,EAA4Bb,MAA5B,EAAoC;AAC5C;AACA,UAAIa,OAAJ,EAAa;AACT,YAAI,QAAQgD,IAAR,CAAahD,OAAb,CAAJ,EAA2B;AACvB,cAAIb,MAAM,KAAK,KAAKxH,sBAApB,EAA4C;AACxC,gBAAMwI,KAAK,GAAG5L,OAAO,CAACO,OAAR,CAAgBsL,OAAhB,CAAwBC,aAAxB,CAAsC,MAAMjD,OAA5C,CAAd;;AACA,gBAAI+C,KAAJ,EAAW;AACP,kBAAI,KAAKxI,sBAAT,EAAiC,KAAKuI,YAAL;AAEjC,mBAAKvI,sBAAL,GAA8BwH,MAA9B;AACAgB,cAAAA,KAAK,CAACxE,KAAN,CAAYqE,OAAZ,GAAsB,OAAtB;;AAEAgB,cAAAA,KAAK,CAACie,mBAAN;;AACAje,cAAAA,KAAK,CAACke,kBAAN;AACH;;AACD7pB,YAAAA,IAAI,CAACuL,QAAL,CAAczB,MAAd,EAAsB,IAAtB;AACH,WAZD,MAYO;AACH,gBAAMgB,MAAK,GAAG5L,OAAO,CAACO,OAAR,CAAgBsL,OAAhB,CAAwBC,aAAxB,CAAsC,MAAM,KAAK1I,sBAAL,CAA4B2F,YAA5B,CAAyC,cAAzC,CAA5C,CAAd;;AACA,gBAAI6C,MAAJ,EAAW;AACP,mBAAKD,YAAL;;AAEAc,cAAAA,KAAK,CAACie,mBAAN;;AACAje,cAAAA,KAAK,CAACke,kBAAN;AACH;AACJ;;AACD;AACH;;AAED,YAAI,YAAYlc,IAAZ,CAAiBhD,OAAjB,MAA8B,KAAKpJ,SAAL,CAAewG,OAAf,MAA4B,IAA5B,IAAoC+B,MAAM,KAAK,KAAK/H,qBAAlF,CAAJ,EAA8G;AAC1G,eAAKyG,UAAL,CAAgBT,OAAhB,EAAyB,KAAKkD,WAAL,CAAiBX,IAAjB,CAAsB,IAAtB,EAA4BR,MAA5B,CAAzB,EAA8DA,MAA9D;AACA;AACH;;AAED,YAAI,KAAK9G,UAAL,IAAmBhD,IAAI,CAAC8pB,aAAL,CAAmB,KAAKznB,uBAAxB,EAAiDyH,MAAjD,CAAvB,EAAiF;;AACjF,YAAI,UAAU6D,IAAV,CAAehD,OAAf,MAA4B,KAAKpJ,SAAL,CAAewG,OAAf,MAA4B,IAA5B,IAAoC+B,MAAM,KAAK,KAAKhI,mBAAhF,CAAJ,EAA0G;AACtG,eAAK0G,UAAL,CAAgBT,OAAhB,EAAyB,KAAKkC,SAAL,CAAeK,IAAf,CAAoB,IAApB,EAA0BR,MAA1B,CAAzB,EAA4DA,MAA5D;AACA;AACH,SAHD,MAGO,IAAI,SAAS6D,IAAT,CAAchD,OAAd,CAAJ,EAA4B;AAC/B,eAAKnC,UAAL,CAAgBT,OAAhB,EAAyB,KAAK3I,OAAL,CAAa2I,OAAb,EAAsBgiB,IAAtB,CAA2Bzf,IAA3B,CAAgC,IAAhC,CAAzB,EAAgER,MAAhE;AACA;AACH,SAHM,MAGA,IAAI,UAAU6D,IAAV,CAAehD,OAAf,CAAJ,EAA6B;AAChC,eAAKnC,UAAL,CAAgBT,OAAhB,EAAyB,KAAK3I,OAAL,CAAa2I,OAAb,EAAsBiiB,MAAtB,CAA6B1f,IAA7B,CAAkC,IAAlC,CAAzB,EAAkER,MAAlE;AACH,SAFM,MAEA,IAAI,cAAc6D,IAAd,CAAmBhD,OAAnB,CAAJ,EAAiC;AACpC,eAAKnC,UAAL,CAAgBT,OAAhB,EAAyB,KAAK3I,OAAL,CAAa2I,OAAb,EAAsBgiB,IAAtB,CAA2Bzf,IAA3B,CAAgC,IAAhC,EAAsC,IAAtC,CAAzB,EAAsER,MAAtE;AACH;AACJ,OA3CD,CA2CE;AA3CF,WA4CK,IAAI/B,OAAJ,EAAa;AACd,aAAKkiB,cAAL,CAAoBngB,MAApB,EAA4B/B,OAA5B;AACH;;AAED,UAAI,UAAU4F,IAAV,CAAehD,OAAf,CAAJ,EAA6B;AACzB,aAAKN,UAAL;AACH,OAFD,MAEO,IAAI,CAAC,UAAUsD,IAAV,CAAehD,OAAf,CAAL,EAA8B;AACjC,aAAKN,UAAL;AACA,aAAKe,YAAL;AACH;AACJ,KAnuIQ;;AAquIT;AACR;AACA;AACA;AACA;AACA;AACQ6e,IAAAA,cAAc,EAAE,wBAAUngB,MAAV,EAAkB/B,OAAlB,EAA2B;AACvC,UAAI7H,IAAI,CAAC8C,UAAL,IAAmB,CAAC,kEAAkE2K,IAAlE,CAAuE5F,OAAvE,CAAxB,EAAyG;;AACzG,cAAQA,OAAR;AACI,aAAK,MAAL;AACA,aAAK,KAAL;AACI,eAAK8G,WAAL,CAAiB9G,OAAjB;AACA;;AACJ,aAAK,OAAL;AACI;;AACJ,aAAK,WAAL;AACI,eAAKqD,YAAL;AACA,cAAMmE,OAAO,GAAGrQ,OAAO,CAACO,OAAR,CAAgB8P,OAAhC;AACA,cAAI6Q,KAAK,GAAGpgB,IAAI,CAACiR,eAAL,CAAqB1B,OAAO,CAACyE,UAA7B,EAAyC,UAAU9C,OAAV,EAAmB;AAAE,mBAAOA,OAAO,CAACC,UAAR,CAAmBnJ,MAAnB,KAA8B,CAA9B,IAAmCkJ,OAAO,CAACE,QAAR,KAAqB,CAA/D;AAAmE,WAAjI,EAAmI,KAAnI,KAA6I7B,OAAO,CAACyE,UAAjK;AACA,cAAI6J,IAAI,GAAG7d,IAAI,CAACiR,eAAL,CAAqB1B,OAAO,CAACkF,SAA7B,EAAwC,UAAUvD,OAAV,EAAmB;AAAE,mBAAOA,OAAO,CAACC,UAAR,CAAmBnJ,MAAnB,KAA8B,CAA9B,IAAmCkJ,OAAO,CAACE,QAAR,KAAqB,CAA/D;AAAmE,WAAhI,EAAkI,IAAlI,KAA2I7B,OAAO,CAACkF,SAA9J;AACA,cAAI,CAAC2L,KAAD,IAAU,CAACvC,IAAf,EAAqB;;AACrB,cAAI7d,IAAI,CAACsa,OAAL,CAAa8F,KAAb,CAAJ,EAAyB;AACrB,gBAAM8J,IAAI,GAAG,KAAK/c,gBAAL,CAAsBiT,KAAtB,CAAb;AACA,gBAAM9P,EAAE,GAAGtQ,IAAI,CAACoQ,aAAL,CAAmB,IAAnB,CAAX;AACA,gBAAM1K,MAAM,GAAG1F,IAAI,CAACoQ,aAAL,CAAmB9Q,OAAO,CAAC+Q,UAA3B,CAAf;AACA3K,YAAAA,MAAM,CAACsE,WAAP,CAAmBsG,EAAnB;AACA8P,YAAAA,KAAK,GAAG8J,IAAI,GAAGA,IAAI,CAACnT,SAAR,GAAoBqJ,KAAhC;AACAA,YAAAA,KAAK,CAACpL,UAAN,CAAiBzE,YAAjB,CAA8B7K,MAA9B,EAAsC0a,KAAtC;AACAA,YAAAA,KAAK,GAAG9P,EAAR;AACH;;AACD,cAAItQ,IAAI,CAACsa,OAAL,CAAauD,IAAb,CAAJ,EAAwB;AACpB,gBAAMvN,GAAE,GAAGtQ,IAAI,CAACoQ,aAAL,CAAmB,IAAnB,CAAX;;AACA,gBAAM1K,QAAM,GAAG1F,IAAI,CAACoQ,aAAL,CAAmB9Q,OAAO,CAAC+Q,UAA3B,CAAf;;AACA3K,YAAAA,QAAM,CAACsE,WAAP,CAAmBsG,GAAnB;;AACAf,YAAAA,OAAO,CAACvF,WAAR,CAAoBtE,QAApB;AACAmY,YAAAA,IAAI,GAAGvN,GAAP;AACH;;AACD3E,UAAAA,KAAK,CAACie,mBAAN,CAA0B,KAAKpZ,QAAL,CAAc4P,KAAd,EAAqB,CAArB,EAAwBvC,IAAxB,EAA8BA,IAAI,CAACxM,WAAL,CAAiBrJ,MAA/C,CAA1B;;AACA;;AACJ,aAAK,UAAL;AACI,eAAKmiB,cAAL;AACA;;AACJ,aAAK,YAAL;AACI,eAAKC,gBAAL,CAAsBtgB,MAAtB;AACA;;AACJ,aAAK,QAAL;AACA,aAAK,SAAL;AACI,eAAKugB,MAAL,CAAYtiB,OAAZ;AACA;;AACJ,aAAK,MAAL;AACI,eAAK3G,OAAL,CAAakpB,IAAb;AACA;;AACJ,aAAK,MAAL;AACI,eAAKlpB,OAAL,CAAampB,IAAb;AACA;;AACJ,aAAK,cAAL;AACI,eAAKC,YAAL;AACA,eAAKlb,KAAL;AACA;;AACJ,aAAK,OAAL;AACI,eAAKmb,KAAL;AACA;;AACJ,aAAK,SAAL;AACI,eAAKC,OAAL;AACA;;AACJ,aAAK,YAAL;AACI,eAAKC,mBAAL;AACA;;AACJ,aAAK,KAAL;AACI,eAAKC,MAAL,CAAYtrB,OAAO,CAACgB,GAAR,GAAc,KAAd,GAAsB,KAAlC;AACA;;AACJ,aAAK,SAAL;AACI,eAAKsqB,MAAL,CAAY,KAAZ;AACA;;AACJ,aAAK,SAAL;AACI,eAAKA,MAAL,CAAY,KAAZ;AACA;;AACJ,aAAK,MAAL;AACI,cAAI,OAAOtrB,OAAO,CAACurB,YAAf,KAAgC,UAApC,EAAgD;AAC5CvrB,YAAAA,OAAO,CAACurB,YAAR,CAAqB,KAAKC,WAAL,CAAiB,KAAjB,CAArB,EAA8C,KAAKnlB,SAAL,CAAeC,SAA7D;AACH,WAFD,MAEO,IAAI,KAAKD,SAAL,CAAeC,SAAf,IAA4B,OAAO3E,SAAS,CAAC8pB,IAAjB,KAA0B,UAA1D,EAAsE;AACzE9pB,YAAAA,SAAS,CAAC8pB,IAAV;AACH,WAFM,MAEA;AACH,kBAAMniB,KAAK,CAAC,uHAAD,CAAX;AACH;;AAED,eAAKjD,SAAL,CAAeC,SAAf,GAA2B,KAA3B;AACA,cAAI1G,OAAO,CAACqJ,IAAR,CAAawiB,IAAjB,EAAuB7rB,OAAO,CAACqJ,IAAR,CAAawiB,IAAb,CAAkBC,YAAlB,CAA+B,UAA/B,EAA2C,IAA3C;AACvB;;AACJ;AAAU;AACNjjB,UAAAA,OAAO,GAAGzI,OAAO,CAAC0mB,eAAR,CAAwBje,OAAO,CAACkR,WAAR,EAAxB,KAAkDlR,OAA5D;AACA,cAAI,CAAC,KAAK/C,UAAL,CAAgB+C,OAAhB,CAAL,EAA+B,KAAK/C,UAAL,CAAgB+C,OAAhB,IAA2B+B,MAA3B;AAE/B,cAAMmhB,QAAQ,GAAG,KAAKtlB,SAAL,CAAec,eAAhC;AACA,cAAMykB,GAAG,GAAGD,QAAQ,CAAC7d,OAAT,CAAiBrF,OAAjB,IAA4B,CAAC,CAA7B,GAAiC,IAAjC,GAAwC/H,IAAI,CAACoQ,aAAL,CAAmBrI,OAAnB,CAApD;AACA,cAAIwQ,UAAU,GAAGxQ,OAAjB;;AAEA,cAAI,SAAS4F,IAAT,CAAc5F,OAAd,KAA0BkjB,QAAQ,CAAC7d,OAAT,CAAiB,KAAjB,IAA0B,CAAC,CAAzD,EAA4D;AACxDmL,YAAAA,UAAU,GAAG,KAAb;AACH,WAFD,MAEO,IAAI,SAAS5K,IAAT,CAAc5F,OAAd,KAA0BkjB,QAAQ,CAAC7d,OAAT,CAAiB,KAAjB,IAA0B,CAAC,CAAzD,EAA4D;AAC/DmL,YAAAA,UAAU,GAAG,KAAb;AACH;;AAED,eAAKmJ,UAAL,CAAgBwJ,GAAhB,EAAqB,KAAKjmB,iBAAL,CAAuB8C,OAAvB,KAAmC,IAAxD,EAA8D,CAACwQ,UAAD,CAA9D,EAA4E,KAA5E;AACA,eAAKjJ,KAAL;AAhGR;AAkGH,KA/0IQ;;AAi1IT;AACR;AACA;AACQkb,IAAAA,YAAY,EAAE,wBAAY;AACtB,WAAK9I,UAAL,CAAgB,IAAhB,EAAsB,IAAtB,EAA4B,IAA5B,EAAkC,IAAlC;AACH,KAt1IQ;;AAw1IT;AACR;AACA;AACA;AACA;AACQ2I,IAAAA,MAAM,EAAE,gBAAUtiB,OAAV,EAAmB;AACvB,UAAM0H,KAAK,GAAG,KAAKC,QAAL,EAAd;AACA,UAAM4N,UAAU,GAAG,KAAK/H,mBAAL,CAAyB,IAAzB,CAAnB;AACA,UAAM4V,KAAK,GAAG,EAAd;AACA,UAAMC,KAAK,GAAG,aAAarjB,OAA3B;AACA,UAAMsjB,SAAS,GAAG/rB,OAAO,CAACgB,GAAR,GAAc,aAAd,GAA8B,YAAhD;AACA,UAAIwS,EAAE,GAAGrD,KAAK,CAACE,cAAf;AACA,UAAIqD,EAAE,GAAGvD,KAAK,CAACG,YAAf;AACA,UAAIqD,EAAE,GAAGxD,KAAK,CAACQ,WAAf;AACA,UAAIkD,EAAE,GAAG1D,KAAK,CAACgB,SAAf;;AAEA,WAAK,IAAI3I,CAAC,GAAG,CAAR,EAAWqB,GAAG,GAAGmU,UAAU,CAACtV,MAA5B,EAAoC2V,CAApC,EAAuC2N,MAA5C,EAAoDxjB,CAAC,GAAGqB,GAAxD,EAA6DrB,CAAC,EAA9D,EAAkE;AAC9D6V,QAAAA,CAAC,GAAGL,UAAU,CAACxV,CAAD,CAAd;;AACA,YAAI,CAAC9H,IAAI,CAACuW,UAAL,CAAgBoH,CAAhB,CAAD,IAAuB,CAAC,KAAKve,OAAL,CAAawe,IAAzC,EAA+C;AAC3C0N,UAAAA,MAAM,GAAG,MAAM3d,IAAN,CAAWgQ,CAAC,CAACrX,KAAF,CAAQ+kB,SAAR,CAAX,IAAiCrrB,IAAI,CAACoG,SAAL,CAAeuX,CAAC,CAACrX,KAAF,CAAQ+kB,SAAR,CAAf,EAAmC,CAAnC,CAAjC,GAAyE,CAAlF;;AACA,cAAID,KAAJ,EAAW;AACPE,YAAAA,MAAM,IAAI,EAAV;AACH,WAFD,MAEO;AACHA,YAAAA,MAAM,IAAI,EAAV;AACH;;AACDtrB,UAAAA,IAAI,CAACurB,QAAL,CAAc5N,CAAd,EAAiB0N,SAAjB,EAA6BC,MAAM,IAAI,CAAV,GAAc,EAAd,GAAmBA,MAAM,GAAG,IAAzD;AACH,SARD,MAQO;AACH,cAAIF,KAAK,IAAIzN,CAAC,CAACvI,sBAAf,EAAuC;AACnC+V,YAAAA,KAAK,CAACniB,IAAN,CAAW2U,CAAX;AACH;AACJ;AACJ,OA1BsB,CA4BvB;;;AACA,UAAIwN,KAAK,CAACnjB,MAAN,GAAe,CAAnB,EAAsB;AAClB,aAAK5I,OAAL,CAAawe,IAAb,CAAkB4N,cAAlB,CAAiC/gB,IAAjC,CAAsC,IAAtC,EAA4C2gB,KAA5C,EAAmDD,KAAnD;AACH;;AAED,WAAK3pB,UAAL,GAAkB,IAAlB;AACA,WAAKgP,QAAL,CAAcsC,EAAd,EAAkBG,EAAlB,EAAsBD,EAAtB,EAA0BG,EAA1B,EAlCuB,CAoCvB;;AACA,WAAK/R,OAAL,CAAa4H,IAAb,CAAkB,KAAlB;AACH,KAn4IQ;;AAq4IT;AACR;AACA;AACQ2hB,IAAAA,mBAAmB,EAAE,+BAAY;AAC7B,UAAMpb,OAAO,GAAGrQ,OAAO,CAACO,OAAR,CAAgB8P,OAAhC;AACAvP,MAAAA,IAAI,CAACyrB,WAAL,CAAiBlc,OAAjB,EAA0B,eAA1B;;AACA,UAAIvP,IAAI,CAACkN,QAAL,CAAcqC,OAAd,EAAuB,eAAvB,CAAJ,EAA6C;AACzCvP,QAAAA,IAAI,CAACuL,QAAL,CAAc,KAAKjG,gBAAL,CAAsBomB,UAApC,EAAgD,QAAhD;AACH,OAFD,MAEO;AACH1rB,QAAAA,IAAI,CAAC4K,WAAL,CAAiB,KAAKtF,gBAAL,CAAsBomB,UAAvC,EAAmD,QAAnD;AACH;;AACD,WAAKC,qBAAL;AACH,KAj5IQ;;AAm5IT;AACR;AACA;AACQxB,IAAAA,cAAc,EAAE,0BAAY;AACxB,UAAMtkB,UAAU,GAAG,KAAKF,SAAL,CAAeE,UAAlC;AACA,WAAKqE,cAAL;AACAlK,MAAAA,IAAI,CAAC4rB,kBAAL,CAAwB,CAAC/lB,UAAzB,EAAqC,KAAKzD,uBAA1C;;AAEA,UAAIyD,UAAJ,EAAgB;AACZ,YAAI,CAAC7F,IAAI,CAACgiB,aAAL,CAAmB9iB,OAAO,CAACO,OAAR,CAAgB4G,YAAnC,CAAL,EAAuD,KAAKwlB,oBAAL;AACvD3sB,QAAAA,OAAO,CAACO,OAAR,CAAgB4G,YAAhB,CAA6BqD,SAA7B,GAAyC,CAAzC;AACAxK,QAAAA,OAAO,CAACO,OAAR,CAAgBqsB,IAAhB,CAAqBxlB,KAArB,CAA2BqE,OAA3B,GAAqC,MAArC;AACAzL,QAAAA,OAAO,CAACO,OAAR,CAAgB4G,YAAhB,CAA6BC,KAA7B,CAAmCqE,OAAnC,GAA6C,OAA7C;AAEA,aAAKhF,SAAL,CAAeuB,kBAAf,GAAoC,KAAKvB,SAAL,CAAeuB,kBAAf,CAAkC4b,OAAlC,CAA0C,yCAA1C,EAAqF,eAArF,CAApC;AACA,aAAKnd,SAAL,CAAesB,qBAAf,GAAuC,KAAKtB,SAAL,CAAesB,qBAAf,CAAqC6b,OAArC,CAA6C,yCAA7C,EAAwF,gBAAxF,CAAvC;AAEA,YAAIxjB,OAAO,CAACgM,MAAR,KAAmB,MAAnB,IAA6B,CAAChM,OAAO,CAACysB,gBAA1C,EAA4D7sB,OAAO,CAACO,OAAR,CAAgBqsB,IAAhB,CAAqBxlB,KAArB,CAA2BgF,MAA3B,GAAoC,KAApC;AAE5D,aAAK3F,SAAL,CAAeE,UAAf,GAA4B,KAA5B;;AAEA,YAAI,CAAC,KAAKF,SAAL,CAAeG,YAApB,EAAkC;AAC9B,eAAKhC,eAAL,GAAuB,KAAvB;;AACA,cAAI,0BAA0B6J,IAA1B,CAA+BrO,OAAO,CAAC0sB,IAAvC,CAAJ,EAAkD;AAC9C9sB,YAAAA,OAAO,CAACO,OAAR,CAAgBwsB,MAAhB,CAAuB3lB,KAAvB,CAA6BqE,OAA7B,GAAuC,EAAvC;AACA,iBAAKpH,SAAL,GAAiB,KAAjB;AACA,iBAAKC,UAAL,GAAkB,IAAlB;;AACAmI,YAAAA,KAAK,CAACugB,YAAN;AACH;AACJ;;AAED,aAAKld,WAAL;AACAhP,QAAAA,IAAI,CAAC4K,WAAL,CAAiB,KAAKtF,gBAAL,CAAsB6mB,QAAvC,EAAiD,QAAjD,EAxBY,CA0BZ;;AACA,YAAI,CAACnsB,IAAI,CAACgiB,aAAL,CAAmB9iB,OAAO,CAACO,OAAR,CAAgB4G,YAAnC,CAAL,EAAuD;AACnD,eAAKjF,OAAL,CAAa4H,IAAb,CAAkB,KAAlB;;AACA,eAAK5H,OAAL,CAAagrB,mBAAb;AACH;AACJ,OA/BD,MA+BO;AACH,aAAKC,wBAAL;;AACA,aAAK1mB,SAAL,CAAeuB,kBAAf,GAAoC,KAAKvB,SAAL,CAAeuB,kBAAf,CAAkC4b,OAAlC,CAA0C,yCAA1C,EAAqF,gBAArF,CAApC;AACA,aAAKnd,SAAL,CAAesB,qBAAf,GAAuC,KAAKtB,SAAL,CAAesB,qBAAf,CAAqC6b,OAArC,CAA6C,yCAA7C,EAAwF,eAAxF,CAAvC;AAEA,YAAI,KAAKnd,SAAL,CAAeG,YAAnB,EAAiC5G,OAAO,CAACO,OAAR,CAAgBqsB,IAAhB,CAAqBxlB,KAArB,CAA2BgF,MAA3B,GAAoC,MAApC,CAAjC,KACK,IAAIhM,OAAO,CAACgM,MAAR,KAAmB,MAAnB,IAA6B,CAAChM,OAAO,CAACysB,gBAA1C,EAA4D7sB,OAAO,CAACO,OAAR,CAAgBqsB,IAAhB,CAAqBxlB,KAArB,CAA2BgF,MAA3B,GAAoCpM,OAAO,CAACO,OAAR,CAAgBqsB,IAAhB,CAAqBQ,YAArB,GAAoC,CAApC,GAAyCptB,OAAO,CAACO,OAAR,CAAgBqsB,IAAhB,CAAqBQ,YAArB,GAAoC,IAA7E,GAAqF,MAAzH;AAEjE,YAAIhtB,OAAO,CAACysB,gBAAZ,EAA8BzsB,OAAO,CAACysB,gBAAR,CAAyBQ,OAAzB;AAE9B,aAAK5mB,SAAL,CAAeE,UAAf,GAA4B,IAA5B;;AAEA,YAAI,CAAC,KAAKF,SAAL,CAAeG,YAApB,EAAkC;AAC9B,eAAKhC,eAAL,GAAuB,IAAvB;;AACA,cAAI,KAAKN,UAAT,EAAqB;AACjBtE,YAAAA,OAAO,CAACO,OAAR,CAAgBwsB,MAAhB,CAAuB3lB,KAAvB,CAA6BqE,OAA7B,GAAuC,MAAvC;AACAzL,YAAAA,OAAO,CAACO,OAAR,CAAgBsL,OAAhB,CAAwBzE,KAAxB,CAA8BuD,IAA9B,GAAqC,EAArC;AACA,iBAAKtG,SAAL,GAAiB,IAAjB;AACA,iBAAKC,UAAL,GAAkB,KAAlB;;AACAmI,YAAAA,KAAK,CAACke,kBAAN;AACH;AACJ;;AAED,aAAKlkB,SAAL,CAAee,MAAf,GAAwB,IAAxB;AACAxH,QAAAA,OAAO,CAACO,OAAR,CAAgBqsB,IAAhB,CAAqBxc,KAArB;AACAtP,QAAAA,IAAI,CAACuL,QAAL,CAAc,KAAKjG,gBAAL,CAAsB6mB,QAApC,EAA8C,QAA9C;AACH;;AAED,WAAKK,iBAAL;;AACA,UAAI,KAAKxpB,UAAT,EAAqBhD,IAAI,CAAC4rB,kBAAL,CAAwB,IAAxB,EAA8B,KAAKvpB,uBAAnC,EAjEG,CAmExB;;AACA,UAAI,OAAOpB,SAAS,CAACkpB,cAAjB,KAAoC,UAAxC,EAAoDlpB,SAAS,CAACkpB,cAAV,CAAyB,KAAKxkB,SAAL,CAAeE,UAAxC,EAAoD,IAApD;AACvD,KA39IQ;;AA69IT;AACR;AACA;AACA;AACQgmB,IAAAA,oBAAoB,EAAE,gCAAY;AAC9B,UAAMY,SAAS,GAAG,KAAKC,YAAL,EAAlB;;AAEA,UAAIptB,OAAO,CAACqtB,QAAZ,EAAsB;AAClB,YAAMC,aAAa,GAAG,KAAKzsB,OAAL,CAAa0sB,eAAb,CAA6BJ,SAA7B,EAAwC,WAAxC,CAAtB;;AACA,YAAMK,YAAY,GAAGF,aAAa,CAACG,IAAd,CAAmB/c,QAAxC;;AAEA,aAAK,IAAIlI,CAAC,GAAG,CAAR,EAAWqB,GAAG,GAAG2jB,YAAY,CAAC9kB,MAAnC,EAA2CF,CAAC,GAAGqB,GAA/C,EAAoDrB,CAAC,EAArD,EAAyD;AACrD,cAAI,YAAY6F,IAAZ,CAAiBmf,YAAY,CAAChlB,CAAD,CAAZ,CAAgBklB,OAAjC,CAAJ,EAA+C;AAC3CJ,YAAAA,aAAa,CAACG,IAAd,CAAmBhS,WAAnB,CAA+B+R,YAAY,CAAChlB,CAAD,CAA3C;AACAA,YAAAA,CAAC,IAAIqB,GAAG,EAAR;AACH;AACJ;;AAED,YAAI8jB,OAAO,GAAGL,aAAa,CAACG,IAAd,CAAmBlZ,SAAjC;;AACA,YAAI,CAAC+Y,aAAa,CAACG,IAAd,CAAmB/hB,aAAnB,CAAiC,wBAAjC,CAAD,IAAgE,KAAK1L,OAAL,CAAagM,MAAb,KAAwB,MAAxB,IAAkC,CAACshB,aAAa,CAACG,IAAd,CAAmB/hB,aAAnB,CAAiC,OAAjC,CAAvG,EAAmJ;AAC/IiiB,UAAAA,OAAO,IAAIjtB,IAAI,CAACktB,iBAAL,CAAuB,KAAK5tB,OAA5B,CAAX;AACH;;AAED,aAAKuB,GAAL,CAASksB,IAAT,CAAclZ,SAAd,GAA0BoZ,OAA1B;AACA,aAAKpsB,GAAL,CAASssB,IAAT,CAActZ,SAAd,GAA0B,KAAKuZ,wBAAL,CAA8BR,aAAa,CAACO,IAAd,CAAmBtZ,SAAjD,CAA1B;AAEA,YAAMwZ,KAAK,GAAGT,aAAa,CAACO,IAAd,CAAmBG,UAAjC;;AACA,aAAK,IAAIxlB,IAAC,GAAG,CAAR,EAAWqB,KAAG,GAAGkkB,KAAK,CAACrlB,MAA5B,EAAoCF,IAAC,GAAGqB,KAAxC,EAA6CrB,IAAC,EAA9C,EAAkD;AAC9C,cAAIulB,KAAK,CAACvlB,IAAD,CAAL,CAASuB,IAAT,KAAkB,iBAAtB,EAAyC;;AACzC,eAAKxI,GAAL,CAASssB,IAAT,CAAcnC,YAAd,CAA2BqC,KAAK,CAACvlB,IAAD,CAAL,CAASuB,IAApC,EAA0CgkB,KAAK,CAACvlB,IAAD,CAAL,CAASiH,KAAnD;AACH;;AACD,YAAI,CAAC/O,IAAI,CAACkN,QAAL,CAAc,KAAKrM,GAAL,CAASssB,IAAvB,EAA6B,qBAA7B,CAAL,EAA0D;AACtD,cAAMI,eAAe,GAAGjuB,OAAO,CAACkuB,cAAR,CAAuBC,KAAvB,CAA6B,GAA7B,CAAxB;;AACA,eAAK,IAAI3lB,IAAC,GAAG,CAAb,EAAgBA,IAAC,GAAGylB,eAAe,CAACvlB,MAApC,EAA4CF,IAAC,EAA7C,EAAiD;AAC7C9H,YAAAA,IAAI,CAACuL,QAAL,CAAc,KAAK1K,GAAL,CAASssB,IAAvB,EAA6B7tB,OAAO,CAACkuB,cAAR,CAAuB1lB,IAAvB,CAA7B;AACH;AACJ;AACJ,OA9BD,MA8BO;AACH5I,QAAAA,OAAO,CAACO,OAAR,CAAgB8P,OAAhB,CAAwBsE,SAAxB,GAAoC4Y,SAAS,CAACzkB,MAAV,GAAmB,CAAnB,GAAuB,KAAKolB,wBAAL,CAA8BX,SAA9B,CAAvB,GAAkE,MAAMntB,OAAO,CAAC+Q,UAAd,GAA2B,SAA3B,GAAuC/Q,OAAO,CAAC+Q,UAA/C,GAA4D,GAAlK;AACH;AACJ,KArgJQ;;AAugJT;AACR;AACA;AACA;AACQgc,IAAAA,wBAAwB,EAAE,oCAAY;AAClC,UAAMqB,YAAY,GAAG,KAAKC,sBAAL,CAA4BzuB,OAAO,CAACO,OAAR,CAAgB8P,OAA5C,EAAqD,KAArD,CAArB;AACA,UAAIqe,SAAS,GAAG,EAAhB;;AAEA,UAAItuB,OAAO,CAACqtB,QAAZ,EAAsB;AAClB,YAAMU,KAAK,GAAGrtB,IAAI,CAAC6tB,qBAAL,CAA2B,KAAKhtB,GAAL,CAASssB,IAApC,EAA0C,IAA1C,CAAd;AACAS,QAAAA,SAAS,GAAG,8BAA8B,KAAK/sB,GAAL,CAASksB,IAAT,CAAce,SAAd,CAAwBhL,OAAxB,CAAgC,UAAhC,EAA4C,KAA5C,CAA9B,GAAmF,QAAnF,GAA8FuK,KAA9F,GAAsG,KAAtG,GAA8GK,YAA9G,GAA6H,kBAAzI;AACH,OAHD,MAGO;AACHE,QAAAA,SAAS,GAAGF,YAAZ;AACH;;AAEDxuB,MAAAA,OAAO,CAACO,OAAR,CAAgBqsB,IAAhB,CAAqBxlB,KAArB,CAA2BqE,OAA3B,GAAqC,OAArC;AACAzL,MAAAA,OAAO,CAACO,OAAR,CAAgB4G,YAAhB,CAA6BC,KAA7B,CAAmCqE,OAAnC,GAA6C,MAA7C;;AAEA,WAAKojB,YAAL,CAAkBH,SAAlB;AACH,KA1hJQ;;AA4hJT;AACR;AACA;AACA;AACQxD,IAAAA,gBAAgB,EAAE,0BAAU3qB,OAAV,EAAmB;AACjC,UAAMoH,OAAO,GAAG3H,OAAO,CAACO,OAAR,CAAgBoH,OAAhC;AACA,UAAMkE,OAAO,GAAG7L,OAAO,CAACO,OAAR,CAAgBsL,OAAhC;AACA,UAAMijB,UAAU,GAAG9uB,OAAO,CAACO,OAAR,CAAgBuuB,UAAnC;AACA,UAAM3nB,YAAY,GAAGnH,OAAO,CAACO,OAAR,CAAgB4G,YAArC;AACA,UAAMylB,IAAI,GAAG5sB,OAAO,CAACO,OAAR,CAAgBqsB,IAA7B;AACA,UAAMmC,IAAI,GAAG,KAAKtoB,SAAlB;AACA,WAAKuE,cAAL;AAEA,UAAMgkB,gBAAgB,GAAInjB,OAAO,CAACzE,KAAR,CAAcqE,OAAd,KAA0B,MAA1B,IAAqC,KAAKpH,SAAL,IAAkB,CAAC,KAAKG,kBAAL,CAAwBG,MAA1G;;AAEA,UAAI,CAACoqB,IAAI,CAACnoB,YAAV,EAAwB;AACpBmoB,QAAAA,IAAI,CAACnoB,YAAL,GAAoB,IAApB;AAEAmoB,QAAAA,IAAI,CAAC9mB,gBAAL,CAAsBG,MAAtB,GAA+B,KAAK/D,SAApC;AACA0qB,QAAAA,IAAI,CAAC9mB,gBAAL,CAAsBE,OAAtB,GAAgC,KAAK7D,UAArC;;AAEA,YAAI,KAAKD,SAAL,IAAkB,KAAKC,UAA3B,EAAuC;AACnC,eAAKD,SAAL,GAAiB,KAAjB;AACA,eAAKC,UAAL,GAAkB,KAAlB;AACH;;AAED,YAAI,CAAC,CAAClE,OAAO,CAAC6uB,gBAAd,EAAgCjvB,OAAO,CAACO,OAAR,CAAgB2uB,QAAhB,CAAyB7d,YAAzB,CAAsCxF,OAAtC,EAA+CijB,UAA/C;AAEhCnnB,QAAAA,OAAO,CAACP,KAAR,CAAc6H,QAAd,GAAyB,OAAzB;AACAtH,QAAAA,OAAO,CAACP,KAAR,CAAc3C,GAAd,GAAoB,GAApB;AACAkD,QAAAA,OAAO,CAACP,KAAR,CAAcuD,IAAd,GAAqB,GAArB;AACAhD,QAAAA,OAAO,CAACP,KAAR,CAAc1C,KAAd,GAAsB,MAAtB;AACAiD,QAAAA,OAAO,CAACP,KAAR,CAAc+nB,QAAd,GAAyB,MAAzB;AACAxnB,QAAAA,OAAO,CAACP,KAAR,CAAcgF,MAAd,GAAuB,MAAvB;AACAzE,QAAAA,OAAO,CAACP,KAAR,CAAcgoB,MAAd,GAAuB,YAAvB;;AAEA,YAAIpvB,OAAO,CAACO,OAAR,CAAgB8uB,YAAhB,CAA6BjoB,KAA7B,CAAmCqE,OAAnC,MAAgD,UAAU,EAA1D,CAAJ,EAAmE;AAC/DsjB,UAAAA,IAAI,CAAC9mB,gBAAL,CAAsBC,MAAtB,GAA+B,IAA/B;AACAlI,UAAAA,OAAO,CAACO,OAAR,CAAgB8uB,YAAhB,CAA6BjoB,KAA7B,CAAmCqE,OAAnC,GAA6C,MAA7C;AACA3K,UAAAA,IAAI,CAAC4K,WAAL,CAAiBG,OAAjB,EAA0B,mBAA1B;AACH;;AAEDkjB,QAAAA,IAAI,CAAClnB,aAAL,GAAqBvH,EAAE,CAAC2tB,IAAH,CAAQ7mB,KAAR,CAAckoB,QAAnC;AACAhvB,QAAAA,EAAE,CAAC2tB,IAAH,CAAQ7mB,KAAR,CAAckoB,QAAd,GAAyB,QAAzB;AAEAP,QAAAA,IAAI,CAACjnB,wBAAL,GAAgCgnB,UAAU,CAAC1nB,KAAX,CAAiBQ,OAAjD;AACAmnB,QAAAA,IAAI,CAAChnB,qBAAL,GAA6BZ,YAAY,CAACC,KAAb,CAAmBQ,OAAhD;AACAmnB,QAAAA,IAAI,CAAC/mB,kBAAL,GAA0B4kB,IAAI,CAACxlB,KAAL,CAAWQ,OAArC;AAEAknB,QAAAA,UAAU,CAAC1nB,KAAX,CAAiBQ,OAAjB,GAA2BiE,OAAO,CAACzE,KAAR,CAAcQ,OAAd,GAAwB,EAAnD;AACAT,QAAAA,YAAY,CAACC,KAAb,CAAmBQ,OAAnB,GAA6B,CAACT,YAAY,CAACC,KAAb,CAAmBQ,OAAnB,CAA2Bmc,KAA3B,CAAiC,mCAAjC,KAAyE,CAAC,EAAD,CAA1E,EAAgF,CAAhF,CAA7B;AACA6I,QAAAA,IAAI,CAACxlB,KAAL,CAAWQ,OAAX,GAAqB,CAACglB,IAAI,CAACxlB,KAAL,CAAWQ,OAAX,CAAmBmc,KAAnB,CAAyB,mCAAzB,KAAiE,CAAC,EAAD,CAAlE,EAAwE,CAAxE,CAArB;AACAlY,QAAAA,OAAO,CAACzE,KAAR,CAAc1C,KAAd,GAAsByC,YAAY,CAACC,KAAb,CAAmBgF,MAAnB,GAA4BwgB,IAAI,CAACxlB,KAAL,CAAWgF,MAAX,GAAoB,MAAtE;AACAP,QAAAA,OAAO,CAACzE,KAAR,CAAc6H,QAAd,GAAyB,UAAzB;AACApD,QAAAA,OAAO,CAACzE,KAAR,CAAcqE,OAAd,GAAwB,OAAxB;AAEAsjB,QAAAA,IAAI,CAACloB,sBAAL,GAA+BlG,EAAE,CAAC8M,WAAH,GAAiB5B,OAAO,CAACwB,YAAxD;AACAyhB,QAAAA,UAAU,CAAC1nB,KAAX,CAAiBgF,MAAjB,GAA2B2iB,IAAI,CAACloB,sBAAL,GAA8BzG,OAAO,CAACmvB,gBAAvC,GAA2D,IAArF;AAEA,YAAIhvB,OAAJ,EAAaO,IAAI,CAAC0uB,aAAL,CAAmBjvB,OAAO,CAACkP,iBAA3B,EAA8C1O,KAAK,CAAC0uB,SAApD;;AAEb,YAAIrvB,OAAO,CAACkQ,MAAR,IAAkBlQ,OAAO,CAACgM,MAAR,KAAmB,MAAzC,EAAiD;AAC7C0iB,UAAAA,UAAU,CAAC1nB,KAAX,CAAiBkoB,QAAjB,GAA4B,MAA5B;;AACA,eAAKI,iBAAL;AACH;;AAED1vB,QAAAA,OAAO,CAACO,OAAR,CAAgBoH,OAAhB,CAAwBP,KAAxB,CAA8BuoB,SAA9B,GAA0CvvB,OAAO,CAACmvB,gBAAR,GAA2B,IAArE;AACAzuB,QAAAA,IAAI,CAACuL,QAAL,CAAc,KAAKjG,gBAAL,CAAsBwpB,UAApC,EAAgD,QAAhD;AACH,OArDD,MAqDO;AACHb,QAAAA,IAAI,CAACnoB,YAAL,GAAoB,KAApB;AAEAO,QAAAA,YAAY,CAACC,KAAb,CAAmBQ,OAAnB,GAA6BmnB,IAAI,CAAChnB,qBAAlC;AACA6kB,QAAAA,IAAI,CAACxlB,KAAL,CAAWQ,OAAX,GAAqBmnB,IAAI,CAAC/mB,kBAA1B;AACA6D,QAAAA,OAAO,CAACzE,KAAR,CAAcQ,OAAd,GAAwB,EAAxB;AACAknB,QAAAA,UAAU,CAAC1nB,KAAX,CAAiBQ,OAAjB,GAA2BmnB,IAAI,CAACjnB,wBAAhC;AACAH,QAAAA,OAAO,CAACP,KAAR,CAAcQ,OAAd,GAAwBmnB,IAAI,CAACrnB,cAA7B;AACApH,QAAAA,EAAE,CAAC2tB,IAAH,CAAQ7mB,KAAR,CAAckoB,QAAd,GAAyBP,IAAI,CAAClnB,aAA9B;AAEA,YAAIzH,OAAO,CAACgM,MAAR,KAAmB,MAAnB,IAA6B,CAAChM,OAAO,CAACysB,gBAA1C,EAA4DpgB,KAAK,CAACojB,mBAAN;AAE5D,YAAI,CAAC,CAACzvB,OAAO,CAAC6uB,gBAAd,EAAgC7uB,OAAO,CAAC6uB,gBAAR,CAAyBnkB,WAAzB,CAAqCe,OAArC;;AAEhC,YAAIzL,OAAO,CAAC0vB,aAAR,GAAwB,CAAC,CAA7B,EAAgC;AAC5BhvB,UAAAA,IAAI,CAAC4K,WAAL,CAAiBG,OAAjB,EAA0B,mBAA1B;AACH;;AAED,YAAIkjB,IAAI,CAAC9mB,gBAAL,CAAsBC,MAAtB,IAAgC,CAAC9H,OAAO,CAAC6uB,gBAA7C,EAA+D;AAC3DF,UAAAA,IAAI,CAAC9mB,gBAAL,CAAsBC,MAAtB,GAA+B,KAA/B;AACAlI,UAAAA,OAAO,CAACO,OAAR,CAAgB8uB,YAAhB,CAA6BjoB,KAA7B,CAAmCqE,OAAnC,GAA6C,OAA7C;AACA3K,UAAAA,IAAI,CAACuL,QAAL,CAAcR,OAAd,EAAuB,mBAAvB;AACH;;AAED,aAAKxH,SAAL,GAAiB0qB,IAAI,CAAC9mB,gBAAL,CAAsBG,MAAvC;AACA,aAAK9D,UAAL,GAAkByqB,IAAI,CAAC9mB,gBAAL,CAAsBE,OAAxC;AACA,YAAI,KAAK9D,SAAT,EAAoBoI,KAAK,CAACke,kBAAN;AACpB,YAAI,CAAC,CAACvqB,OAAO,CAAC6uB,gBAAd,EAAgCnuB,IAAI,CAAC4K,WAAL,CAAiBG,OAAjB,EAA0B,oBAA1B;AAEhCY,QAAAA,KAAK,CAACsjB,eAAN;AACA,YAAIxvB,OAAJ,EAAaO,IAAI,CAAC0uB,aAAL,CAAmBjvB,OAAO,CAACkP,iBAA3B,EAA8C1O,KAAK,CAACivB,SAApD;AAEbhwB,QAAAA,OAAO,CAACO,OAAR,CAAgBoH,OAAhB,CAAwBP,KAAxB,CAA8BuoB,SAA9B,GAA0C,EAA1C;AACA7uB,QAAAA,IAAI,CAAC4K,WAAL,CAAiB,KAAKtF,gBAAL,CAAsBwpB,UAAvC,EAAmD,QAAnD;AACH;;AAED,UAAIZ,gBAAJ,EAAsBjtB,SAAS,CAAC8J,OAAV,CAAkBokB,IAAlB,GApGW,CAsGjC;;AACA,UAAI,OAAOluB,SAAS,CAACmpB,gBAAjB,KAAsC,UAA1C,EAAsDnpB,SAAS,CAACmpB,gBAAV,CAA2B,KAAKzkB,SAAL,CAAeG,YAA1C,EAAwD,IAAxD;AACzD,KAxoJQ;;AA0oJT;AACR;AACA;AACQ2kB,IAAAA,KAAK,EAAE,iBAAY;AACf,UAAMjb,MAAM,GAAGxP,IAAI,CAACoQ,aAAL,CAAmB,QAAnB,CAAf;AACAZ,MAAAA,MAAM,CAAClJ,KAAP,CAAaqE,OAAb,GAAuB,MAAvB;;AACAnL,MAAAA,EAAE,CAAC2tB,IAAH,CAAQnjB,WAAR,CAAoBwF,MAApB;;AAEA,UAAM4f,YAAY,GAAG9vB,OAAO,CAAC+vB,aAAR,GAAwB/vB,OAAO,CAAC+vB,aAAR,CAAsBvM,OAAtB,CAA8B,yBAA9B,EAAyD,KAAKgI,WAAL,CAAiB,IAAjB,CAAzD,CAAxB,GAA2G,KAAKA,WAAL,CAAiB,IAAjB,CAAhI;AACA,UAAMwE,aAAa,GAAGtvB,IAAI,CAACuvB,iBAAL,CAAuB/f,MAAvB,CAAtB;AACA,UAAMggB,IAAI,GAAG,KAAK3uB,GAAlB;;AAEA,UAAIvB,OAAO,CAACkQ,MAAZ,EAAoB;AAChB,YAAMigB,KAAK,GAAGnwB,OAAO,CAACowB,WAAR,KAAwB,IAAxB,GAA+B,YAAYpwB,OAAO,CAACowB,WAApB,GAAkC,GAAjE,GAAuEpwB,OAAO,CAACqtB,QAAR,GAAmB3sB,IAAI,CAAC6tB,qBAAL,CAA2B2B,IAAI,CAACrC,IAAhC,EAAsC,CAAC,iBAAD,CAAtC,CAAnB,GAAgF,YAAY7tB,OAAO,CAACkuB,cAApB,GAAqC,GAA1M;AAEA8B,QAAAA,aAAa,CAACK,KAAd,CAAoB,KAChB,uBADgB,GAEhB,QAFgB,GAGhBH,IAAI,CAACzC,IAAL,CAAUlZ,SAHM,GAIhB,SAJgB,GAKhB,QALgB,GAKL4b,KALK,GAKG,GALH,GAKSL,YALT,GAKwB,SALxB,GAMhB,SANJ;AAQH,OAXD,MAWO;AACH,YAAMQ,KAAK,GAAGpwB,EAAE,CAACutB,IAAH,CAAQ8C,oBAAR,CAA6B,MAA7B,CAAd;;AACA,YAAMC,MAAM,GAAGtwB,EAAE,CAACutB,IAAH,CAAQ8C,oBAAR,CAA6B,OAA7B,CAAf;;AACA,YAAIE,QAAQ,GAAG,EAAf;;AACA,aAAK,IAAIjoB,CAAC,GAAG,CAAR,EAAWqB,GAAG,GAAGymB,KAAK,CAAC5nB,MAA5B,EAAoCF,CAAC,GAAGqB,GAAxC,EAA6CrB,CAAC,EAA9C,EAAkD;AAC9CioB,UAAAA,QAAQ,IAAIH,KAAK,CAAC9nB,CAAD,CAAL,CAASgmB,SAArB;AACH;;AACD,aAAK,IAAIhmB,IAAC,GAAG,CAAR,EAAWqB,MAAG,GAAG2mB,MAAM,CAAC9nB,MAA7B,EAAqCF,IAAC,GAAGqB,MAAzC,EAA8CrB,IAAC,EAA/C,EAAmD;AAC/CioB,UAAAA,QAAQ,IAAID,MAAM,CAAChoB,IAAD,CAAN,CAAUgmB,SAAtB;AACH;;AAEDwB,QAAAA,aAAa,CAACK,KAAd,CAAoB,KAChB,uBADgB,GAEhB,QAFgB,GAGhBI,QAHgB,GAIhB,SAJgB,GAKhB,eALgB,IAKGzwB,OAAO,CAACowB,WAAR,KAAwB,IAAxB,GAA+BpwB,OAAO,CAACowB,WAAvC,GAAqDpwB,OAAO,CAACkuB,cALhE,IAKkF,IALlF,GAKyF4B,YALzF,GAKwG,SALxG,GAMhB,SANJ;AAQH;;AAED,WAAK5X,WAAL;;AACA3X,MAAAA,EAAE,CAACuZ,UAAH,CAAc,YAAY;AACtB,YAAI;AACA5J,UAAAA,MAAM,CAACF,KAAP,GADA,CAEA;;AACA,cAAItP,IAAI,CAACgwB,SAAL,IAAkBhwB,IAAI,CAACiwB,UAAvB,IAAqC,CAAC,CAACzwB,EAAE,CAAC0wB,YAA1C,IAA0D,CAAC,CAACrwB,EAAE,CAACswB,UAAnE,EAA+E;AAC3E,gBAAI;AACA3gB,cAAAA,MAAM,CAAC4gB,aAAP,CAAqBxwB,QAArB,CAA8BiP,WAA9B,CAA0C,OAA1C,EAAmD,KAAnD,EAA0D,IAA1D;AACH,aAFD,CAEE,OAAOvB,CAAP,EAAU;AACRkC,cAAAA,MAAM,CAAC4gB,aAAP,CAAqB3F,KAArB;AACH;AACJ,WAND,MAMO;AACH;AACAjb,YAAAA,MAAM,CAAC4gB,aAAP,CAAqB3F,KAArB;AACH;AACJ,SAbD,CAaE,OAAO3Y,KAAP,EAAc;AACZ,gBAAMlJ,KAAK,CAAC,wCAAwCkJ,KAAzC,CAAX;AACH,SAfD,SAeU;AACN5R,UAAAA,IAAI,CAACwX,YAAL;AACA1X,UAAAA,IAAI,CAACsV,UAAL,CAAgB9F,MAAhB;AACH;AACJ,OApBD,EAoBG,IApBH;AAqBH,KA5sJQ;;AA8sJT;AACR;AACA;AACQkb,IAAAA,OAAO,EAAE,mBAAY;AACjBxqB,MAAAA,IAAI,CAACmK,UAAL;AACAnK,MAAAA,IAAI,CAACkL,YAAL;AACAlL,MAAAA,IAAI,CAACgK,cAAL;AAEA,UAAMklB,YAAY,GAAG9vB,OAAO,CAAC+wB,eAAR,GAA0B/wB,OAAO,CAAC+wB,eAAR,CAAwBvN,OAAxB,CAAgC,yBAAhC,EAA2D,KAAKgI,WAAL,CAAiB,IAAjB,CAA3D,CAA1B,GAA+G,KAAKA,WAAL,CAAiB,IAAjB,CAApI;;AACA,UAAMwF,YAAY,GAAGzwB,EAAE,CAACkqB,IAAH,CAAQ,EAAR,EAAY,QAAZ,CAArB;;AACAuG,MAAAA,YAAY,CAACC,QAAb,GAAwB,WAAxB;AACA,UAAMf,IAAI,GAAG,KAAK3uB,GAAlB;;AAEA,UAAIvB,OAAO,CAACkQ,MAAZ,EAAoB;AAChB,YAAMigB,KAAK,GAAGnwB,OAAO,CAACowB,WAAR,KAAwB,IAAxB,GAA+B,YAAYpwB,OAAO,CAACowB,WAApB,GAAkC,GAAjE,GAAuEpwB,OAAO,CAACqtB,QAAR,GAAmB3sB,IAAI,CAAC6tB,qBAAL,CAA2B2B,IAAI,CAACrC,IAAhC,EAAsC,CAAC,iBAAD,CAAtC,CAAnB,GAAgF,YAAY7tB,OAAO,CAACkuB,cAApB,GAAqC,GAA1M;AAEA8C,QAAAA,YAAY,CAAC1wB,QAAb,CAAsB+vB,KAAtB,CAA4B,KACxB,uBADwB,GAExB,QAFwB,GAGxBH,IAAI,CAACzC,IAAL,CAAUlZ,SAHc,GAIxB,gIAJwB,GAKxB,SALwB,GAMxB,QANwB,GAMb4b,KANa,GAML,GANK,GAMCL,YAND,GAMgB,SANhB,GAOxB,SAPJ;AASH,OAZD,MAYO;AACH,YAAMQ,KAAK,GAAGpwB,EAAE,CAACutB,IAAH,CAAQ8C,oBAAR,CAA6B,MAA7B,CAAd;;AACA,YAAMC,MAAM,GAAGtwB,EAAE,CAACutB,IAAH,CAAQ8C,oBAAR,CAA6B,OAA7B,CAAf;;AACA,YAAIE,QAAQ,GAAG,EAAf;;AACA,aAAK,IAAIjoB,CAAC,GAAG,CAAR,EAAWqB,GAAG,GAAGymB,KAAK,CAAC5nB,MAA5B,EAAoCF,CAAC,GAAGqB,GAAxC,EAA6CrB,CAAC,EAA9C,EAAkD;AAC9CioB,UAAAA,QAAQ,IAAIH,KAAK,CAAC9nB,CAAD,CAAL,CAASgmB,SAArB;AACH;;AACD,aAAK,IAAIhmB,IAAC,GAAG,CAAR,EAAWqB,MAAG,GAAG2mB,MAAM,CAAC9nB,MAA7B,EAAqCF,IAAC,GAAGqB,MAAzC,EAA8CrB,IAAC,EAA/C,EAAmD;AAC/CioB,UAAAA,QAAQ,IAAID,MAAM,CAAChoB,IAAD,CAAN,CAAUgmB,SAAtB;AACH;;AAEDwC,QAAAA,YAAY,CAAC1wB,QAAb,CAAsB+vB,KAAtB,CAA4B,KACxB,uBADwB,GAExB,QAFwB,GAGxB,0BAHwB,GAIxB,sEAJwB,GAKxB,SALwB,GAKZtwB,IAAI,CAAC0L,OAAL,CAAa2f,OALD,GAKW,UALX,GAMxBqF,QANwB,GAOxB,SAPwB,GAQxB,eARwB,IAQLzwB,OAAO,CAACowB,WAAR,KAAwB,IAAxB,GAA+BpwB,OAAO,CAACowB,WAAvC,GAAqDpwB,OAAO,CAACkuB,cARxD,IAQ0E,0FAR1E,GAQuK4B,YARvK,GAQsL,SARtL,GASxB,SATJ;AAWH;AACJ,KA9vJQ;;AAgwJT;AACR;AACA;AACA;AACQxE,IAAAA,MAAM,EAAE,gBAAUzT,GAAV,EAAe;AACnB,UAAM7W,GAAG,GAAG6W,GAAG,KAAK,KAApB;AACA,UAAMqZ,SAAS,GAAG,KAAKnwB,QAAL,KAAkBC,GAApC;AACA,WAAKD,QAAL,GAAgBf,OAAO,CAACgB,GAAR,GAAcA,GAA9B;;AAEA,UAAIkwB,SAAJ,EAAe;AACX;AACA,YAAI,KAAKpxB,OAAL,CAAaqxB,KAAjB,EAAwB;AACpB,eAAKrxB,OAAL,CAAaqxB,KAAb,CAAmBC,WAAnB,CAA+BjmB,IAA/B,CAAoC,IAApC;AACH,SAJU,CAKX;;;AACA,YAAIvL,OAAO,CAACqJ,IAAR,CAAa8hB,MAAjB,EAAyBrqB,IAAI,CAAC0uB,aAAL,CAAmBxvB,OAAO,CAACqJ,IAAR,CAAa8hB,MAAb,CAAoB1b,iBAAvC,EAA0D1O,KAAK,CAACoqB,MAAhE;AACzB,YAAInrB,OAAO,CAACqJ,IAAR,CAAaooB,OAAjB,EAA0B3wB,IAAI,CAAC0uB,aAAL,CAAmBxvB,OAAO,CAACqJ,IAAR,CAAaooB,OAAb,CAAqBhiB,iBAAxC,EAA2D1O,KAAK,CAAC0wB,OAAjE;AAC7B;;AAED,UAAMlnB,EAAE,GAAGvK,OAAO,CAACO,OAAnB;;AACA,UAAIa,GAAJ,EAAS;AACLN,QAAAA,IAAI,CAACuL,QAAL,CAAc9B,EAAE,CAAC5C,OAAjB,EAA0B,QAA1B;AACA7G,QAAAA,IAAI,CAACuL,QAAL,CAAc9B,EAAE,CAACpD,YAAjB,EAA+B,QAA/B;AACH,OAHD,MAGO;AACHrG,QAAAA,IAAI,CAAC4K,WAAL,CAAiBnB,EAAE,CAAC5C,OAApB,EAA6B,QAA7B;AACA7G,QAAAA,IAAI,CAAC4K,WAAL,CAAiBnB,EAAE,CAACpD,YAApB,EAAkC,QAAlC;AACH;;AAED,UAAMsP,SAAS,GAAG3V,IAAI,CAAC4V,eAAL,CAAqBnM,EAAE,CAAC8F,OAAxB,EAAiC,UAAU2B,OAAV,EAAmB;AAClE,eAAOlR,IAAI,CAACkQ,eAAL,CAAqBgB,OAArB,MAAkCA,OAAO,CAAC5K,KAAR,CAAcsqB,WAAd,IAA6B1f,OAAO,CAAC5K,KAAR,CAAcuqB,UAA3C,IAAyD3f,OAAO,CAAC5K,KAAR,CAAcwqB,SAAzG,CAAP;AACH,OAFiB,CAAlB;;AAIA,WAAK,IAAIhpB,CAAC,GAAG,CAAR,EAAWqB,GAAG,GAAGwM,SAAS,CAAC3N,MAA3B,EAAmCuc,CAAnC,EAAsC/a,CAAtC,EAAyC8O,CAA9C,EAAiDxQ,CAAC,GAAGqB,GAArD,EAA0DrB,CAAC,EAA3D,EAA+D;AAC3Dyc,QAAAA,CAAC,GAAG5O,SAAS,CAAC7N,CAAD,CAAb,CAD2D,CAE3D;;AACAwQ,QAAAA,CAAC,GAAGiM,CAAC,CAACje,KAAF,CAAQsqB,WAAZ;AACApnB,QAAAA,CAAC,GAAG+a,CAAC,CAACje,KAAF,CAAQuqB,UAAZ;;AACA,YAAIvY,CAAC,IAAI9O,CAAT,EAAY;AACR+a,UAAAA,CAAC,CAACje,KAAF,CAAQsqB,WAAR,GAAsBpnB,CAAtB;AACA+a,UAAAA,CAAC,CAACje,KAAF,CAAQuqB,UAAR,GAAqBvY,CAArB;AACH,SAR0D,CAS3D;;;AACAA,QAAAA,CAAC,GAAGiM,CAAC,CAACje,KAAF,CAAQwqB,SAAZ;AACA,YAAIxY,CAAC,KAAK,MAAV,EAAkBiM,CAAC,CAACje,KAAF,CAAQwqB,SAAR,GAAoB,OAApB,CAAlB,KACK,IAAIxY,CAAC,KAAK,OAAV,EAAmBiM,CAAC,CAACje,KAAF,CAAQwqB,SAAR,GAAoB,MAApB;AAC3B;;AAED,UAAMvoB,IAAI,GAAGrJ,OAAO,CAACqJ,IAArB;;AACA,UAAIA,IAAI,CAAC4O,GAAT,EAAc;AACVnX,QAAAA,IAAI,CAAC+wB,SAAL,CAAexoB,IAAI,CAAC4O,GAAL,CAASnM,aAAT,CAAuB,kBAAvB,CAAf,EAA2D3L,IAAI,CAAC0L,OAAL,CAAazL,OAAO,CAACgB,GAAR,GAAc,SAAd,GAA0B,SAAvC,CAA3D;AACAN,QAAAA,IAAI,CAAC0uB,aAAL,CAAmBnmB,IAAI,CAAC4O,GAAL,CAASxI,iBAA5B,EAA+C1O,KAAK,CAACX,OAAO,CAACgB,GAAR,GAAc,SAAd,GAA0B,SAA3B,CAApD;AACH;;AAED,UAAIiI,IAAI,CAACyoB,OAAT,EAAkB;AACd,YAAI1wB,GAAJ,EAASN,IAAI,CAAC4K,WAAL,CAAiBrC,IAAI,CAACyoB,OAAtB,EAA+B,QAA/B,EAAT,KACKhxB,IAAI,CAACuL,QAAL,CAAchD,IAAI,CAACyoB,OAAnB,EAA4B,QAA5B;AACR;;AAED,UAAIzoB,IAAI,CAAC0oB,OAAT,EAAkB;AACd,YAAI3wB,GAAJ,EAASN,IAAI,CAACuL,QAAL,CAAchD,IAAI,CAAC0oB,OAAnB,EAA4B,QAA5B,EAAT,KACKjxB,IAAI,CAAC4K,WAAL,CAAiBrC,IAAI,CAAC0oB,OAAtB,EAA+B,QAA/B;AACR;AACJ,KA9zJQ;;AAg0JT;AACR;AACA;AACA;AACQC,IAAAA,WAAW,EAAE,qBAAUC,IAAV,EAAgB;AACzB,WAAK7e,WAAL;AAEA,UAAM8e,YAAY,GAAID,IAAI,KAAK,IAAT,IAAiBA,IAAI,KAAKtU,SAA3B,GAAwC,EAAxC,GAA6C,KAAKuQ,wBAAL,CAA8B+D,IAA9B,CAAlE;;AACA,WAAKE,gBAAL;;AAEA,UAAI,CAAC,KAAK1rB,SAAL,CAAeE,UAApB,EAAgC;AAC5B3G,QAAAA,OAAO,CAACO,OAAR,CAAgB8P,OAAhB,CAAwBsE,SAAxB,GAAoCud,YAApC,CAD4B,CAE5B;;AACA,aAAKhwB,OAAL,CAAa4H,IAAb,CAAkB,KAAlB;AACH,OAJD,MAIO;AACH,YAAM+F,KAAK,GAAG,KAAK4e,sBAAL,CAA4ByD,YAA5B,EAA0C,KAA1C,CAAd;;AACA,aAAKrD,YAAL,CAAkBhf,KAAlB;AACH;AACJ,KAl1JQ;;AAo1JT;AACR;AACA;AACA;AACQuiB,IAAAA,iBAAiB,EAAE,2BAAUC,GAAV,EAAe;AAC9B,UAAI,CAACjyB,OAAO,CAACkQ,MAAb,EAAqB,OAAO,KAAP;AACrB,UAAI+hB,GAAG,CAACxE,IAAR,EAAc,KAAKlsB,GAAL,CAASksB,IAAT,CAAclZ,SAAd,GAA0B0d,GAAG,CAACxE,IAAJ,CAASjK,OAAT,CAAiB,oCAAjB,EAAuD,EAAvD,CAA1B;AACd,UAAIyO,GAAG,CAACpE,IAAR,EAAc,KAAKtsB,GAAL,CAASssB,IAAT,CAActZ,SAAd,GAA0B,KAAKuZ,wBAAL,CAA8BmE,GAAG,CAACpE,IAAlC,CAA1B;AACjB,KA51JQ;;AA81JT;AACR;AACA;AACA;AACA;AACQrC,IAAAA,WAAW,EAAE,qBAAU0G,YAAV,EAAwB;AACjC,UAAMC,QAAQ,GAAG,KAAK9D,sBAAL,CAA4BzuB,OAAO,CAACO,OAAR,CAAgB8P,OAA5C,EAAqD,IAArD,CAAjB;AACA,UAAMmiB,UAAU,GAAG1xB,IAAI,CAACoQ,aAAL,CAAmB,KAAnB,CAAnB;AACAshB,MAAAA,UAAU,CAAC7d,SAAX,GAAuB4d,QAAvB;AAEA,UAAME,WAAW,GAAG3xB,IAAI,CAAC4V,eAAL,CAAqB8b,UAArB,EAAiC,UAAUxgB,OAAV,EAAmB;AACpE,eAAO,cAAcvD,IAAd,CAAmBuD,OAAO,CAACiD,QAA3B,CAAP;AACH,OAFmB,CAApB;;AAIA,WAAK,IAAIrM,CAAC,GAAG,CAAR,EAAWqB,GAAG,GAAGwoB,WAAW,CAAC3pB,MAAlC,EAA0CF,CAAC,GAAGqB,GAA9C,EAAmDrB,CAAC,EAApD,EAAwD;AACpD6pB,QAAAA,WAAW,CAAC7pB,CAAD,CAAX,CAAeoc,eAAf,CAA+B,iBAA/B;AACH;;AAED,UAAI5kB,OAAO,CAACqtB,QAAR,IAAoB,CAAC6E,YAAzB,EAAuC;AACnC,YAAMnE,KAAK,GAAGrtB,IAAI,CAAC6tB,qBAAL,CAA2B,KAAKhtB,GAAL,CAASssB,IAApC,EAA0C,CAAC,iBAAD,CAA1C,CAAd;AACA,eAAO,0BAA0B,KAAKtsB,GAAL,CAASksB,IAAT,CAAce,SAAxC,GAAoD,QAApD,GAA+DT,KAA/D,GAAuE,GAAvE,GAA6EqE,UAAU,CAAC7d,SAAxF,GAAoG,gBAA3G;AACH,OAHD,MAGO;AACH,eAAO6d,UAAU,CAAC7d,SAAlB;AACH;AACJ,KAt3JQ;;AAw3JT;AACR;AACA;AACA;AACA;AACA;AACQ+d,IAAAA,eAAe,EAAE,yBAAUJ,YAAV,EAAwB;AACrC,aAAO,qCAAqClyB,OAAO,CAACgB,GAAR,GAAc,SAAd,GAA0B,EAA/D,IAAqE,IAArE,GAA4E,KAAKwqB,WAAL,CAAiB0G,YAAjB,CAA5E,GAA6G,QAApH;AACH,KAh4JQ;;AAk4JT;AACR;AACA;AACA;AACA;AACA;AACA;AACQK,IAAAA,SAAS,EAAE,mBAAUva,IAAV,EAAgBwa,aAAhB,EAA+B;AACtC,UAAMzhB,UAAU,GAAG/Q,OAAO,CAAC+Q,UAA3B,CADsC,CAEtC;;AACA,UAAIiH,IAAI,CAAClG,QAAL,KAAkB,CAAtB,EAAyB;AACrB,YAAIpR,IAAI,CAAC+xB,eAAL,CAAqBza,IAArB,CAAJ,EAAgC,OAAO,EAAP;AAEhC,YAAMgP,EAAE,GAAGtmB,IAAI,CAACqc,iBAAL,CAAuB/E,IAAvB,EAA6B,UAASpG,OAAT,EAAkB;AAAE,iBAAOlR,IAAI,CAACgyB,iBAAL,CAAuB9gB,OAAvB,CAAP;AAAyC,SAA1F,KAA+F,EAA1G;;AACA,aAAK,IAAIpJ,CAAC,GAAGwe,EAAE,CAACte,MAAH,GAAY,CAAzB,EAA4BF,CAAC,IAAI,CAAjC,EAAoCA,CAAC,EAArC,EAAyC;AACrCwe,UAAAA,EAAE,CAACxe,CAAD,CAAF,CAAMgmB,SAAN,GAAkBxH,EAAE,CAACxe,CAAD,CAAF,CAAM+L,SAAxB;AACH;;AAED,YAAI,CAACie,aAAD,IAAmB9xB,IAAI,CAACkQ,eAAL,CAAqBoH,IAArB,KAA8BtX,IAAI,CAAC6V,oBAAL,CAA0ByB,IAA1B,CAA9B,IAAiEtX,IAAI,CAACmQ,WAAL,CAAiBmH,IAAjB,CAAjE,IAA2FtX,IAAI,CAACsa,OAAL,CAAahD,IAAb,CAA3F,IAAkHtX,IAAI,CAACiyB,QAAL,CAAc3a,IAAd,KAAuBtX,IAAI,CAACsa,OAAL,CAAahD,IAAI,CAAC3I,iBAAlB,CAAhK,EAAwM;AACpM,iBAAO3O,IAAI,CAACgyB,iBAAL,CAAuB1a,IAAvB,IAA+BA,IAAI,CAACzD,SAApC,GAAgDyD,IAAI,CAACwW,SAA5D;AACH,SAFD,MAEO;AACH,iBAAO,MAAMzd,UAAN,GAAmB,GAAnB,IAA0BrQ,IAAI,CAACgyB,iBAAL,CAAuB1a,IAAvB,IAA+BA,IAAI,CAACzD,SAApC,GAAgDyD,IAAI,CAACwW,SAA/E,IAA4F,IAA5F,GAAmGzd,UAAnG,GAAgH,GAAvH;AACH;AACJ,OAhBqC,CAiBtC;;;AACA,UAAIiH,IAAI,CAAClG,QAAL,KAAkB,CAAtB,EAAyB;AACrB,YAAI,CAAC0gB,aAAL,EAAoB,OAAO9xB,IAAI,CAACkyB,cAAL,CAAoB5a,IAAI,CAACjG,WAAzB,CAAP;AACpB,YAAM8gB,SAAS,GAAG7a,IAAI,CAACjG,WAAL,CAAiBoc,KAAjB,CAAuB,KAAvB,CAAlB;AACA,YAAI0D,IAAI,GAAG,EAAX;;AACA,aAAK,IAAIrpB,IAAC,GAAG,CAAR,EAAWsqB,IAAI,GAAGD,SAAS,CAACnqB,MAA5B,EAAoCqqB,IAAzC,EAA+CvqB,IAAC,GAAGsqB,IAAnD,EAAyDtqB,IAAC,EAA1D,EAA8D;AAC1DuqB,UAAAA,IAAI,GAAGF,SAAS,CAACrqB,IAAD,CAAT,CAAa2N,IAAb,EAAP;AACA,cAAI4c,IAAI,CAACrqB,MAAL,GAAc,CAAlB,EAAqBmpB,IAAI,IAAI,MAAM9gB,UAAN,GAAmB,GAAnB,GAAyBrQ,IAAI,CAACkyB,cAAL,CAAoBG,IAApB,CAAzB,GAAqD,IAArD,GAA4DhiB,UAA5D,GAAyE,GAAjF;AACxB;;AACD,eAAO8gB,IAAP;AACH,OA3BqC,CA4BtC;;;AACA,UAAI7Z,IAAI,CAAClG,QAAL,KAAkB,CAAlB,IAAuB,KAAKkhB,kBAAhC,EAAoD;AAChD,eAAO,SAAShb,IAAI,CAACjG,WAAL,CAAiBoE,IAAjB,EAAT,GAAmC,KAA1C;AACH;;AAED,aAAO,EAAP;AACH,KA36JQ;;AA66JT;AACR;AACA;AACA;AACA;AACA;AACQ8c,IAAAA,aAAa,EAAE,uBAAUF,IAAV,EAAgB;AAC3B,UAAI,CAAC,KAAK5vB,yBAAV,EAAqC,OAAO4vB,IAAP;AAErC,UAAMrf,EAAE,GAAG1T,OAAO,CAACsmB,YAAnB;AACA,aAAOyM,IAAI,CAACvP,OAAL,CAAa,KAAKrgB,yBAAlB,EAA6C,UAAUilB,CAAV,EAAane,CAAb,EAAgBgb,CAAhB,EAAmB1F,CAAnB,EAAsB;AACtE,eAAOtV,CAAC,IAAI,OAAOyJ,EAAE,CAACuR,CAAD,CAAT,KAAiB,QAAjB,GAA4BvR,EAAE,CAACuR,CAAD,CAA9B,GAAoCA,CAAxC,CAAD,IAA+C1F,CAAC,GAAG,MAAMA,CAAT,GAAa,EAA7D,CAAP;AACH,OAFM,CAAP;AAGH,KA17JQ;;AA47JT;AACR;AACA;AACA;AACA;AACA;AACQ2T,IAAAA,qBAAqB,EAAE,+BAAUrB,IAAV,EAAgB;AACnC,aAAOA,IAAI,CACNrO,OADE,CACM,KADN,EACa,EADb,EAEFA,OAFE,CAEM,oDAFN,EAE4D,EAF5D,EAGFA,OAHE,CAGM,+DAHN,EAGuE,EAHvE,EAIFA,OAJE,CAIM,KAAKpgB,yBAJX,EAIsC,EAJtC,EAKFogB,OALE,CAKM,KAAKngB,yBALX,EAKsC,EALtC,CAAP;AAMH,KAz8JQ;AA28JT8vB,IAAAA,WAAW,EAAE,qBAAU/K,CAAV,EAAa/D,CAAb,EAAgBta,IAAhB,EAAsB;AAC/B,UAAMqpB,EAAE,GAAGhL,CAAC,CAACzE,KAAF,CAAQ,kCAAR,CAAX;;AACA,UAAIyP,EAAJ,EAAQ;AACJ,YAAI,CAAC/O,CAAL,EAAQA,CAAC,GAAG,EAAJ;AACR,YAAMrd,KAAK,GAAGosB,EAAE,CAAC,CAAD,CAAF,CAAM5P,OAAN,CAAc,SAAd,EAAyB,EAAzB,EAA6BG,KAA7B,CAAmC,KAAK1d,iBAAL,CAAuB8D,IAAvB,CAAnC,CAAd;;AACA,YAAI/C,KAAJ,EAAW;AACP,cAAMqsB,YAAY,GAAG,EAArB;;AACA,eAAK,IAAI7qB,CAAC,GAAG,CAAR,EAAWqB,GAAG,GAAG7C,KAAK,CAAC0B,MAAvB,EAA+BsQ,CAApC,EAAuCxQ,CAAC,GAAGqB,GAA3C,EAAgDrB,CAAC,EAAjD,EAAqD;AACjDwQ,YAAAA,CAAC,GAAGhS,KAAK,CAACwB,CAAD,CAAL,CAASmb,KAAT,CAAe,iBAAf,CAAJ;;AACA,gBAAI3K,CAAC,IAAI,CAAC,mBAAmB3K,IAAnB,CAAwB2K,CAAC,CAAC,CAAD,CAAzB,CAAV,EAAyC;AACrC,kBAAM6J,CAAC,GAAGniB,IAAI,CAAC4yB,gBAAL,CAAsBta,CAAC,CAAC,CAAD,CAAD,CAAK7C,IAAL,EAAtB,CAAV;;AACA,kBAAMkO,EAAC,GAAG,KAAKziB,eAAL,CAAqBihB,CAArB,EAAwBW,OAAxB,CAAgC,IAAhC,EAAsC,EAAtC,CAAV;;AACA,kBAAMhI,GAAC,GAAGxC,CAAC,CAAC,CAAD,CAAD,CAAK7C,IAAL,EAAV;;AACA,sBAAQ0M,CAAR;AACI,qBAAK,YAAL;AACI,sBAAI,CAAC7iB,OAAO,CAACF,OAAR,CAAgByzB,IAAjB,IAAyBvzB,OAAO,CAACuzB,IAAR,CAAazlB,OAAb,CAAqB0N,GAArB,MAA4B,CAAC,CAA1D,EAA6D;AAC7D;;AACJ,qBAAK,UAAL;AACI,sBAAI,CAACxb,OAAO,CAACF,OAAR,CAAgB0zB,QAArB,EAA+B;AAC/B;;AACJ,qBAAK,OAAL;AACI,sBAAI,CAACxzB,OAAO,CAACF,OAAR,CAAgB2zB,SAAjB,IAA8B,0CAA0CplB,IAA1C,CAA+CmN,GAA/C,CAAlC,EAAqF;AACrF;;AACJ,qBAAK,iBAAL;AACI,sBAAI,CAACxb,OAAO,CAACF,OAAR,CAAgB4zB,WAAjB,IAAgC,0CAA0CrlB,IAA1C,CAA+CmN,GAA/C,CAApC,EAAuF;AACvF;AAZR;;AAeA,kBAAI6I,EAAC,KAAK7I,GAAV,EAAa;AACT6X,gBAAAA,YAAY,CAAC3pB,IAAb,CAAkBsP,CAAC,CAAC,CAAD,CAAnB;AACH;AACJ;AACJ;;AACD,cAAIqa,YAAY,CAAC3qB,MAAb,GAAsB,CAA1B,EAA6B2b,CAAC,CAAC3a,IAAF,CAAO,YAAY2pB,YAAY,CAACM,IAAb,CAAkB,GAAlB,CAAZ,GAAqC,GAA5C;AAChC;AACJ;;AAED,aAAOtP,CAAP;AACH,KAj/JQ;;AAm/JT;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACQuP,IAAAA,UAAU,EAAE,oBAAUC,aAAV,EAAyBzL,CAAzB,EAA4Bne,CAA5B,EAA+B;AACvC,UAAI,0BAA0BoE,IAA1B,CAA+B+Z,CAA/B,CAAJ,EAAuC,OAAOA,CAAP;AAEvC,UAAI/D,CAAC,GAAG,IAAR;AACA,UAAMqJ,OAAO,GAAGzjB,CAAC,CAAC0Z,KAAF,CAAQ,qBAAR,EAA+B,CAA/B,EAAkChK,WAAlC,EAAhB,CAJuC,CAMvC;;AACA,UAAMma,KAAK,GAAG,KAAK/vB,wBAAL,CAA8B2pB,OAA9B,CAAd;AACAtF,MAAAA,CAAC,GAAGA,CAAC,CAAC5E,OAAF,CAAU,mCAAV,EAA+C,EAA/C,CAAJ;AACA,UAAIsQ,KAAJ,EAAW1L,CAAC,GAAGA,CAAC,CAAC5E,OAAF,CAAUsQ,KAAV,EAAiB,EAAjB,CAAJ,CAAX,KACK1L,CAAC,GAAGA,CAAC,CAAC5E,OAAF,CAAU,KAAK3f,0BAAf,EAA2C,EAA3C,CAAJ,CAVkC,CAYvC;;AACA,UAAMkwB,KAAK,GAAG,KAAKjwB,wBAAL,CAA8B4pB,OAA9B,CAAd;AACA,UAAIqG,KAAJ,EAAW1P,CAAC,GAAG+D,CAAC,CAACzE,KAAF,CAAQoQ,KAAR,CAAJ,CAAX,KACK1P,CAAC,GAAG+D,CAAC,CAACzE,KAAF,CAAQkQ,aAAa,GAAG,KAAKlwB,0BAAR,GAAqC,KAAKC,mCAA/D,CAAJ,CAfkC,CAiBvC;;AACA,UAAIiwB,aAAJ,EAAmB;AACf,YAAInG,OAAO,KAAK,GAAhB,EAAqB;AACjB,cAAM0F,EAAE,GAAGhL,CAAC,CAACzE,KAAF,CAAQ,6CAAR,CAAX;;AACA,cAAIyP,EAAJ,EAAQ;AACJ,gBAAI,CAAC/O,CAAL,EAAQA,CAAC,GAAG,EAAJ;AACRA,YAAAA,CAAC,CAAC3a,IAAF,CAAO0pB,EAAE,CAAC,CAAD,CAAT;AACH;AACJ,SAND,MAMO,IAAI,CAAC/O,CAAD,IAAM,CAAC,UAAUhW,IAAV,CAAegW,CAAC,CAAC2P,QAAF,EAAf,CAAX,EAAyC;AAC5C,cAAItG,OAAO,KAAK,MAAhB,EAAwB;AACpBrJ,YAAAA,CAAC,GAAG,KAAK8O,WAAL,CAAiB/K,CAAjB,EAAoB/D,CAApB,EAAuB,MAAvB,CAAJ;AACH,WAFD,MAEO,IAAI,wBAAwBhW,IAAxB,CAA6Bqf,OAA7B,CAAJ,EAA2C;AAC9CrJ,YAAAA,CAAC,GAAG,KAAK8O,WAAL,CAAiB/K,CAAjB,EAAoB/D,CAApB,EAAuB,QAAvB,CAAJ;AACH;AACJ;AACJ,OAdD,MAcO;AACH,YAAM+O,GAAE,GAAGhL,CAAC,CAACzE,KAAF,CAAQ,kCAAR,CAAX;;AACA,YAAIyP,GAAE,IAAI,CAAC/O,CAAX,EAAcA,CAAC,GAAG,CAAC+O,GAAE,CAAC,CAAD,CAAH,CAAJ,CAAd,KACK,IAAIA,GAAE,IAAI,CAAC/O,CAAC,CAACzB,IAAF,CAAO,UAAUyB,CAAV,EAAa;AAAE,iBAAO,SAAShW,IAAT,CAAcgW,CAAC,CAAClO,IAAF,EAAd,CAAP;AAAiC,SAAvD,CAAX,EAAqEkO,CAAC,CAAC3a,IAAF,CAAO0pB,GAAE,CAAC,CAAD,CAAT;AAC7E,OApCsC,CAsCvC;;;AACA,UAAI1F,OAAO,KAAK,KAAhB,EAAuB;AACnB,YAAIlT,CAAC,GAAG,EAAR;AAAA,YAAYyZ,CAAC,GAAG,EAAhB;;AACA,YAAMb,IAAE,GAAGhL,CAAC,CAACzE,KAAF,CAAQ,kCAAR,CAAX;;AACA,YAAI,CAACU,CAAL,EAAQA,CAAC,GAAG,EAAJ;;AACR,YAAI+O,IAAJ,EAAQ;AACJ5Y,UAAAA,CAAC,GAAG4Y,IAAE,CAAC,CAAD,CAAF,CAAMzP,KAAN,CAAY,aAAZ,CAAJ;AACAnJ,UAAAA,CAAC,GAAG9Z,IAAI,CAACoG,SAAL,CAAe0T,CAAC,GAAGA,CAAC,CAAC,CAAD,CAAJ,GAAU,EAA1B,EAA8B,CAAC,CAA/B,KAAqC,EAAzC;AACAyZ,UAAAA,CAAC,GAAGb,IAAE,CAAC,CAAD,CAAF,CAAMzP,KAAN,CAAY,cAAZ,CAAJ;AACAsQ,UAAAA,CAAC,GAAGvzB,IAAI,CAACoG,SAAL,CAAemtB,CAAC,GAAGA,CAAC,CAAC,CAAD,CAAJ,GAAU,EAA1B,EAA8B,CAAC,CAA/B,KAAqC,EAAzC;AACH;;AAED,YAAI,CAACzZ,CAAD,IAAM,CAACyZ,CAAX,EAAc;AACV,cAAMC,GAAG,GAAG9L,CAAC,CAACzE,KAAF,CAAQ,oCAAR,CAAZ;AACA,cAAMwQ,GAAG,GAAG/L,CAAC,CAACzE,KAAF,CAAQ,qCAAR,CAAZ;;AACA,cAAIuQ,GAAG,IAAIC,GAAX,EAAgB;AACZ3Z,YAAAA,CAAC,GAAG,CAACA,CAAD,GAAK9Z,IAAI,CAACoG,SAAL,CAAeotB,GAAG,GAAGA,GAAG,CAAC,CAAD,CAAN,GAAY,EAA9B,KAAqC,EAA1C,GAA+C1Z,CAAnD;AACAyZ,YAAAA,CAAC,GAAG,CAACA,CAAD,GAAKvzB,IAAI,CAACoG,SAAL,CAAeqtB,GAAG,GAAGA,GAAG,CAAC,CAAD,CAAN,GAAY,EAA9B,KAAqC,EAA1C,GAA+CF,CAAnD;AACH;AACJ;;AACD5P,QAAAA,CAAC,CAAC3a,IAAF,CAAO,mBAAmB8Q,CAAC,GAAG,GAAJ,GAAUyZ,CAA7B,IAAkC,GAAzC;AACH;;AAED,UAAI5P,CAAJ,EAAO;AACH,aAAK,IAAI7b,CAAC,GAAG,CAAR,EAAWqB,GAAG,GAAGwa,CAAC,CAAC3b,MAAxB,EAAgCF,CAAC,GAAGqB,GAApC,EAAyCrB,CAAC,EAA1C,EAA8C;AAC1C,cAAIqrB,aAAa,IAAI,iCAAiCxlB,IAAjC,CAAsCgW,CAAC,CAAC7b,CAAD,CAAD,CAAK2N,IAAL,EAAtC,CAArB,EAAyE;AACzElM,UAAAA,CAAC,IAAI,OAAO,gDAAgDoE,IAAhD,CAAqDgW,CAAC,CAAC7b,CAAD,CAAD,CAAK2N,IAAL,EAArD,IAAoE,EAApE,GAAyEkO,CAAC,CAAC7b,CAAD,CAAjF,CAAL;AACH;AACJ;;AAED,aAAOyB,CAAP;AACH,KAhkKQ;;AAkkKT;AACR;AACA;AACA;AACA;AACA;AACQmqB,IAAAA,WAAW,EAAE,qBAAUC,GAAV,EAAe;AACxB,UAAI5kB,KAAK,GAAG,EAAZ;AAAA,UAAgB4O,CAAhB;AACA,UAAMiW,QAAQ,GAAGD,GAAG,CAACxiB,UAArB;;AACA,WAAK,IAAIrJ,CAAC,GAAG,CAAR,EAAWqB,GAAG,GAAGyqB,QAAQ,CAAC5rB,MAA1B,EAAkCuc,CAAvC,EAA0Czc,CAAC,GAAGqB,GAA9C,EAAmDrB,CAAC,EAApD,EAAwD;AACpDyc,QAAAA,CAAC,GAAGqP,QAAQ,CAAC9rB,CAAD,CAAZ;;AACA,YAAI,CAAC9H,IAAI,CAACkQ,eAAL,CAAqBqU,CAArB,CAAD,IAA4B,CAACvkB,IAAI,CAAC6V,oBAAL,CAA0B0O,CAA1B,CAA7B,IAA6D,CAACvkB,IAAI,CAACmQ,WAAL,CAAiBoU,CAAjB,CAA9D,IAAqF,CAAC,QAAQ5W,IAAR,CAAa4W,CAAC,CAACpQ,QAAf,CAA1F,EAAoH;AAChH,cAAI,CAACwJ,CAAL,EAAQA,CAAC,GAAG3d,IAAI,CAACoQ,aAAL,CAAmB9Q,OAAO,CAAC+Q,UAA3B,CAAJ;AACRsN,UAAAA,CAAC,CAAC3T,WAAF,CAAcua,CAAd;AACAzc,UAAAA,CAAC;AAAIqB,UAAAA,GAAG;AACX,SAJD,MAIO;AACH,cAAIwU,CAAJ,EAAO;AACH5O,YAAAA,KAAK,IAAI4O,CAAC,CAACmQ,SAAX;AACAnQ,YAAAA,CAAC,GAAG,IAAJ;AACH;;AACD5O,UAAAA,KAAK,IAAIwV,CAAC,CAACuJ,SAAX;AACH;AACJ;;AAED,UAAInQ,CAAJ,EAAO5O,KAAK,IAAI4O,CAAC,CAACmQ,SAAX;AAEP,aAAOtuB,EAAE,CAACmS,WAAH,GAAiBkiB,wBAAjB,CAA0C9kB,KAA1C,CAAP;AACH,KA7lKQ;AA+lKT+kB,IAAAA,gBAAgB,EAAE,0BAAUC,OAAV,EAAmB;AACjC,UAAI5C,IAAI,GAAG,EAAX;;AAEA,WAAK,IAAIrpB,CAAC,GAAG,CAAR,EAAWqB,GAAG,GAAG4qB,OAAO,CAAC/rB,MAAzB,EAAiCsP,IAAtC,EAA4CxP,CAAC,GAAGqB,GAAhD,EAAqDrB,CAAC,EAAtD,EAA0D;AACtDwP,QAAAA,IAAI,GAAGyc,OAAO,CAACjsB,CAAD,CAAd;;AACA,YAAIwP,IAAI,CAAClG,QAAL,KAAkB,CAAtB,EAAyB;AACrB,cAAIpR,IAAI,CAAC2Z,MAAL,CAAYrC,IAAZ,CAAJ,EAAuB;AACnB6Z,YAAAA,IAAI,IAAI7Z,IAAI,CAACzD,SAAb;AACH,WAFD,MAEO,IAAI7T,IAAI,CAACuW,UAAL,CAAgBe,IAAhB,CAAJ,EAA2B;AAC9B6Z,YAAAA,IAAI,IAAI7Z,IAAI,CAACwW,SAAb;AACH,WAFM,MAEA,IAAI9tB,IAAI,CAACkQ,eAAL,CAAqBoH,IAArB,CAAJ,EAAgC;AACnC6Z,YAAAA,IAAI,IAAI,UAAS7Z,IAAI,CAACzD,SAAL,CAAe4B,IAAf,MAAyB,MAAlC,IAA4C,OAApD;AACH,WAFM,MAEA,IAAIzV,IAAI,CAAC6V,oBAAL,CAA0ByB,IAA1B,KAAmC,CAACtX,IAAI,CAACoW,OAAL,CAAakB,IAAb,CAAxC,EAA4D;AAC/D6Z,YAAAA,IAAI,IAAI,KAAK2C,gBAAL,CAAsBxc,IAAtB,CAAR;AACH,WAFM,MAEA;AACH6Z,YAAAA,IAAI,IAAI,SAAS7Z,IAAI,CAACwW,SAAd,GAA0B,OAAlC;AACH;AACJ,SAZD,MAYO;AACHqD,UAAAA,IAAI,IAAI,UAAU7Z,IAAI,CAACjG,WAAL,IAAoB,MAA9B,IAAwC,OAAhD;AACH;AACJ;;AAED,aAAO8f,IAAP;AACH,KAtnKQ;AAwnKT6C,IAAAA,aAAa,EAAE,uBAAUD,OAAV,EAAmB;AAC9B,UAAIjC,aAAa,GAAG,KAApB;;AAEA,WAAK,IAAIhqB,CAAC,GAAG,CAAR,EAAWqB,GAAG,GAAG4qB,OAAO,CAAC/rB,MAAzB,EAAiCuB,CAAtC,EAAyCzB,CAAC,GAAGqB,GAA7C,EAAkDrB,CAAC,EAAnD,EAAuD;AACnDyB,QAAAA,CAAC,GAAGwqB,OAAO,CAACjsB,CAAD,CAAX;;AACA,YAAIyB,CAAC,CAAC6H,QAAF,KAAe,CAAf,IAAoB,CAACpR,IAAI,CAACi0B,kBAAL,CAAwB1qB,CAAxB,CAArB,IAAmD,CAACvJ,IAAI,CAAC0U,OAAL,CAAanL,CAAb,CAApD,IAAuE,CAACvJ,IAAI,CAAC+xB,eAAL,CAAqBxoB,CAArB,CAA5E,EAAqG;AACjGuoB,UAAAA,aAAa,GAAG,IAAhB;AACA;AACH;AACJ;;AAED,aAAOA,aAAP;AACH,KApoKQ;;AAsoKT;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQoC,IAAAA,SAAS,EAAE,mBAAU/C,IAAV,EAAgBgD,SAAhB,EAA2BC,SAA3B,EAAsC;AAC7CjD,MAAAA,IAAI,GAAG,KAAKqB,qBAAL,CAA2B,KAAKryB,OAAL,CAAa0sB,eAAb,CAA6BsE,IAA7B,EAAmC,WAAnC,EAAgDhE,IAAhD,CAAqDtZ,SAAhF,EAA2FiP,OAA3F,CAAmG,8BAAnG,EAAmI,KAAKoQ,UAAL,CAAgB5oB,IAAhB,CAAqB,IAArB,EAA2B,IAA3B,CAAnI,EAAqKwY,OAArK,CAA6K,uDAA7K,EAAsO,EAAtO,CAAP;;AAEA,UAAM6Q,GAAG,GAAGn0B,EAAE,CAACmS,WAAH,GAAiBkiB,wBAAjB,CAA0C1C,IAA1C,CAAZ;;AACA,UAAI;AACAnxB,QAAAA,IAAI,CAACq0B,uBAAL,CAA6BV,GAA7B,EAAkC,KAAKpxB,yBAAvC,EAAkE,KAAKC,yBAAvE,EAAkG,IAAlG;AACH,OAFD,CAEE,OAAOsP,KAAP,EAAc;AACZC,QAAAA,OAAO,CAACC,IAAR,CAAa,iDAAiDF,KAA9D;AACH;;AAED,UAAI,KAAKxN,eAAL,IAAwB,KAAKA,eAAL,CAAqBgwB,KAAjD,EAAwD;AACpD,YAAMC,YAAY,GAAGZ,GAAG,CAAC9rB,gBAAJ,CAAqB,KAAKvD,eAAL,CAAqBgwB,KAA1C,CAArB;;AACA,aAAK,IAAIxsB,CAAC,GAAG,CAAR,EAAWqB,GAAG,GAAGorB,YAAY,CAACvsB,MAA9B,EAAsCwsB,UAAtC,EAAkD7R,SAAvD,EAAkE7a,CAAC,GAAGqB,GAAtE,EAA2ErB,CAAC,EAA5E,EAAgF;AAC5E6a,UAAAA,SAAS,GAAG,GAAGjM,KAAH,CAASjM,IAAT,CAAc8pB,YAAY,CAACzsB,CAAD,CAAZ,CAAgB6a,SAA9B,CAAZ;;AACA,eAAK,IAAI7H,GAAC,GAAG,CAAR,EAAWkE,IAAI,GAAG2D,SAAS,CAAC3a,MAAjC,EAAyC8S,GAAC,GAAGkE,IAA7C,EAAmDlE,GAAC,EAApD,EAAwD;AACpD0Z,YAAAA,UAAU,GAAG,KAAKlwB,eAAL,CAAqBmwB,GAArB,CAAyB9R,SAAS,CAAC7H,GAAD,CAAlC,CAAb;;AACA,gBAAI0Z,UAAJ,EAAgB;AACZA,cAAAA,UAAU,CAACD,YAAY,CAACzsB,CAAD,CAAb,CAAV;AACA;AACH;AACJ;AACJ;AACJ;;AAED,UAAIisB,OAAO,GAAGJ,GAAG,CAACxiB,UAAlB;AACA,UAAI+iB,SAAS,GAAG,EAAhB;;AACA,UAAMpC,aAAa,GAAG,KAAKkC,aAAL,CAAmBD,OAAnB,CAAtB;;AAEA,UAAGjC,aAAH,EAAkB;AACdiC,QAAAA,OAAO,GAAG,KAAKL,WAAL,CAAiBC,GAAjB,EAAsBxiB,UAAhC;AACH;;AAED,WAAK,IAAIrJ,IAAC,GAAG,CAAR,EAAWqB,MAAG,GAAG4qB,OAAO,CAAC/rB,MAA9B,EAAsCF,IAAC,GAAGqB,MAA1C,EAA+CrB,IAAC,EAAhD,EAAoD;AAChDosB,QAAAA,SAAS,IAAI,KAAKrC,SAAL,CAAekC,OAAO,CAACjsB,IAAD,CAAtB,EAA2BgqB,aAA3B,CAAb;AACH;;AAEDoC,MAAAA,SAAS,GAAGl0B,IAAI,CAAC00B,oBAAL,CAA0BR,SAA1B,CAAZ;;AACA,UAAI,CAACA,SAAL,EAAgB;AACZA,QAAAA,SAAS,GAAG/C,IAAZ;AACH,OAFD,MAEO;AACH,YAAIgD,SAAJ,EAAeD,SAAS,GAAGA,SAAS,CAACpR,OAAV,CAAkB,OAAOqR,SAAP,KAAqB,QAArB,GAAgCn0B,IAAI,CAAC20B,mBAAL,CAAyBR,SAAzB,CAAhC,GAAsEA,SAAxF,EAAmG,EAAnG,CAAZ;AACf,YAAIC,SAAJ,EAAeF,SAAS,GAAGA,SAAS,CAACpR,OAAV,CAAkB,OAAOsR,SAAP,KAAqB,QAArB,GAAgCp0B,IAAI,CAAC40B,mBAAL,CAAyBR,SAAzB,CAAhC,GAAsEA,SAAxF,EAAmG,EAAnG,CAAZ;AAClB;;AAED,aAAO,KAAK7B,aAAL,CAAmB2B,SAAnB,CAAP;AACH,KA5rKQ;;AA8rKT;AACR;AACA;AACA;AACA;AACQ9G,IAAAA,wBAAwB,EAAE,kCAAUqE,QAAV,EAAoB;AAC1CA,MAAAA,QAAQ,GAAG,KAAKe,qBAAL,CAA2B,KAAKryB,OAAL,CAAa0sB,eAAb,CAA6B4E,QAA7B,EAAuC,WAAvC,EAAoDtE,IAApD,CAAyDtZ,SAApF,EAA+FiP,OAA/F,CAAuG,8BAAvG,EAAuI,KAAKoQ,UAAL,CAAgB5oB,IAAhB,CAAqB,IAArB,EAA2B,KAA3B,CAAvI,CAAX;;AACA,UAAMqpB,GAAG,GAAGn0B,EAAE,CAACmS,WAAH,GAAiBkiB,wBAAjB,CAA0CpC,QAA1C,CAAZ;;AAEA,UAAI;AACAzxB,QAAAA,IAAI,CAACq0B,uBAAL,CAA6BV,GAA7B,EAAkC,KAAKpxB,yBAAvC,EAAkE,KAAKC,yBAAvE,EAAkG,KAAlG;AACH,OAFD,CAEE,OAAOsP,KAAP,EAAc;AACZC,QAAAA,OAAO,CAACC,IAAR,CAAa,gEAAgEF,KAA7E;AACH;;AAED,UAAI,KAAKxN,eAAL,IAAwB,KAAKA,eAAL,CAAqBgwB,KAAjD,EAAwD;AACpD,YAAMC,YAAY,GAAGZ,GAAG,CAAC9rB,gBAAJ,CAAqB,KAAKvD,eAAL,CAAqBgwB,KAA1C,CAArB;;AACA,aAAK,IAAIxsB,CAAC,GAAG,CAAR,EAAWqB,GAAG,GAAGorB,YAAY,CAACvsB,MAA9B,EAAsCwsB,UAAtC,EAAkD7R,SAAvD,EAAkE7a,CAAC,GAAGqB,GAAtE,EAA2ErB,CAAC,EAA5E,EAAgF;AAC5E6a,UAAAA,SAAS,GAAG,GAAGjM,KAAH,CAASjM,IAAT,CAAc8pB,YAAY,CAACzsB,CAAD,CAAZ,CAAgB6a,SAA9B,CAAZ;;AACA,eAAK,IAAI7H,GAAC,GAAG,CAAR,EAAWkE,IAAI,GAAG2D,SAAS,CAAC3a,MAAjC,EAAyC8S,GAAC,GAAGkE,IAA7C,EAAmDlE,GAAC,EAApD,EAAwD;AACpD0Z,YAAAA,UAAU,GAAG,KAAKlwB,eAAL,CAAqBmwB,GAArB,CAAyB9R,SAAS,CAAC7H,GAAD,CAAlC,CAAb;;AACA,gBAAI0Z,UAAJ,EAAgB;AACZA,cAAAA,UAAU,CAACD,YAAY,CAACzsB,CAAD,CAAb,CAAV;AACA;AACH;AACJ;AACJ;AACJ;;AAED,UAAMisB,OAAO,GAAGJ,GAAG,CAACxiB,UAApB;AACA,UAAI+iB,SAAS,GAAG,EAAhB;AAAA,UAAoBrV,CAAC,GAAG,IAAxB;;AACA,WAAK,IAAI/W,IAAC,GAAG,CAAR,EAAWyB,CAAhB,EAAmBzB,IAAC,GAAGisB,OAAO,CAAC/rB,MAA/B,EAAuCF,IAAC,EAAxC,EAA4C;AACxCyB,QAAAA,CAAC,GAAGwqB,OAAO,CAACjsB,IAAD,CAAX;;AAEA,YAAI,CAAC9H,IAAI,CAACkQ,eAAL,CAAqB3G,CAArB,CAAD,IAA4B,CAACvJ,IAAI,CAAC6V,oBAAL,CAA0BtM,CAA1B,CAA7B,IAA6D,CAACvJ,IAAI,CAACmQ,WAAL,CAAiB5G,CAAjB,CAA9D,IAAqF,CAACvJ,IAAI,CAACsa,OAAL,CAAa/Q,CAAb,CAAtF,IAAyGA,CAAC,CAAC6H,QAAF,KAAe,CAA5H,EAA+H;AAC3H,cAAI,CAACyN,CAAL,EAAQA,CAAC,GAAG7e,IAAI,CAACoQ,aAAL,CAAmB9Q,OAAO,CAAC+Q,UAA3B,CAAJ;AACRwO,UAAAA,CAAC,CAAC7U,WAAF,CAAcT,CAAd;AACAzB,UAAAA,IAAC;;AACD,cAAIisB,OAAO,CAACjsB,IAAC,GAAG,CAAL,CAAP,IAAkB,CAAC9H,IAAI,CAACkQ,eAAL,CAAqB6jB,OAAO,CAACjsB,IAAC,GAAG,CAAL,CAA5B,CAAvB,EAA6D;AACzD;AACH,WAFD,MAEO;AACHyB,YAAAA,CAAC,GAAGsV,CAAJ;AACAA,YAAAA,CAAC,GAAG,IAAJ;AACH;AACJ;;AAED,YAAIA,CAAJ,EAAO;AACHqV,UAAAA,SAAS,IAAI,KAAKrC,SAAL,CAAehT,CAAf,EAAkB,IAAlB,CAAb;AACAA,UAAAA,CAAC,GAAG,IAAJ;AACH;;AACDqV,QAAAA,SAAS,IAAI,KAAKrC,SAAL,CAAetoB,CAAf,EAAkB,IAAlB,CAAb;AACH;;AACD,UAAIsV,CAAJ,EAAOqV,SAAS,IAAI,KAAKrC,SAAL,CAAehT,CAAf,EAAkB,IAAlB,CAAb;AAEP,UAAIqV,SAAS,CAAClsB,MAAV,KAAqB,CAAzB,EAA4B,OAAO,MAAM1I,OAAO,CAAC+Q,UAAd,GAA2B,SAA3B,GAAuC/Q,OAAO,CAAC+Q,UAA/C,GAA4D,GAAnE;AAE5B6jB,MAAAA,SAAS,GAAGl0B,IAAI,CAAC00B,oBAAL,CAA0BR,SAA1B,CAAZ;AACA,aAAO,KAAK3B,aAAL,CAAmB2B,SAAnB,CAAP;AACH,KAxvKQ;;AA0vKT;AACR;AACA;AACA;AACA;AACA;AACQvG,IAAAA,sBAAsB,EAAE,gCAAUwD,IAAV,EAAgB0D,IAAhB,EAAsB;AAC1C,UAAIC,UAAU,GAAG,EAAjB;AACA,UAAM1S,OAAO,GAAGviB,EAAE,CAAC4F,MAAnB;AACA,UAAMsvB,KAAK,GAAG,IAAI3S,OAAJ,CAAY,kHAAZ,EAAgI,GAAhI,CAAd;AACA,UAAMoN,IAAI,GAAG,OAAO2B,IAAP,KAAgB,QAAhB,GAA2B3xB,EAAE,CAACmS,WAAH,GAAiBkiB,wBAAjB,CAA0C1C,IAA1C,CAA3B,GAA6EA,IAA1F;;AACA,UAAM6D,QAAQ,GAAG,UAAU9jB,OAAV,EAAmB;AAAE,eAAO,KAAKhB,eAAL,CAAqBgB,OAArB,KAAiC,KAAKf,WAAL,CAAiBe,OAAjB,CAAxC;AAAoE,OAAzF,CAA0F5G,IAA1F,CAA+FtK,IAA/F,CAAjB;;AACA,UAAMi1B,MAAM,GAAGJ,IAAI,GAAG,EAAH,GAAQ,IAA3B;AAEA,UAAIK,UAAU,GAAGL,IAAI,GAAG,CAAH,GAAO,KAAKlvB,SAAL,CAAeO,UAAf,GAA4B,CAAxD;AACAgvB,MAAAA,UAAU,GAAGA,UAAU,GAAG,CAAb,GAAiB,IAAIr1B,EAAE,CAACs1B,KAAP,CAAaD,UAAU,GAAG,CAA1B,EAA6BjC,IAA7B,CAAkC,GAAlC,CAAjB,GAA0D,EAAvE;;AAEC,gBAAS5L,aAAT,CAAwB5nB,OAAxB,EAAiC4qB,MAAjC,EAAyC;AACtC,YAAMra,QAAQ,GAAGvQ,OAAO,CAAC0R,UAAzB;AACA,YAAMikB,cAAc,GAAGL,KAAK,CAACpnB,IAAN,CAAWlO,OAAO,CAAC0U,QAAnB,CAAvB;AACA,YAAMkhB,aAAa,GAAID,cAAc,GAAG/K,MAAH,GAAY,EAAjD;;AAEA,aAAK,IAAIviB,CAAC,GAAG,CAAR,EAAWqB,GAAG,GAAG6G,QAAQ,CAAChI,MAA1B,EAAkCsP,IAAlC,EAAwChH,EAAxC,EAA4CglB,MAA5C,EAAoDC,WAApD,EAAiEC,GAAjE,EAAsEC,SAA3E,EAAsF3tB,CAAC,GAAGqB,GAA1F,EAA+FrB,CAAC,EAAhG,EAAoG;AAChGwP,UAAAA,IAAI,GAAGtH,QAAQ,CAAClI,CAAD,CAAf;AACAytB,UAAAA,WAAW,GAAGR,KAAK,CAACpnB,IAAN,CAAW2J,IAAI,CAACnD,QAAhB,CAAd;AACA7D,UAAAA,EAAE,GAAGilB,WAAW,GAAGN,MAAH,GAAY,EAA5B;AACAK,UAAAA,MAAM,GAAGN,QAAQ,CAAC1d,IAAD,CAAR,IAAkB,CAAC8d,cAAnB,IAAqC,CAAC,aAAaznB,IAAb,CAAkBlO,OAAO,CAAC0U,QAA1B,CAAtC,GAA4E8gB,MAA5E,GAAqF,EAA9F;;AAEA,cAAI3d,IAAI,CAAClG,QAAL,KAAkB,CAAtB,EAAyB;AACrB0jB,YAAAA,UAAU,IAAI,YAAYxd,IAAI,CAACjG,WAAL,CAAiBoE,IAAjB,EAAZ,GAAsC,MAAtC,GAA+CnF,EAA7D;AACA;AACH;;AACD,cAAIgH,IAAI,CAAClG,QAAL,KAAkB,CAAtB,EAAyB;AACrB,gBAAI,CAACpR,IAAI,CAAC2Z,MAAL,CAAYrC,IAAI,CAACjP,aAAjB,CAAL,EAAsCysB,UAAU,IAAI90B,IAAI,CAACkyB,cAAL,CAAoB,QAAQvkB,IAAR,CAAa2J,IAAI,CAACsF,IAAlB,IAA0B,EAA1B,GAA+BtF,IAAI,CAACsF,IAAxD,CAAd;AACtC;AACH;;AACD,cAAItF,IAAI,CAACnG,UAAL,CAAgBnJ,MAAhB,KAA2B,CAA/B,EAAkC;AAC9B8sB,YAAAA,UAAU,IAAI,CAAC,QAAQnnB,IAAR,CAAa2J,IAAI,CAACnD,QAAlB,IAA8B8gB,MAA9B,GAAuC,EAAxC,KAA+C,SAAStnB,IAAT,CAAc2J,IAAI,CAACjP,aAAL,CAAmB8L,QAAjC,KAA8C,QAAQxG,IAAR,CAAa2J,IAAI,CAACnD,QAAlB,CAA9C,GAA4E,EAA5E,GAAiFkhB,aAAhI,IAAiJ/d,IAAI,CAACwW,SAAtJ,GAAkKxd,EAAhL;AACA;AACH;;AAED,cAAI,CAACgH,IAAI,CAACwW,SAAV,EAAqB;AAAE;AACnBgH,YAAAA,UAAU,IAAI,IAAIj1B,EAAE,CAAC61B,aAAP,GAAuBC,iBAAvB,CAAyCre,IAAzC,CAAd;AACH,WAFD,MAEO;AACHke,YAAAA,GAAG,GAAGle,IAAI,CAACnD,QAAL,CAAc8E,WAAd,EAAN;AACAwc,YAAAA,SAAS,GAAGJ,aAAa,IAAIE,WAAjB,GAA+BlL,MAA/B,GAAwC,EAApD;AACAyK,YAAAA,UAAU,IAAI,CAACQ,MAAM,KAAKF,cAAc,GAAG,EAAH,GAAQ9kB,EAA3B,CAAP,IAAyCmlB,SAAzC,GAAqDne,IAAI,CAACwW,SAAL,CAAe7K,KAAf,CAAqBb,OAAO,CAAC,MAAMoT,GAAN,GAAY,QAAb,EAAuB,GAAvB,CAA5B,EAAyD,CAAzD,CAArD,GAAmHllB,EAAjI;AACA+W,YAAAA,aAAa,CAAC/P,IAAD,EAAO+S,MAAM,GAAG6K,UAAhB,EAA4B,EAA5B,CAAb;AACAJ,YAAAA,UAAU,IAAI,CAAC,MAAMnnB,IAAN,CAAWmnB,UAAX,IAAyBW,SAAzB,GAAqC,EAAtC,IAA4C,IAA5C,GAAmDD,GAAnD,GAAyD,GAAzD,IAAgEF,MAAM,IAAIhlB,EAAV,IAAgB8kB,cAAhB,GAAiCH,MAAjC,GAA0C,MAAM,aAAatnB,IAAb,CAAkB2J,IAAI,CAACnD,QAAvB,CAAN,GAAyC8gB,MAAzC,GAAkD,EAA5J,CAAd;AACH;AACJ;AACJ,OAlCA,EAkCCzF,IAlCD,EAkCO,EAlCP,CAAD;;AAoCA,aAAOsF,UAAU,CAACrf,IAAX,KAAoBwf,MAA3B;AACH,KAhzKQ;;AAkzKT;AACR;AACA;AACA;AACA;AACA;AACA;AACQ1qB,IAAAA,WAAW,EAAE,qBAAUqD,IAAV,EAAgBgoB,QAAhB,EAA0BC,UAA1B,EAAsC;AAC/Cr2B,MAAAA,EAAE,CAAC6N,gBAAH,CAAoBO,IAApB,EAA0BgoB,QAA1B,EAAoCC,UAApC;;AACA,UAAIv2B,OAAO,CAACkQ,MAAZ,EAAoB;AAChB,aAAK3O,GAAL,CAASwM,gBAAT,CAA0BO,IAA1B,EAAgCgoB,QAAhC;AACH;AACJ,KA9zKQ;;AAg0KT;AACR;AACA;AACA;AACA;AACA;AACQlrB,IAAAA,cAAc,EAAE,wBAAUkD,IAAV,EAAgBgoB,QAAhB,EAA0B;AACtCp2B,MAAAA,EAAE,CAACs2B,mBAAH,CAAuBloB,IAAvB,EAA6BgoB,QAA7B;;AACA,UAAIt2B,OAAO,CAACkQ,MAAZ,EAAoB;AAChB,aAAK3O,GAAL,CAASi1B,mBAAT,CAA6BloB,IAA7B,EAAmCgoB,QAAnC;AACH;AACJ,KA30KQ;;AA60KT;AACR;AACA;AACA;AACA;AACA;AACQG,IAAAA,UAAU,EAAE,oBAAUC,SAAV,EAAqB;AAC7B,UAAMC,YAAY,GAAG32B,OAAO,CAAC22B,YAA7B;AACA,UAAMC,SAAS,GAAG52B,OAAO,CAAC62B,eAA1B;AACA,UAAIC,aAAa,GAAG,CAApB;AACA,UAAI,CAAC,CAACJ,SAAN,EAAiBI,aAAa,GAAG,KAAKC,aAAL,CAAmBL,SAAnB,EAA8BE,SAA9B,CAAhB;;AAEjB,WAAKI,aAAL;;AAEA,UAAIL,YAAY,GAAG,CAAnB,EAAsB;AAClB,YAAIM,IAAI,GAAG,KAAX;AACA,YAAMC,KAAK,GAAGv1B,SAAS,CAACw1B,YAAV,CAAuBP,SAAvB,CAAd;;AAEA,YAAIM,KAAK,GAAGP,YAAZ,EAA0B;AACtBM,UAAAA,IAAI,GAAG,IAAP;;AACA,cAAIH,aAAa,GAAG,CAApB,EAAuB;AACnB,iBAAKlnB,YAAL;;AACA,gBAAMO,KAAK,GAAG,KAAKC,QAAL,EAAd;AACA,gBAAMgC,MAAM,GAAGjC,KAAK,CAACgB,SAAN,GAAkB,CAAjC;AACA,gBAAM4hB,IAAI,GAAG,KAAKhjB,gBAAL,GAAwBgC,WAArC;AACA,gBAAMqlB,aAAa,GAAGjnB,KAAK,CAACgB,SAAN,IAAmB+lB,KAAK,GAAGP,YAA3B,CAAtB;AAEA,iBAAK5mB,gBAAL,GAAwBgC,WAAxB,GAAsCghB,IAAI,CAAC3b,KAAL,CAAW,CAAX,EAAcggB,aAAa,GAAG,CAAhB,GAAoB,CAApB,GAAwBA,aAAtC,IAAuDrE,IAAI,CAAC3b,KAAL,CAAWjH,KAAK,CAACgB,SAAjB,EAA4B4hB,IAAI,CAACrqB,MAAjC,CAA7F;AACA,iBAAKwI,QAAL,CAAcf,KAAK,CAACG,YAApB,EAAkC8B,MAAlC,EAA0CjC,KAAK,CAACG,YAAhD,EAA8D8B,MAA9D;AACH;AACJ,SAZD,MAYO,IAAK8kB,KAAK,GAAGJ,aAAT,GAA0BH,YAA9B,EAA4C;AAC/CM,UAAAA,IAAI,GAAG,IAAP;AACH;;AAED,YAAIA,IAAJ,EAAU;AACN,eAAKI,iBAAL;;AACA,cAAIP,aAAa,GAAG,CAApB,EAAuB,OAAO,KAAP;AAC1B;AACJ;;AAED,aAAO,IAAP;AACH,KAt3KQ;;AAw3KT;AACR;AACA;AACA;AACA;AACA;AACQhe,IAAAA,cAAc,EAAE,wBAAU3Y,OAAV,EAAmB02B,eAAnB,EAAoC;AAChD,UAAI72B,OAAO,CAAC22B,YAAZ,EAA0B;AACtB,YAAMC,SAAS,GAAGC,eAAe,IAAI72B,OAAO,CAAC62B,eAA7C;AACA,YAAMnuB,MAAM,GAAG,KAAKquB,aAAL,CAAoB,OAAO52B,OAAP,KAAmB,QAAnB,GAA8BA,OAA9B,GAAyC,KAAK8E,aAAL,IAAsB9E,OAAO,CAAC2R,QAAR,KAAqB,CAA5C,GAAiD3R,OAAO,CAACquB,SAAzD,GAAqEruB,OAAO,CAAC4R,WAAzI,EAAuJ6kB,SAAvJ,CAAf;;AACA,YAAIluB,MAAM,GAAG,CAAT,IAAcA,MAAM,GAAG/G,SAAS,CAACw1B,YAAV,CAAuBP,SAAvB,CAAT,GAA6C52B,OAAO,CAAC22B,YAAvE,EAAqF;AACjF,eAAKU,iBAAL;;AACA,iBAAO,KAAP;AACH;AACJ;;AACD,aAAO,IAAP;AACH,KAx4KQ;;AA04KT;AACR;AACA;AACA;AACA;AACA;AACA;AACQN,IAAAA,aAAa,EAAE,uBAAUO,OAAV,EAAmBT,eAAnB,EAAoC;AAC/C,aAAO,OAAOxoB,IAAP,CAAYwoB,eAAZ,IAA+Bn2B,IAAI,CAAC62B,aAAL,CAAmBD,OAAnB,CAA/B,GAA6DA,OAAO,CAAC5uB,MAA5E;AACH,KAn5KQ;;AAq5KT;AACR;AACA;AACQ8uB,IAAAA,sBAAsB,EAAE,kCAAY;AAChC52B,MAAAA,IAAI,CAACgK,cAAL;AAEA,UAAM6sB,cAAc,GAAGprB,KAAK,CAACqrB,qBAA7B;;AACA,UAAID,cAAJ,EAAoB;AAChB,YAAIjd,CAAC,GAAG,CAAR;;AACA,YAAI,CAAC5Z,IAAI,CAACsD,UAAL,IAAmBtD,IAAI,CAACqD,SAAzB,KAAuCjE,OAAO,CAAC23B,YAAR,KAAyB,MAApE,EAA4E;AACxEnd,UAAAA,CAAC,GAAG5a,OAAO,CAACO,OAAR,CAAgBoH,OAAhB,CAAwB4E,WAA5B;AACH,SAFD,MAEO;AACHqO,UAAAA,CAAC,GAAG5a,OAAO,CAACO,OAAR,CAAgBsL,OAAhB,CAAwBU,WAA5B;AACH;;AAED,YAAIyrB,eAAe,GAAG,SAAtB;;AACA,aAAK,IAAIpvB,CAAC,GAAG,CAAR,EAAWqB,GAAG,GAAG4tB,cAAc,CAAC/uB,MAArC,EAA6CF,CAAC,GAAGqB,GAAjD,EAAsDrB,CAAC,EAAvD,EAA2D;AACvD,cAAIgS,CAAC,GAAGid,cAAc,CAACjvB,CAAD,CAAtB,EAA2B;AACvBovB,YAAAA,eAAe,GAAGH,cAAc,CAACjvB,CAAD,CAAd,GAAoB,EAAtC;AACA;AACH;AACJ;;AAED,YAAI6D,KAAK,CAACwrB,sBAAN,KAAiCD,eAArC,EAAsD;AAClDvrB,UAAAA,KAAK,CAACwrB,sBAAN,GAA+BD,eAA/B;AACAj2B,UAAAA,SAAS,CAACm2B,iBAAV,CAA4BzrB,KAAK,CAACpM,kBAAN,CAAyB23B,eAAzB,CAA5B;AACH;AACJ;AACJ,KAj7KQ;;AAm7KT;AACR;AACA;AACA;AACQZ,IAAAA,aAAa,EAAE,yBAAY;AACvB,UAAIp3B,OAAO,CAACO,OAAR,CAAgB43B,WAApB,EAAiC;AAC7Bx3B,QAAAA,EAAE,CAACuZ,UAAH,CAAc,YAAY;AAAEla,UAAAA,OAAO,CAACO,OAAR,CAAgB43B,WAAhB,CAA4BhmB,WAA5B,GAA0CpQ,SAAS,CAACw1B,YAAV,CAAuBn3B,OAAO,CAAC62B,eAA/B,CAA1C;AAA4F,SAAxH;AACH;AACJ,KA37KQ;;AA67KT;AACR;AACA;AACA;AACQQ,IAAAA,iBAAiB,EAAE,6BAAY;AAC3B,UAAMW,WAAW,GAAGp4B,OAAO,CAACO,OAAR,CAAgB63B,WAApC;;AACA,UAAIA,WAAW,IAAI,CAACt3B,IAAI,CAACkN,QAAL,CAAcoqB,WAAd,EAA2B,UAA3B,CAApB,EAA4D;AACxDt3B,QAAAA,IAAI,CAACuL,QAAL,CAAc+rB,WAAd,EAA2B,UAA3B;;AACAz3B,QAAAA,EAAE,CAACuZ,UAAH,CAAc,YAAY;AACtBpZ,UAAAA,IAAI,CAAC4K,WAAL,CAAiB0sB,WAAjB,EAA8B,UAA9B;AACH,SAFD,EAEG,GAFH;AAGH;AACJ,KAz8KQ;;AA28KT;AACR;AACA;AACA;AACQC,IAAAA,gBAAgB,EAAE,4BAAY;AAC1B,WAAK,IAAIzvB,CAAC,GAAG,CAAR,EAAWqB,GAAG,GAAG,KAAK3E,qBAAL,CAA2BwD,MAAjD,EAAyDF,CAAC,GAAGqB,GAA7D,EAAkErB,CAAC,EAAnE,EAAuE;AACnE,aAAKtD,qBAAL,CAA2BsD,CAA3B;AACH;AACJ,KAn9KQ;;AAq9KT;AACR;AACA;AACA;AACQupB,IAAAA,gBAAgB,EAAE,4BAAY;AAC1B,WAAK,IAAIvpB,CAAC,GAAG,CAAR,EAAWqB,GAAG,GAAG,KAAK1E,qBAAL,CAA2BuD,MAAjD,EAAyDF,CAAC,GAAGqB,GAA7D,EAAkErB,CAAC,EAAnE,EAAuE;AACnE,aAAKrD,qBAAL,CAA2BqD,CAA3B;AACH;AACJ,KA79KQ;;AA+9KT;AACR;AACA;AACA;AACA;AACQimB,IAAAA,YAAY,EAAE,sBAAUhf,KAAV,EAAiB;AAC3B,UAAIzP,OAAO,CAACysB,gBAAZ,EAA8B;AAC1BzsB,QAAAA,OAAO,CAACysB,gBAAR,CAAyByL,MAAzB,GAAkCC,QAAlC,CAA2C1oB,KAA3C;AACH,OAFD,MAEO;AACH7P,QAAAA,OAAO,CAACO,OAAR,CAAgBqsB,IAAhB,CAAqB/c,KAArB,GAA6BA,KAA7B;AACH;AACJ,KA1+KQ;;AA4+KT;AACR;AACA;AACA;AACQ2d,IAAAA,YAAY,EAAE,wBAAY;AACtB,aAAOptB,OAAO,CAACysB,gBAAR,GAA2BzsB,OAAO,CAACysB,gBAAR,CAAyByL,MAAzB,GAAkCE,QAAlC,EAA3B,GAA0Ex4B,OAAO,CAACO,OAAR,CAAgBqsB,IAAhB,CAAqB/c,KAAtG;AACH,KAl/KQ;;AAo/KT;AACR;AACA;AACA;AACQwD,IAAAA,aAAa,EAAE,uBAAUolB,WAAV,EAAuB;AAClC,UAAM3yB,UAAU,GAAG,KAAKA,UAAxB;AACA,UAAMX,aAAa,GAAG,KAAKA,aAA3B;;AAEA,WAAK,IAAIuzB,GAAT,IAAgB5yB,UAAhB,EAA4B;AACxB,YAAI2yB,WAAW,CAACvqB,OAAZ,CAAoBwqB,GAApB,IAA2B,CAAC,CAA5B,IAAiC,CAAC53B,IAAI,CAAC63B,MAAL,CAAY7yB,UAAZ,EAAwB4yB,GAAxB,CAAtC,EAAoE;;AACpE,YAAIvzB,aAAa,CAAC+I,OAAd,CAAsBwqB,GAAtB,IAA6B,CAAC,CAAlC,EAAqC;AACjCx4B,UAAAA,OAAO,CAACw4B,GAAD,CAAP,CAAa7uB,MAAb,CAAoB0B,IAApB,CAAyB,IAAzB,EAA+B,IAA/B;AACH,SAFD,MAEO,IAAIzF,UAAU,CAAC8yB,OAAX,IAAsB,aAAanqB,IAAb,CAAkBiqB,GAAlB,CAA1B,EAAkD;AACrD,cAAI,CAAC53B,IAAI,CAAC+3B,mBAAL,CAAyB/yB,UAAU,CAAC8yB,OAApC,CAAL,EAAmD9yB,UAAU,CAAC8yB,OAAX,CAAmB9M,YAAnB,CAAgC,UAAhC,EAA4C,IAA5C;AACtD,SAFM,MAEA,IAAIhmB,UAAU,CAACgzB,MAAX,IAAqB,YAAYrqB,IAAZ,CAAiBiqB,GAAjB,CAAzB,EAAgD;AACnD,cAAI,CAAC53B,IAAI,CAAC+3B,mBAAL,CAAyB/yB,UAAU,CAACgzB,MAApC,CAAL,EAAkDhzB,UAAU,CAACgzB,MAAX,CAAkB9T,eAAlB,CAAkC,UAAlC;AACrD,SAFM,MAEA;AACHlkB,UAAAA,IAAI,CAAC4K,WAAL,CAAiB5F,UAAU,CAAC4yB,GAAD,CAA3B,EAAkC,QAAlC;AACH;AACJ;AACJ,KAxgLQ;;AA0gLT;AACR;AACA;AACA;AACA;AACA;AACQK,IAAAA,KAAK,EAAE,eAAUC,MAAV,EAAkBC,SAAlB,EAA6B;AAChC,UAAM/V,OAAO,GAAGviB,EAAE,CAAC4F,MAAnB;AACA,WAAK3E,GAAL,GAAWxB,OAAO,CAACkQ,MAAR,GAAiBtQ,OAAO,CAACO,OAAR,CAAgB4G,YAAhB,CAA6B+pB,aAA9C,GAA8DvwB,EAAzE;AACA,WAAKgB,GAAL,GAAWrB,EAAX;AACA,WAAK+E,aAAL,GAAqBjF,OAAO,CAAC62B,eAAR,KAA4B,WAAjD;AACA,WAAKj1B,eAAL,GAAuBrB,EAAE,CAACu4B,gBAAH,CAAoBl5B,OAAO,CAACO,OAAR,CAAgB8P,OAApC,CAAvB;AACA,WAAKhP,aAAL,GAAqBrB,OAAO,CAACO,OAAR,CAAgB4G,YAAhB,CAA6BkG,YAAlD;AACA,WAAK/L,oBAAL,GAA4BR,IAAI,CAACoG,SAAL,CAAe,KAAKlF,eAAL,CAAqBm3B,gBAArB,CAAsC,aAAtC,CAAf,IAAuEr4B,IAAI,CAACoG,SAAL,CAAe,KAAKlF,eAAL,CAAqBm3B,gBAArB,CAAsC,gBAAtC,CAAf,CAAnG;;AAEA,UAAI,CAAC/4B,OAAO,CAACkQ,MAAT,IAAmB,OAAO3P,EAAE,CAACy4B,UAAV,KAAyB,UAAhD,EAA4D;AACxD,YAAIzS,KAAK,GAAG3mB,OAAO,CAACO,OAAR,CAAgB4G,YAA5B;;AACA,eAAOwf,KAAP,EAAc;AACV,cAAIA,KAAK,CAAC0S,UAAV,EAAsB;AAClB,iBAAKx3B,WAAL,GAAmB8kB,KAAK,CAAC0S,UAAzB;AACA;AACH,WAHD,MAGO,IAAI1S,KAAK,YAAYhmB,EAAE,CAACy4B,UAAxB,EAAoC;AACvC,iBAAKv3B,WAAL,GAAmB8kB,KAAnB;AACA;AACH;;AACDA,UAAAA,KAAK,GAAGA,KAAK,CAAC7Q,UAAd;AACH;;AACD,YAAI,KAAKjU,WAAT,EAAsB,KAAKC,gCAAL,GAAwC,EAAxC;AACzB,OAtB+B,CAwBhC;;;AACA,UAAMw3B,gBAAgB,GAAG34B,EAAE,CAAC44B,MAAH,CAAUC,IAAV,CAAep5B,OAAO,CAACsmB,YAAvB,CAAzB;;AACA,UAAM+S,aAAa,GAAG,CAACr5B,OAAO,CAACs5B,gBAAT,GAA4B,EAA5B,GAAiCt5B,OAAO,CAACs5B,gBAAR,CAAyBnL,KAAzB,CAA+B,GAA/B,EAAoCoL,MAApC,CAA2C,UAAUlV,CAAV,EAAa;AAAE,eAAO,oBAAoBhW,IAApB,CAAyBgW,CAAzB,CAAP;AAAqC,OAA/F,CAAvD;;AACA,WAAK,IAAI7b,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG6wB,aAAa,CAAC3wB,MAAlC,EAA0CF,CAAC,EAA3C,EAA+C;AAC3C0wB,QAAAA,gBAAgB,CAACvhB,MAAjB,CAAwBuhB,gBAAgB,CAACprB,OAAjB,CAAyBurB,aAAa,CAAC7wB,CAAD,CAAb,CAAiBmR,WAAjB,EAAzB,CAAxB,EAAkF,CAAlF;AACH;;AACD,WAAKxW,yBAAL,GAAiC+1B,gBAAgB,CAACxwB,MAAjB,KAA4B,CAA5B,GAAgC,IAAhC,GAAuC,IAAIoa,OAAJ,CAAY,aAAaoW,gBAAgB,CAACvF,IAAjB,CAAsB,GAAtB,CAAb,GAA0C,6BAAtD,EAAqF,IAArF,CAAxE,CA9BgC,CAgChC;;AACA,UAAM6F,UAAU,GAAG,SAAbA,UAAa,CAAUC,GAAV,EAAeC,IAAf,EAAqB;AAAE,eAAO,CAACD,GAAD,GAAO,GAAP,GAAcA,GAAG,KAAK,GAAR,GAAc,SAAd,GAA2B,CAACC,IAAD,GAAQD,GAAR,GAAeA,GAAG,GAAG,GAAN,GAAYC,IAA3E;AAAqF,OAA/H,CAjCgC,CAkChC;;;AACA,UAAMC,WAAW,GAAG,kGAApB;AACA,UAAMC,QAAQ,GAAG,gKAAjB;AACA,WAAK5G,kBAAL,GAA0BhzB,OAAO,CAAC65B,oBAAR,CAA6B/rB,OAA7B,CAAqC,IAArC,IAA6C,CAAC,CAA9C,IAAmD9N,OAAO,CAAC65B,oBAAR,KAAiC,GAA9G,CArCgC,CAsChC;;AACA,WAAK52B,yBAAL,GAAiC,IAAI6f,OAAJ,CAAY,OAAO0W,UAAU,CAACx5B,OAAO,CAAC65B,oBAAR,CAA6BrW,OAA7B,CAAqC,KAArC,EAA4C,EAA5C,CAAD,EAAkD,EAAlD,CAAjB,GAAyE,IAArF,EAA2F,GAA3F,CAAjC;AACA,WAAKtgB,yBAAL,GAAiC,IAAI4f,OAAJ,CAAY,QAAQ9iB,OAAO,CAAC85B,aAAR,IAAyB,GAAjC,IAAwC,IAApD,EAA0D,GAA1D,CAAjC,CAxCgC,CAyChC;;AACA,WAAK12B,yBAAL,GAAiC1C,IAAI,CAAC20B,mBAAL,CAAyBmE,UAAU,CAACx5B,OAAO,CAAC65B,oBAAR,CAA6BrW,OAA7B,CAAqC,KAArC,EAA4C,WAA5C,CAAD,EAA2D,EAA3D,CAAnC,CAAjC;AACA,WAAKngB,yBAAL,GAAiC3C,IAAI,CAAC40B,mBAAL,CAAyBt1B,OAAO,CAAC85B,aAAR,CAAsBtW,OAAtB,CAA8B,KAA9B,EAAqC,WAArC,CAAzB,CAAjC,CA3CgC,CA4ChC;;AACA,WAAKlgB,wBAAL,GAAgC5C,IAAI,CAAC20B,mBAAL,CAAyBmE,UAAU,CAACx5B,OAAO,CAAC+5B,kBAAT,EAA6B,EAA7B,CAAnC,CAAhC;AACA,WAAKx2B,wBAAL,GAAgC7C,IAAI,CAAC40B,mBAAL,CAAyBt1B,OAAO,CAACg6B,kBAAjC,CAAhC,CA9CgC,CA+ChC;;AACA,UAAMC,SAAS,GAAG,wBAAlB;AACA,UAAMC,MAAM,GAAGl6B,OAAO,CAACm6B,mBAAvB;AACA,UAAIC,QAAQ,GAAG,EAAf;AACA,UAAIC,OAAO,GAAG,EAAd;;AACA,UAAI,CAAC,CAACH,MAAN,EAAc;AACV,aAAK,IAAIrX,CAAT,IAAcqX,MAAd,EAAsB;AAClB,cAAI,CAACx5B,IAAI,CAAC63B,MAAL,CAAY2B,MAAZ,EAAoBrX,CAApB,CAAD,IAA2B,cAAcxU,IAAd,CAAmB6rB,MAAM,CAACrX,CAAD,CAAzB,CAA/B,EAA8D;;AAC9D,cAAIA,CAAC,KAAK,KAAV,EAAiB;AACbwX,YAAAA,OAAO,GAAGb,UAAU,CAACU,MAAM,CAACrX,CAAD,CAAP,EAAY8W,WAAZ,CAApB;AACH,WAFD,MAEO;AACHS,YAAAA,QAAQ,CAACvX,CAAD,CAAR,GAAc,IAAIC,OAAJ,CAAY,WAAW0W,UAAU,CAACU,MAAM,CAACrX,CAAD,CAAP,EAAY,EAAZ,CAArB,GAAuC,GAAvC,GAA6CoX,SAAzD,EAAoE,IAApE,CAAd;AACH;AACJ;AACJ;;AAED,WAAKt2B,0BAAL,GAAkC,IAAImf,OAAJ,CAAY,YAAYuX,OAAO,IAAIV,WAAW,GAAG,GAAd,GAAoBC,QAA3C,IAAuD,GAAvD,GAA6DK,SAAzE,EAAoF,IAApF,CAAlC;AACA,WAAKr2B,mCAAL,GAA2C,IAAIkf,OAAJ,CAAY,YAAY,CAACuX,OAAO,IAAIV,WAAZ,IAA2B,oBAAvC,IAA+D,GAA/D,GAAqEM,SAAjF,EAA4F,IAA5F,CAA3C;AACA,WAAKn2B,wBAAL,GAAgCs2B,QAAhC,CAjEgC,CAmEhC;;AACA,UAAME,MAAM,GAAGt6B,OAAO,CAACu6B,mBAAvB;AACAH,MAAAA,QAAQ,GAAG,EAAX;AACAC,MAAAA,OAAO,GAAG,EAAV;;AACA,UAAI,CAAC,CAACC,MAAN,EAAc;AACV,aAAK,IAAIzX,EAAT,IAAcyX,MAAd,EAAsB;AAClB,cAAI,CAAC55B,IAAI,CAAC63B,MAAL,CAAY+B,MAAZ,EAAoBzX,EAApB,CAAL,EAA6B;;AAC7B,cAAIA,EAAC,KAAK,KAAV,EAAiB;AACbwX,YAAAA,OAAO,GAAGb,UAAU,CAACc,MAAM,CAACzX,EAAD,CAAP,EAAY,EAAZ,CAApB;AACH,WAFD,MAEO;AACHuX,YAAAA,QAAQ,CAACvX,EAAD,CAAR,GAAc,IAAIC,OAAJ,CAAY,WAAW0W,UAAU,CAACc,MAAM,CAACzX,EAAD,CAAP,EAAY,EAAZ,CAArB,GAAuC,GAAvC,GAA6CoX,SAAzD,EAAoE,IAApE,CAAd;AACH;AACJ;AACJ;;AAED,WAAKp2B,0BAAL,GAAkC,IAAIif,OAAJ,CAAY,YAAYuX,OAAO,IAAI,GAAvB,IAA8B,GAA9B,GAAoCJ,SAAhD,EAA2D,IAA3D,CAAlC;AACA,WAAKl2B,wBAAL,GAAgCq2B,QAAhC,CAnFgC,CAqFhC;;AACA,WAAKn2B,SAAL,GAAiB,UAAUoK,IAAV,CAAerO,OAAO,CAAC0sB,IAAvB,CAAjB;AACA,WAAKxoB,UAAL,GAAkB,0BAA0BmK,IAA1B,CAA+BrO,OAAO,CAAC0sB,IAAvC,CAAlB;AACA,WAAKvoB,gBAAL,GAAwB,kBAAkBkK,IAAlB,CAAuBrO,OAAO,CAAC0sB,IAA/B,CAAxB,CAxFgC,CA0FhC;;AACA,WAAK8N,eAAL,GA3FgC,CA6FhC;;;AACA,WAAKt1B,qBAAL,GAA6B,EAA7B;AACA,WAAKC,qBAAL,GAA6B,EAA7B,CA/FgC,CAiGhC;;AACA,WAAKH,eAAL,GAAuB;AAAEgwB,QAAAA,KAAK,EAAE,EAAT;AAAaG,QAAAA,GAAG,EAAE;AAAlB,OAAvB;AACA,UAAMsF,YAAY,GAAG,EAArB,CAnGgC,CAqGhC;;AACA,WAAK11B,aAAL,GAAqB,EAArB;AACA,WAAKK,YAAL,CAAkBC,IAAlB,GAAyB,EAAzB;AACA,WAAKD,YAAL,CAAkBK,SAAlB,GAA8B,EAA9B;AAEA,UAAIi1B,gBAAgB,GAAG,EAAvB;AACA,UAAI7gB,MAAJ,EAAYhR,MAAZ;;AACA,WAAK,IAAIyvB,GAAT,IAAgBx4B,OAAhB,EAAyB;AACrB,YAAI,CAACY,IAAI,CAAC63B,MAAL,CAAYz4B,OAAZ,EAAqBw4B,GAArB,CAAL,EAAgC;AAChCze,QAAAA,MAAM,GAAG/Z,OAAO,CAACw4B,GAAD,CAAhB;AACAzvB,QAAAA,MAAM,GAAGhJ,iBAAiB,CAACy4B,GAAD,CAA1B;;AACA,YAAI,CAACze,MAAM,CAACpQ,MAAP,IAAiBoQ,MAAM,CAAC6Q,MAAzB,KAAoC7hB,MAAxC,EAAgD;AAC5C,eAAKK,UAAL,CAAgBovB,GAAhB,EAAqB,IAArB,EAA2BzvB,MAA3B;AACH;;AACD,YAAI,OAAOgR,MAAM,CAAC8gB,aAAd,KAAgC,UAAhC,IAA8C,OAAO9gB,MAAM,CAAC+gB,aAAd,KAAgC,UAAlF,EAA8F;AAC1F,eAAK1xB,UAAL,CAAgBovB,GAAhB,EAAqB,IAArB,EAA2BzvB,MAA3B;;AACA,eAAK3D,qBAAL,CAA2BwE,IAA3B,CAAgCmQ,MAAM,CAAC8gB,aAAP,CAAqB3vB,IAArB,CAA0B,IAA1B,CAAhC;;AACA,eAAK7F,qBAAL,CAA2BuE,IAA3B,CAAgCmQ,MAAM,CAAC+gB,aAAP,CAAqB5vB,IAArB,CAA0B,IAA1B,CAAhC;AACH;;AACD,YAAIzK,EAAE,CAACs1B,KAAH,CAASgF,OAAT,CAAiBhhB,MAAM,CAACihB,QAAxB,CAAJ,EAAuC;AACnC,cAAMA,QAAQ,GAAGjhB,MAAM,CAACihB,QAAxB;AACA,eAAK5xB,UAAL,CAAgBovB,GAAhB,EAAqB,IAArB,EAA2BzvB,MAA3B;AACA,eAAKzD,YAAL,CAAkBC,IAAlB,GAAyB,KAAKD,YAAL,CAAkBC,IAAlB,CAAuBqjB,MAAvB,CAA8BoS,QAA9B,CAAzB;AACAJ,UAAAA,gBAAgB,CAAChxB,IAAjB,CAAsB4uB,GAAtB;;AACA,eAAK,IAAIpC,GAAG,GAAG,CAAV,EAAapD,IAAI,GAAGgI,QAAQ,CAACpyB,MAAlC,EAA0CwtB,GAAG,GAAGpD,IAAhD,EAAsDoD,GAAG,EAAzD,EAA6D;AACzD,iBAAK9wB,YAAL,CAAkBK,SAAlB,CAA4Bq1B,QAAQ,CAAC5E,GAAD,CAAR,CAAcvc,WAAd,EAA5B,IAA2D2e,GAA3D;AACH;AACJ;;AACD,YAAIze,MAAM,CAACkhB,WAAX,EAAwB;AACpB,cAAMnQ,IAAI,GAAG/Q,MAAM,CAACkhB,WAAP,EAAb;AACAN,UAAAA,YAAY,CAAC/wB,IAAb,CAAkB,MAAMkhB,IAAI,CAAClR,SAA7B;AACA,eAAK1U,eAAL,CAAqBmwB,GAArB,CAAyBvK,IAAI,CAAClR,SAA9B,IAA2CkR,IAAI,CAACoQ,MAAL,CAAYhwB,IAAZ,CAAiB,IAAjB,CAA3C;AACH;AACJ;;AAED,WAAKhG,eAAL,CAAqBgwB,KAArB,GAA6ByF,YAAY,CAACzG,QAAb,EAA7B;AACA,WAAK5uB,YAAL,CAAkBG,WAAlB,GAAgC,KAAKH,YAAL,CAAkBC,IAAlB,CAAuBsuB,IAAvB,CAA4B,GAA5B,CAAhC;AACA,WAAKvuB,YAAL,CAAkBE,MAAlB,GAA2B,IAAIwd,OAAJ,CAAY,QAAS,KAAK1d,YAAL,CAAkBC,IAAlB,CAAuBsuB,IAAvB,CAA4B,GAA5B,KAAoC,GAA7C,IAAoD,IAAhE,EAAsE,GAAtE,CAA3B;AACA,WAAKvuB,YAAL,CAAkBI,YAAlB,GAAiC,IAAIsd,OAAJ,CAAY,QAAS4X,gBAAgB,CAAChyB,MAAjB,KAA4B,CAA5B,GAAgC,GAAhC,GAAsCgyB,gBAAgB,CAAC/G,IAAjB,CAAsB,GAAtB,CAA/C,IAA6E,IAAzF,EAA+F,GAA/F,CAAjC,CA3IgC,CA6IhC;;AACA,WAAKttB,SAAL,CAAeiB,cAAf,GAAgC1H,OAAO,CAACO,OAAR,CAAgBoH,OAAhB,CAAwBP,KAAxB,CAA8BQ,OAA9D;AACA,WAAKyzB,YAAL,GAAoBr7B,OAAO,CAACO,OAAR,CAAgB+6B,WAApC;AACA,WAAKv2B,YAAL,GAAoB/E,OAAO,CAACO,OAAR,CAAgBg7B,WAApC;AACA,WAAKv2B,kBAAL,GAA0B,KAAKD,YAAL,CAAkB+G,aAAlB,CAAgC,QAAhC,CAA1B,CAjJgC,CAmJhC;;AACA,WAAK5J,OAAL,GAAerC,QAAQ,CAAC,IAAD,EAAO,KAAK27B,sBAAL,CAA4BpwB,IAA5B,CAAiC,IAAjC,CAAP,CAAvB,CApJgC,CAsJhC;;AACA,WAAKrB,SAAL,CAAe,CAAChK,OAAD,CAAf,EAvJgC,CAyJhC;;AACA,UAAIK,OAAO,CAACkQ,MAAZ,EAAoB;AAChB,aAAK3O,GAAL,GAAW3B,OAAO,CAACO,OAAR,CAAgB4G,YAAhB,CAA6Bs0B,eAAxC;AACAz7B,QAAAA,OAAO,CAACO,OAAR,CAAgB8P,OAAhB,GAA0B,KAAK1O,GAAL,CAASssB,IAAnC;AACA,YAAI7tB,OAAO,CAACs7B,aAAR,CAAsBC,MAA1B,EAAkC37B,OAAO,CAACO,OAAR,CAAgB8P,OAAhB,CAAwBjJ,KAAxB,CAA8BQ,OAA9B,GAAwCxH,OAAO,CAACs7B,aAAR,CAAsBC,MAA9D;AAClC,YAAIv7B,OAAO,CAACgM,MAAR,KAAmB,MAAvB,EAA+B,KAAKwvB,WAAL,GAAmB,KAAKj6B,GAAL,CAASssB,IAA5B;AAClC;;AAED,WAAK4N,gBAAL,CAAsB7C,MAAtB,EAA8BC,SAA9B;AACH,KAlrLQ;;AAorLT;AACR;AACA;AACA;AACQ2B,IAAAA,eAAe,EAAE,2BAAY;AACzB,WAAK13B,uBAAL,GAA+BlD,OAAO,CAACO,OAAR,CAAgBmI,WAAhB,CAA4BC,gBAA5B,CAA6C,oGAA7C,CAA/B;AACA,WAAKxF,uBAAL,GAA+BnD,OAAO,CAACO,OAAR,CAAgBmI,WAAhB,CAA4BC,gBAA5B,CAA6C,mGAA7C,CAA/B;;AAEA,WAAKJ,iBAAL;;AAEA,UAAMc,IAAI,GAAGrJ,OAAO,CAACqJ,IAArB;AACA,WAAKvD,UAAL,GAAkB;AACd8yB,QAAAA,OAAO,EAAEvvB,IAAI,CAACooB,OADA;AAEdqH,QAAAA,MAAM,EAAEzvB,IAAI,CAAC8hB;AAFC,OAAlB;AAIA,WAAKrlB,UAAL,CAAgB1F,OAAO,CAAC07B,QAAR,CAAiB/U,IAAjB,CAAsBgV,WAAtB,EAAhB,IAAuD1yB,IAAI,CAAC0d,IAA5D;AACA,WAAKjhB,UAAL,CAAgB1F,OAAO,CAAC07B,QAAR,CAAiBE,SAAjB,CAA2BD,WAA3B,EAAhB,IAA4D1yB,IAAI,CAAC2yB,SAAjE;AACA,WAAKl2B,UAAL,CAAgB1F,OAAO,CAAC07B,QAAR,CAAiB7U,MAAjB,CAAwB8U,WAAxB,EAAhB,IAAyD1yB,IAAI,CAAC4d,MAA9D;AACA,WAAKnhB,UAAL,CAAgB1F,OAAO,CAAC07B,QAAR,CAAiBG,MAAjB,CAAwBF,WAAxB,EAAhB,IAAyD1yB,IAAI,CAAC4yB,MAA9D;AACA,WAAKn2B,UAAL,CAAgB1F,OAAO,CAAC07B,QAAR,CAAiBI,GAAjB,CAAqBH,WAArB,EAAhB,IAAsD1yB,IAAI,CAAC8yB,SAA3D;AACA,WAAKr2B,UAAL,CAAgB1F,OAAO,CAAC07B,QAAR,CAAiBM,GAAjB,CAAqBL,WAArB,EAAhB,IAAsD1yB,IAAI,CAACgzB,WAA3D;AAEA,WAAKj2B,gBAAL,GAAwB;AACpBwpB,QAAAA,UAAU,EAAEvmB,IAAI,CAACumB,UADG;AAEpBpD,QAAAA,UAAU,EAAEnjB,IAAI,CAACmjB,UAFG;AAGpBS,QAAAA,QAAQ,EAAE5jB,IAAI,CAAC4jB;AAHK,OAAxB;AAKH,KA/sLQ;;AAitLT;AACR;AACA;AACA;AACA;AACA;AACQ4O,IAAAA,gBAAgB,EAAE,0BAAU7C,MAAV,EAAkBC,SAAlB,EAA6B;AAC3Cj5B,MAAAA,OAAO,CAACO,OAAR,CAAgB8P,OAAhB,CAAwBsE,SAAxB,GAAoCqkB,MAAM,GAAGC,SAAH,GAAe,KAAK/K,wBAAL,CAA8B,OAAO+K,SAAP,KAAqB,QAArB,GAAgCA,SAAhC,GAA4Cj5B,OAAO,CAACO,OAAR,CAAgBC,aAAhB,CAA8BqP,KAAxG,CAAzD;AACH,KAztLQ;;AA2tLT;AACR;AACA;AACA;AACQ4c,IAAAA,qBAAqB,EAAE,iCAAY;AAC/B,WAAKiD,iBAAL;;AACA,WAAKpC,iBAAL;AACH,KAluLQ;;AAouLT;AACR;AACA;AACA;AACQkO,IAAAA,sBAAsB,EAAE,kCAAY;AAChC,UAAI,KAAK53B,QAAT,EAAmB6I,KAAK,CAAC+E,gBAAN;AACnB,WAAK/K,SAAL,CAAeC,SAAf,GAA2B,IAA3B;AACA,UAAI1G,OAAO,CAACqJ,IAAR,CAAawiB,IAAjB,EAAuB7rB,OAAO,CAACqJ,IAAR,CAAawiB,IAAb,CAAkB7G,eAAlB,CAAkC,UAAlC,EAHS,CAIhC;;AACA,UAAIjjB,SAAS,CAACu6B,QAAd,EAAwBv6B,SAAS,CAACu6B,QAAV,CAAmB,KAAK1Q,WAAL,CAAiB,IAAjB,CAAnB,EAA2C,IAA3C;AACxB,UAAI5rB,OAAO,CAACO,OAAR,CAAgBsL,OAAhB,CAAwBzE,KAAxB,CAA8BqE,OAA9B,KAA0C,OAA9C,EAAuDgB,KAAK,CAACie,mBAAN;AAC1D,KA/uLQ;;AAivLT;AACR;AACA;AACA;AACQgF,IAAAA,iBAAiB,EAAE,6BAAY;AAC3B,UAAI,KAAKkM,WAAT,EAAsB;AAClBj7B,QAAAA,EAAE,CAACuZ,UAAH,CAAc,YAAY;AACtB,cAAMma,CAAC,GAAGrzB,IAAI,CAAC46B,WAAL,CAAiBvuB,YAA3B;AACArN,UAAAA,OAAO,CAACO,OAAR,CAAgB4G,YAAhB,CAA6BC,KAA7B,CAAmCgF,MAAnC,GAA4CioB,CAAC,GAAG,IAAhD;AACA,cAAIvzB,IAAI,CAACy7B,IAAT,EAAev7B,IAAI,CAACw7B,oBAAL,CAA0BnI,CAA1B,EAA6B,IAA7B;AAClB,SAJD;AAKH,OAND,MAMO,IAAIvzB,IAAI,CAACy7B,IAAT,EAAe;AAClBv7B,QAAAA,IAAI,CAACw7B,oBAAL,CAA0Bx8B,OAAO,CAACO,OAAR,CAAgB4G,YAAhB,CAA6BkG,YAAvD,EAAqE,IAArE;AACH;AACJ,KA/vLQ;AAiwLTmvB,IAAAA,oBAAoB,EAAE,8BAAUnI,CAAV,EAAaoI,mBAAb,EAAkC;AACpDpI,MAAAA,CAAC,GAAGA,CAAC,KAAK,CAAC,CAAP,GAAYoI,mBAAmB,CAACC,aAApB,GAAoCD,mBAAmB,CAACC,aAApB,CAAkC,CAAlC,EAAqCC,SAAzE,GAAsFF,mBAAmB,CAACG,WAApB,CAAgCxwB,MAAhC,GAAyC,KAAK9K,oBAAhJ,GAAyK+yB,CAA7K;;AACA,UAAI,KAAKhzB,aAAL,KAAuBgzB,CAA3B,EAA8B;AAC1B,YAAI,OAAOtyB,SAAS,CAAC86B,cAAjB,KAAoC,UAAxC,EAAoD96B,SAAS,CAAC86B,cAAV,CAAyBxI,CAAzB,EAA4B,KAAKhzB,aAAjC,EAAgDL,IAAhD,EAAsDy7B,mBAAtD;AACpD,aAAKp7B,aAAL,GAAqBgzB,CAArB;AACH;AACJ,KAvwLQ;;AAywLT;AACR;AACA;AACA;AACQ/G,IAAAA,iBAAiB,EAAE,6BAAY;AAC3B,UAAI,KAAK+N,YAAT,EAAuB;AACnB,YAAI,KAAK50B,SAAL,CAAeE,UAAnB,EAA+B;AAC3B,eAAK00B,YAAL,CAAkBj0B,KAAlB,CAAwBqE,OAAxB,GAAkC,MAAlC;AACA;AACH;;AAED,YAAM4E,OAAO,GAAGrQ,OAAO,CAACO,OAAR,CAAgB8P,OAAhC;;AACA,YAAI,CAACvP,IAAI,CAAC8Y,kBAAL,CAAwBvJ,OAAO,CAAC8B,WAAhC,CAAD,IAAiD9B,OAAO,CAACvE,aAAR,CAAsBhL,IAAI,CAACg8B,qBAA3B,CAAjD,IAAsG,CAACzsB,OAAO,CAAC0sB,SAAR,CAAkBhZ,KAAlB,CAAwB,KAAxB,KAAkC,EAAnC,EAAuCjb,MAAvC,GAAgD,CAA1J,EAA6J;AACzJ,eAAKuyB,YAAL,CAAkBj0B,KAAlB,CAAwBqE,OAAxB,GAAkC,MAAlC;AACH,SAFD,MAEO;AACH,eAAK4vB,YAAL,CAAkBj0B,KAAlB,CAAwBqE,OAAxB,GAAkC,OAAlC;AACH;AACJ;AACJ,KA3xLQ;;AA6xLT;AACR;AACA;AACA;AACA;AACA;AACQuxB,IAAAA,iBAAiB,EAAE,2BAAUC,UAAV,EAAsB;AACrC,UAAI,KAAKz3B,YAAL,CAAkBI,YAAlB,CAA+B6I,IAA/B,CAAoC,KAAK1L,qBAAzC,CAAJ,EAAqE;AAErE,UAAMwN,KAAK,GAAG,KAAKC,QAAL,EAAd;AACA,UAAMgG,SAAS,GAAGjG,KAAK,CAACM,uBAAxB;AACA,UAAMwB,QAAQ,GAAG9B,KAAK,CAACE,cAAvB;AACA,UAAM+P,OAAO,GAAG1f,IAAI,CAAC8U,qBAAL,CAA2BY,SAA3B,EAAsC,IAAtC,CAAhB;AACA,UAAI/C,SAAJ,EAAetE,MAAf,EAAuB3I,MAAvB;AAEA,UAAM02B,aAAa,GAAGp8B,IAAI,CAACoP,gBAAL,CAAsBsG,SAAtB,EAAiC1V,IAAI,CAACmQ,WAAtC,CAAtB;;AACA,UAAIisB,aAAa,IAAI,CAACp8B,IAAI,CAACoW,OAAL,CAAagmB,aAAb,CAAtB,EAAmD;AAC/C;AACH,OAFD,MAEO,IAAI1mB,SAAS,CAACtE,QAAV,KAAuB,CAAvB,IAA4BsE,SAAS,CAACzN,YAAV,CAAuB,eAAvB,MAA4C,MAA5E,EAAoF;AACvF,YAAIwB,EAAE,GAAGiM,SAAS,CAAC5B,kBAAnB;AACA,YAAI,CAAC9T,IAAI,CAACkQ,eAAL,CAAqBzG,EAArB,CAAL,EAA+BA,EAAE,GAAG,KAAKkO,eAAL,CAAqBjC,SAArB,EAAgCpW,OAAO,CAAC+Q,UAAxC,CAAL;AAC/B,aAAKG,QAAL,CAAc/G,EAAE,CAACuK,UAAjB,EAA6B,CAA7B,EAAgCvK,EAAE,CAACuK,UAAnC,EAA+C,CAA/C;AACA;AACH;;AAED,UAAI,CAAChU,IAAI,CAAC6V,oBAAL,CAA0BtE,QAA1B,KAAuCvR,IAAI,CAAC6P,YAAL,CAAkB0B,QAAlB,CAAxC,MAAyEvR,IAAI,CAACmQ,WAAL,CAAiBoB,QAAQ,CAACvB,QAAT,CAAkBP,KAAK,CAACQ,WAAxB,CAAjB,KAA0DjQ,IAAI,CAACmQ,WAAL,CAAiBoB,QAAQ,CAACvB,QAAT,CAAkBP,KAAK,CAACQ,WAAN,GAAoB,CAAtC,CAAjB,CAAnI,CAAJ,EAAoM;AACpM,UAAIjQ,IAAI,CAACoP,gBAAL,CAAsBsG,SAAtB,EAAiC1V,IAAI,CAACq8B,iBAAtC,CAAJ,EAA8D,OAAO,IAAP;;AAE9D,UAAI3c,OAAJ,EAAa;AACTha,QAAAA,MAAM,GAAG1F,IAAI,CAACoQ,aAAL,CAAmB+rB,UAAU,IAAI78B,OAAO,CAAC+Q,UAAzC,CAAT;AACA3K,QAAAA,MAAM,CAACmO,SAAP,GAAmB6L,OAAO,CAAC7L,SAA3B;AACA,YAAInO,MAAM,CAACyL,UAAP,CAAkBnJ,MAAlB,KAA6B,CAAjC,EAAoCtC,MAAM,CAACmO,SAAP,GAAmB7T,IAAI,CAACmV,cAAxB;AAEpCuK,QAAAA,OAAO,CAAC7L,SAAR,GAAoBnO,MAAM,CAACooB,SAA3B;AACApoB,QAAAA,MAAM,GAAGga,OAAO,CAAC1L,UAAjB;AACArB,QAAAA,SAAS,GAAG3S,IAAI,CAAC+Y,iBAAL,CAAuBrT,MAAvB,EAA+B,IAA/B,EAAqCoN,EAAjD;;AAEA,YAAI,CAACH,SAAL,EAAgB;AACZA,UAAAA,SAAS,GAAG3S,IAAI,CAACkV,cAAL,CAAoBlV,IAAI,CAACmV,cAAzB,CAAZ;AACAzP,UAAAA,MAAM,CAAC6K,YAAP,CAAoBoC,SAApB,EAA+BjN,MAAM,CAACsO,UAAtC;AACH;;AAED3F,QAAAA,MAAM,GAAGsE,SAAS,CAACtB,WAAV,CAAsBrJ,MAA/B;AACA,aAAKwI,QAAL,CAAcmC,SAAd,EAAyBtE,MAAzB,EAAiCsE,SAAjC,EAA4CtE,MAA5C;AACA;AACH;;AAED,UAAGrO,IAAI,CAAC6V,oBAAL,CAA0BH,SAA1B,KAAyCA,SAAS,CAACvE,UAAV,CAAqBnJ,MAArB,IAA+B,CAA3E,EAA+E;AAC3E,YAAIsI,EAAE,GAAG,IAAT;;AACA,YAAIoF,SAAS,CAACvE,UAAV,CAAqBnJ,MAArB,KAAgC,CAAhC,IAAqChI,IAAI,CAAC0U,OAAL,CAAagB,SAAS,CAAC1B,UAAvB,CAAzC,EAA6E;AACzE1D,UAAAA,EAAE,GAAGoF,SAAS,CAAC1B,UAAf;AACH,SAFD,MAEO;AACH1D,UAAAA,EAAE,GAAGtQ,IAAI,CAACkV,cAAL,CAAoBlV,IAAI,CAACmV,cAAzB,CAAL;AACAO,UAAAA,SAAS,CAAC1L,WAAV,CAAsBsG,EAAtB;AACH;;AAED,aAAKE,QAAL,CAAcF,EAAd,EAAkB,CAAlB,EAAqBA,EAArB,EAAyB,CAAzB;AACA;AACH;;AAED,WAAKzB,WAAL,CAAiB,aAAjB,EAAgC,KAAhC,EAAwCstB,UAAU,IAAI78B,OAAO,CAAC+Q,UAA9D;AACAsC,MAAAA,SAAS,GAAG3S,IAAI,CAAC+Y,iBAAL,CAAuBrD,SAAvB,EAAkCA,SAAlC,CAAZ;AACA/C,MAAAA,SAAS,GAAGA,SAAS,GAAGA,SAAS,CAACK,EAAb,GAAkB0C,SAAvC;AAEAhQ,MAAAA,MAAM,GAAG1F,IAAI,CAAC6U,gBAAL,CAAsBlC,SAAtB,EAAiC,IAAjC,CAAT;;AACA,UAAI,CAACjN,MAAL,EAAa;AACT,aAAK4M,WAAL;;AACA,aAAKpD,YAAL;;AACA;AACH;;AAED,UAAIlP,IAAI,CAAC0U,OAAL,CAAahP,MAAM,CAACkP,WAApB,CAAJ,EAAsC5U,IAAI,CAACsV,UAAL,CAAgB5P,MAAM,CAACkP,WAAvB;AACtC,UAAI5U,IAAI,CAAC0U,OAAL,CAAahP,MAAM,CAAC2P,eAApB,CAAJ,EAA0CrV,IAAI,CAACsV,UAAL,CAAgB5P,MAAM,CAAC2P,eAAvB;;AAC1C,UAAIrV,IAAI,CAAC0U,OAAL,CAAa/B,SAAb,CAAJ,EAA6B;AACzB,YAAMqJ,SAAS,GAAGhc,IAAI,CAACkV,cAAL,CAAoBlV,IAAI,CAACmV,cAAzB,CAAlB;AACAxC,QAAAA,SAAS,CAACqC,UAAV,CAAqBzE,YAArB,CAAkCyL,SAAlC,EAA6CrJ,SAA7C;AACAA,QAAAA,SAAS,GAAGqJ,SAAZ;AACH;;AAED,WAAKxa,UAAL,GAAkB,IAAlB;AACA,WAAKwN,WAAL;AACH,KA92LQ;;AAg3LT;AACR;AACA;AACA;AACA;AACA;AACQstB,IAAAA,eAAe,EAAE,yBAAU7yB,EAAV,EAAc0uB,SAAd,EAAyB;AACtC,WAAKj5B,OAAL,GAAeA,OAAO,GAAGJ,QAAQ,CAAC2K,EAAE,CAAC/J,aAAJ,EAAmB,KAAK68B,eAAL,CAAqB9yB,EAArB,CAAnB,EAA6CnK,OAA7C,CAAjC;AACA,WAAK8E,oBAAL,GAA4B,IAA5B;;AACA,WAAKo4B,WAAL,CAAiB,IAAjB,EAAuBrE,SAAvB;AACH,KA13LQ;;AA43LT;AACR;AACA;AACA;AACA;AACA;AACQqE,IAAAA,WAAW,EAAE,qBAAUtE,MAAV,EAAkBC,SAAlB,EAA6B;AACtC;AACA,WAAKF,KAAL,CAAWC,MAAX,EAAmBC,SAAnB;;AACAxsB,MAAAA,KAAK,CAAC8wB,SAAN;;AACA,WAAKnG,aAAL;;AACA3qB,MAAAA,KAAK,CAAC+wB,iBAAN;;AACA/wB,MAAAA,KAAK,CAACgxB,eAAN,GANsC,CAQtC;;AACAz9B,MAAAA,OAAO,CAACO,OAAR,CAAgBsL,OAAhB,CAAwBzE,KAAxB,CAA8B+E,UAA9B,GAA2C,EAA3C;;AAEA,WAAKksB,gBAAL;;AACA,WAAKpzB,mBAAL,GAA2B,KAA3B;AACA,WAAKC,oBAAL,GAA4B,KAA5B;AAEA,WAAKhD,OAAL,CAAaye,KAAb,CAAmB,IAAnB;;AACA,WAAK8L,qBAAL;;AAEA9rB,MAAAA,EAAE,CAACuZ,UAAH,CAAc,YAAY;AACtB;AACA,YAAIzN,KAAK,CAACixB,eAAV,EAA2BjxB,KAAK,CAACixB,eAAN,CAAsBC,OAAtB,CAA8B39B,OAAO,CAACO,OAAR,CAAgB4G,YAA9C;AAC3B,YAAIsF,KAAK,CAACmxB,gBAAV,EAA4BnxB,KAAK,CAACmxB,gBAAN,CAAuBD,OAAvB,CAA+B39B,OAAO,CAACO,OAAR,CAAgBs9B,cAA/C,EAHN,CAItB;;AACA,YAAI,OAAO97B,SAAS,CAAC+7B,MAAjB,KAA4B,UAAhC,EAA4C/7B,SAAS,CAAC+7B,MAAV,CAAiB98B,IAAjB,EAAuBg4B,MAAvB;AAC/C,OAND;AAOH,KA35LQ;;AA65LT;AACR;AACA;AACA;AACA;AACA;AACQqE,IAAAA,eAAe,EAAE,yBAAUU,SAAV,EAAqB;AAClC,aAAO;AACHC,QAAAA,IAAI,EAAED,SAAS,CAACp2B,OADb;AAEHs2B,QAAAA,SAAS,EAAEF,SAAS,CAAC7O,QAFlB;AAGHgP,QAAAA,QAAQ,EAAEH,SAAS,CAAClyB,OAHjB;AAIHgyB,QAAAA,cAAc,EAAEE,SAAS,CAACF,cAJvB;AAKHx7B,QAAAA,SAAS,EAAE07B,SAAS,CAAC17B,SALlB;AAMH87B,QAAAA,WAAW,EAAEJ,SAAS,CAACjP,UANpB;AAOHsP,QAAAA,YAAY,EAAEL,SAAS,CAAC52B,YAPrB;AAQHk3B,QAAAA,SAAS,EAAEN,SAAS,CAACnR,IARlB;AASHyO,QAAAA,YAAY,EAAE0C,SAAS,CAACzC,WATrB;AAUHgD,QAAAA,YAAY,EAAEP,SAAS,CAACQ,WAVrB;AAWHC,QAAAA,WAAW,EAAET,SAAS,CAACU,UAXpB;AAYHC,QAAAA,YAAY,EAAEX,SAAS,CAAC5F,WAZrB;AAaHwG,QAAAA,YAAY,EAAEZ,SAAS,CAAC3F,WAbrB;AAcHwG,QAAAA,QAAQ,EAAEb,SAAS,CAACxlB,OAdjB;AAeHxT,QAAAA,YAAY,EAAEg5B,SAAS,CAACxC,WAfrB;AAgBHsD,QAAAA,cAAc,EAAEd,SAAS,CAACnvB,aAhBvB;AAiBHkwB,QAAAA,cAAc,EAAEf,SAAS,CAAClvB,aAjBvB;AAkBHkwB,QAAAA,WAAW,EAAEhB,SAAS,CAACiB,gBAlBpB;AAmBH3P,QAAAA,YAAY,EAAE0O,SAAS,CAAC1O,YAnBrB;AAoBHtC,QAAAA,MAAM,EAAEgR,SAAS,CAAChR;AApBf,OAAP;AAsBH;AA17LQ,GAAb;AA67LA;AACJ;AACA;;AACI,MAAMtgB,KAAK,GAAG;AACVwyB,IAAAA,cAAc,EAAE,KADN;AACa;AACvBC,IAAAA,gBAAgB,EAAE,IAFR;AAGVjH,IAAAA,sBAAsB,EAAE,SAHd;AAIVH,IAAAA,qBAAqB,EAAE,IAJb;AAKVz3B,IAAAA,kBAAkB,EAAE,IALV;AAMV8+B,IAAAA,iBAAiB,EAAE,IAAIx+B,EAAE,CAAC4F,MAAP,CAAc,uBAAd,CANT;AAOV64B,IAAAA,eAAe,EAAE,IAAIz+B,EAAE,CAAC4F,MAAP,CAAc,+DAAd,CAPP;AAQV84B,IAAAA,qBAAqB,EAAE,IAAI1+B,EAAE,CAAC4F,MAAP,CAAc,uDAAd,CARb;AASV+4B,IAAAA,eAAe,EAAE,IAAI3+B,EAAE,CAAC4F,MAAP,CAAc,OAAO5F,EAAE,CAAC44B,MAAH,CAAUC,IAAV,CAAep5B,OAAO,CAACsmB,YAAvB,EAAqCqN,IAArC,CAA0C,GAA1C,CAAP,GAAwD,IAAtE,EAA4E,GAA5E,CATP;AAUVwL,IAAAA,kBAAkB,EAAE,IAAI5+B,EAAE,CAAC4F,MAAP,CAAczF,IAAI,CAACmV,cAAL,GAAsB,GAApC,EAAyC,EAAzC,CAVV;AAWVupB,IAAAA,gBAAgB,EAAE;AACd,UAAI,GADU;AAEd,UAAI,GAFU;AAGd,UAAI,GAHU;AAId,UAAI,GAJU;AAKd,UAAI,GALU;AAMd,UAAI,GANU;AAOd,UAAI,GAPU;AAQd,WAAK,GARS;AASd,WAAK;AATS,KAXR;AAuBVC,IAAAA,gBAAgB,EAAE,0BAAU9wB,OAAV,EAAmBud,KAAnB,EAA0B;AACxC,UAAIrjB,OAAO,GAAG,IAAd;AACA,UAAM62B,MAAM,GAAGjzB,KAAK,CAAC+yB,gBAAN,CAAuB7wB,OAAvB,CAAf;;AAEA,cAAQ+wB,MAAR;AACI,aAAK,GAAL;AACI72B,UAAAA,OAAO,GAAG,WAAV;AACA;;AACJ,aAAK,GAAL;AACI,cAAIzI,OAAO,CAACu/B,gBAAR,CAAyBzxB,OAAzB,CAAiC,MAAjC,MAA6C,CAAC,CAAlD,EAAqD;AACjDrF,YAAAA,OAAO,GAAG,MAAV;AACH;;AACD;;AACJ,aAAK,GAAL;AACI,cAAIqjB,KAAK,IAAI9rB,OAAO,CAACu/B,gBAAR,CAAyBzxB,OAAzB,CAAiC,QAAjC,MAA+C,CAAC,CAA7D,EAAgE;AAC5DrF,YAAAA,OAAO,GAAG,QAAV;AACH,WAFD,MAEO,IAAI,CAACqjB,KAAD,IAAU9rB,OAAO,CAACu/B,gBAAR,CAAyBzxB,OAAzB,CAAiC,MAAjC,MAA6C,CAAC,CAA5D,EAA+D;AAClErF,YAAAA,OAAO,GAAG,MAAV;AACH;;AACD;;AACJ,aAAK,GAAL;AACI,cAAIzI,OAAO,CAACu/B,gBAAR,CAAyBzxB,OAAzB,CAAiC,WAAjC,MAAkD,CAAC,CAAvD,EAA0D;AACtDrF,YAAAA,OAAO,GAAG,WAAV;AACH;;AACD;;AACJ,aAAK,GAAL;AACI,cAAIzI,OAAO,CAACu/B,gBAAR,CAAyBzxB,OAAzB,CAAiC,QAAjC,MAA+C,CAAC,CAApD,EAAuD;AACnDrF,YAAAA,OAAO,GAAG,QAAV;AACH;;AACD;;AACJ,aAAK,GAAL;AACI,cAAIzI,OAAO,CAACu/B,gBAAR,CAAyBzxB,OAAzB,CAAiC,MAAjC,MAA6C,CAAC,CAAlD,EAAqD;AACjD,gBAAIge,KAAJ,EAAW;AACPrjB,cAAAA,OAAO,GAAG,MAAV;AACH,aAFD,MAEO;AACHA,cAAAA,OAAO,GAAG,MAAV;AACH;AACJ;;AACD;;AACJ,aAAK,GAAL;AACI,cAAIzI,OAAO,CAACu/B,gBAAR,CAAyBzxB,OAAzB,CAAiC,MAAjC,MAA6C,CAAC,CAAlD,EAAqD;AACjDrF,YAAAA,OAAO,GAAG,MAAV;AACH;;AACD;;AACJ,aAAK,GAAL;AACI,cAAIzI,OAAO,CAACu/B,gBAAR,CAAyBzxB,OAAzB,CAAiC,QAAjC,MAA+C,CAAC,CAApD,EAAuD;AACnDrF,YAAAA,OAAO,GAAGzI,OAAO,CAACgB,GAAR,GAAc,QAAd,GAAyB,SAAnC;AACH;;AACD;;AACJ,aAAK,GAAL;AACI,cAAIhB,OAAO,CAACu/B,gBAAR,CAAyBzxB,OAAzB,CAAiC,QAAjC,MAA+C,CAAC,CAApD,EAAuD;AACnDrF,YAAAA,OAAO,GAAGzI,OAAO,CAACgB,GAAR,GAAc,SAAd,GAA0B,QAApC;AACH;;AACD;AAjDR;;AAoDA,UAAI,CAACyH,OAAL,EAAc,OAAO,CAAC,CAAC62B,MAAT;AAEd1+B,MAAAA,IAAI,CAAC+pB,cAAL,CAAoB/pB,IAAI,CAAC8E,UAAL,CAAgB+C,OAAhB,CAApB,EAA8CA,OAA9C;AACA,aAAO,IAAP;AACH,KAnFS;AAqFV2I,IAAAA,gBAAgB,EAAE,4BAAY;AAC1B,UAAIqD,aAAa,GAAG7T,IAAI,CAACmP,gBAAL,EAApB;AACA,UAAI0E,aAAa,KAAK7T,IAAI,CAACsB,UAA3B,EAAuC;AACvCtB,MAAAA,IAAI,CAACsB,UAAL,GAAkBuS,aAAlB;AAEA,UAAMsX,SAAS,GAAG/rB,OAAO,CAACgB,GAAR,GAAc,aAAd,GAA8B,YAAhD;AACA,UAAM0E,UAAU,GAAG9E,IAAI,CAAC8E,UAAxB;AACA,UAAM85B,YAAY,GAAGnzB,KAAK,CAAC6yB,eAA3B;AACA,UAAMO,eAAe,GAAG,EAAxB;AACA,UAAMv4B,YAAY,GAAG,EAArB;AAEA,UAAMnC,aAAa,GAAGnE,IAAI,CAACmE,aAA3B;AACA,UAAM2a,IAAI,GAAG3a,aAAa,CAAC2D,MAA3B;AACA,UAAImM,QAAQ,GAAG,EAAf;;AAEA,aAAOJ,aAAa,CAACC,UAArB,EAAiC;AAC7BD,QAAAA,aAAa,GAAGA,aAAa,CAACC,UAA9B;AACH;;AAED,WAAK,IAAIvU,OAAO,GAAGsU,aAAnB,EAAkC,CAAC/T,IAAI,CAAC6P,YAAL,CAAkBpQ,OAAlB,CAAnC,EAA+DA,OAAO,GAAGA,OAAO,CAACuV,UAAjF,EAA6F;AACzF,YAAI,CAACvV,OAAL,EAAc;AACd,YAAIA,OAAO,CAAC2R,QAAR,KAAqB,CAArB,IAA0BpR,IAAI,CAAC0U,OAAL,CAAajV,OAAb,CAA9B,EAAqD;AACrD0U,QAAAA,QAAQ,GAAG1U,OAAO,CAAC0U,QAAR,CAAiB8mB,WAAjB,EAAX;AACAz0B,QAAAA,YAAY,CAACwC,IAAb,CAAkBmL,QAAlB;AAEA;;AACA,YAAI,CAACjU,IAAI,CAAC8C,UAAV,EAAsB;AAClB,eAAK,IAAI8X,GAAC,GAAG,CAAR,EAAWzR,IAAhB,EAAsByR,GAAC,GAAGkE,IAA1B,EAAgClE,GAAC,EAAjC,EAAqC;AACjCzR,YAAAA,IAAI,GAAGhF,aAAa,CAACyW,GAAD,CAApB;;AACA,gBAAIikB,eAAe,CAAC3xB,OAAhB,CAAwB/D,IAAxB,MAAkC,CAAC,CAAnC,IAAwCjK,OAAO,CAACiK,IAAD,CAAP,CAAcN,MAAd,CAAqB0B,IAArB,CAA0BvK,IAA1B,EAAgCT,OAAhC,CAA5C,EAAsF;AAClFs/B,cAAAA,eAAe,CAAC/1B,IAAhB,CAAqBK,IAArB;AACH;AACJ;AACJ;;AAED,YAAIrJ,IAAI,CAACkQ,eAAL,CAAqBzQ,OAArB,CAAJ,EAAmC;AAC/B;AACA,cAAIs/B,eAAe,CAAC3xB,OAAhB,CAAwB,SAAxB,MAAuC,CAAC,CAAxC,IAA6CpI,UAAU,CAAC8yB,OAAxD,IAAmE,CAAC93B,IAAI,CAAC+3B,mBAAL,CAAyB/yB,UAAU,CAAC8yB,OAApC,CAAxE,EAAsH;AAClH,gBAAI93B,IAAI,CAACuW,UAAL,CAAgB9W,OAAhB,KAA6BA,OAAO,CAAC6G,KAAR,CAAc+kB,SAAd,KAA4BrrB,IAAI,CAACoG,SAAL,CAAe3G,OAAO,CAAC6G,KAAR,CAAc+kB,SAAd,CAAf,EAAyC,CAAzC,IAA8C,CAA3G,EAA+G;AAC3G0T,cAAAA,eAAe,CAAC/1B,IAAhB,CAAqB,SAArB;AACAhE,cAAAA,UAAU,CAAC8yB,OAAX,CAAmB5T,eAAnB,CAAmC,UAAnC;AACH;AACJ;AAED;;;AACA,cAAI6a,eAAe,CAAC3xB,OAAhB,CAAwB,QAAxB,MAAsC,CAAC,CAAvC,IAA4CpI,UAAU,CAACgzB,MAAvD,IAAiE,CAACh4B,IAAI,CAAC+3B,mBAAL,CAAyB/yB,UAAU,CAACgzB,MAApC,CAAtE,EAAmH;AAC/G+G,YAAAA,eAAe,CAAC/1B,IAAhB,CAAqB,QAArB;;AACA,gBAAIhJ,IAAI,CAACuW,UAAL,CAAgB9W,OAAhB,KAA4B,CAACA,OAAO,CAAC2V,sBAAzC,EAAiE;AAC7DpQ,cAAAA,UAAU,CAACgzB,MAAX,CAAkBhN,YAAlB,CAA+B,UAA/B,EAA2C,IAA3C;AACH,aAFD,MAEO;AACHhmB,cAAAA,UAAU,CAACgzB,MAAX,CAAkB9T,eAAlB,CAAkC,UAAlC;AACH;AACJ;;AAED;AACH;AAED;;;AACA,YAAI4a,YAAY,IAAIA,YAAY,CAACnxB,IAAb,CAAkBwG,QAAlB,CAApB,EAAiD;AAC7C4qB,UAAAA,eAAe,CAAC/1B,IAAhB,CAAqBmL,QAArB;AACAnU,UAAAA,IAAI,CAACuL,QAAL,CAAcvG,UAAU,CAACmP,QAAD,CAAxB,EAAoC,QAApC;AACH;AACJ;;AAEDjU,MAAAA,IAAI,CAACqS,aAAL,CAAmBwsB,eAAnB;AAEA;;;AACA7+B,MAAAA,IAAI,CAACyF,SAAL,CAAea,YAAf,GAA8BA,YAAY,CAACw4B,OAAb,EAA9B;AACA9+B,MAAAA,IAAI,CAACyF,SAAL,CAAec,eAAf,GAAiCs4B,eAAjC;AAEA;;AACA,UAAIz/B,OAAO,CAAC2/B,aAAZ,EAA2B//B,OAAO,CAACO,OAAR,CAAgBk+B,UAAhB,CAA2BtsB,WAA3B,GAAyCnR,IAAI,CAACyF,SAAL,CAAea,YAAf,CAA4BysB,IAA5B,CAAiC,KAAjC,CAAzC;AAC9B,KA7JS;AA+JViM,IAAAA,kBAAkB,EAAE,8BAAY;AAC5B,WAAKlU,YAAL,CAAkB,iBAAlB,EAAqC,KAArC;AACA,WAAK8K,mBAAL,CAAyB,MAAzB,EAAiCnqB,KAAK,CAACuzB,kBAAvC;AACH,KAlKS;AAoKVC,IAAAA,oBAAoB,EAAE,8BAAU7xB,CAAV,EAAa;AAC/B,UAAIxD,MAAM,GAAGwD,CAAC,CAACxD,MAAf;AACA,UAAI5J,IAAI,CAACoD,mBAAT,EAA8BgK,CAAC,CAACE,eAAF;;AAE9B,UAAI,oCAAoCG,IAApC,CAAyC7D,MAAM,CAACqK,QAAhD,CAAJ,EAA+D;AAC3DjU,QAAAA,IAAI,CAAC8D,SAAL,GAAiB,KAAjB;AACH,OAFD,MAEO;AACHsJ,QAAAA,CAAC,CAACC,cAAF;AACH;;AAED,UAAIvN,IAAI,CAACoP,gBAAL,CAAsBtF,MAAtB,EAA8B,aAA9B,CAAJ,EAAkD;AAC9CwD,QAAAA,CAAC,CAACE,eAAF;AACAtN,QAAAA,IAAI,CAAC4D,eAAL,GAAuB,IAAvB;AACH,OAHD,MAGO;AACH,YAAIiE,OAAO,GAAG+B,MAAM,CAAC7B,YAAP,CAAoB,cAApB,CAAd;AACA,YAAI+Q,SAAS,GAAGlP,MAAM,CAACkP,SAAvB;;AAEA,eAAO,CAACjR,OAAD,IAAY,CAAC,eAAe4F,IAAf,CAAoBqL,SAApB,CAAb,IAA+C,CAAC,oBAAoBrL,IAApB,CAAyBqL,SAAzB,CAAvD,EAA4F;AACxFlP,UAAAA,MAAM,GAAGA,MAAM,CAACkL,UAAhB;AACAjN,UAAAA,OAAO,GAAG+B,MAAM,CAAC7B,YAAP,CAAoB,cAApB,CAAV;AACA+Q,UAAAA,SAAS,GAAGlP,MAAM,CAACkP,SAAnB;AACH;;AAED,YAAIjR,OAAO,KAAK7H,IAAI,CAACyB,YAAjB,IAAiCoG,OAAO,KAAK7H,IAAI,CAACiL,cAAtD,EAAsE;AAClEmC,UAAAA,CAAC,CAACE,eAAF;AACH;AACJ;AACJ,KA/LS;AAiMV4xB,IAAAA,eAAe,EAAE,yBAAU9xB,CAAV,EAAa;AAC1B,UAAIxD,MAAM,GAAGwD,CAAC,CAACxD,MAAf;AACA,UAAIa,OAAO,GAAGb,MAAM,CAAC7B,YAAP,CAAoB,cAApB,CAAd;AACA,UAAIF,OAAO,GAAG+B,MAAM,CAAC7B,YAAP,CAAoB,cAApB,CAAd;AACA,UAAI+Q,SAAS,GAAGlP,MAAM,CAACkP,SAAvB;AACA9Y,MAAAA,IAAI,CAACgK,cAAL;;AAEA,aAAOJ,MAAM,CAACkL,UAAP,IAAqB,CAACjN,OAAtB,IAAiC,CAAC,eAAe4F,IAAf,CAAoBqL,SAApB,CAAlC,IAAoE,CAAC,aAAarL,IAAb,CAAkBqL,SAAlB,CAA5E,EAA0G;AACtGlP,QAAAA,MAAM,GAAGA,MAAM,CAACkL,UAAhB;AACAjN,QAAAA,OAAO,GAAG+B,MAAM,CAAC7B,YAAP,CAAoB,cAApB,CAAV;AACA0C,QAAAA,OAAO,GAAGb,MAAM,CAAC7B,YAAP,CAAoB,cAApB,CAAV;AACA+Q,QAAAA,SAAS,GAAGlP,MAAM,CAACkP,SAAnB;AACH;;AAED,UAAI,CAACjR,OAAD,IAAY,CAAC4C,OAAjB,EAA0B;AAC1B,UAAIb,MAAM,CAACu1B,QAAX,EAAqB;AAErBn/B,MAAAA,IAAI,CAACypB,UAAL,CAAgB5hB,OAAhB,EAAyB4C,OAAzB,EAAkCb,MAAlC;AACH,KAnNS;AAqNVw1B,IAAAA,mBAAmB,EAAE,6BAAUhyB,CAAV,EAAa;AAC9B,UAAIpN,IAAI,CAAC8C,UAAL,IAAmBhD,IAAI,CAACgiB,aAAL,CAAmB9iB,OAAO,CAACO,OAAR,CAAgB8P,OAAnC,CAAvB,EAAoE,OADtC,CAG9B;;AACA,UAAI,OAAOtO,SAAS,CAACs+B,WAAjB,KAAiC,UAAjC,IAA+Ct+B,SAAS,CAACs+B,WAAV,CAAsBjyB,CAAtB,EAAyBpN,IAAzB,MAAmC,KAAtF,EAA6F;AAE7F,UAAMs/B,SAAS,GAAGx/B,IAAI,CAACoP,gBAAL,CAAsB9B,CAAC,CAACxD,MAAxB,EAAgC9J,IAAI,CAAC+U,MAArC,CAAlB;;AACA,UAAIyqB,SAAJ,EAAe;AACX,YAAMC,WAAW,GAAGv/B,IAAI,CAACd,OAAL,CAAasgC,KAAjC;;AACA,YAAID,WAAW,IAAID,SAAS,KAAKC,WAAW,CAACE,UAAzC,IAAuD,CAACF,WAAW,CAACG,MAAxE,EAAgF;AAC5E1/B,UAAAA,IAAI,CAACsI,UAAL,CAAgB,OAAhB,EAAyB,YAAY;AACjCi3B,YAAAA,WAAW,CAACI,sBAAZ,CAAmCp1B,IAAnC,CAAwCvK,IAAxC,EAA8Cs/B,SAA9C,EAAyD,KAAzD;AACH,WAFD,EAEG,IAFH;AAGH;AACJ;;AAED,UAAIt/B,IAAI,CAACsD,UAAT,EAAqB;AACjBmI,QAAAA,KAAK,CAACugB,YAAN;AACH;;AAED,UAAI,UAAUve,IAAV,CAAeL,CAAC,CAACxD,MAAF,CAASqK,QAAxB,CAAJ,EAAuC7G,CAAC,CAACC,cAAF;AAC1C,KA1OS;AA4OVuyB,IAAAA,eAAe,EAAE,yBAAUxyB,CAAV,EAAa;AAC1B,UAAMyyB,aAAa,GAAGzyB,CAAC,CAACxD,MAAxB;;AAEA,UAAI5J,IAAI,CAAC8C,UAAT,EAAqB;AACjBsK,QAAAA,CAAC,CAACC,cAAF;;AACA,YAAIvN,IAAI,CAACiyB,QAAL,CAAc8N,aAAd,CAAJ,EAAiC;AAC7BlgC,UAAAA,EAAE,CAACkqB,IAAH,CAAQgW,aAAa,CAACC,IAAtB,EAA4BD,aAAa,CAACj2B,MAA1C;AACH;;AACD,eAAO,KAAP;AACH;;AAED,UAAI9J,IAAI,CAACgiB,aAAL,CAAmB9iB,OAAO,CAACO,OAAR,CAAgB8P,OAAnC,CAAJ,EAAiD,OAXvB,CAa1B;;AACA,UAAI,OAAOtO,SAAS,CAACg/B,OAAjB,KAA6B,UAA7B,IAA2Ch/B,SAAS,CAACg/B,OAAV,CAAkB3yB,CAAlB,EAAqBpN,IAArB,MAA+B,KAA9E,EAAqF;AAErF,UAAM6Q,iBAAiB,GAAG7Q,IAAI,CAACiN,gBAAL,CAAsB4yB,aAAtB,CAA1B;;AACA,UAAIhvB,iBAAJ,EAAuB;AACnBzD,QAAAA,CAAC,CAACC,cAAF;AACArN,QAAAA,IAAI,CAAC8Q,eAAL,CAAqBD,iBAAiB,CAACjH,MAAvC,EAA+CiH,iBAAiB,CAACtI,UAAjE;AACA;AACH;;AAED,UAAMy3B,UAAU,GAAGlgC,IAAI,CAACoP,gBAAL,CAAsB2wB,aAAtB,EAAqC,YAArC,CAAnB;;AACA,UAAIG,UAAU,KAAKlgC,IAAI,CAACgiB,aAAL,CAAmBke,UAAnB,KAAkC,CAACA,UAAU,CAACj4B,YAAX,CAAwB,iBAAxB,CAAxC,CAAd,EAAmG;AAC/FqF,QAAAA,CAAC,CAACC,cAAF;AACA2yB,QAAAA,UAAU,CAAClV,YAAX,CAAwB,iBAAxB,EAA2C,IAA3C;AACAkV,QAAAA,UAAU,CAAC5wB,KAAX;;AAEA,YAAIpP,IAAI,CAACqD,SAAL,IAAkB,CAACrD,IAAI,CAACwD,kBAAL,CAAwBG,MAA/C,EAAuD;AACnD8H,UAAAA,KAAK,CAACke,kBAAN;;AAEA,cAAMsW,WAAW,GAAG,SAAdA,WAAc,GAAY;AAC5Bx0B,YAAAA,KAAK,CAACugB,YAAN;;AACAgU,YAAAA,UAAU,CAACpK,mBAAX,CAA+B,MAA/B,EAAuCqK,WAAvC;AACH,WAHD;;AAKAD,UAAAA,UAAU,CAAC7yB,gBAAX,CAA4B,MAA5B,EAAoC8yB,WAApC;AACH;AACJ;;AAEDtgC,MAAAA,EAAE,CAACuZ,UAAH,CAAclZ,IAAI,CAACgP,YAAL,CAAkB5E,IAAlB,CAAuBpK,IAAvB,CAAd;;AACAA,MAAAA,IAAI,CAACgP,YAAL;;AAEA,UAAM6E,aAAa,GAAG7T,IAAI,CAACmP,gBAAL,EAAtB;AACA,UAAMoJ,QAAQ,GAAGzY,IAAI,CAAC6U,gBAAL,CAAsBd,aAAtB,EAAqC,IAArC,CAAjB;AACA,UAAM2L,OAAO,GAAG1f,IAAI,CAAC8U,qBAAL,CAA2Bf,aAA3B,EAA0C,IAA1C,CAAhB;;AACA,UAAI,CAAC0E,QAAD,IAAa,CAACzY,IAAI,CAACgiB,aAAL,CAAmB+d,aAAnB,CAAd,IAAmD,CAAC//B,IAAI,CAAC2Z,MAAL,CAAY+F,OAAZ,CAAxD,EAA8E;AAC1E,YAAMjQ,KAAK,GAAGvP,IAAI,CAACwP,QAAL,EAAd;;AACA,YAAI1P,IAAI,CAAC6U,gBAAL,CAAsBpF,KAAK,CAACE,cAA5B,MAAgD3P,IAAI,CAAC6U,gBAAL,CAAsBpF,KAAK,CAACG,YAA5B,CAApD,EAA+F;AAC3F,cAAI5P,IAAI,CAAC2Z,MAAL,CAAY+F,OAAZ,CAAJ,EAA0B;AACtBpS,YAAAA,CAAC,CAACC,cAAF;AACA,gBAAM6yB,GAAG,GAAGpgC,IAAI,CAACoQ,aAAL,CAAmB,IAAnB,CAAZ;AACA,gBAAMiwB,MAAM,GAAGtsB,aAAa,CAACD,kBAA7B;AACAssB,YAAAA,GAAG,CAACp2B,WAAJ,CAAgB+J,aAAhB;AACA2L,YAAAA,OAAO,CAACnP,YAAR,CAAqB6vB,GAArB,EAA0BC,MAA1B;AACAngC,YAAAA,IAAI,CAACoP,KAAL;AACH,WAPD,MAOO,IAAI,CAACtP,IAAI,CAAC6P,YAAL,CAAkBkE,aAAlB,CAAD,IAAqC,CAAC/T,IAAI,CAACmQ,WAAL,CAAiB4D,aAAjB,CAAtC,KAA0E,CAAC/T,IAAI,CAACoW,OAAL,CAAarC,aAAb,CAAD,IAAgC/T,IAAI,CAAC+U,MAAL,CAAYhB,aAAZ,CAA1G,KAAyI7T,IAAI,CAACg8B,iBAAL,CAAuBl8B,IAAI,CAAC6V,oBAAL,CAA0B6J,OAA1B,IAAqC,KAArC,GAA6CpgB,OAAO,CAAC+Q,UAA5E,MAA4F,IAAzO,EAA+O;AAClP/C,YAAAA,CAAC,CAACC,cAAF;AACArN,YAAAA,IAAI,CAACoP,KAAL;AACH,WAHM,MAGA;AACH3D,YAAAA,KAAK,CAAC+E,gBAAN;AACH;AACJ;AACJ,OAjBD,MAiBO;AACH/E,QAAAA,KAAK,CAAC+E,gBAAN;AACH;;AAED,UAAIxQ,IAAI,CAACsD,UAAT,EAAqB3D,EAAE,CAACuZ,UAAH,CAAczN,KAAK,CAACgF,qBAApB;AACxB,KAjTS;AAmTV2vB,IAAAA,aAAa,EAAE,IAnTL;AAoTVC,IAAAA,wBAAwB,EAAE,oCAAY;AAClC,UAAI50B,KAAK,CAAC20B,aAAV,EAAyB;AACrBzgC,QAAAA,EAAE,CAAC2gC,YAAH,CAAgB70B,KAAK,CAAC20B,aAAtB;AACH;;AAED30B,MAAAA,KAAK,CAAC20B,aAAN,GAAsBzgC,EAAE,CAACuZ,UAAH,CAAc,YAAY;AAC5CvZ,QAAAA,EAAE,CAAC2gC,YAAH,CAAgB,KAAKF,aAArB;;AACA,aAAKA,aAAL,GAAqB,IAArB;;AACA,aAAK1W,mBAAL;AACH,OAJmC,CAIlCtf,IAJkC,CAI7BqB,KAJ6B,CAAd,EAIP,GAJO,CAAtB;AAKH,KA9TS;AAgUVgF,IAAAA,qBAAqB,EAAE,iCAAY;AAC/BzQ,MAAAA,IAAI,CAACgP,YAAL;;AACA,UAAMO,KAAK,GAAGvP,IAAI,CAACwP,QAAL,EAAd;AACA,UAAIxP,IAAI,CAACoD,mBAAL,IAA6B,CAACpD,IAAI,CAACuD,gBAAN,IAA0BgM,KAAK,CAACgD,SAAjE,EAA6E9G,KAAK,CAACugB,YAAN,GAA7E,KACKvgB,KAAK,CAACie,mBAAN,CAA0Bna,KAA1B;AACR,KArUS;AAuUVma,IAAAA,mBAAmB,EAAE,6BAAU6W,QAAV,EAAoB;AACrC,UAAI,CAACvgC,IAAI,CAACsD,UAAV,EAAsB;AAEtB,UAAMiM,KAAK,GAAGgxB,QAAQ,IAAIvgC,IAAI,CAACwP,QAAL,EAA1B;AACA,UAAM3E,OAAO,GAAG7L,OAAO,CAACO,OAAR,CAAgBsL,OAAhC;AACA,UAAMlE,OAAO,GAAG3H,OAAO,CAACO,OAAR,CAAgBoH,OAAhC;AACA,UAAMoL,SAAS,GAAG/R,IAAI,CAACgS,YAAL,EAAlB;AAEA,UAAIwuB,QAAJ;;AACA,UAAIxgC,IAAI,CAACuD,gBAAL,IAAyBgM,KAAK,CAACgD,SAAnC,EAA8C;AAC1CiuB,QAAAA,QAAQ,GAAG,IAAX;AACH,OAFD,MAEO,IAAIzuB,SAAS,CAACU,SAAV,KAAwBV,SAAS,CAACc,UAAtC,EAAkD;AACrD2tB,QAAAA,QAAQ,GAAGzuB,SAAS,CAACmB,WAAV,GAAwBnB,SAAS,CAACiB,YAA7C;AACH,OAFM,MAEA;AACH,YAAM/B,UAAU,GAAGnR,IAAI,CAACqc,iBAAL,CAAuB5M,KAAK,CAACM,uBAA7B,EAAsD,IAAtD,CAAnB;AACA2wB,QAAAA,QAAQ,GAAG1gC,IAAI,CAACuc,aAAL,CAAmBpL,UAAnB,EAA+Bc,SAAS,CAACU,SAAzC,IAAsD3S,IAAI,CAACuc,aAAL,CAAmBpL,UAAnB,EAA+Bc,SAAS,CAACc,UAAzC,CAAjE;AACH;;AAED,UAAI4tB,KAAK,GAAGlxB,KAAK,CAACmxB,cAAN,EAAZ;AACAD,MAAAA,KAAK,GAAGA,KAAK,CAACD,QAAQ,GAAG,CAAH,GAAOC,KAAK,CAAC34B,MAAN,GAAe,CAA/B,CAAb;AAEA,UAAM64B,YAAY,GAAG3gC,IAAI,CAACoJ,qBAAL,EAArB;AACA,UAAIK,UAAU,GAAGk3B,YAAY,CAACh3B,IAA9B;AACA,UAAIH,SAAS,GAAGm3B,YAAY,CAACl9B,GAA7B;AAEA,UAAMm9B,WAAW,GAAGj6B,OAAO,CAAC4E,WAA5B;;AACA,UAAM4d,OAAO,GAAG1d,KAAK,CAACC,iBAAN,CAAwB,IAAxB,CAAhB;;AACA,UAAMm1B,SAAS,GAAG1X,OAAO,CAAC1lB,GAA1B;AACA,UAAMq9B,UAAU,GAAG3X,OAAO,CAACxf,IAA3B;AAEAkB,MAAAA,OAAO,CAACzE,KAAR,CAAc3C,GAAd,GAAoB,UAApB;AACAoH,MAAAA,OAAO,CAACzE,KAAR,CAAc+E,UAAd,GAA2B,QAA3B;AACAN,MAAAA,OAAO,CAACzE,KAAR,CAAcqE,OAAd,GAAwB,OAAxB;;AAEA,UAAI,CAACg2B,KAAL,EAAY;AACR,YAAMrpB,IAAI,GAAGpX,IAAI,CAACmP,gBAAL,EAAb;;AACA,YAAIrP,IAAI,CAACkQ,eAAL,CAAqBoH,IAArB,CAAJ,EAAgC;AAC5B,cAAM0E,SAAS,GAAGhc,IAAI,CAACkV,cAAL,CAAoBlV,IAAI,CAACmV,cAAzB,CAAlB;AACAjV,UAAAA,IAAI,CAACwY,UAAL,CAAgBsD,SAAhB,EAA2B,IAA3B,EAAiC,KAAjC;AACA9b,UAAAA,IAAI,CAACsQ,QAAL,CAAcwL,SAAd,EAAyB,CAAzB,EAA4BA,SAA5B,EAAuC,CAAvC;;AACA9b,UAAAA,IAAI,CAACgP,YAAL;;AACAyxB,UAAAA,KAAK,GAAGzgC,IAAI,CAACwP,QAAL,GAAgBkxB,cAAhB,EAAR;AACAD,UAAAA,KAAK,GAAGA,KAAK,CAACD,QAAQ,GAAG,CAAH,GAAOC,KAAK,CAAC34B,MAAN,GAAe,CAA/B,CAAb;AACH;;AAED,YAAI,CAAC24B,KAAL,EAAY;AACR,cAAMM,UAAU,GAAGjhC,IAAI,CAACsO,SAAL,CAAegJ,IAAf,EAAqBpY,OAAO,CAACO,OAAR,CAAgB4G,YAArC,CAAnB;AACAs6B,UAAAA,KAAK,GAAG;AACJ92B,YAAAA,IAAI,EAAEo3B,UAAU,CAACp3B,IADb;AAEJlG,YAAAA,GAAG,EAAEs9B,UAAU,CAACt9B,GAFZ;AAGJu9B,YAAAA,KAAK,EAAED,UAAU,CAACp3B,IAHd;AAIJs3B,YAAAA,MAAM,EAAEF,UAAU,CAACt9B,GAAX,GAAiB2T,IAAI,CAAC/K,YAJ1B;AAKJ60B,YAAAA,MAAM,EAAE;AALJ,WAAR;AAOAz3B,UAAAA,UAAU,GAAG,CAAb;AACAD,UAAAA,SAAS,GAAG,CAAZ;AACH;;AAEDg3B,QAAAA,QAAQ,GAAG,IAAX;AACH;;AAED,UAAMW,WAAW,GAAGxhC,EAAE,CAACyhC,IAAH,CAAQC,KAAR,CAAcriC,OAAO,CAACO,OAAR,CAAgBwsB,MAAhB,CAAuBxgB,WAAvB,GAAqC,CAAnD,CAApB;;AACA,UAAMwrB,YAAY,GAAGlsB,OAAO,CAACU,WAA7B;AACA,UAAM+1B,aAAa,GAAGz2B,OAAO,CAACwB,YAA9B;AACA,UAAMk1B,WAAW,GAAG,UAAU9zB,IAAV,CAAezO,OAAO,CAACO,OAAR,CAAgB4G,YAAhB,CAA6B8N,QAA5C,IAAwDjV,OAAO,CAACO,OAAR,CAAgB4G,YAAhB,CAA6Bu6B,cAA7B,GAA8C,CAA9C,CAAxD,GAA2G,IAA/H;;AACA,UAAIa,WAAJ,EAAiB;AACbd,QAAAA,KAAK,GAAG;AACJ92B,UAAAA,IAAI,EAAE82B,KAAK,CAAC92B,IAAN,GAAa43B,WAAW,CAAC53B,IAD3B;AAEJlG,UAAAA,GAAG,EAAEg9B,KAAK,CAACh9B,GAAN,GAAY89B,WAAW,CAAC99B,GAFzB;AAGJu9B,UAAAA,KAAK,EAAEP,KAAK,CAACO,KAAN,GAAcO,WAAW,CAACP,KAA1B,GAAkCO,WAAW,CAAC79B,KAHjD;AAIJu9B,UAAAA,MAAM,EAAER,KAAK,CAACQ,MAAN,GAAeM,WAAW,CAACN,MAA3B,GAAoCM,WAAW,CAACn2B;AAJpD,SAAR;AAMH;;AAEDK,MAAAA,KAAK,CAAC+1B,iBAAN,CAAwBhB,QAAxB,EAAkCC,KAAlC,EAAyC51B,OAAzC,EAAkDi2B,UAAlD,EAA8DF,WAA9D,EAA2En3B,UAA3E,EAAuFD,SAAvF,EAAkGq3B,SAAlG,EAA6GM,WAA7G;;AACA,UAAIpK,YAAY,KAAKlsB,OAAO,CAACU,WAAzB,IAAwC+1B,aAAa,KAAKz2B,OAAO,CAACwB,YAAtE,EAAoF;AAChFZ,QAAAA,KAAK,CAAC+1B,iBAAN,CAAwBhB,QAAxB,EAAkCC,KAAlC,EAAyC51B,OAAzC,EAAkDi2B,UAAlD,EAA8DF,WAA9D,EAA2En3B,UAA3E,EAAuFD,SAAvF,EAAkGq3B,SAAlG,EAA6GM,WAA7G;AACH;;AAED,UAAI/hC,OAAO,CAAC6uB,gBAAZ,EAA8B;AAC1B,YAAMwT,YAAY,GAAG96B,OAAO,CAACwB,aAA7B;AAEA,YAAI3G,SAAS,GAAGpC,OAAO,CAAC6uB,gBAAxB;AACA,YAAItkB,IAAI,GAAGnI,SAAS,CAACoK,UAArB;AACA,YAAInI,GAAG,GAAGjC,SAAS,CAAC0K,SAApB;;AAEA,eAAM,CAAC1K,SAAS,CAAC2G,aAAV,CAAwBqF,QAAxB,CAAiCi0B,YAAjC,CAAD,IAAmD,CAAC,iBAAiBh0B,IAAjB,CAAsBjM,SAAS,CAAC2G,aAAV,CAAwB8L,QAA9C,CAA1D,EAAmH;AAC/GzS,UAAAA,SAAS,GAAGA,SAAS,CAAC2K,YAAtB;AACAxC,UAAAA,IAAI,IAAInI,SAAS,CAACoK,UAAlB;AACAnI,UAAAA,GAAG,IAAIjC,SAAS,CAAC0K,SAAjB;AACH;;AAEDrB,QAAAA,OAAO,CAACzE,KAAR,CAAcuD,IAAd,GAAsBkB,OAAO,CAACe,UAAR,GAAqBjC,IAArB,GAA4BhD,OAAO,CAACiF,UAArC,GAAmD,IAAxE;AACAf,QAAAA,OAAO,CAACzE,KAAR,CAAc3C,GAAd,GAAqBoH,OAAO,CAACqB,SAAR,GAAoBzI,GAApB,GAA0BkD,OAAO,CAACuF,SAAnC,GAAgD,IAApE;AACH;;AAEDrB,MAAAA,OAAO,CAACzE,KAAR,CAAc+E,UAAd,GAA2B,EAA3B;AACH,KAxaS;AA0aVq2B,IAAAA,iBAAiB,EAAE,2BAAUhB,QAAV,EAAoBC,KAApB,EAA2B51B,OAA3B,EAAoCi2B,UAApC,EAAgDF,WAAhD,EAA6Dn3B,UAA7D,EAAyED,SAAzE,EAAoFq3B,SAApF,EAA+FM,WAA/F,EAA4G;AAC3H,UAAMO,OAAO,GAAG,CAAhB;AACA,UAAM3K,YAAY,GAAGlsB,OAAO,CAACU,WAA7B;AACA,UAAM+1B,aAAa,GAAGb,KAAK,CAACS,MAAN,IAAgB,CAACV,QAAjB,GAA4B,CAA5B,GAAgC31B,OAAO,CAACwB,YAA9D;AAEA,UAAMs1B,YAAY,GAAG,CAACnB,QAAQ,GAAGC,KAAK,CAAC92B,IAAT,GAAgB82B,KAAK,CAACO,KAA/B,IAAwCF,UAAxC,GAAsD/J,YAAY,GAAG,CAArE,GAA0EttB,UAA/F;AACA,UAAMm4B,SAAS,GAAGD,YAAY,GAAG5K,YAAf,GAA8B6J,WAAhD;AAEA,UAAIv3B,CAAC,GAAG,CAACm3B,QAAQ,GAAGC,KAAK,CAACh9B,GAAN,GAAY69B,aAAZ,GAA4BH,WAA/B,GAA6CV,KAAK,CAACQ,MAAN,GAAeE,WAArE,KAAqFV,KAAK,CAACS,MAAN,GAAe,CAAf,GAAmBL,SAAxG,IAAqHr3B,SAA7H;AACA,UAAIF,CAAC,GAAGq4B,YAAY,GAAG,CAAf,GAAmBD,OAAnB,GAA6BE,SAAS,GAAG,CAAZ,GAAgBD,YAAhB,GAA+BA,YAAY,GAAGC,SAAf,GAA2BF,OAA3B,GAAqC,CAAzG;AAEA,UAAIG,QAAQ,GAAG,KAAf;AACA,UAAMC,KAAK,GAAGz4B,CAAC,IAAIm3B,QAAQ,GAAI/0B,KAAK,CAACC,iBAAN,CAAwB,IAAxB,EAA8BjI,GAAlC,GAA0CoH,OAAO,CAACwB,YAAR,GAAuBrN,OAAO,CAACO,OAAR,CAAgB8P,OAAhB,CAAwBhD,YAArG,CAAf;;AACA,UAAI,CAACm0B,QAAD,IAAasB,KAAK,GAAG,CAArB,IAA0Br2B,KAAK,CAACs2B,mBAAN,KAA8BD,KAA5D,EAAmE;AAC/DtB,QAAAA,QAAQ,GAAG,IAAX;AACAqB,QAAAA,QAAQ,GAAG,IAAX;AACH,OAHD,MAGO,IAAIrB,QAAQ,IAAIlhC,EAAE,CAAC0iC,eAAH,CAAmB91B,SAAnB,GAA+B41B,KAA/C,EAAsD;AACzDtB,QAAAA,QAAQ,GAAG,KAAX;AACAqB,QAAAA,QAAQ,GAAG,IAAX;AACH;;AAED,UAAIA,QAAJ,EAAcx4B,CAAC,GAAG,CAACm3B,QAAQ,GAAGC,KAAK,CAACh9B,GAAN,GAAY69B,aAAZ,GAA4BH,WAA/B,GAA6CV,KAAK,CAACQ,MAAN,GAAeE,WAArE,KAAqFV,KAAK,CAACS,MAAN,GAAe,CAAf,GAAmBL,SAAxG,IAAqHr3B,SAAzH;AAEdqB,MAAAA,OAAO,CAACzE,KAAR,CAAcuD,IAAd,GAAqBhK,EAAE,CAACyhC,IAAH,CAAQa,KAAR,CAAc34B,CAAd,IAAmB,IAAxC;AACAuB,MAAAA,OAAO,CAACzE,KAAR,CAAc3C,GAAd,GAAoB9D,EAAE,CAACyhC,IAAH,CAAQa,KAAR,CAAc54B,CAAd,IAAmB,IAAvC;;AAEA,UAAIm3B,QAAJ,EAAc;AACV1gC,QAAAA,IAAI,CAAC4K,WAAL,CAAiB1L,OAAO,CAACO,OAAR,CAAgBwsB,MAAjC,EAAyC,aAAzC;AACAjsB,QAAAA,IAAI,CAACuL,QAAL,CAAcrM,OAAO,CAACO,OAAR,CAAgBwsB,MAA9B,EAAsC,eAAtC;AACA/sB,QAAAA,OAAO,CAACO,OAAR,CAAgBwsB,MAAhB,CAAuB3lB,KAAvB,CAA6B3C,GAA7B,GAAmC69B,aAAa,GAAG,IAAnD;AACH,OAJD,MAIO;AACHxhC,QAAAA,IAAI,CAAC4K,WAAL,CAAiB1L,OAAO,CAACO,OAAR,CAAgBwsB,MAAjC,EAAyC,eAAzC;AACAjsB,QAAAA,IAAI,CAACuL,QAAL,CAAcrM,OAAO,CAACO,OAAR,CAAgBwsB,MAA9B,EAAsC,aAAtC;AACA/sB,QAAAA,OAAO,CAACO,OAAR,CAAgBwsB,MAAhB,CAAuB3lB,KAAvB,CAA6B3C,GAA7B,GAAmC,CAAC09B,WAAD,GAAe,IAAlD;AACH;;AAED,UAAMe,UAAU,GAAGviC,EAAE,CAACyhC,IAAH,CAAQa,KAAR,CAAelL,YAAY,GAAG,CAAhB,IAAsB4K,YAAY,GAAGr4B,CAArC,CAAd,CAAnB;;AACAtK,MAAAA,OAAO,CAACO,OAAR,CAAgBwsB,MAAhB,CAAuB3lB,KAAvB,CAA6BuD,IAA7B,GAAoC,CAACu4B,UAAU,GAAGf,WAAb,GAA2Bt2B,OAAO,CAACU,WAAnC,GAAiDV,OAAO,CAACU,WAAR,GAAsB41B,WAAvE,GAAqFe,UAAU,GAAGf,WAAb,GAA2BA,WAA3B,GAAyCe,UAA/H,IAA6I,IAAjL;AACH,KAhdS;AAkdVvY,IAAAA,kBAAkB,EAAE,8BAAY;AAC5B,UAAI,CAAC3pB,IAAI,CAACqD,SAAV,EAAqB;AAErB,UAAMwH,OAAO,GAAG7L,OAAO,CAACO,OAAR,CAAgBsL,OAAhC;AACA,UAAIzL,OAAO,CAAC6uB,gBAAZ,EAA8BpjB,OAAO,CAACzE,KAAR,CAAc6H,QAAd,GAAyB,UAAzB,CAA9B,KACKpD,OAAO,CAACzE,KAAR,CAAc6H,QAAd,GAAyB,UAAzB;AAELpD,MAAAA,OAAO,CAACzE,KAAR,CAAc+E,UAAd,GAA2B,QAA3B;AACAN,MAAAA,OAAO,CAACzE,KAAR,CAAcqE,OAAd,GAAwB,OAAxB;AACAzK,MAAAA,IAAI,CAACwD,kBAAL,CAAwBE,KAAxB,GAAgCmH,OAAO,CAACzE,KAAR,CAAc1C,KAAd,GAAsBtE,OAAO,CAAC23B,YAA9D;AACA/2B,MAAAA,IAAI,CAACwD,kBAAL,CAAwBC,GAAxB,GAA8BoH,OAAO,CAACzE,KAAR,CAAc3C,GAAd,GAAoB,CAACrE,OAAO,CAAC6uB,gBAAR,GAA2B,CAA3B,GAAgC,CAAC,CAAD,GAAKpjB,OAAO,CAACwB,YAA9C,IAA+D,IAAjH;AAEA,UAAI,OAAOtL,SAAS,CAACohC,UAAjB,KAAgC,UAApC,EAAgDphC,SAAS,CAACohC,UAAV,CAAqBt3B,OAArB,EAA8B7L,OAA9B,EAAuCgB,IAAvC;AAEhDyL,MAAAA,KAAK,CAACsjB,eAAN;AACA/uB,MAAAA,IAAI,CAACwD,kBAAL,CAAwBG,MAAxB,GAAiC,IAAjC;AACAkH,MAAAA,OAAO,CAACzE,KAAR,CAAc+E,UAAd,GAA2B,EAA3B;AACH,KAneS;AAqeV6gB,IAAAA,YAAY,EAAE,wBAAY;AACtB,UAAI,CAAChsB,IAAI,CAAC4D,eAAN,IAAyB,CAAC5D,IAAI,CAACyF,SAAL,CAAeG,YAA7C,EAA2D;AACvD5G,QAAAA,OAAO,CAACO,OAAR,CAAgBsL,OAAhB,CAAwBzE,KAAxB,CAA8BqE,OAA9B,GAAwC,MAAxC;AACAzK,QAAAA,IAAI,CAACwD,kBAAL,CAAwBG,MAAxB,GAAiC,KAAjC;AACH;AACJ,KA1eS;AA4eVy+B,IAAAA,eAAe,EAAE,yBAAUh1B,CAAV,EAAa;AAC1B,UAAIpN,IAAI,CAAC8C,UAAL,IAAmB9C,IAAI,CAAC6C,UAA5B,EAAwC;AACpCuK,QAAAA,CAAC,CAACC,cAAF;AACAD,QAAAA,CAAC,CAACE,eAAF;AACAtN,QAAAA,IAAI,CAACkB,OAAL,CAAamhC,EAAb,CAAgBriC,IAAI,CAACkB,OAAL,CAAaohC,eAAb,EAAhB;AACA,eAAO,KAAP;AACH;;AAEDtiC,MAAAA,IAAI,CAACgP,YAAL,GAR0B,CAU1B;;;AACA,UAAI,OAAOjO,SAAS,CAACwhC,OAAjB,KAA6B,UAA7B,IAA2CxhC,SAAS,CAACwhC,OAAV,CAAkBn1B,CAAlB,EAAqBpN,IAArB,MAA+B,KAA9E,EAAqF;AAErF,UAAM0c,IAAI,GAAG,CAACtP,CAAC,CAACsP,IAAF,KAAW,IAAX,GAAkB,EAAlB,GAAuBtP,CAAC,CAACsP,IAAF,KAAWC,SAAX,GAAuB,GAAvB,GAA6BvP,CAAC,CAACsP,IAAvD,KAAgE,EAA7E;;AACA,UAAI,CAAC1c,IAAI,CAAC61B,UAAL,CAAgBnZ,IAAhB,CAAL,EAA4B;AACxBtP,QAAAA,CAAC,CAACC,cAAF;AACAD,QAAAA,CAAC,CAACE,eAAF;AACA,eAAO,KAAP;AACH,OAlByB,CAoB1B;;;AACAtN,MAAAA,IAAI,CAACkB,OAAL,CAAa4H,IAAb,CAAkB,IAAlB;AACH,KAlgBS;AAogBV05B,IAAAA,iBAAiB,EAAE,2BAAUjzB,KAAV,EAAiBkzB,OAAjB,EAA0B;AACzC,UAAMjhC,SAAS,GAAGihC,OAAO,GAAGlzB,KAAK,CAACE,cAAT,GAA0BF,KAAK,CAACG,YAAzD;AACA,UAAMvB,MAAM,GAAGs0B,OAAO,GAAGlzB,KAAK,CAACQ,WAAT,GAAuBR,KAAK,CAACgB,SAAnD;AACA,UAAMmyB,UAAU,GAAGD,OAAO,GAAG,iBAAH,GAAuB,aAAjD;AACA,UAAME,SAAS,GAAGnhC,SAAS,CAAC0P,QAAV,KAAuB,CAAzC;AACA,UAAI0xB,WAAJ;;AAEA,UAAID,SAAJ,EAAe;AACXC,QAAAA,WAAW,GAAGn3B,KAAK,CAACo3B,4BAAN,CAAmCrhC,SAAS,CAACyP,UAAV,CAAqB9C,MAArB,CAAnC,EAAiEu0B,UAAjE,EAA6ElhC,SAA7E,CAAd;AACA,eAAOohC,WAAW,IAAIA,WAAW,CAAC1xB,QAAZ,KAAyB,CAAxC,IAA6C0xB,WAAW,CAAC76B,YAAZ,CAAyB,iBAAzB,MAAgD,OAApG;AACH,OAHD,MAGO;AACH66B,QAAAA,WAAW,GAAGn3B,KAAK,CAACo3B,4BAAN,CAAmCrhC,SAAnC,EAA8CkhC,UAA9C,EAA0DlhC,SAA1D,CAAd;AACA,eAAOxB,IAAI,CAACgX,WAAL,CAAiBxV,SAAjB,EAA4B2M,MAA5B,EAAoCs0B,OAAO,GAAG,OAAH,GAAa,KAAxD,KAAmEG,WAAW,IAAIA,WAAW,CAAC1xB,QAAZ,KAAyB,CAAxC,IAA6C0xB,WAAW,CAAC76B,YAAZ,CAAyB,iBAAzB,MAAgD,OAAvK;AACH;AACJ,KAlhBS;AAohBV86B,IAAAA,4BAA4B,EAAE,sCAAUC,UAAV,EAAsBJ,UAAtB,EAAkClhC,SAAlC,EAA6C;AACvE,UAAI,CAACshC,UAAL,EAAiB,OAAO,IAAP;AACjB,UAAIF,WAAW,GAAGE,UAAU,CAACJ,UAAD,CAA5B;;AAEA,UAAI,CAACE,WAAL,EAAkB;AACdA,QAAAA,WAAW,GAAG9iC,IAAI,CAAC6U,gBAAL,CAAsBnT,SAAtB,CAAd;AACAohC,QAAAA,WAAW,GAAGA,WAAW,GAAGA,WAAW,CAACF,UAAD,CAAd,GAA6B,IAAtD;AACA,YAAIE,WAAW,IAAI,CAAC9iC,IAAI,CAACmQ,WAAL,CAAiB2yB,WAAjB,CAApB,EAAmDA,WAAW,GAAGF,UAAU,KAAK,iBAAf,GAAmCE,WAAW,CAACn0B,iBAA/C,GAAmEm0B,WAAW,CAAChyB,gBAA7F,CAAnD,KACK,OAAO,IAAP;AACR;;AAED,aAAOgyB,WAAP;AACH,KAhiBS;AAkiBVG,IAAAA,cAAc,EAAE,KAliBN;AAmiBVC,IAAAA,iBAAiB,EAAE,2BAAU51B,CAAV,EAAa;AAC5B,UAAMO,OAAO,GAAGP,CAAC,CAACO,OAAlB;AACA,UAAMud,KAAK,GAAG9d,CAAC,CAAC61B,QAAhB;AACA,UAAMC,IAAI,GAAG91B,CAAC,CAAC+1B,OAAF,IAAa/1B,CAAC,CAACg2B,OAAf,IAA0Bz1B,OAAO,KAAK,EAAtC,IAA4CA,OAAO,KAAK,EAAxD,IAA8DA,OAAO,KAAK,GAAvF;AACA,UAAM01B,GAAG,GAAGj2B,CAAC,CAACk2B,MAAd;AACA73B,MAAAA,KAAK,CAACwyB,cAAN,GAAuBtwB,OAAO,KAAK,GAAnC;;AAEA,UAAI,CAACu1B,IAAD,IAASljC,IAAI,CAAC8C,UAAd,IAA4B,CAAC2I,KAAK,CAAC0yB,iBAAN,CAAwB1wB,IAAxB,CAA6BE,OAA7B,CAAjC,EAAwE;AACpEP,QAAAA,CAAC,CAACC,cAAF;AACA,eAAO,KAAP;AACH;;AAEDrN,MAAAA,IAAI,CAACmK,UAAL;;AAEA,UAAInK,IAAI,CAACsD,UAAT,EAAqB;AACjBmI,QAAAA,KAAK,CAACugB,YAAN;AACH,OAhB2B,CAkB5B;;;AACA,UAAI,OAAOjrB,SAAS,CAACwiC,SAAjB,KAA+B,UAA/B,IAA6CxiC,SAAS,CAACwiC,SAAV,CAAoBn2B,CAApB,EAAuBpN,IAAvB,MAAiC,KAAlF,EAAyF;AAEzF;;AACA,UAAIkjC,IAAI,IAAIz3B,KAAK,CAACgzB,gBAAN,CAAuB9wB,OAAvB,EAAgCud,KAAhC,CAAZ,EAAoD;AAChDzf,QAAAA,KAAK,CAACs3B,cAAN,GAAuB,IAAvB;AACA31B,QAAAA,CAAC,CAACC,cAAF;AACAD,QAAAA,CAAC,CAACE,eAAF;AACA,eAAO,KAAP;AACH,OALD,MAKO,IAAI7B,KAAK,CAACs3B,cAAV,EAA0B;AAC7Bt3B,QAAAA,KAAK,CAACs3B,cAAN,GAAuB,KAAvB;AACH;AAED;;;AACA,UAAIlvB,aAAa,GAAG7T,IAAI,CAACmP,gBAAL,EAApB;AACA,UAAMI,KAAK,GAAGvP,IAAI,CAACwP,QAAL,EAAd;AACA,UAAMg0B,WAAW,GAAG,CAACj0B,KAAK,CAACgD,SAAP,IAAoBhD,KAAK,CAACE,cAAN,KAAyBF,KAAK,CAACG,YAAvE;AACA,UAAM+zB,iBAAiB,GAAGzjC,IAAI,CAACwE,YAAL,CAAkBI,YAAlB,CAA+B6I,IAA/B,CAAoCzN,IAAI,CAAC+B,qBAAzC,IAAkE/B,IAAI,CAAC+B,qBAAvE,GAA+F,EAAzH;AACA,UAAIwW,QAAQ,GAAGzY,IAAI,CAAC6U,gBAAL,CAAsBd,aAAtB,EAAqC,IAArC,KAA8CA,aAA7D;AACA,UAAI2L,OAAO,GAAG1f,IAAI,CAAC8U,qBAAL,CAA2B2D,QAA3B,EAAqC,IAArC,CAAd;;AAEA,cAAQ5K,OAAR;AACI,aAAK,CAAL;AAAQ;AACJ,cAAI,CAAC61B,WAAL,EAAkB;AACd,gBAAIC,iBAAJ,EAAuB;AACnBr2B,cAAAA,CAAC,CAACC,cAAF;AACAD,cAAAA,CAAC,CAACE,eAAF;AACAtN,cAAAA,IAAI,CAACd,OAAL,CAAaukC,iBAAb,EAAgCC,OAAhC,CAAwCn5B,IAAxC,CAA6CvK,IAA7C;AACA;AACH;AACJ;;AAED,cAAIwjC,WAAW,IAAI/3B,KAAK,CAACk4B,WAAN,EAAnB,EAAwC;AACpCv2B,YAAAA,CAAC,CAACC,cAAF;AACAD,YAAAA,CAAC,CAACE,eAAF;AACA;AACH;;AAED,cAAI,CAACxN,IAAI,CAACkQ,eAAL,CAAqBuI,QAArB,CAAD,IAAmC,CAACvZ,OAAO,CAACO,OAAR,CAAgB8P,OAAhB,CAAwBZ,iBAA5D,IAAiF,CAAC3O,IAAI,CAACmQ,WAAL,CAAiB4D,aAAjB,CAAlF,IAAqH7T,IAAI,CAACg8B,iBAAL,CAAuB58B,OAAO,CAAC+Q,UAA/B,MAA+C,IAAxK,EAA8K;AAC1K/C,YAAAA,CAAC,CAACC,cAAF;AACAD,YAAAA,CAAC,CAACE,eAAF;AACA,mBAAO,KAAP;AACH;;AAED,cAAI,CAACk2B,WAAD,IAAgB,CAACjrB,QAAQ,CAACrD,sBAA1B,IAAqD3F,KAAK,CAACQ,WAAN,KAAsB,CAAtB,IAA2B,CAAC8D,aAAa,CAACsB,eAA1C,IAA6D,CAACrV,IAAI,CAACuW,UAAL,CAAgBkC,QAAhB,CAA9D,IACvDzY,IAAI,CAACkQ,eAAL,CAAqBuI,QAArB,MAAmC,CAACzY,IAAI,CAAC+X,mBAAL,CAAyBU,QAAzB,CAAD,IAAuCzY,IAAI,CAAC8jC,0BAAL,CAAgCrrB,QAAhC,CAA1E,CADF,EAC0H;AACtH;AACA,gBAAIzY,IAAI,CAAC+jC,2BAAL,CAAiCtrB,QAAQ,CAACzD,UAA1C,CAAJ,EAA2D;AACvD1H,cAAAA,CAAC,CAACC,cAAF;AACAD,cAAAA,CAAC,CAACE,eAAF;AACA,qBAAO,KAAP;AACH,aANqH,CAOtH;;;AACA,gBAAIxN,IAAI,CAAC6P,YAAL,CAAkB4I,QAAQ,CAACzD,UAA3B,KAA0CyD,QAAQ,CAACtH,UAAT,CAAoBnJ,MAApB,IAA8B,CAAxE,KAA8E,CAACyQ,QAAQ,CAACzE,UAAV,IAAwBhU,IAAI,CAAC8Y,kBAAL,CAAwBL,QAAQ,CAACpH,WAAjC,CAAtG,CAAJ,EAA0J;AACtJ/D,cAAAA,CAAC,CAACC,cAAF;AACAD,cAAAA,CAAC,CAACE,eAAF;;AAEA,kBAAIiL,QAAQ,CAACtE,QAAT,CAAkB8mB,WAAlB,OAAoC37B,OAAO,CAAC+Q,UAAR,CAAmB4qB,WAAnB,EAAxC,EAA0E;AACtExiB,gBAAAA,QAAQ,CAAC5E,SAAT,GAAqB,MAArB;AACA,oBAAMwZ,KAAK,GAAG5U,QAAQ,CAAC6U,UAAvB;;AACA,uBAAOD,KAAK,CAAC,CAAD,CAAZ,EAAiB;AACb5U,kBAAAA,QAAQ,CAACyL,eAAT,CAAyBmJ,KAAK,CAAC,CAAD,CAAL,CAAShkB,IAAlC;AACH;AACJ,eAND,MAMO;AACH,oBAAM26B,aAAa,GAAGhkC,IAAI,CAACoQ,aAAL,CAAmB9Q,OAAO,CAAC+Q,UAA3B,CAAtB;AACA2zB,gBAAAA,aAAa,CAACnwB,SAAd,GAA0B,MAA1B;AACA4E,gBAAAA,QAAQ,CAACpQ,aAAT,CAAuBC,YAAvB,CAAoC07B,aAApC,EAAmDvrB,QAAnD;AACH;;AAEDvY,cAAAA,IAAI,CAAC8O,WAAL;AACA,qBAAO,KAAP;AACH;AACJ,WAlDL,CAoDI;;;AACA,cAAIyJ,QAAQ,IAAIhJ,KAAK,CAACE,cAAN,KAAyBF,KAAK,CAACG,YAA3C,IAA2DmE,aAAa,CAAC3C,QAAd,KAA2B,CAAtF,IAA2F,CAACpR,IAAI,CAACkQ,eAAL,CAAqB6D,aAAa,CAACiB,UAAnC,CAAhG,EAAgJ;AAC5I,gBAAIvF,KAAK,CAACgD,SAAN,GAAkBsB,aAAa,CAAC1C,WAAd,CAA0BrJ,MAA1B,KAAqC,CAAvD,GAA4DyH,KAAK,CAACgB,SAAN,GAAkBhB,KAAK,CAACQ,WAAzB,KAA0C8D,aAAa,CAAC1C,WAAd,CAA0BrJ,MAAnI,EAA2I;AACvIsF,cAAAA,CAAC,CAACC,cAAF;AAEA,kBAAIc,MAAM,GAAG,IAAb;AACA,kBAAI41B,IAAI,GAAGlwB,aAAa,CAACiB,UAAd,CAAyBK,eAApC;AACA,kBAAMuG,IAAI,GAAG7H,aAAa,CAACiB,UAAd,CAAyBJ,WAAtC;;AACA,kBAAI,CAACqvB,IAAL,EAAW;AACP,oBAAI,CAACroB,IAAL,EAAW;AACPqoB,kBAAAA,IAAI,GAAGjkC,IAAI,CAACoQ,aAAL,CAAmB,IAAnB,CAAP;AACAqI,kBAAAA,QAAQ,CAACzO,WAAT,CAAqBi6B,IAArB;AACH,iBAHD,MAGO;AACHA,kBAAAA,IAAI,GAAGroB,IAAP;AACAvN,kBAAAA,MAAM,GAAG,CAAT;AACH;AACJ;;AAED0F,cAAAA,aAAa,CAAC1C,WAAd,GAA4B,EAA5B;AACArR,cAAAA,IAAI,CAACmd,oBAAL,CAA0BpJ,aAA1B,EAAyC,IAAzC,EAA+C0E,QAA/C;AACApK,cAAAA,MAAM,GAAG,OAAOA,MAAP,KAAkB,QAAlB,GAA6BA,MAA7B,GAAsC41B,IAAI,CAAC7yB,QAAL,KAAkB,CAAlB,GAAsB6yB,IAAI,CAAC5yB,WAAL,CAAiBrJ,MAAvC,GAAgD,CAA/F;AACA9H,cAAAA,IAAI,CAACsQ,QAAL,CAAcyzB,IAAd,EAAoB51B,MAApB,EAA4B41B,IAA5B,EAAkC51B,MAAlC;AACA;AACH;AACJ,WA5EL,CA8EI;;;AACA,cAAI1C,KAAK,CAAC+2B,iBAAN,CAAwBjzB,KAAxB,EAA+B,IAA/B,CAAJ,EAA0C;AACtCnC,YAAAA,CAAC,CAACC,cAAF;AACAD,YAAAA,CAAC,CAACE,eAAF;AACA;AACH,WAnFL,CAqFI;;;AACA,cAAMkI,SAAS,GAAGjG,KAAK,CAACM,uBAAxB;AACA0I,UAAAA,QAAQ,GAAGzY,IAAI,CAAC6U,gBAAL,CAAsBpF,KAAK,CAACE,cAA5B,EAA4C,IAA5C,CAAX;AACA+P,UAAAA,OAAO,GAAG1f,IAAI,CAAC8U,qBAAL,CAA2B2D,QAA3B,EAAqC,IAArC,CAAV;;AACA,cAAIiH,OAAO,IAAIjH,QAAX,IAAuB,CAACzY,IAAI,CAAC+U,MAAL,CAAY2K,OAAZ,CAAxB,IAAgD,CAAC,gBAAgB/R,IAAhB,CAAqB+R,OAAO,CAACvL,QAA7B,CAArD,EAA6F;AACzF,gBAAInU,IAAI,CAACuW,UAAL,CAAgBkC,QAAhB,KAA6BzY,IAAI,CAAC2Z,MAAL,CAAY+F,OAAZ,CAA7B,KAAsD1f,IAAI,CAACuW,UAAL,CAAgBmJ,OAAO,CAAC1K,UAAxB,KAAuCyD,QAAQ,CAACrD,sBAAtG,MAAkIrB,aAAa,KAAK0E,QAAlB,IAA+B1E,aAAa,CAAC3C,QAAd,KAA2B,CAA3B,KAAiC,CAAC2C,aAAa,CAACsB,eAAf,IAAkCrV,IAAI,CAAC2Z,MAAL,CAAY5F,aAAa,CAACsB,eAA1B,CAAnE,CAAjK,MACFrV,IAAI,CAAC6U,gBAAL,CAAsBpF,KAAK,CAACE,cAA5B,EAA4C,IAA5C,MAAsD3P,IAAI,CAAC6U,gBAAL,CAAsBpF,KAAK,CAACG,YAA5B,EAA0C,IAA1C,CAAtD,GAAwG8P,OAAO,CAAChS,QAAR,CAAiB+B,KAAK,CAACE,cAAvB,CAAxG,GAAkJF,KAAK,CAACQ,WAAN,KAAsB,CAAtB,IAA4BR,KAAK,CAACgD,SADlL,CAAJ,EACmM;AAC/L,kBAAIhD,KAAK,CAACE,cAAN,KAAyBF,KAAK,CAACG,YAAnC,EAAiD;AAC7CtC,gBAAAA,CAAC,CAACC,cAAF;AAEArN,gBAAAA,IAAI,CAACqY,UAAL;;AACA,oBAAI9I,KAAK,CAACE,cAAN,CAAqByB,QAArB,KAAkC,CAAtC,EAAyC;AACrClR,kBAAAA,IAAI,CAACsQ,QAAL,CAAcf,KAAK,CAACE,cAApB,EAAoCF,KAAK,CAACE,cAAN,CAAqB0B,WAArB,CAAiCrJ,MAArE,EAA6EyH,KAAK,CAACE,cAAnF,EAAmGF,KAAK,CAACE,cAAN,CAAqB0B,WAArB,CAAiCrJ,MAApI;AACH,iBAN4C,CAO7C;;;AACA9H,gBAAAA,IAAI,CAACkB,OAAL,CAAa4H,IAAb,CAAkB,IAAlB;AACH,eATD,MASO;AACH,oBAAIi7B,KAAI,GAAGxrB,QAAQ,CAACrD,sBAAT,IAAmCsK,OAAO,CAAC1K,UAAtD;;AACA,oBAAIhV,IAAI,CAACuW,UAAL,CAAgB0tB,KAAhB,CAAJ,EAA2B;AACvB32B,kBAAAA,CAAC,CAACC,cAAF;AAEA,sBAAI22B,QAAQ,GAAGD,KAAf;;AACA,sBAAI,CAACA,KAAI,CAACv2B,QAAL,CAAc+K,QAAd,CAAD,IAA4BzY,IAAI,CAACuW,UAAL,CAAgB2tB,QAAhB,CAA5B,IAAyDlkC,IAAI,CAAC2Z,MAAL,CAAYuqB,QAAQ,CAACpzB,gBAArB,CAA7D,EAAqG;AACjGozB,oBAAAA,QAAQ,GAAGA,QAAQ,CAACpzB,gBAAT,CAA0BA,gBAArC;;AACA,2BAAO9Q,IAAI,CAACuW,UAAL,CAAgB2tB,QAAhB,KAA6BlkC,IAAI,CAAC2Z,MAAL,CAAYuqB,QAAQ,CAACpzB,gBAArB,CAApC,EAA4E;AACxEozB,sBAAAA,QAAQ,GAAGA,QAAQ,CAACpzB,gBAAT,IAA6BozB,QAAQ,CAACpzB,gBAAT,CAA0BA,gBAAlE;AACH;;AACDmzB,oBAAAA,KAAI,GAAGC,QAAP;AACH;;AAED,sBAAIC,GAAG,GAAGF,KAAI,KAAKvkB,OAAO,CAAC1K,UAAjB,GAA8B0K,OAAO,CAACrK,eAAtC,GAAwD4uB,KAAI,CAACxvB,SAAvE;;AACA,sBAAI,CAAC0vB,GAAL,EAAU;AACNA,oBAAAA,GAAG,GAAGnkC,IAAI,CAACkV,cAAL,CAAoBlV,IAAI,CAACmV,cAAzB,CAAN;AACAuK,oBAAAA,OAAO,CAAC1K,UAAR,CAAmBzE,YAAnB,CAAgC4zB,GAAhC,EAAqCzkB,OAAO,CAAC1K,UAAR,CAAmBhB,UAAxD;AACH;;AACD,sBAAM3F,OAAM,GAAG81B,GAAG,CAAC/yB,QAAJ,KAAiB,CAAjB,GAAqB+yB,GAAG,CAAC9yB,WAAJ,CAAgBrJ,MAArC,GAA8C,CAA7D;;AACA,sBAAMgI,QAAQ,GAAGyI,QAAQ,CAACtH,UAA1B;AACA,sBAAIizB,KAAK,GAAGD,GAAZ;AACA,sBAAIte,KAAK,GAAG7V,QAAQ,CAAC,CAAD,CAApB;;AACA,yBAAQ6V,KAAK,GAAG7V,QAAQ,CAAC,CAAD,CAAxB,EAA8B;AAC1Bi0B,oBAAAA,KAAI,CAAC1zB,YAAL,CAAkBsV,KAAlB,EAAyBue,KAAK,CAACxvB,WAA/B;;AACAwvB,oBAAAA,KAAK,GAAGve,KAAR;AACH;;AAED7lB,kBAAAA,IAAI,CAACsV,UAAL,CAAgBmD,QAAhB;AACA,sBAAIiH,OAAO,CAAC1P,QAAR,CAAiBhI,MAAjB,KAA4B,CAAhC,EAAmChI,IAAI,CAACsV,UAAL,CAAgBoK,OAAhB;AAEnCxf,kBAAAA,IAAI,CAACsQ,QAAL,CAAc2zB,GAAd,EAAmB91B,OAAnB,EAA2B81B,GAA3B,EAAgC91B,OAAhC,EA7BuB,CA8BvB;;AACAnO,kBAAAA,IAAI,CAACkB,OAAL,CAAa4H,IAAb,CAAkB,IAAlB;AACH;AACJ;;AAED;AACH,aAlDwF,CAoDzF;;;AACA,gBAAI,CAAC06B,WAAD,IAAgBj0B,KAAK,CAACQ,WAAN,KAAsB,CAA1C,EAA6C;AACzC,kBAAIo0B,MAAM,GAAG,IAAb;AACA,kBAAInwB,IAAI,GAAGwB,SAAX;;AACA,qBAAOxB,IAAI,IAAIA,IAAI,KAAKwL,OAAjB,IAA4B,CAAC1f,IAAI,CAAC6P,YAAL,CAAkBqE,IAAlB,CAApC,EAA6D;AACzD,oBAAIA,IAAI,CAACmB,eAAT,EAA0B;AACtB,sBAAInB,IAAI,CAACmB,eAAL,CAAqBjE,QAArB,KAAkC,CAAlC,IAAuC,CAACpR,IAAI,CAAC8Y,kBAAL,CAAwB5E,IAAI,CAACmB,eAAL,CAAqBhE,WAArB,CAAiCoE,IAAjC,EAAxB,CAA5C,EAA8G;AAC1G4uB,oBAAAA,MAAM,GAAG,KAAT;AACA;AACH;AACJ;;AACDnwB,gBAAAA,IAAI,GAAGA,IAAI,CAACc,UAAZ;AACH;;AAED,kBAAIqvB,MAAM,IAAI3kB,OAAO,CAAC1K,UAAtB,EAAkC;AAC9B1H,gBAAAA,CAAC,CAACC,cAAF;AACArN,gBAAAA,IAAI,CAAC6e,wBAAL,CAA8BW,OAA9B,EAAwC1f,IAAI,CAACuW,UAAL,CAAgBkC,QAAhB,IAA4B,CAACA,QAAD,CAA5B,GAAyC,IAAjF,EAAwF,IAAxF,EAA8F,KAA9F,EAAqG,KAArG,EAF8B,CAG9B;;AACAvY,gBAAAA,IAAI,CAACkB,OAAL,CAAa4H,IAAb,CAAkB,IAAlB;AACA;AACH;AACJ;AACJ,WAnKL,CAqKI;;;AACA,cAAI,CAAC06B,WAAD,IAAgBjrB,QAAhB,KAA6BhJ,KAAK,CAACQ,WAAN,KAAsB,CAAtB,KAA4B8D,aAAa,KAAK0E,QAAlB,GAA6B,CAAC,CAACA,QAAQ,CAACtH,UAAT,CAAoB1B,KAAK,CAACQ,WAA1B,CAA/B,GAAwE,KAApG,CAA7B,CAAJ,EAA8I;AAC1I,gBAAMyV,GAAG,GAAG3R,aAAa,KAAK0E,QAAlB,GAA6BA,QAAQ,CAACtH,UAAT,CAAoB1B,KAAK,CAACQ,WAA1B,CAA7B,GAAsE8D,aAAlF;AACA,gBAAMkwB,MAAI,GAAGxrB,QAAQ,CAACpD,eAAtB,CAF0I,CAG1I;;AACA,gBAAMivB,SAAS,GAAG,CAAC5uB,SAAS,CAACtE,QAAV,KAAuB,CAAvB,IAA4BpR,IAAI,CAAC0U,OAAL,CAAagB,SAAb,CAA7B,KAAyD,CAACA,SAAS,CAACL,eAApE,IAAuF5F,KAAK,CAACQ,WAAN,KAAsB,CAA/H;;AACA,gBAAI,CAACyV,GAAG,CAACrQ,eAAL,KAAyBrV,IAAI,CAACmQ,WAAL,CAAiBuF,SAAS,CAACL,eAA3B,KAAgDivB,SAAS,IAAItkC,IAAI,CAACmQ,WAAL,CAAiB8zB,MAAjB,CAAtF,CAAJ,EAAoH;AAChH,kBAAMlzB,iBAAiB,GAAG7Q,IAAI,CAACiN,gBAAL,CAAsB82B,MAAtB,CAA1B;;AACA,kBAAIlzB,iBAAJ,EAAuB;AACnBzD,gBAAAA,CAAC,CAACC,cAAF;AACAD,gBAAAA,CAAC,CAACE,eAAF;AACA,oBAAIiL,QAAQ,CAACpH,WAAT,CAAqBrJ,MAArB,KAAgC,CAApC,EAAuChI,IAAI,CAACsV,UAAL,CAAgBmD,QAAhB;AACvC,oBAAIvY,IAAI,CAAC8Q,eAAL,CAAqBD,iBAAiB,CAACjH,MAAvC,EAA+CiH,iBAAiB,CAACtI,UAAjE,MAAiF,KAArF,EAA4FvI,IAAI,CAACoR,IAAL;AAC/F,eALD,MAKO,IAAItR,IAAI,CAACmQ,WAAL,CAAiB8zB,MAAjB,CAAJ,EAA4B;AAC/B32B,gBAAAA,CAAC,CAACC,cAAF;AACAD,gBAAAA,CAAC,CAACE,eAAF;AACAxN,gBAAAA,IAAI,CAACsV,UAAL,CAAgB2uB,MAAhB;AACH;;AACD;AACH,aAlByI,CAmB1I;;;AACA,gBAAIjkC,IAAI,CAACgiB,aAAL,CAAmB0D,GAAG,CAACrQ,eAAvB,CAAJ,EAA6C;AACzC/H,cAAAA,CAAC,CAACC,cAAF;AACAD,cAAAA,CAAC,CAACE,eAAF;AACAxN,cAAAA,IAAI,CAACsV,UAAL,CAAgBoQ,GAAG,CAACrQ,eAApB;AACA;AACH;AACJ;;AAED;;AACJ,aAAK,EAAL;AAAS;AACL,cAAIsuB,iBAAJ,EAAuB;AACnBr2B,YAAAA,CAAC,CAACC,cAAF;AACAD,YAAAA,CAAC,CAACE,eAAF;AACAtN,YAAAA,IAAI,CAACd,OAAL,CAAaukC,iBAAb,EAAgCC,OAAhC,CAAwCn5B,IAAxC,CAA6CvK,IAA7C;AACA;AACH;;AAED,cAAIwjC,WAAW,IAAI/3B,KAAK,CAACk4B,WAAN,EAAnB,EAAwC;AACpCv2B,YAAAA,CAAC,CAACC,cAAF;AACAD,YAAAA,CAAC,CAACE,eAAF;AACA;AACH,WAZL,CAcI;;;AACA,cAAI7B,KAAK,CAAC+2B,iBAAN,CAAwBjzB,KAAxB,EAA+B,KAA/B,CAAJ,EAA2C;AACvCnC,YAAAA,CAAC,CAACC,cAAF;AACAD,YAAAA,CAAC,CAACE,eAAF;AACA;AACH,WAnBL,CAqBI;;;AACA,cAAI,CAACxN,IAAI,CAACkQ,eAAL,CAAqB6D,aAArB,KAAuCA,aAAa,CAACa,WAAd,KAA8B,IAArE,IAA8E5U,IAAI,CAAC8Y,kBAAL,CAAwB/E,aAAa,CAACa,WAAtC,KAAsDb,aAAa,CAACa,WAAd,CAA0BA,WAA1B,KAA0C,IAA/K,KAAyLnF,KAAK,CAACQ,WAAN,KAAsB8D,aAAa,CAAC1C,WAAd,CAA0BrJ,MAA7O,EAAqP;AACjP,gBAAMu8B,MAAM,GAAG9rB,QAAQ,CAAC3E,kBAAxB;AACA,gBAAI,CAACywB,MAAL,EAAa;;AACb,gBAAIvkC,IAAI,CAACmQ,WAAL,CAAiBo0B,MAAjB,CAAJ,EAA8B;AAC1Bj3B,cAAAA,CAAC,CAACC,cAAF;;AAEA,kBAAIvN,IAAI,CAAC8Y,kBAAL,CAAwBL,QAAxB,CAAJ,EAAuC;AACnCzY,gBAAAA,IAAI,CAACsV,UAAL,CAAgBmD,QAAhB,EADmC,CAEnC;;AACA,oBAAIzY,IAAI,CAACoW,OAAL,CAAamuB,MAAb,CAAJ,EAA0B;AACtB,sBAAIC,IAAI,GAAGxkC,IAAI,CAACiR,eAAL,CAAqBszB,MAArB,EAA6BvkC,IAAI,CAAC+U,MAAlC,EAA0C,KAA1C,CAAX;AACAyvB,kBAAAA,IAAI,GAAGA,IAAI,CAAC71B,iBAAL,IAA0B61B,IAAjC;AACAtkC,kBAAAA,IAAI,CAACsQ,QAAL,CAAcg0B,IAAd,EAAoB,CAApB,EAAuBA,IAAvB,EAA6B,CAA7B;AACA;AACH;AACJ,eAZyB,CAc1B;;;AACA,kBAAMzzB,kBAAiB,GAAG7Q,IAAI,CAACiN,gBAAL,CAAsBo3B,MAAtB,CAA1B;;AACA,kBAAIxzB,kBAAJ,EAAuB;AACnBzD,gBAAAA,CAAC,CAACE,eAAF;AACA,oBAAItN,IAAI,CAAC8Q,eAAL,CAAqBD,kBAAiB,CAACjH,MAAvC,EAA+CiH,kBAAiB,CAACtI,UAAjE,MAAiF,KAArF,EAA4FvI,IAAI,CAACoR,IAAL;AAC/F,eAHD,MAGO,IAAItR,IAAI,CAACmQ,WAAL,CAAiBo0B,MAAjB,CAAJ,EAA8B;AACjCj3B,gBAAAA,CAAC,CAACE,eAAF;AACAxN,gBAAAA,IAAI,CAACsV,UAAL,CAAgBivB,MAAhB;AACH;;AAED;AACH;AACJ;;AAED,cAAI,CAACb,WAAD,KAAiBxjC,IAAI,CAACgX,WAAL,CAAiBzH,KAAK,CAACG,YAAvB,EAAqCH,KAAK,CAACgB,SAA3C,MAA0DsD,aAAa,KAAK0E,QAAlB,GAA6B,CAAC,CAACA,QAAQ,CAACtH,UAAT,CAAoB1B,KAAK,CAACQ,WAA1B,CAA/B,GAAwE,KAAlI,CAAjB,CAAJ,EAAgK;AAC5J,gBAAMyV,IAAG,GAAG3R,aAAa,KAAK0E,QAAlB,GAA6BA,QAAQ,CAACtH,UAAT,CAAoB1B,KAAK,CAACQ,WAA1B,KAA0C8D,aAAvE,GAAuFA,aAAnG,CAD4J,CAE5J;;;AACA,gBAAI2R,IAAG,IAAI1lB,IAAI,CAACgiB,aAAL,CAAmB0D,IAAG,CAAC9Q,WAAvB,CAAX,EAAgD;AAC5CtH,cAAAA,CAAC,CAACC,cAAF;AACAD,cAAAA,CAAC,CAACE,eAAF;AACAxN,cAAAA,IAAI,CAACsV,UAAL,CAAgBoQ,IAAG,CAAC9Q,WAApB;AACA;AACH,aALD,MAKO,IAAI5U,IAAI,CAACmQ,WAAL,CAAiBuV,IAAjB,CAAJ,EAA2B;AAC9BpY,cAAAA,CAAC,CAACC,cAAF;AACAD,cAAAA,CAAC,CAACE,eAAF;AACAxN,cAAAA,IAAI,CAACsV,UAAL,CAAgBoQ,IAAhB;AACA;AACH;AACJ,WAnEL,CAqEI;;;AACAjN,UAAAA,QAAQ,GAAGzY,IAAI,CAAC6U,gBAAL,CAAsBpF,KAAK,CAACE,cAA5B,EAA4C,IAA5C,CAAX;AACA+P,UAAAA,OAAO,GAAG1f,IAAI,CAAC8U,qBAAL,CAA2B2D,QAA3B,EAAqC,IAArC,CAAV;;AACA,cAAIzY,IAAI,CAACuW,UAAL,CAAgBkC,QAAhB,KAA6BzY,IAAI,CAAC2Z,MAAL,CAAY+F,OAAZ,CAA7B,KAAsD3L,aAAa,KAAK0E,QAAlB,IAA+B1E,aAAa,CAAC3C,QAAd,KAA2B,CAA3B,KAAiC,CAAC2C,aAAa,CAACa,WAAf,IAA8B5U,IAAI,CAAC2Z,MAAL,CAAY5F,aAAa,CAACa,WAA1B,CAA/D,MACvF5U,IAAI,CAAC6U,gBAAL,CAAsBpF,KAAK,CAACE,cAA5B,EAA4C,IAA5C,MAAsD3P,IAAI,CAAC6U,gBAAL,CAAsBpF,KAAK,CAACG,YAA5B,EAA0C,IAA1C,CAAtD,GAAwG8P,OAAO,CAAChS,QAAR,CAAiB+B,KAAK,CAACG,YAAvB,CAAxG,GAAgJH,KAAK,CAACgB,SAAN,KAAoBsD,aAAa,CAAC1C,WAAd,CAA0BrJ,MAA9C,IAAwDyH,KAAK,CAACgD,SADvH,CAArF,CAAJ,EAC+N;AAC3N,gBAAIhD,KAAK,CAACE,cAAN,KAAyBF,KAAK,CAACG,YAAnC,EAAiD1P,IAAI,CAACqY,UAAL;;AAEjD,gBAAIqD,KAAI,GAAG5b,IAAI,CAACub,YAAL,CAAkB9C,QAAQ,CAACzI,QAA3B,EAAqChQ,IAAI,CAAC2Z,MAA1C,EAAkD,KAAlD,CAAX;;AACAiC,YAAAA,KAAI,GAAGA,KAAI,IAAInD,QAAQ,CAAC3E,kBAAjB,IAAuC4L,OAAO,CAAC1K,UAAR,CAAmBlB,kBAAjE;;AACA,gBAAI8H,KAAI,KAAK5b,IAAI,CAAC2Z,MAAL,CAAYiC,KAAZ,KAAqB5b,IAAI,CAACub,YAAL,CAAkBK,KAAI,CAAC5L,QAAvB,EAAiChQ,IAAI,CAAC2Z,MAAtC,EAA8C,KAA9C,CAA1B,CAAR,EAAyF;AACrFrM,cAAAA,CAAC,CAACC,cAAF;;AAEA,kBAAI42B,IAAJ,EAASn0B,SAAT;;AACA,kBAAIhQ,IAAI,CAAC2Z,MAAL,CAAYiC,KAAZ,CAAJ,EAAuB;AACnB,oBAAMiK,OAAK,GAAGjK,KAAI,CAACjN,iBAAnB;AACAqB,gBAAAA,SAAQ,GAAG6V,OAAK,CAAC1U,UAAjB;AACAgzB,gBAAAA,IAAG,GAAGn0B,SAAQ,CAAC,CAAD,CAAd;;AACA,uBAAOA,SAAQ,CAAC,CAAD,CAAf,EAAoB;AAChByI,kBAAAA,QAAQ,CAAClI,YAAT,CAAsBP,SAAQ,CAAC,CAAD,CAA9B,EAAmC4L,KAAnC;AACH;;AACD5b,gBAAAA,IAAI,CAACsV,UAAL,CAAgBuQ,OAAhB;AACH,eARD,MAQO;AACHse,gBAAAA,IAAG,GAAGvoB,KAAI,CAAC5H,UAAX;AACAhE,gBAAAA,SAAQ,GAAG4L,KAAI,CAACzK,UAAhB;;AACA,uBAAOnB,SAAQ,CAAC,CAAD,CAAf,EAAoB;AAChByI,kBAAAA,QAAQ,CAACzO,WAAT,CAAqBgG,SAAQ,CAAC,CAAD,CAA7B;AACH;;AACDhQ,gBAAAA,IAAI,CAACsV,UAAL,CAAgBsG,KAAhB;AACH;;AACD1b,cAAAA,IAAI,CAACsQ,QAAL,CAAc2zB,IAAd,EAAmB,CAAnB,EAAsBA,IAAtB,EAA2B,CAA3B,EApBqF,CAqBrF;;AACAjkC,cAAAA,IAAI,CAACkB,OAAL,CAAa4H,IAAb,CAAkB,IAAlB;AACH;;AACD;AACH;;AAED;;AACJ,aAAK,CAAL;AAAQ;AACJ,cAAI26B,iBAAiB,IAAIrkC,OAAO,CAACmlC,UAAjC,EAA6C;AAC7Cn3B,UAAAA,CAAC,CAACC,cAAF;AACA,cAAI61B,IAAI,IAAIG,GAAR,IAAevjC,IAAI,CAAC6P,YAAL,CAAkBkE,aAAlB,CAAnB,EAAqD;AAErD,cAAMwG,MAAM,GAAI,CAAC9K,KAAK,CAACgD,SAAP,IAAoBvS,IAAI,CAACgX,WAAL,CAAiBzH,KAAK,CAACE,cAAvB,EAAuCF,KAAK,CAACQ,WAA7C,CAApC;AACA,cAAMoP,eAAe,GAAGnf,IAAI,CAACqV,mBAAL,CAAyB,IAAzB,CAAxB;AACAxB,UAAAA,aAAa,GAAG7T,IAAI,CAACmP,gBAAL,EAAhB;AACA,cAAM8b,KAAK,GAAG,EAAd;AACA,cAAIuZ,KAAK,GAAG,EAAZ;AACA,cAAIC,EAAE,GAAG3kC,IAAI,CAACuW,UAAL,CAAgB8I,eAAe,CAAC,CAAD,CAA/B,CAAT;AAAA,cAA8CulB,EAAE,GAAG5kC,IAAI,CAACuW,UAAL,CAAgB8I,eAAe,CAACA,eAAe,CAACrX,MAAhB,GAAyB,CAA1B,CAA/B,CAAnD;AACA,cAAIsQ,CAAC,GAAG;AAACxF,YAAAA,EAAE,EAAErD,KAAK,CAACE,cAAX;AAA2BsD,YAAAA,EAAE,EAAExD,KAAK,CAACQ,WAArC;AAAkD+C,YAAAA,EAAE,EAAEvD,KAAK,CAACG,YAA5D;AAA0EuD,YAAAA,EAAE,EAAE1D,KAAK,CAACgB;AAApF,WAAR;;AACA,eAAK,IAAI3I,CAAC,GAAG,CAAR,EAAWqB,GAAG,GAAGkW,eAAe,CAACrX,MAAjC,EAAyC2V,CAA9C,EAAiD7V,CAAC,GAAGqB,GAArD,EAA0DrB,CAAC,EAA3D,EAA+D;AAC3D6V,YAAAA,CAAC,GAAG0B,eAAe,CAACvX,CAAD,CAAnB;;AACA,gBAAI9H,IAAI,CAACuW,UAAL,CAAgBoH,CAAhB,CAAJ,EAAwB;AACpB,kBAAI,CAACA,CAAC,CAACvI,sBAAH,IAA6B,CAACgW,KAAlC,EAAyC;AACrC;AACH,eAFD,MAEO;AACHD,gBAAAA,KAAK,CAACniB,IAAN,CAAW2U,CAAX;AACH;AACJ,aAND,MAMO;AACH+mB,cAAAA,KAAK,CAAC17B,IAAN,CAAW2U,CAAX;AACH;AACJ,WAvBL,CAyBI;;;AACA,cAAIwN,KAAK,CAACnjB,MAAN,GAAe,CAAf,IAAoBuS,MAApB,IAA8Bra,IAAI,CAACd,OAAL,CAAawe,IAA/C,EAAqD;AACjDtF,YAAAA,CAAC,GAAGpY,IAAI,CAACd,OAAL,CAAawe,IAAb,CAAkB4N,cAAlB,CAAiC/gB,IAAjC,CAAsCvK,IAAtC,EAA4CkrB,KAA5C,EAAmDD,KAAnD,CAAJ;AACH,WAFD,MAEO;AACH;AACA,gBAAMqU,SAAS,GAAGx/B,IAAI,CAACoP,gBAAL,CAAsB2E,aAAtB,EAAqC/T,IAAI,CAAC+U,MAA1C,CAAlB;;AACA,gBAAIyqB,SAAS,IAAIjlB,MAAjB,EAAyB;AACrB,kBAAMmlB,KAAK,GAAG1/B,IAAI,CAACoP,gBAAL,CAAsBowB,SAAtB,EAAiC,OAAjC,CAAd;;AACA,kBAAMrU,MAAK,GAAGnrB,IAAI,CAAC4V,eAAL,CAAqB8pB,KAArB,EAA4B1/B,IAAI,CAAC+U,MAAjC,CAAd;;AACA,kBAAI8vB,GAAG,GAAGzZ,KAAK,GAAGprB,IAAI,CAAC8kC,OAAL,CAAa3Z,MAAb,EAAoBqU,SAApB,CAAH,GAAoCx/B,IAAI,CAAC+kC,OAAL,CAAa5Z,MAAb,EAAoBqU,SAApB,CAAnD;AAEA,kBAAIqF,GAAG,KAAK1Z,MAAK,CAACnjB,MAAd,IAAwB,CAACojB,KAA7B,EAAoCyZ,GAAG,GAAG,CAAN;AACpC,kBAAIA,GAAG,KAAK,CAAC,CAAT,IAAczZ,KAAlB,EAAyByZ,GAAG,GAAG1Z,MAAK,CAACnjB,MAAN,GAAe,CAArB;AAEzB,kBAAIg9B,QAAQ,GAAG7Z,MAAK,CAAC0Z,GAAD,CAApB;AACA,kBAAI,CAACG,QAAL,EAAe;AACfA,cAAAA,QAAQ,GAAGA,QAAQ,CAACr2B,iBAAT,IAA8Bq2B,QAAzC;AACA9kC,cAAAA,IAAI,CAACsQ,QAAL,CAAcw0B,QAAd,EAAwB,CAAxB,EAA2BA,QAA3B,EAAqC,CAArC;AACA;AACH;;AAEDN,YAAAA,KAAK,GAAGA,KAAK,CAAC1c,MAAN,CAAamD,KAAb,CAAR;AACAwZ,YAAAA,EAAE,GAAGC,EAAE,GAAG,IAAV;AACH,WAhDL,CAkDI;;;AACA,cAAIF,KAAK,CAAC18B,MAAN,GAAe,CAAnB,EAAsB;AAClB,gBAAI,CAACojB,KAAL,EAAY;AACR,kBAAM6Z,OAAO,GAAGjlC,IAAI,CAACkV,cAAL,CAAoB,IAAIrV,EAAE,CAACs1B,KAAP,CAAaj1B,IAAI,CAACyF,SAAL,CAAeM,OAAf,GAAyB,CAAtC,EAAyCgtB,IAAzC,CAA8C,MAA9C,CAApB,CAAhB;;AACA,kBAAIyR,KAAK,CAAC18B,MAAN,KAAiB,CAArB,EAAwB;AACpB,oBAAMk9B,SAAS,GAAGhlC,IAAI,CAACwY,UAAL,CAAgBusB,OAAhB,EAAyB,IAAzB,EAA+B,IAA/B,CAAlB;AACA,oBAAI,CAACC,SAAL,EAAgB,OAAO,KAAP;;AAChB,oBAAI,CAACP,EAAL,EAAS;AACLrsB,kBAAAA,CAAC,CAACxF,EAAF,GAAOmyB,OAAP;AACA3sB,kBAAAA,CAAC,CAACrF,EAAF,GAAOiyB,SAAS,CAACz0B,SAAjB;AACH;;AACD,oBAAI,CAACm0B,EAAL,EAAS;AACLtsB,kBAAAA,CAAC,CAACtF,EAAF,GAAOiyB,OAAP;AACA3sB,kBAAAA,CAAC,CAACnF,EAAF,GAAO+xB,SAAS,CAACz0B,SAAjB;AACH;AACJ,eAXD,MAWO;AACH,oBAAMtH,MAAG,GAAGu7B,KAAK,CAAC18B,MAAN,GAAe,CAA3B;;AACA,qBAAK,IAAIF,IAAC,GAAG,CAAR,EAAW+d,OAAhB,EAAuB/d,IAAC,IAAIqB,MAA5B,EAAiCrB,IAAC,EAAlC,EAAsC;AAClC+d,kBAAAA,OAAK,GAAG6e,KAAK,CAAC58B,IAAD,CAAL,CAASkM,UAAjB;AACA,sBAAI,CAAC6R,OAAL,EAAY;;AAEZ,sBAAI7lB,IAAI,CAAC0U,OAAL,CAAamR,OAAb,CAAJ,EAAyB;AACrB6e,oBAAAA,KAAK,CAAC58B,IAAD,CAAL,CAASyI,YAAT,CAAsB00B,OAAO,CAAC1tB,SAAR,CAAkB,KAAlB,CAAtB,EAAgDsO,OAAhD;AACH,mBAFD,MAEO;AACHA,oBAAAA,OAAK,CAACxU,WAAN,GAAoB4zB,OAAO,CAAC5zB,WAAR,GAAsBwU,OAAK,CAACxU,WAAhD;AACH;AACJ;;AAED,oBAAM2C,UAAU,GAAGhU,IAAI,CAACiR,eAAL,CAAqByzB,KAAK,CAAC,CAAD,CAA1B,EAA+B,MAA/B,EAAuC,KAAvC,CAAnB;AACA,oBAAMS,QAAQ,GAAGnlC,IAAI,CAACiR,eAAL,CAAqByzB,KAAK,CAACv7B,MAAD,CAA1B,EAAiC,MAAjC,EAAyC,IAAzC,CAAjB;;AACA,oBAAI,CAACw7B,EAAD,IAAO3wB,UAAX,EAAuB;AACnBsE,kBAAAA,CAAC,CAACxF,EAAF,GAAOkB,UAAP;AACAsE,kBAAAA,CAAC,CAACrF,EAAF,GAAO,CAAP;AACH;;AACD,oBAAI,CAAC2xB,EAAD,IAAOO,QAAX,EAAqB;AACjB7sB,kBAAAA,CAAC,CAACtF,EAAF,GAAOmyB,QAAP;AACA7sB,kBAAAA,CAAC,CAACnF,EAAF,GAAOgyB,QAAQ,CAAC9zB,WAAT,CAAqBrJ,MAA5B;AACH;AACJ;AACJ,aArCD,MAqCO;AACH,kBAAMmB,MAAG,GAAGu7B,KAAK,CAAC18B,MAAN,GAAe,CAA3B;;AACA,mBAAK,IAAIF,IAAC,GAAG,CAAR,EAAW2O,IAAhB,EAAsB3O,IAAC,IAAIqB,MAA3B,EAAgCrB,IAAC,EAAjC,EAAqC;AACjC2O,gBAAAA,IAAI,GAAGiuB,KAAK,CAAC58B,IAAD,CAAL,CAASqJ,UAAhB;;AACA,qBAAK,IAAI2J,GAAC,GAAG,CAAR,EAAWkE,IAAI,GAAGvI,IAAI,CAACzO,MAAvB,EAA+B6d,OAApC,EAA2C/K,GAAC,GAAGkE,IAA/C,EAAqDlE,GAAC,EAAtD,EAA0D;AACtD+K,kBAAAA,OAAK,GAAGpP,IAAI,CAACqE,GAAD,CAAZ;AACA,sBAAI,CAAC+K,OAAL,EAAY;AACZ,sBAAI7lB,IAAI,CAAC8Y,kBAAL,CAAwB+M,OAAxB,CAAJ,EAAoC;;AAEpC,sBAAI,YAAYlY,IAAZ,CAAiBkY,OAAK,CAACxU,WAAvB,CAAJ,EAAyC;AACrCrR,oBAAAA,IAAI,CAACsV,UAAL,CAAgBuQ,OAAhB;AACH,mBAFD,MAEO,IAAI,WAAWlY,IAAX,CAAgBkY,OAAK,CAACxU,WAAtB,CAAJ,EAAwC;AAC3CwU,oBAAAA,OAAK,CAACxU,WAAN,GAAoBwU,OAAK,CAACxU,WAAN,CAAkByR,OAAlB,CAA0B,UAA1B,EAAsC,EAAtC,CAApB;AACH;;AAED;AACH;AACJ;;AAED,kBAAM9O,WAAU,GAAGhU,IAAI,CAACiR,eAAL,CAAqByzB,KAAK,CAAC,CAAD,CAA1B,EAA+B,MAA/B,EAAuC,KAAvC,CAAnB;;AACA,kBAAMS,SAAQ,GAAGnlC,IAAI,CAACiR,eAAL,CAAqByzB,KAAK,CAACv7B,MAAD,CAA1B,EAAiC,MAAjC,EAAyC,IAAzC,CAAjB;;AACA,kBAAI,CAACw7B,EAAD,IAAO3wB,WAAX,EAAuB;AACnBsE,gBAAAA,CAAC,CAACxF,EAAF,GAAOkB,WAAP;AACAsE,gBAAAA,CAAC,CAACrF,EAAF,GAAO,CAAP;AACH;;AACD,kBAAI,CAAC2xB,EAAD,IAAOO,SAAX,EAAqB;AACjB7sB,gBAAAA,CAAC,CAACtF,EAAF,GAAOmyB,SAAP;AACA7sB,gBAAAA,CAAC,CAACnF,EAAF,GAAOgyB,SAAQ,CAAC9zB,WAAT,CAAqBrJ,MAA5B;AACH;AACJ;AACJ;;AAED9H,UAAAA,IAAI,CAACsQ,QAAL,CAAc8H,CAAC,CAACxF,EAAhB,EAAoBwF,CAAC,CAACrF,EAAtB,EAA0BqF,CAAC,CAACtF,EAA5B,EAAgCsF,CAAC,CAACnF,EAAlC,EAzHJ,CA0HI;;AACAjT,UAAAA,IAAI,CAACkB,OAAL,CAAa4H,IAAb,CAAkB,KAAlB;AAEA;;AACJ,aAAK,EAAL;AAAS;AACL,cAAMo8B,YAAY,GAAGplC,IAAI,CAACqlC,oBAAL,CAA0BtxB,aAA1B,EAAyC,IAAzC,CAArB;;AAEA,cAAI7T,IAAI,CAACqE,aAAT,EAAwB;AACpB,gBAAI+gC,SAAS,GAAG,EAAhB;;AACA,gBAAK,CAACla,KAAD,IAAUga,YAAX,IAA4Bha,KAAhC,EAAuC;AACnCka,cAAAA,SAAS,GAAG,MAAZ;AACH,aAFD,MAEO;AACHA,cAAAA,SAAS,GAAG,MAAM7sB,QAAQ,CAACtE,QAAf,GAA0B,SAA1B,GAAsCsE,QAAQ,CAACtE,QAA/C,GAA0D,GAAtE;AACH;;AAED,gBAAI,CAACjU,IAAI,CAACkY,cAAL,CAAoBktB,SAApB,EAA+B,WAA/B,CAAL,EAAkD;AAC9Ch4B,cAAAA,CAAC,CAACC,cAAF;AACA,qBAAO,KAAP;AACH;AACJ;;AAED,cAAI,CAAC6d,KAAL,EAAY;AACR,gBAAMma,YAAY,GAAGrlC,IAAI,CAACmX,aAAL,CAAmB5H,KAAK,CAACG,YAAzB,EAAuCH,KAAK,CAACgB,SAA7C,EAAwD,KAAxD,CAArB;;AACA,gBAAK80B,YAAY,IAAI,YAAY53B,IAAZ,CAAiB8K,QAAQ,CAACtE,QAA1B,CAAjB,IAAyD,QAAQxG,IAAR,CAAa8K,QAAQ,CAACtE,QAAtB,CAA7D,EAA8F;AAC1F7G,cAAAA,CAAC,CAACC,cAAF;AACA,kBAAIi4B,IAAI,GAAG,IAAX;AACA,kBAAMC,SAAS,GAAGvlC,IAAI,CAACyX,eAAL,CAAqBc,QAArB,EAA+BnZ,OAAO,CAAC+Q,UAAvC,CAAlB;;AAEA,kBAAIk1B,YAAY,IAAIA,YAAY,CAACv9B,MAAb,GAAsB,CAA1C,EAA6C;AACzCw9B,gBAAAA,IAAI,GAAGD,YAAY,CAACzd,GAAb,EAAP;AACA,oBAAM4d,SAAS,GAAGF,IAAlB;;AACA,uBAAMD,YAAY,CAACv9B,MAAb,GAAsB,CAA5B,EAA+B;AAC3Bw9B,kBAAAA,IAAI,GAAGA,IAAI,CAACx7B,WAAL,CAAiBu7B,YAAY,CAACzd,GAAb,EAAjB,CAAP;AACH;;AACD2d,gBAAAA,SAAS,CAACz7B,WAAV,CAAsB07B,SAAtB;AACH;;AAEDF,cAAAA,IAAI,GAAG,CAACA,IAAD,GAAQC,SAAS,CAACzxB,UAAlB,GAA+BwxB,IAAI,CAACx7B,WAAL,CAAiBy7B,SAAS,CAACzxB,UAA3B,CAAtC;AACA9T,cAAAA,IAAI,CAACsQ,QAAL,CAAcg1B,IAAd,EAAoB,CAApB,EAAuBA,IAAvB,EAA6B,CAA7B;AACA;AACH,aAjBD,MAiBO,IAAIlmC,OAAO,CAACqmC,aAAR,IAAyBltB,QAAzB,IAAqC,CAACzY,IAAI,CAACuW,UAAL,CAAgBkC,QAAhB,CAA1C,EAAqE;AACxEnL,cAAAA,CAAC,CAACC,cAAF;AACAD,cAAAA,CAAC,CAACE,eAAF;AAEA,kBAAIo4B,KAAJ;;AACA,kBAAI,CAACn2B,KAAK,CAACgD,SAAX,EAAsB;AAClB,oBAAMozB,WAAW,GAAG7lC,IAAI,CAAC6U,gBAAL,CAAsBpF,KAAK,CAACE,cAA5B,EAA4C,IAA5C,MAAsD3P,IAAI,CAAC6U,gBAAL,CAAsBpF,KAAK,CAACG,YAA5B,EAA0C,IAA1C,CAA1E;;AACA,oBAAM0I,GAAC,GAAGpY,IAAI,CAACqY,UAAL,EAAV;;AACA,oBAAIstB,WAAJ,EAAiB;AACbD,kBAAAA,KAAK,GAAG5lC,IAAI,CAAC6U,gBAAL,CAAsByD,GAAC,CAAC5W,SAAxB,EAAmC,IAAnC,CAAR;;AAEA,sBAAI,CAAC4W,GAAC,CAACkC,aAAP,EAAsB;AAClB,wBAAMirB,UAAS,GAAGhtB,QAAQ,CAAClB,SAAT,CAAmB,KAAnB,CAAlB;;AACAkuB,oBAAAA,UAAS,CAAC5xB,SAAV,GAAsB,MAAtB;AACA+xB,oBAAAA,KAAK,CAAC5wB,UAAN,CAAiBzE,YAAjB,CAA8Bk1B,UAA9B,EAAyCG,KAAzC;AACH,mBAJD,MAIO,IAAIA,KAAK,KAAKntB,QAAV,IAAsBmtB,KAAK,CAAC9xB,kBAAN,KAA6B2E,QAAvD,EAAiE;AACpEmtB,oBAAAA,KAAK,GAAGntB,QAAR;AACH;AACJ,iBAVD,MAUO;AACHmtB,kBAAAA,KAAK,GAAG5lC,IAAI,CAAC4Y,YAAL,CAAkBN,GAAC,CAAC5W,SAApB,EAA+B4W,GAAC,CAACjK,MAAjC,EAAyC,CAAzC,CAAR;AACH;AACJ,eAhBD,MAgBO;AACH,oBAAIrO,IAAI,CAAC8Y,kBAAL,CAAwBL,QAAxB,CAAJ,EAAuCmtB,KAAK,GAAG1lC,IAAI,CAACyX,eAAL,CAAqBc,QAArB,EAA+BA,QAAQ,CAAClB,SAAT,CAAmB,KAAnB,CAA/B,CAAR,CAAvC,KACKquB,KAAK,GAAG5lC,IAAI,CAAC4Y,YAAL,CAAkBnJ,KAAK,CAACG,YAAxB,EAAsCH,KAAK,CAACgB,SAA5C,EAAuD,CAAvD,CAAR;AACR;;AAED,kBAAMq1B,SAAS,GAAGxmC,OAAO,CAACqmC,aAAR,KAA0B,GAA1B,GAAgC,IAAhC,GAAuCrmC,OAAO,CAACqmC,aAAjE;AACA,kBAAMtY,MAAK,GAAGuY,KAAK,CAACtY,UAApB;AACA,kBAAIxlB,IAAC,GAAG,CAAR;;AACA,qBAAOulB,MAAK,CAACvlB,IAAD,CAAZ,EAAiB;AACb,oBAAIg+B,SAAS,IAAIA,SAAS,CAACn4B,IAAV,CAAe0f,MAAK,CAACvlB,IAAD,CAAL,CAASuB,IAAxB,CAAjB,EAAgD;AAC5CvB,kBAAAA,IAAC;AACD;AACH;;AACD89B,gBAAAA,KAAK,CAAC1hB,eAAN,CAAsBmJ,MAAK,CAACvlB,IAAD,CAAL,CAASuB,IAA/B;AACH;;AACDnJ,cAAAA,IAAI,CAACsQ,QAAL,CAAco1B,KAAK,CAAC5xB,UAApB,EAAgC,CAAhC,EAAmC4xB,KAAK,CAAC5xB,UAAzC,EAAqD,CAArD;AAEA;AACH;;AAED,gBAAIoxB,YAAJ,EAAkB;AACd93B,cAAAA,CAAC,CAACC,cAAF;AACA,kBAAMw4B,eAAe,GAAGhyB,aAAa,KAAKqxB,YAA1C;AACA,kBAAMY,UAAU,GAAG9lC,IAAI,CAACgS,YAAL,EAAnB;AACA,kBAAMlC,UAAQ,GAAG+D,aAAa,CAAC5C,UAA/B;AAAA,kBAA2C9C,QAAM,GAAG23B,UAAU,CAAC5yB,WAA/D;AAAA,kBAA4E6wB,MAAI,GAAGlwB,aAAa,CAACqB,sBAAjG;AAAA,kBAAyHwG,MAAI,GAAG7H,aAAa,CAACa,WAA9I;;AAEA,kBAAI,CAAC5U,IAAI,CAAC8jC,0BAAL,CAAgCsB,YAAhC,CAAD,IAAkD,CAAC,CAACp1B,UAApD,KAAkE+1B,eAAe,IAAIt2B,KAAK,CAACgD,SAAzB,IAAsCzC,UAAQ,CAAChI,MAAT,GAAkB,CAAlB,IAAuBqG,QAAM,GAAG,CAAtE,IAA2ErO,IAAI,CAAC0U,OAAL,CAAa1E,UAAQ,CAAC3B,QAAD,CAArB,CAA3E,KAA8G,CAAC2B,UAAQ,CAAC3B,QAAM,GAAG,CAAV,CAAT,IAA0B,CAAC,CAAC2B,UAAQ,CAAC3B,QAAM,GAAG,CAAV,CAAT,IAAyBrO,IAAI,CAAC8Y,kBAAL,CAAwB9I,UAAQ,CAAC3B,QAAM,GAAG,CAAV,CAAR,CAAqBgD,WAA7C,CAA1B,KAAwFrB,UAAQ,CAAC3B,QAAM,GAAG,CAAV,CAAR,CAAqB+C,QAArB,KAAkC,CAA1H,IAA+HpR,IAAI,CAAC8Y,kBAAL,CAAwB9I,UAAQ,CAAC3B,QAAM,GAAG,CAAV,CAAR,CAAqBgD,WAA7C,CAAvQ,KAAuUhD,QAAM,GAAG,CAAhV,IAAqVrO,IAAI,CAAC0U,OAAL,CAAa1E,UAAQ,CAAC3B,QAAM,GAAG,CAAV,CAArB,CAAtV,IAClE,CAAC03B,eAAD,IAAoB/lC,IAAI,CAAC8Y,kBAAL,CAAwB/E,aAAa,CAAC1C,WAAtC,CAApB,IAA0ErR,IAAI,CAAC0U,OAAL,CAAauvB,MAAb,CAA1E,KAAiGjkC,IAAI,CAAC0U,OAAL,CAAauvB,MAAI,CAAC5uB,eAAlB,KAAsC,CAACrV,IAAI,CAAC8Y,kBAAL,CAAwBmrB,MAAI,CAAC5uB,eAAL,CAAqBhE,WAA7C,CAAxI,MAAuM,CAACuK,MAAD,IAAU,CAAC5b,IAAI,CAAC0U,OAAL,CAAakH,MAAb,CAAD,IAAuB5b,IAAI,CAAC8Y,kBAAL,CAAwB8C,MAAI,CAACvK,WAA7B,CAAxO,CADC,CAAJ,EAC0R;AACtR,oBAAI00B,eAAJ,EAAqB/lC,IAAI,CAACsV,UAAL,CAAgBtF,UAAQ,CAAC3B,QAAM,GAAG,CAAV,CAAxB,EAArB,KACKrO,IAAI,CAACsV,UAAL,CAAgBvB,aAAhB;;AACL,oBAAM6xB,MAAK,GAAG1lC,IAAI,CAACyX,eAAL,CAAqBytB,YAArB,EAAoCplC,IAAI,CAACkQ,eAAL,CAAqBk1B,YAAY,CAACtxB,kBAAlC,KAAyD,CAAC9T,IAAI,CAAC6V,oBAAL,CAA0BuvB,YAAY,CAACtxB,kBAAvC,CAA3D,GAAyHsxB,YAAY,CAACtxB,kBAAtI,GAA2J,IAA9L,CAAd;;AACA9T,gBAAAA,IAAI,CAAC8gB,oBAAL,CAA0B8kB,MAA1B,EAAiCR,YAAjC;AACAllC,gBAAAA,IAAI,CAACsQ,QAAL,CAAco1B,MAAd,EAAqB,CAArB,EAAwBA,MAAxB,EAA+B,CAA/B;AACA;AACH;;AAED,kBAAIG,eAAJ,EAAqB;AACjB9kC,gBAAAA,SAAS,CAACglC,UAAV,CAAuBx2B,KAAK,CAACgD,SAAN,IAAmBzS,IAAI,CAAC0U,OAAL,CAAajF,KAAK,CAACE,cAAN,CAAqBwB,UAArB,CAAgC1B,KAAK,CAACQ,WAAN,GAAoB,CAApD,CAAb,CAApB,GAA4F,MAA5F,GAAqG,UAA3H,EAAwI,IAAxI,EAA8I,KAA9I;AAEA,oBAAI0C,SAAS,GAAGqzB,UAAU,CAACrzB,SAA3B;AACA,oBAAMuzB,OAAO,GAAGF,UAAU,CAAC5yB,WAA3B;;AACA,oBAAIgyB,YAAY,KAAKzyB,SAArB,EAAgC;AAC5BA,kBAAAA,SAAS,GAAGA,SAAS,CAACxB,UAAV,CAAqB+0B,OAAO,GAAG73B,QAAV,GAAmB,CAAnB,GAAuB63B,OAAO,GAAG,CAAjC,GAAqCA,OAA1D,CAAZ;AACH;;AAEDhmC,gBAAAA,IAAI,CAACsQ,QAAL,CAAcmC,SAAd,EAAyB,CAAzB,EAA4BA,SAA5B,EAAuC,CAAvC;AACH,eAVD,MAUO;AACH,oBAAMwzB,SAAS,GAAGH,UAAU,CAACrzB,SAAX,CAAqBiC,WAAvC;AACA,oBAAMtE,EAAE,GAAGtQ,IAAI,CAACoQ,aAAL,CAAmB,IAAnB,CAAX;AACAlQ,gBAAAA,IAAI,CAACwY,UAAL,CAAgBpI,EAAhB,EAAoB,IAApB,EAA0B,KAA1B;AAEA,oBAAM81B,MAAM,GAAG91B,EAAE,CAAC+E,eAAlB;AAAA,oBAAmCgxB,MAAM,GAAG/1B,EAAE,CAACsE,WAA/C;;AACA,oBAAI,CAAC5U,IAAI,CAAC0U,OAAL,CAAayxB,SAAb,CAAD,IAA4B,CAACnmC,IAAI,CAAC0U,OAAL,CAAa0xB,MAAb,CAA7B,KAAsD,CAACC,MAAD,IAAWrmC,IAAI,CAAC8Y,kBAAL,CAAwButB,MAAxB,CAAjE,CAAJ,EAAuG;AACnG/1B,kBAAAA,EAAE,CAAC0E,UAAH,CAAczE,YAAd,CAA2BD,EAAE,CAACiH,SAAH,CAAa,KAAb,CAA3B,EAAgDjH,EAAhD;AACApQ,kBAAAA,IAAI,CAACsQ,QAAL,CAAcF,EAAd,EAAkB,CAAlB,EAAqBA,EAArB,EAAyB,CAAzB;AACH,iBAHD,MAGO;AACHpQ,kBAAAA,IAAI,CAACsQ,QAAL,CAAc61B,MAAd,EAAsB,CAAtB,EAAyBA,MAAzB,EAAiC,CAAjC;AACH;AACJ;;AAED16B,cAAAA,KAAK,CAACs3B,cAAN,GAAuB,IAAvB;AACA;AACH;AACJ;;AAED,cAAIS,WAAJ,EAAiB;;AAEjB,cAAIhkB,OAAO,IAAIjH,QAAX,IAAuB,CAACzY,IAAI,CAAC+U,MAAL,CAAY2K,OAAZ,CAAxB,IAAgD,CAAC,gBAAgB/R,IAAhB,CAAqB+R,OAAO,CAACvL,QAA7B,CAArD,EAA6F;AACzF,gBAAM1E,MAAK,GAAGvP,IAAI,CAACwP,QAAL,EAAd;;AACA,gBAAGxP,IAAI,CAACgX,WAAL,CAAiBzH,MAAK,CAACG,YAAvB,EAAqCH,MAAK,CAACgB,SAA3C,KAAyDzQ,IAAI,CAAC2Z,MAAL,CAAY5F,aAAa,CAACa,WAA1B,CAA5D,EAAoG;AAChGtH,cAAAA,CAAC,CAACC,cAAF;;AACA,kBAAMq4B,OAAK,GAAG5lC,IAAI,CAACoQ,aAAL,CAAmB,IAAnB,CAAd;;AACA,kBAAME,IAAE,GAAGtQ,IAAI,CAACoQ,aAAL,CAAmB,IAAnB,CAAX;;AACAw1B,cAAAA,OAAK,CAAC57B,WAAN,CAAkBsG,IAAlB;;AAEAmI,cAAAA,QAAQ,CAACzD,UAAT,CAAoBzE,YAApB,CAAiCq1B,OAAjC,EAAwCntB,QAAQ,CAAC3E,kBAAjD;;AACA8xB,cAAAA,OAAK,CAAC57B,WAAN,CAAkB+J,aAAa,CAACa,WAAhC;;AAEA1U,cAAAA,IAAI,CAACsQ,QAAL,CAAcF,IAAd,EAAkB,CAAlB,EAAqBA,IAArB,EAAyB,CAAzB;AACA;AACH;;AAED,gBAAI,CAACb,MAAK,CAACM,uBAAN,CAA8BqB,QAA9B,KAA2C,CAA3C,GAA+C,CAAC3B,MAAK,CAACM,uBAAN,CAA8B+D,kBAA9E,GAAmG,IAApG,KAA6G9T,IAAI,CAAC8Y,kBAAL,CAAwBL,QAAQ,CAACwjB,SAAT,CAAmBxmB,IAAnB,EAAxB,CAAjH,EAAqK;AACjKnI,cAAAA,CAAC,CAACC,cAAF;AACA,kBAAIq4B,OAAK,GAAG,IAAZ;;AAEA,kBAAI5lC,IAAI,CAACuW,UAAL,CAAgBmJ,OAAO,CAAC1K,UAAxB,CAAJ,EAAyC;AACrC0K,gBAAAA,OAAO,GAAGjH,QAAQ,CAACzD,UAAT,CAAoBA,UAApB,CAA+BA,UAAzC;AACA4wB,gBAAAA,OAAK,GAAG5lC,IAAI,CAAC4Y,YAAL,CAAkBH,QAAlB,EAA4B,IAA5B,EAAkCzY,IAAI,CAAC6Y,eAAL,CAAqBJ,QAArB,IAAiC,CAAnE,CAAR;;AACA,oBAAI,CAACmtB,OAAL,EAAY;AACR,sBAAMU,WAAW,GAAGtmC,IAAI,CAACoQ,aAAL,CAAmB,IAAnB,CAApB;AACAk2B,kBAAAA,WAAW,CAACzyB,SAAZ,GAAwB,MAAxB;AACA6L,kBAAAA,OAAO,CAACnP,YAAR,CAAqB+1B,WAArB,EAAkCV,OAAlC;AACAA,kBAAAA,OAAK,GAAGU,WAAR;AACH;AACJ,eATD,MASO;AACH,oBAAMb,WAAS,GAAGzlC,IAAI,CAAC+U,MAAL,CAAY2K,OAAO,CAAC1K,UAApB,IAAkC,KAAlC,GAA0ChV,IAAI,CAAC2Z,MAAL,CAAY+F,OAAO,CAAC1K,UAApB,IAAkC,IAAlC,GAA0ChV,IAAI,CAACkQ,eAAL,CAAqBwP,OAAO,CAAC5L,kBAA7B,KAAoD,CAAC9T,IAAI,CAAC6V,oBAAL,CAA0B6J,OAAO,CAAC5L,kBAAlC,CAAtD,GAA+G4L,OAAO,CAAC5L,kBAAR,CAA2BK,QAA1I,GAAsJnU,IAAI,CAACkQ,eAAL,CAAqBwP,OAAO,CAACtK,sBAA7B,KAAwD,CAACpV,IAAI,CAAC6V,oBAAL,CAA0B6J,OAAO,CAACtK,sBAAlC,CAA1D,GAAuHsK,OAAO,CAACtK,sBAAR,CAA+BjB,QAAtJ,GAAiK7U,OAAO,CAAC+Q,UAAna;;AACAu1B,gBAAAA,OAAK,GAAG5lC,IAAI,CAACoQ,aAAL,CAAmBq1B,WAAnB,CAAR;AACA,oBAAM3mB,IAAI,GAAG5e,IAAI,CAAC6e,wBAAL,CAA8BW,OAA9B,EAAuC,CAACjH,QAAD,CAAvC,EAAmD,IAAnD,EAAyD,IAAzD,EAA+D,IAA/D,CAAb;AACAqG,gBAAAA,IAAI,CAACN,EAAL,CAAQjO,YAAR,CAAqBq1B,OAArB,EAA4B9mB,IAAI,CAAC9L,EAAjC;AACH;;AAED4yB,cAAAA,OAAK,CAAC/xB,SAAN,GAAkB,MAAlB;AACA7T,cAAAA,IAAI,CAACmd,oBAAL,CAA0B1E,QAA1B,EAAoC,IAApC,EAA0C,IAA1C;AACAvY,cAAAA,IAAI,CAACsQ,QAAL,CAAco1B,OAAd,EAAqB,CAArB,EAAwBA,OAAxB,EAA+B,CAA/B;AACA;AACH;AACJ;;AAED,cAAIlmB,OAAO,IAAI1f,IAAI,CAACoP,gBAAL,CAAsBsQ,OAAtB,EAA+B,YAA/B,CAAX,IAA2D1f,IAAI,CAACoP,gBAAL,CAAsBsQ,OAAtB,EAA+B1f,IAAI,CAAC2Z,MAApC,CAA/D,EAA4G;AACxGrM,YAAAA,CAAC,CAACC,cAAF;AACAkL,YAAAA,QAAQ,GAAGvY,IAAI,CAACyX,eAAL,CAAqBc,QAArB,EAA+B,IAA/B,CAAX;AACAvY,YAAAA,IAAI,CAACsQ,QAAL,CAAciI,QAAd,EAAwB,CAAxB,EAA2BA,QAA3B,EAAqC,CAArC;AACH;;AAED,cAAIkrB,iBAAJ,EAAuB;AACnBr2B,YAAAA,CAAC,CAACC,cAAF;AACAD,YAAAA,CAAC,CAACE,eAAF;AACA,gBAAM+4B,WAAW,GAAGrnC,OAAO,CAACykC,iBAAD,CAA3B;AACA,gBAAMjiC,SAAS,GAAG6kC,WAAW,CAACC,UAA9B;AACA,gBAAMvmB,OAAO,GAAGve,SAAS,CAAC0T,sBAAV,IAAoC1T,SAAS,CAACoS,kBAA9D;AAEA,gBAAI8xB,OAAK,GAAG,IAAZ;;AACA,gBAAI5lC,IAAI,CAACuW,UAAL,CAAgB7U,SAAS,CAACsT,UAA1B,CAAJ,EAA2C;AACvC4wB,cAAAA,OAAK,GAAG5lC,IAAI,CAACoQ,aAAL,CAAmB,IAAnB,CAAR;AACH,aAFD,MAEO;AACHw1B,cAAAA,OAAK,GAAG5lC,IAAI,CAACoQ,aAAL,CAAoBpQ,IAAI,CAACkQ,eAAL,CAAqB+P,OAArB,KAAiC,CAACjgB,IAAI,CAAC6V,oBAAL,CAA0BoK,OAA1B,CAAnC,GAAyEA,OAAO,CAAC9L,QAAjF,GAA4F7U,OAAO,CAAC+Q,UAAvH,CAAR;AACAu1B,cAAAA,OAAK,CAAC/xB,SAAN,GAAkB,MAAlB;AACH;;AAEDnS,YAAAA,SAAS,CAACsT,UAAV,CAAqBzE,YAArB,CAAkCq1B,OAAlC,EAAyClkC,SAAzC;AAEAxB,YAAAA,IAAI,CAACsI,UAAL,CAAgBm7B,iBAAhB,EAAmC,YAAY;AAC3C,kBAAIzjC,IAAI,CAAC8Q,eAAL,CAAqBu1B,WAAW,CAACE,QAAjC,EAA2C9C,iBAA3C,MAAkE,KAAtE,EAA6EzjC,IAAI,CAACoR,IAAL;AAChF,aAFD,EAEG,IAFH;AAGH;;AAED;;AACJ,aAAK,EAAL;AACI,cAAIqyB,iBAAJ,EAAuB;AACnBr2B,YAAAA,CAAC,CAACC,cAAF;AACAD,YAAAA,CAAC,CAACE,eAAF;AACAtN,YAAAA,IAAI,CAACgK,cAAL;AACA,mBAAO,KAAP;AACH;;AACD;AAtnBR;;AAynBA,UAAIkhB,KAAK,IAAIvd,OAAO,KAAK,EAAzB,EAA6B;AACzBP,QAAAA,CAAC,CAACC,cAAF;AACAD,QAAAA,CAAC,CAACE,eAAF;AACA,YAAMiyB,WAAW,GAAGv/B,IAAI,CAACd,OAAL,CAAasgC,KAAjC;;AACA,YAAID,WAAW,IAAI,CAACA,WAAW,CAACG,MAA5B,IAAsC,CAACH,WAAW,CAACiH,IAAvD,EAA6D;AACzD,cAAMlC,KAAI,GAAGxkC,IAAI,CAACoP,gBAAL,CAAsBqJ,QAAtB,EAAgCzY,IAAI,CAAC+U,MAArC,CAAb;;AACA,cAAIyvB,KAAJ,EAAU;AACN/E,YAAAA,WAAW,CAACI,sBAAZ,CAAmCp1B,IAAnC,CAAwCvK,IAAxC,EAA8CskC,KAA9C,EAAoD,IAApD;AACA;AACH;AACJ;AACJ,OAXD,MAWO,IAAIpZ,KAAK,KAAKprB,IAAI,CAAC2mC,SAAL,GAAiBpD,GAAjB,GAAuBH,IAA5B,CAAL,IAA0Cv1B,OAAO,KAAK,EAA1D,EAA8D;AACjEP,QAAAA,CAAC,CAACC,cAAF;AACAD,QAAAA,CAAC,CAACE,eAAF;AACA,YAAMo5B,IAAI,GAAG1mC,IAAI,CAACwY,UAAL,CAAgB1Y,IAAI,CAACkV,cAAL,CAAoB,MAApB,CAAhB,CAAb;;AACA,YAAI0xB,IAAI,IAAIA,IAAI,CAACllC,SAAjB,EAA4B;AACxBxB,UAAAA,IAAI,CAACsQ,QAAL,CAAco2B,IAAI,CAACllC,SAAnB,EAA8BklC,IAAI,CAACn2B,SAAnC,EAA8Cm2B,IAAI,CAACllC,SAAnD,EAA8DklC,IAAI,CAACn2B,SAAnE;AACA;AACH;AACJ;;AAED,UAAIzQ,IAAI,CAACy7B,IAAL,IAAa,CAAC2H,IAAd,IAAsB,CAACG,GAAvB,IAA8B,CAACG,WAA/B,IAA8C,CAAC/3B,KAAK,CAAC2yB,eAAN,CAAsB3wB,IAAtB,CAA2BE,OAA3B,CAA/C,IAAsF7N,IAAI,CAAC0U,OAAL,CAAajF,KAAK,CAACM,uBAAnB,CAA1F,EAAuI;AACnI,YAAMiM,SAAS,GAAGhc,IAAI,CAACkV,cAAL,CAAoBlV,IAAI,CAACmV,cAAzB,CAAlB;AACAjV,QAAAA,IAAI,CAACwY,UAAL,CAAgBsD,SAAhB,EAA2B,IAA3B,EAAiC,KAAjC;AACA9b,QAAAA,IAAI,CAACsQ,QAAL,CAAcwL,SAAd,EAAyB,CAAzB,EAA4BA,SAA5B,EAAuC,CAAvC;AACH;AACJ,KA7tCS;AA+tCV6qB,IAAAA,eAAe,EAAE,yBAAUv5B,CAAV,EAAa;AAC1B,UAAI3B,KAAK,CAACs3B,cAAV,EAA0B;;AAE1B/iC,MAAAA,IAAI,CAACgP,YAAL;;AACA,UAAMrB,OAAO,GAAGP,CAAC,CAACO,OAAlB;AACA,UAAMu1B,IAAI,GAAG91B,CAAC,CAAC+1B,OAAF,IAAa/1B,CAAC,CAACg2B,OAAf,IAA0Bz1B,OAAO,KAAK,EAAtC,IAA4CA,OAAO,KAAK,EAAxD,IAA8DA,OAAO,KAAK,GAAvF;AACA,UAAM01B,GAAG,GAAGj2B,CAAC,CAACk2B,MAAd;;AAEA,UAAItjC,IAAI,CAAC8C,UAAT,EAAqB;AACjB,YAAI,CAACogC,IAAD,IAASz3B,KAAK,CAAC0yB,iBAAN,CAAwB1wB,IAAxB,CAA6BE,OAA7B,CAAb,EAAoDlC,KAAK,CAAC+E,gBAAN;AACpD;AACH;;AAED,UAAMjB,KAAK,GAAGvP,IAAI,CAACwP,QAAL,EAAd;AACA,UAAIqE,aAAa,GAAG7T,IAAI,CAACmP,gBAAL,EAApB;;AAEA,UAAInP,IAAI,CAACsD,UAAL,KAAqBtD,IAAI,CAACuD,gBAAL,IAAyBoK,OAAO,KAAK,EAAtC,IAA6C,CAAC4B,KAAK,CAACgD,SAAxE,CAAJ,EAAwF;AACpF,YAAIvS,IAAI,CAACuD,gBAAT,EAA2B;AACvB,cAAIoK,OAAO,KAAK,EAAhB,EAAoBlC,KAAK,CAAC40B,wBAAN;AACvB,SAFD,MAEO;AACH50B,UAAAA,KAAK,CAACie,mBAAN;;AACA;AACH;AACJ;AAED;;;AACA,UAAI/b,OAAO,KAAK,CAAZ,IAAiB7N,IAAI,CAAC6P,YAAL,CAAkBkE,aAAlB,CAAjB,IAAqDA,aAAa,CAAC1C,WAAd,KAA8B,EAAnF,IAAyF0C,aAAa,CAAC/D,QAAd,CAAuBhI,MAAvB,KAAkC,CAA/H,EAAkI;AAC9HsF,QAAAA,CAAC,CAACC,cAAF;AACAD,QAAAA,CAAC,CAACE,eAAF;AAEAuG,QAAAA,aAAa,CAACF,SAAd,GAA0B,EAA1B;AAEA,YAAMizB,UAAU,GAAG9mC,IAAI,CAACoQ,aAAL,CAAmBpQ,IAAI,CAACkQ,eAAL,CAAqBhQ,IAAI,CAACyF,SAAL,CAAea,YAAf,CAA4B,CAA5B,CAArB,IAAuDtG,IAAI,CAACyF,SAAL,CAAea,YAAf,CAA4B,CAA5B,CAAvD,GAAwFlH,OAAO,CAAC+Q,UAAnH,CAAnB;AACAy2B,QAAAA,UAAU,CAACjzB,SAAX,GAAuB,MAAvB;AAEAE,QAAAA,aAAa,CAAC/J,WAAd,CAA0B88B,UAA1B;AACA5mC,QAAAA,IAAI,CAACsQ,QAAL,CAAcs2B,UAAd,EAA0B,CAA1B,EAA6BA,UAA7B,EAAyC,CAAzC;;AACAn7B,QAAAA,KAAK,CAAC+E,gBAAN;;AAEAxQ,QAAAA,IAAI,CAACkB,OAAL,CAAa4H,IAAb,CAAkB,KAAlB;AACA;AACH;;AAED,UAAMyP,QAAQ,GAAGzY,IAAI,CAAC6U,gBAAL,CAAsBd,aAAtB,EAAqC,IAArC,CAAjB;AACA,UAAM2L,OAAO,GAAG1f,IAAI,CAAC8U,qBAAL,CAA2Bf,aAA3B,EAA0C,IAA1C,CAAhB;;AACA,UAAI,CAAC0E,QAAD,IAAahJ,KAAK,CAACgD,SAAnB,IAAgC,CAACzS,IAAI,CAACmQ,WAAL,CAAiB4D,aAAjB,CAAjC,IAAoE,CAAC/T,IAAI,CAAC2Z,MAAL,CAAY5F,aAAZ,CAArE,IAAmG7T,IAAI,CAACg8B,iBAAL,CAAuBl8B,IAAI,CAAC6V,oBAAL,CAA0B6J,OAA1B,IAAqC,KAArC,GAA6CpgB,OAAO,CAAC+Q,UAA5E,MAA4F,IAAnM,EAAyM;AACrM0D,QAAAA,aAAa,GAAG7T,IAAI,CAACmP,gBAAL,EAAhB;AACH;;AAED,UAAI1D,KAAK,CAAC0yB,iBAAN,CAAwB1wB,IAAxB,CAA6BE,OAA7B,CAAJ,EAA2C;AACvClC,QAAAA,KAAK,CAAC+E,gBAAN;AACH;;AAED,UAAMq2B,OAAO,GAAG,CAAC3D,IAAD,IAAS,CAACG,GAAV,IAAiB,CAAC53B,KAAK,CAAC2yB,eAAN,CAAsB3wB,IAAtB,CAA2BE,OAA3B,CAAlC;;AACA,UAAIk5B,OAAO,IAAIhzB,aAAa,CAAC3C,QAAd,KAA2B,CAAtC,IAA2CpR,IAAI,CAACgnC,eAAL,CAAqBr5B,IAArB,CAA0BoG,aAAa,CAAC1C,WAAxC,CAA3C,IAAmG,EAAE/D,CAAC,CAAC25B,WAAF,KAAkBpqB,SAAlB,GAA8BvP,CAAC,CAAC25B,WAAhC,GAA8Ct7B,KAAK,CAACwyB,cAAtD,CAAvG,EAA8K;AAC1K,YAAIlrB,EAAE,GAAGxD,KAAK,CAACQ,WAAf;AAAA,YAA4BkD,EAAE,GAAG1D,KAAK,CAACgB,SAAvC;AACA,YAAMy2B,iBAAiB,GAAG,CAACnzB,aAAa,CAAC1C,WAAd,CAA0B81B,SAA1B,CAAoC,CAApC,EAAuCh0B,EAAvC,EAA2C8P,KAA3C,CAAiDtX,KAAK,CAAC8yB,kBAAvD,KAA8E,EAA/E,EAAmFz2B,MAA7G;AACAiL,QAAAA,EAAE,GAAGxD,KAAK,CAACQ,WAAN,GAAoBi3B,iBAAzB;AACA/zB,QAAAA,EAAE,GAAG1D,KAAK,CAACgB,SAAN,GAAkBy2B,iBAAvB;AACAnzB,QAAAA,aAAa,CAAC1C,WAAd,GAA4B0C,aAAa,CAAC1C,WAAd,CAA0ByR,OAA1B,CAAkC9iB,IAAI,CAACgnC,eAAvC,EAAwD,EAAxD,CAA5B;AACA9mC,QAAAA,IAAI,CAACsQ,QAAL,CAAcuD,aAAd,EAA6Bd,EAAE,GAAG,CAAL,GAAS,CAAT,GAAaA,EAA1C,EAA8Cc,aAA9C,EAA6DZ,EAAE,GAAG,CAAL,GAAS,CAAT,GAAaA,EAA1E;AACH;;AAEDjT,MAAAA,IAAI,CAAC61B,UAAL,CAAgB,EAAhB,EA/D0B,CAiE1B;;;AACA,UAAI,OAAO90B,SAAS,CAACmmC,OAAjB,KAA6B,UAA7B,IAA2CnmC,SAAS,CAACmmC,OAAV,CAAkB95B,CAAlB,EAAqBpN,IAArB,MAA+B,KAA9E,EAAqF,OAlE3D,CAoE1B;;AACA,UAAI,CAACkjC,IAAD,IAAS,CAACG,GAAV,IAAiB,CAAC53B,KAAK,CAAC4yB,qBAAN,CAA4B5wB,IAA5B,CAAiCE,OAAjC,CAAtB,EAAiE;AAC7D3N,QAAAA,IAAI,CAACkB,OAAL,CAAa4H,IAAb,CAAkB,IAAlB;AACH;AACJ,KAvyCS;AAyyCVq+B,IAAAA,gBAAgB,EAAE,0BAAU/5B,CAAV,EAAa;AAC3BpN,MAAAA,IAAI,CAACgK,cAAL;AACA,UAAIhK,IAAI,CAACsD,UAAT,EAAqBmI,KAAK,CAACugB,YAAN,GAFM,CAI3B;;AACA,UAAI,OAAOjrB,SAAS,CAACqmC,QAAjB,KAA8B,UAAlC,EAA8CrmC,SAAS,CAACqmC,QAAV,CAAmBh6B,CAAnB,EAAsBpN,IAAtB;AACjD,KA/yCS;AAizCVqnC,IAAAA,eAAe,EAAE,yBAAUj6B,CAAV,EAAa;AAC1B,UAAIpN,IAAI,CAAC8D,SAAT,EAAoB;AACpB9D,MAAAA,IAAI,CAAC4C,QAAL,GAAgB,IAAhB;;AACAjD,MAAAA,EAAE,CAACuZ,UAAH,CAAczN,KAAK,CAAC+E,gBAApB;;AAEA,UAAIxQ,IAAI,CAACqD,SAAT,EAAoBoI,KAAK,CAACke,kBAAN,GALM,CAO1B;;AACA,UAAI,OAAO5oB,SAAS,CAACumC,OAAjB,KAA6B,UAAjC,EAA6CvmC,SAAS,CAACumC,OAAV,CAAkBl6B,CAAlB,EAAqBpN,IAArB;AAChD,KA1zCS;AA4zCVunC,IAAAA,cAAc,EAAE,wBAAUn6B,CAAV,EAAa;AACzB,UAAIpN,IAAI,CAAC8D,SAAL,IAAkB9D,IAAI,CAACyF,SAAL,CAAeE,UAArC,EAAiD;AACjD3F,MAAAA,IAAI,CAAC4C,QAAL,GAAgB,KAAhB;AACA5C,MAAAA,IAAI,CAACsB,UAAL,GAAkB,IAAlB;AACAtB,MAAAA,IAAI,CAACgK,cAAL;AACA,UAAIhK,IAAI,CAACqD,SAAL,IAAkBrD,IAAI,CAACsD,UAA3B,EAAuCmI,KAAK,CAACugB,YAAN;;AAEvChsB,MAAAA,IAAI,CAACqS,aAAL,CAAmB,EAAnB;;AAEArS,MAAAA,IAAI,CAACyF,SAAL,CAAea,YAAf,GAA8B,EAA9B;AACAtG,MAAAA,IAAI,CAACyF,SAAL,CAAec,eAAf,GAAiC,EAAjC;AACA,UAAInH,OAAO,CAAC2/B,aAAZ,EAA2B//B,OAAO,CAACO,OAAR,CAAgBk+B,UAAhB,CAA2BtsB,WAA3B,GAAyC,EAAzC,CAXF,CAazB;;AACA,UAAI,OAAOpQ,SAAS,CAACymC,MAAjB,KAA4B,UAAhC,EAA4CzmC,SAAS,CAACymC,MAAV,CAAiBp6B,CAAjB,EAAoBpN,IAApB;AAC/C,KA30CS;AA60CVynC,IAAAA,uBAAuB,EAAE,iCAAUr6B,CAAV,EAAa;AAClCA,MAAAA,CAAC,CAACE,eAAF;AAEAtN,MAAAA,IAAI,CAACmK,UAAL;AACAnK,MAAAA,IAAI,CAACgK,cAAL;AAEAhK,MAAAA,IAAI,CAACyF,SAAL,CAAeK,aAAf,GAA+BsH,CAAC,CAACs6B,OAAjC;AACA1oC,MAAAA,OAAO,CAACO,OAAR,CAAgBy+B,gBAAhB,CAAiC53B,KAAjC,CAAuCqE,OAAvC,GAAiD,OAAjD;;AAEA,eAASk9B,WAAT,GAAuB;AACnB3oC,QAAAA,OAAO,CAACO,OAAR,CAAgBy+B,gBAAhB,CAAiC53B,KAAjC,CAAuCqE,OAAvC,GAAiD,MAAjD;;AACAnL,QAAAA,EAAE,CAACs2B,mBAAH,CAAuB,WAAvB,EAAoCnqB,KAAK,CAACm8B,cAA1C;;AACAtoC,QAAAA,EAAE,CAACs2B,mBAAH,CAAuB,SAAvB,EAAkC+R,WAAlC;AACH;;AAEDroC,MAAAA,EAAE,CAAC6N,gBAAH,CAAoB,WAApB,EAAiC1B,KAAK,CAACm8B,cAAvC;;AACAtoC,MAAAA,EAAE,CAAC6N,gBAAH,CAAoB,SAApB,EAA+Bw6B,WAA/B;AACH,KA91CS;AAg2CVC,IAAAA,cAAc,EAAE,wBAAUx6B,CAAV,EAAa;AACzB,UAAMy6B,cAAc,GAAG7oC,OAAO,CAACO,OAAR,CAAgBuuB,UAAhB,CAA2BzhB,YAA3B,IAA2Ce,CAAC,CAACs6B,OAAF,GAAY1nC,IAAI,CAACyF,SAAL,CAAeK,aAAtE,CAAvB;AACA,UAAMutB,CAAC,GAAIwU,cAAc,GAAG7nC,IAAI,CAACyF,SAAL,CAAeQ,eAAhC,GAAkDjG,IAAI,CAACyF,SAAL,CAAeQ,eAAjE,GAAmF4hC,cAA9F;AACA7oC,MAAAA,OAAO,CAACO,OAAR,CAAgB4G,YAAhB,CAA6BC,KAA7B,CAAmCgF,MAAnC,GAA4CpM,OAAO,CAACO,OAAR,CAAgBqsB,IAAhB,CAAqBxlB,KAArB,CAA2BgF,MAA3B,GAAoCioB,CAAC,GAAG,IAApF;AACArzB,MAAAA,IAAI,CAACyF,SAAL,CAAeK,aAAf,GAA+BsH,CAAC,CAACs6B,OAAjC;AACA,UAAI5nC,IAAI,CAACy7B,IAAT,EAAev7B,IAAI,CAACw7B,oBAAL,CAA0BnI,CAA1B,EAA6B,IAA7B;AAClB,KAt2CS;AAw2CVoJ,IAAAA,eAAe,EAAE,2BAAY;AACzB,UAAI38B,IAAI,CAACy7B,IAAT,EAAev7B,IAAI,CAAC42B,sBAAL;AAEf,UAAI53B,OAAO,CAACO,OAAR,CAAgBsL,OAAhB,CAAwBU,WAAxB,KAAwC,CAA5C,EAA+C;;AAE/C,UAAIvM,OAAO,CAAC8oC,WAAR,IAAuB9oC,OAAO,CAAC8oC,WAAR,CAAoBC,IAApB,CAAyB3hC,KAAzB,CAA+BqE,OAA/B,KAA2C,OAAtE,EAA+E;AAC3EzL,QAAAA,OAAO,CAAC8oC,WAAR,CAAoB7a,IAApB,CAAyB7mB,KAAzB,CAA+B4hC,SAA/B,GAA4CroC,EAAE,CAAC8M,WAAH,GAAiBzN,OAAO,CAAC8oC,WAAR,CAAoBG,MAApB,CAA2B57B,YAA5C,GAA2D,EAA5D,GAAkE,IAA7G;AACH;;AAED,UAAIrM,IAAI,CAAC4B,mBAAL,IAA4B5B,IAAI,CAACuB,OAArC,EAA8C;AAC1CvB,QAAAA,IAAI,CAACkK,gBAAL,CAAsBlK,IAAI,CAAC4B,mBAA3B,EAAgD5B,IAAI,CAACuB,OAArD;AACH;;AAED,UAAIvB,IAAI,CAACyF,SAAL,CAAeG,YAAnB,EAAiC;AAC7B5F,QAAAA,IAAI,CAACyF,SAAL,CAAeI,sBAAf,IAA0ClG,EAAE,CAAC8M,WAAH,GAAiBzN,OAAO,CAACO,OAAR,CAAgBsL,OAAhB,CAAwBwB,YAA1C,GAA0DrM,IAAI,CAACyF,SAAL,CAAeI,sBAAlH;AACA7G,QAAAA,OAAO,CAACO,OAAR,CAAgBuuB,UAAhB,CAA2B1nB,KAA3B,CAAiCgF,MAAjC,GAA0CpL,IAAI,CAACyF,SAAL,CAAeI,sBAAf,GAAwC,IAAlF;AACA;AACH;;AAED,UAAI7F,IAAI,CAACyF,SAAL,CAAeE,UAAf,IAA6B3F,IAAI,CAACqD,SAAtC,EAAiD;AAC7CoI,QAAAA,KAAK,CAACke,kBAAN;;AACA;AACH;;AAED3pB,MAAAA,IAAI,CAAC0uB,iBAAL;;AAEA,UAAI1uB,IAAI,CAAC6D,OAAT,EAAkB;AACd7E,QAAAA,OAAO,CAACO,OAAR,CAAgBsL,OAAhB,CAAwBzE,KAAxB,CAA8B1C,KAA9B,GAAuC1E,OAAO,CAACO,OAAR,CAAgBoH,OAAhB,CAAwB4E,WAAxB,GAAsC,CAAvC,GAA4C,IAAlF;AACAE,QAAAA,KAAK,CAACsjB,eAAN;AACH;AACJ,KAt4CS;AAw4CVA,IAAAA,eAAe,EAAE,2BAAY;AACzB,UAAI/uB,IAAI,CAACyF,SAAL,CAAeG,YAAf,IAA+B5G,OAAO,CAACO,OAAR,CAAgBsL,OAAhB,CAAwBU,WAAxB,KAAwC,CAAvE,IAA4EnM,OAAO,CAAC0vB,aAAR,GAAwB,CAAxG,EAA2G;AAE3G,UAAMvvB,OAAO,GAAGP,OAAO,CAACO,OAAxB;AACA,UAAM2oC,YAAY,GAAG3oC,OAAO,CAACuuB,UAAR,CAAmBzhB,YAAxC;AACA,UAAM87B,CAAC,GAAG,CAAC,KAAKC,OAAL,IAAgB9oC,EAAE,CAAC0iC,eAAH,CAAmBx4B,SAApC,IAAiDpK,OAAO,CAAC0vB,aAAnE;AACA,UAAMuZ,SAAS,GAAG58B,KAAK,CAACC,iBAAN,CAAwBtM,OAAO,CAAC6uB,gBAAhC,EAAkDxqB,GAAlD,IAAyDzD,IAAI,CAACqD,SAAL,GAAiB9D,OAAO,CAACsL,OAAR,CAAgBwB,YAAjC,GAAgD,CAAzG,CAAlB;AACA,UAAMi8B,YAAY,GAAGtoC,IAAI,CAACqD,SAAL,IAAmB8kC,CAAC,GAAGE,SAAL,GAAkB,CAApC,GAAwCF,CAAC,GAAGE,SAAJ,GAAgBrpC,OAAO,CAACO,OAAR,CAAgBsL,OAAhB,CAAwBwB,YAAhF,GAA+F,CAApH;;AAEA,UAAI87B,CAAC,GAAGE,SAAR,EAAmB;AACf58B,QAAAA,KAAK,CAAC+wB,iBAAN;AACH,OAFD,MAGK,IAAI2L,CAAC,GAAGnoC,IAAI,CAACyF,SAAL,CAAeQ,eAAnB,IAAsCiiC,YAAY,GAAGG,SAAzD,EAAoE;AACrE,YAAI,CAACroC,IAAI,CAAC6D,OAAV,EAAmB4H,KAAK,CAAC88B,gBAAN,CAAuBD,YAAvB;AACnB/oC,QAAAA,OAAO,CAACsL,OAAR,CAAgBzE,KAAhB,CAAsB3C,GAAtB,GAA6B6kC,YAAY,GAAGJ,YAAf,GAA8BG,SAA9B,GAA0CjpC,OAAO,CAAC0vB,aAAlD,GAAkEqZ,CAAlE,GAAsEnoC,IAAI,CAACyF,SAAL,CAAeQ,eAAtF,GAAyG,IAArI;AACH,OAHI,MAIA,IAAIkiC,CAAC,IAAIE,SAAT,EAAoB;AACrB58B,QAAAA,KAAK,CAAC88B,gBAAN,CAAuBD,YAAvB;AACH;AACJ,KA35CS;AA65CV58B,IAAAA,iBAAiB,EAAE,2BAAUlK,SAAV,EAAqB;AACpC,UAAIyK,QAAQ,GAAGzK,SAAS,IAAIxC,OAAO,CAACO,OAAR,CAAgBoH,OAA5C;AACA,UAAI0C,CAAC,GAAG,CAAR;AAAA,UAAWC,CAAC,GAAG,CAAf;AAAA,UAAkBoZ,CAAC,GAAG,CAAtB;;AAEA,aAAOzW,QAAP,EAAiB;AACb5C,QAAAA,CAAC,IAAI4C,QAAQ,CAACC,SAAd;AACA5C,QAAAA,CAAC,IAAI2C,QAAQ,CAACL,UAAd;AACA8W,QAAAA,CAAC,IAAIzW,QAAQ,CAACzC,SAAd;AACAyC,QAAAA,QAAQ,GAAGA,QAAQ,CAACE,YAApB;AACH;;AAED,aAAO;AACH1I,QAAAA,GAAG,EAAE4F,CADF;AAEHM,QAAAA,IAAI,EAAEL,CAFH;AAGHk/B,QAAAA,MAAM,EAAE9lB;AAHL,OAAP;AAKH,KA76CS;AA+6CVqf,IAAAA,mBAAmB,EAAE,+BAAY;AAC7B,aAAOziC,EAAE,CAAC0iC,eAAH,CAAmB5V,YAAnB,IAAmC3gB,KAAK,CAACC,iBAAN,CAAwB,IAAxB,EAA8BjI,GAA9B,GAAoCzE,OAAO,CAACO,OAAR,CAAgBoH,OAAhB,CAAwB0F,YAA/F,CAAP;AACH,KAj7CS;AAm7CVk8B,IAAAA,gBAAgB,EAAE,0BAAUD,YAAV,EAAwB;AACtC,UAAM/oC,OAAO,GAAGP,OAAO,CAACO,OAAxB;;AAEA,UAAI,CAACS,IAAI,CAACqD,SAAN,IAAmB,CAACjE,OAAO,CAAC6uB,gBAAhC,EAAkD;AAC9C1uB,QAAAA,OAAO,CAAC8uB,YAAR,CAAqBjoB,KAArB,CAA2BgF,MAA3B,GAAoC7L,OAAO,CAACsL,OAAR,CAAgBwB,YAAhB,GAA+B,IAAnE;AACA9M,QAAAA,OAAO,CAAC8uB,YAAR,CAAqBjoB,KAArB,CAA2BqE,OAA3B,GAAqC,OAArC;AACH;;AAEDlL,MAAAA,OAAO,CAACsL,OAAR,CAAgBzE,KAAhB,CAAsB3C,GAAtB,GAA6BrE,OAAO,CAAC0vB,aAAR,GAAwBwZ,YAAzB,GAAyC,IAArE;AACA/oC,MAAAA,OAAO,CAACsL,OAAR,CAAgBzE,KAAhB,CAAsB1C,KAAtB,GAA8B1D,IAAI,CAACqD,SAAL,GAAiBrD,IAAI,CAACwD,kBAAL,CAAwBE,KAAzC,GAAiDnE,OAAO,CAACsL,OAAR,CAAgBU,WAAhB,GAA8B,IAA7G;AACAzL,MAAAA,IAAI,CAACuL,QAAL,CAAc9L,OAAO,CAACsL,OAAtB,EAA+B,mBAA/B;AACA7K,MAAAA,IAAI,CAAC6D,OAAL,GAAe,IAAf;AACH,KA/7CS;AAi8CV24B,IAAAA,iBAAiB,EAAE,6BAAY;AAC3B,UAAMj9B,OAAO,GAAGP,OAAO,CAACO,OAAxB;AAEAA,MAAAA,OAAO,CAAC8uB,YAAR,CAAqBjoB,KAArB,CAA2BqE,OAA3B,GAAqC,MAArC;AACAlL,MAAAA,OAAO,CAACsL,OAAR,CAAgBzE,KAAhB,CAAsB3C,GAAtB,GAA4BzD,IAAI,CAACqD,SAAL,GAAiBrD,IAAI,CAACwD,kBAAL,CAAwBC,GAAzC,GAA+C,EAA3E;AACAlE,MAAAA,OAAO,CAACsL,OAAR,CAAgBzE,KAAhB,CAAsB1C,KAAtB,GAA8B1D,IAAI,CAACqD,SAAL,GAAiBrD,IAAI,CAACwD,kBAAL,CAAwBE,KAAzC,GAAiD,EAA/E;AACAnE,MAAAA,OAAO,CAACuuB,UAAR,CAAmB1nB,KAAnB,CAAyBuoB,SAAzB,GAAqC,EAArC;AAEA7uB,MAAAA,IAAI,CAAC4K,WAAL,CAAiBnL,OAAO,CAACsL,OAAzB,EAAkC,mBAAlC;AACA7K,MAAAA,IAAI,CAAC6D,OAAL,GAAe,KAAf;AACH,KA38CS;AA68CVgrB,IAAAA,mBAAmB,EAAE,+BAAY;AAC7B,UAAI7uB,IAAI,CAACyF,SAAL,CAAeG,YAAnB,EAAiC;AACjC5G,MAAAA,OAAO,CAACO,OAAR,CAAgBqsB,IAAhB,CAAqBxlB,KAArB,CAA2BgF,MAA3B,GAAoCpM,OAAO,CAACO,OAAR,CAAgBqsB,IAAhB,CAAqBQ,YAArB,GAAoC,IAAxE;AACH,KAh9CS;AAk9CV;AACAuX,IAAAA,WAAW,EAAE,uBAAY;AACrB,UAAMp0B,KAAK,GAAGvP,IAAI,CAACwP,QAAL,EAAd;AACA,UAAMoD,EAAE,GAAGrD,KAAK,CAACE,cAAjB;AACA,UAAMqD,EAAE,GAAGvD,KAAK,CAACG,YAAjB,CAHqB,CAKrB;;AACA,UAAM+4B,KAAK,GAAG3oC,IAAI,CAAC8U,qBAAL,CAA2BhC,EAA3B,CAAd;AACA,UAAM81B,KAAK,GAAG5oC,IAAI,CAAC8U,qBAAL,CAA2B9B,EAA3B,CAAd;AACA,UAAM61B,OAAO,GAAG7oC,IAAI,CAAC+U,MAAL,CAAY4zB,KAAZ,CAAhB;AACA,UAAMG,OAAO,GAAG9oC,IAAI,CAAC+U,MAAL,CAAY6zB,KAAZ,CAAhB;AACA,UAAMp1B,QAAQ,GAAG/D,KAAK,CAACM,uBAAvB;;AACA,UAAI,CAAE84B,OAAO,IAAI,CAACF,KAAK,CAACvzB,sBAAlB,IAA4C,CAACuzB,KAAK,CAACtgC,aAAN,CAAoB+M,sBAAlE,IAA8F0zB,OAAO,IAAI,CAACF,KAAK,CAAC90B,kBAAlB,IAAwC,CAAC80B,KAAK,CAACvgC,aAAN,CAAoByL,kBAA5J,KAAoL60B,KAAK,KAAKC,KAAlM,EAAyM;AACrM,YAAI,CAACC,OAAL,EAAc;AACV7oC,UAAAA,IAAI,CAACsV,UAAL,CAAgBtV,IAAI,CAACoP,gBAAL,CAAsBw5B,KAAtB,EAA6B,UAAS13B,OAAT,EAAkB;AAAC,mBAAOsC,QAAQ,KAAKtC,OAAO,CAAC8D,UAA5B;AAAwC,WAAxF,CAAhB;AACH,SAFD,MAEO,IAAI,CAAC8zB,OAAL,EAAc;AACjB9oC,UAAAA,IAAI,CAACsV,UAAL,CAAgBtV,IAAI,CAACoP,gBAAL,CAAsBu5B,KAAtB,EAA6B,UAASz3B,OAAT,EAAkB;AAAC,mBAAOsC,QAAQ,KAAKtC,OAAO,CAAC8D,UAA5B;AAAwC,WAAxF,CAAhB;AACH,SAFM,MAEA;AACHhV,UAAAA,IAAI,CAACsV,UAAL,CAAgBtV,IAAI,CAACoP,gBAAL,CAAsBu5B,KAAtB,EAA6B,UAASz3B,OAAT,EAAkB;AAAC,mBAAOsC,QAAQ,KAAKtC,OAAO,CAAC8D,UAA5B;AAAwC,WAAxF,CAAhB;AACA9U,UAAAA,IAAI,CAAC8O,WAAL;AACA,iBAAO,IAAP;AACH;AACJ,OArBoB,CAuBrB;;;AACA,UAAM+5B,KAAK,GAAGj2B,EAAE,CAAC1B,QAAH,KAAgB,CAAhB,GAAoBpR,IAAI,CAACoP,gBAAL,CAAsB0D,EAAtB,EAA0B,eAA1B,CAApB,GAAiE,IAA/E;AACA,UAAMk2B,KAAK,GAAGh2B,EAAE,CAAC5B,QAAH,KAAgB,CAAhB,GAAoBpR,IAAI,CAACoP,gBAAL,CAAsB4D,EAAtB,EAA0B,eAA1B,CAApB,GAAiE,IAA/E;AACA,UAAI+1B,KAAJ,EAAW/oC,IAAI,CAACsV,UAAL,CAAgByzB,KAAhB;AACX,UAAIC,KAAJ,EAAWhpC,IAAI,CAACsV,UAAL,CAAgB0zB,KAAhB;AAEX,aAAO,KAAP;AACH,KAj/CS;AAm/CVC,IAAAA,eAAe,EAAE,yBAAU37B,CAAV,EAAa;AAC1B,UAAM47B,aAAa,GAAGlpC,IAAI,CAACy7B,IAAL,GAAY57B,EAAE,CAACqpC,aAAf,GAA+B57B,CAAC,CAAC47B,aAAvD;AACA,UAAI,CAACA,aAAL,EAAoB,OAAO,IAAP;AACpB,aAAOv9B,KAAK,CAACw9B,mBAAN,CAA0B,OAA1B,EAAmC77B,CAAnC,EAAsC47B,aAAtC,CAAP;AACH,KAv/CS;AAy/CVE,IAAAA,sBAAsB,EAAE,gCAAU97B,CAAV,EAAa4c,IAAb,EAAmBgf,aAAnB,EAAkC;AACtD57B,MAAAA,CAAC,CAACC,cAAF;AACAD,MAAAA,CAAC,CAACE,eAAF;AACA07B,MAAAA,aAAa,CAACG,OAAd,CAAsB,WAAtB,EAAmCnf,IAAI,CAACnT,SAAL,CAAe+W,SAAlD;AACH,KA7/CS;AA+/CVwb,IAAAA,cAAc,EAAE,wBAAUh8B,CAAV,EAAa;AACzB,UAAM47B,aAAa,GAAGlpC,IAAI,CAACy7B,IAAL,GAAY57B,EAAE,CAACqpC,aAAf,GAA+B57B,CAAC,CAAC47B,aAAvD,CADyB,CAGzB;;AACA,UAAI,OAAOjoC,SAAS,CAACsoC,MAAjB,KAA4B,UAA5B,IAA0C,CAACtoC,SAAS,CAACsoC,MAAV,CAAiBj8B,CAAjB,EAAoB47B,aAApB,EAAmChpC,IAAnC,CAA/C,EAAyF;AACrFoN,QAAAA,CAAC,CAACC,cAAF;AACAD,QAAAA,CAAC,CAACE,eAAF;AACA,eAAO,KAAP;AACH;;AAED,UAAM0c,IAAI,GAAGhqB,IAAI,CAACiC,wBAAlB;;AACA,UAAI+nB,IAAI,IAAI,CAAClqB,IAAI,CAACy7B,IAAlB,EAAwB;AACpB9vB,QAAAA,KAAK,CAACy9B,sBAAN,CAA6B97B,CAA7B,EAAgC4c,IAAhC,EAAsCgf,aAAtC;;AACAlpC,QAAAA,IAAI,CAACuL,QAAL,CAAc2e,IAAI,CAACnT,SAAnB,EAA8B,mBAA9B,EAFoB,CAGpB;;AACAlX,QAAAA,EAAE,CAACuZ,UAAH,CAAc,YAAY;AACtBpZ,UAAAA,IAAI,CAAC4K,WAAL,CAAiBsf,IAAI,CAACnT,SAAtB,EAAiC,mBAAjC;AACH,SAFD,EAEG,GAFH;AAGH;AACJ,KAlhDS;AAohDVyyB,IAAAA,cAAc,EAAE,wBAAU5S,OAAV,EAAmB;AAC/B;AACA,UAAI,OAAO31B,SAAS,CAACwoC,MAAjB,KAA4B,UAAhC,EAA4C;AACxCxoC,QAAAA,SAAS,CAACwoC,MAAV,CAAiB7S,OAAjB,EAA0B12B,IAA1B;AACA;AACH;AACJ,KA1hDS;AA4hDVwpC,IAAAA,aAAa,EAAE,uBAAUp8B,CAAV,EAAa;AACxB,UAAM47B,aAAa,GAAGlpC,IAAI,CAACy7B,IAAL,GAAY57B,EAAE,CAACqpC,aAAf,GAA+B57B,CAAC,CAAC47B,aAAvD,CADwB,CAGxB;;AACA,UAAI,OAAOjoC,SAAS,CAAC0oC,KAAjB,KAA2B,UAA3B,IAAyC,CAAC1oC,SAAS,CAAC0oC,KAAV,CAAgBr8B,CAAhB,EAAmB47B,aAAnB,EAAkChpC,IAAlC,CAA9C,EAAuF;AACnFoN,QAAAA,CAAC,CAACC,cAAF;AACAD,QAAAA,CAAC,CAACE,eAAF;AACA,eAAO,KAAP;AACH;;AAED,UAAM0c,IAAI,GAAGhqB,IAAI,CAACiC,wBAAlB;;AACA,UAAI+nB,IAAI,IAAI,CAAClqB,IAAI,CAACy7B,IAAlB,EAAwB;AACpB9vB,QAAAA,KAAK,CAACy9B,sBAAN,CAA6B97B,CAA7B,EAAgC4c,IAAhC,EAAsCgf,aAAtC;;AACAlpC,QAAAA,IAAI,CAACsV,UAAL,CAAgB4U,IAAI,CAACnT,SAArB;AACA7W,QAAAA,IAAI,CAACgK,cAAL;AACH;;AAEDrK,MAAAA,EAAE,CAACuZ,UAAH,CAAc,YAAY;AACtB;AACAlZ,QAAAA,IAAI,CAACkB,OAAL,CAAa4H,IAAb,CAAkB,KAAlB;AACH,OAHD;AAIH,KAjjDS;AAmjDV4gC,IAAAA,cAAc,EAAE,wBAAUt8B,CAAV,EAAa;AACzB,UAAIpN,IAAI,CAAC8C,UAAL,IAAmBhD,IAAI,CAACy7B,IAA5B,EAAkC;AAC9BnuB,QAAAA,CAAC,CAACC,cAAF;AACAD,QAAAA,CAAC,CAACE,eAAF;AACA,eAAO,KAAP;AACH;;AAED,UAAMq8B,YAAY,GAAGv8B,CAAC,CAACu8B,YAAvB;AACA,UAAI,CAACA,YAAL,EAAmB,OAAO,IAAP;AAEnB3pC,MAAAA,IAAI,CAACqY,UAAL;;AACA5M,MAAAA,KAAK,CAACm+B,yBAAN,CAAgCx8B,CAAhC;;AACA,aAAO3B,KAAK,CAACw9B,mBAAN,CAA0B,MAA1B,EAAkC77B,CAAlC,EAAqCu8B,YAArC,CAAP;AACH,KAhkDS;AAkkDVC,IAAAA,yBAAyB,EAAE,mCAAUx8B,CAAV,EAAa;AACpC,UAAIA,CAAC,CAACyT,WAAN,EAAmB;AACf7gB,QAAAA,IAAI,CAACsQ,QAAL,CAAclD,CAAC,CAACyT,WAAhB,EAA6BzT,CAAC,CAACy8B,WAA/B,EAA4Cz8B,CAAC,CAACyT,WAA9C,EAA2DzT,CAAC,CAACy8B,WAA7D;AACH,OAFD,MAEO,IAAI7pC,IAAI,CAACW,GAAL,CAASmpC,mBAAb,EAAkC;AACrC,YAAM1xB,CAAC,GAAGpY,IAAI,CAACW,GAAL,CAASmpC,mBAAT,CAA6B18B,CAAC,CAAC28B,OAA/B,EAAwC38B,CAAC,CAACs6B,OAA1C,CAAV;;AACA1nC,QAAAA,IAAI,CAACsQ,QAAL,CAAc8H,CAAC,CAAC3I,cAAhB,EAAgC2I,CAAC,CAACrI,WAAlC,EAA+CqI,CAAC,CAAC1I,YAAjD,EAA+D0I,CAAC,CAAC7H,SAAjE;AACH,OAHM,MAGA;AACH,YAAM6H,GAAC,GAAGpY,IAAI,CAACwP,QAAL,EAAV;;AACAxP,QAAAA,IAAI,CAACsQ,QAAL,CAAc8H,GAAC,CAAC3I,cAAhB,EAAgC2I,GAAC,CAACrI,WAAlC,EAA+CqI,GAAC,CAAC1I,YAAjD,EAA+D0I,GAAC,CAAC7H,SAAjE;AACH;AACJ,KA5kDS;AA8kDV04B,IAAAA,mBAAmB,EAAE,6BAAUv7B,IAAV,EAAgBN,CAAhB,EAAmBsP,IAAnB,EAAyB;AAC1C,UAAIstB,SAAJ,EAAeC,SAAf;;AACA,UAAInqC,IAAI,CAACy7B,IAAT,EAAe;AACXyO,QAAAA,SAAS,GAAGttB,IAAI,CAACwtB,OAAL,CAAa,MAAb,CAAZ;AAEA,YAAM36B,KAAK,GAAGvP,IAAI,CAACwP,QAAL,EAAd;AACA,YAAM26B,OAAO,GAAGrqC,IAAI,CAACoQ,aAAL,CAAmB,KAAnB,CAAhB;AACA,YAAMk6B,SAAS,GAAG;AACdx3B,UAAAA,EAAE,EAAErD,KAAK,CAACE,cADI;AAEdsD,UAAAA,EAAE,EAAExD,KAAK,CAACQ,WAFI;AAGd+C,UAAAA,EAAE,EAAEvD,KAAK,CAACG,YAHI;AAIduD,UAAAA,EAAE,EAAE1D,KAAK,CAACgB;AAJI,SAAlB;AAOA45B,QAAAA,OAAO,CAACrf,YAAR,CAAqB,iBAArB,EAAwC,IAAxC;AACAqf,QAAAA,OAAO,CAAC/jC,KAAR,CAAcQ,OAAd,GAAwB,2EAAxB;AAEA5H,QAAAA,OAAO,CAACO,OAAR,CAAgB2uB,QAAhB,CAAyBpkB,WAAzB,CAAqCqgC,OAArC;AACAA,QAAAA,OAAO,CAAC/6B,KAAR;;AAEAzP,QAAAA,EAAE,CAACuZ,UAAH,CAAc,YAAY;AACtB+wB,UAAAA,SAAS,GAAGE,OAAO,CAACx2B,SAApB;AACA7T,UAAAA,IAAI,CAACsV,UAAL,CAAgB+0B,OAAhB;AACAnqC,UAAAA,IAAI,CAACsQ,QAAL,CAAc85B,SAAS,CAACx3B,EAAxB,EAA4Bw3B,SAAS,CAACr3B,EAAtC,EAA0Cq3B,SAAS,CAACt3B,EAApD,EAAwDs3B,SAAS,CAACn3B,EAAlE;;AACAxH,UAAAA,KAAK,CAAC4+B,iBAAN,CAAwB38B,IAAxB,EAA8BN,CAA9B,EAAiC48B,SAAjC,EAA4CC,SAA5C,EAAuDvtB,IAAvD;AACH,SALD;;AAOA,eAAO,IAAP;AACH,OA1BD,MA0BO;AACHstB,QAAAA,SAAS,GAAGttB,IAAI,CAACwtB,OAAL,CAAa,YAAb,CAAZ;AACAD,QAAAA,SAAS,GAAGvtB,IAAI,CAACwtB,OAAL,CAAa,WAAb,CAAZ;;AACA,YAAIz+B,KAAK,CAAC4+B,iBAAN,CAAwB38B,IAAxB,EAA8BN,CAA9B,EAAiC48B,SAAjC,EAA4CC,SAA5C,EAAuDvtB,IAAvD,MAAiE,KAArE,EAA4E;AACxEtP,UAAAA,CAAC,CAACC,cAAF;AACAD,UAAAA,CAAC,CAACE,eAAF;AACA,iBAAO,KAAP;AACH;AACJ;AACJ,KAnnDS;AAqnDV+8B,IAAAA,iBAAiB,EAAE,2BAAU38B,IAAV,EAAgBN,CAAhB,EAAmB48B,SAAnB,EAA8BC,SAA9B,EAAyCvtB,IAAzC,EAA+C;AAC9D;AACA,UAAM4tB,MAAM,GAAG,+BAA+B78B,IAA/B,CAAoCw8B,SAApC,KAAkD,8BAA8Bx8B,IAA9B,CAAmCw8B,SAAnC,CAAlD,IAAmG,6BAA6Bx8B,IAA7B,CAAkCw8B,SAAlC,CAAnG,IAAmJ,4BAA4Bx8B,IAA5B,CAAiCw8B,SAAjC,CAAlK;AACA,UAAMM,QAAQ,GAAG,CAACN,SAAlB;;AAEA,UAAI,CAACM,QAAL,EAAe;AACX,YAAID,MAAJ,EAAY;AACRL,UAAAA,SAAS,GAAGA,SAAS,CAACrnB,OAAV,CAAkB,KAAlB,EAAyB,GAAzB,CAAZ;AACAonB,UAAAA,SAAS,GAAGA,SAAS,CAACpnB,OAAV,CAAkB,KAAlB,EAAyB,GAAzB,CAAZ;AACH,SAHD,MAGO;AACHqnB,UAAAA,SAAS,GAAG,CAACD,SAAS,KAAKC,SAAd,GAA0BD,SAA1B,GAAsCC,SAAvC,EAAkDrnB,OAAlD,CAA0D,KAA1D,EAAiE,MAAjE,CAAZ;AACH;;AACDqnB,QAAAA,SAAS,GAAGjqC,IAAI,CAACg0B,SAAL,CAAeiW,SAAf,EAA0BjqC,IAAI,CAAC0C,wBAA/B,EAAyD1C,IAAI,CAAC2C,wBAA9D,CAAZ;AACH,OARD,MAQO;AACHsnC,QAAAA,SAAS,GAAGnqC,IAAI,CAACkyB,cAAL,CAAoBgY,SAApB,EAA+BpnB,OAA/B,CAAuC,KAAvC,EAA8C,MAA9C,CAAZ;AACH;;AAED,UAAMmT,YAAY,GAAG/1B,IAAI,CAAC61B,UAAL,CAAgB71B,IAAI,CAACqE,aAAL,GAAqB4lC,SAArB,GAAiCD,SAAjD,CAArB,CAjB8D,CAkB9D;;;AACA,UAAIt8B,IAAI,KAAK,OAAT,IAAoB,OAAO3M,SAAS,CAACypC,OAAjB,KAA6B,UAArD,EAAiE;AAC7D,YAAM37B,KAAK,GAAG9N,SAAS,CAACypC,OAAV,CAAkBp9B,CAAlB,EAAqB68B,SAArB,EAAgClU,YAAhC,EAA8C/1B,IAA9C,CAAd;AACA,YAAI,CAAC6O,KAAL,EAAY,OAAO,KAAP;AACZ,YAAI,OAAOA,KAAP,KAAiB,QAArB,EAA+Bo7B,SAAS,GAAGp7B,KAAZ;AAClC,OAvB6D,CAwB9D;;;AACA,UAAInB,IAAI,KAAK,MAAT,IAAmB,OAAO3M,SAAS,CAAC0pC,MAAjB,KAA4B,UAAnD,EAA+D;AAC3D,YAAM57B,MAAK,GAAG9N,SAAS,CAAC0pC,MAAV,CAAiBr9B,CAAjB,EAAoB68B,SAApB,EAA+BlU,YAA/B,EAA6C/1B,IAA7C,CAAd;;AACA,YAAI,CAAC6O,MAAL,EAAY,OAAO,KAAP;AACZ,YAAI,OAAOA,MAAP,KAAiB,QAArB,EAA+Bo7B,SAAS,GAAGp7B,MAAZ;AAClC,OA7B6D,CA+B9D;;;AACA,UAAM67B,KAAK,GAAGhuB,IAAI,CAACguB,KAAnB;;AACA,UAAIA,KAAK,CAAC5iC,MAAN,GAAe,CAAf,IAAoB,CAACwiC,MAAzB,EAAiC;AAC7B,YAAI,SAAS78B,IAAT,CAAci9B,KAAK,CAAC,CAAD,CAAL,CAASh9B,IAAvB,KAAgC1N,IAAI,CAACd,OAAL,CAAayrC,KAAjD,EAAwD;AACpD5pC,UAAAA,SAAS,CAAC6pC,WAAV,CAAsBF,KAAtB;AACH;;AACD,eAAO,KAAP;AACH;;AAED,UAAI,CAAC3U,YAAL,EAAmB;AACf,eAAO,KAAP;AACH;;AAED,UAAIkU,SAAJ,EAAe;AACXlpC,QAAAA,SAAS,CAACglC,UAAV,CAAqBkE,SAArB,EAAgC,IAAhC,EAAsC,KAAtC;AACA,eAAO,KAAP;AACH;AACJ,KArqDS;AAuqDVY,IAAAA,mBAAmB,EAAE,6BAAUz9B,CAAV,EAAa;AAC9B,UAAIpN,IAAI,CAAC6C,UAAL,IAAmB7C,IAAI,CAAC8C,UAA5B,EAAwC,OAAO,KAAP;AACxC,UAAM+T,SAAS,GAAG/W,IAAI,CAACoP,gBAAL,CAAsB9B,CAAC,CAACxD,MAAxB,EAAgC9J,IAAI,CAACmQ,WAArC,CAAlB;AACA,UAAM66B,gBAAgB,GAAG9qC,IAAI,CAAC+D,YAAL,CAAkBqC,KAA3C;;AAEA,UAAIyQ,SAAS,IAAI,CAAC7W,IAAI,CAAC+B,qBAAvB,EAA8C;AAC1C,YAAMgpC,KAAK,GAAG/rC,OAAO,CAACO,OAAtB;AACA,YAAIiK,SAAS,GAAG,CAAhB;AACA,YAAID,EAAE,GAAGwhC,KAAK,CAAC17B,OAAf;;AACA,WAAG;AACC7F,UAAAA,SAAS,IAAID,EAAE,CAACC,SAAhB;AACAD,UAAAA,EAAE,GAAGA,EAAE,CAACpB,aAAR;AACH,SAHD,QAGSoB,EAAE,IAAI,CAAC,iBAAiBkE,IAAjB,CAAsBlE,EAAE,CAAC0K,QAAzB,CAHhB;;AAKA,YAAM0F,OAAO,GAAGoxB,KAAK,CAAC17B,OAAN,CAAc7F,SAA9B;;AACA,YAAM2f,OAAO,GAAG1d,KAAK,CAACC,iBAAN,CAAwB,IAAxB,CAAhB;;AACA,YAAMgO,YAAY,GAAG5Z,IAAI,CAACsO,SAAL,CAAeyI,SAAf,EAA0Bk0B,KAAK,CAAC5kC,YAAhC,EAA8C1C,GAA9C,GAAoDkW,OAAzE;AACA,YAAMwuB,CAAC,GAAG/6B,CAAC,CAAC49B,KAAF,GAAUxhC,SAAV,IAAuBpK,OAAO,CAACkQ,MAAR,IAAkB,CAAClQ,OAAO,CAAC6uB,gBAA3B,GAA8C8c,KAAK,CAAClgC,OAAN,CAAcwB,YAA5D,GAA2E,CAAlG,CAAV;;AACA,YAAMuO,GAAC,GAAGlB,YAAY,IAAIta,OAAO,CAACkQ,MAAR,GAAiB9F,SAAjB,GAA6B2f,OAAO,CAAC1lB,GAAzC,CAAtB;;AAEA,YAAMgW,MAAM,GAAG3Z,IAAI,CAACuW,UAAL,CAAgBQ,SAAS,CAAC/B,UAA1B,CAAf;AACA,YAAImC,GAAG,GAAG,EAAV;AAAA,YAAcxT,GAAG,GAAG,EAApB;;AACA,YAAI,CAACgW,MAAM,GAAG,CAAC5C,SAAS,CAAC1B,eAAd,GAAgC,CAACrV,IAAI,CAACkQ,eAAL,CAAqB6G,SAAS,CAAC3B,sBAA/B,CAAxC,KAAmGizB,CAAC,GAAIvtB,GAAC,GAAG,EAAhH,EAAqH;AACjHnX,UAAAA,GAAG,GAAGiW,YAAN;AACAzC,UAAAA,GAAG,GAAG,GAAN;AACH,SAHD,MAGO,IAAI,CAACwC,MAAM,GAAG,CAAC5C,SAAS,CAACnC,WAAd,GAA4B,CAAC5U,IAAI,CAACkQ,eAAL,CAAqB6G,SAAS,CAACjD,kBAA/B,CAApC,KAA2Fu0B,CAAC,GAAIvtB,GAAC,GAAG/D,SAAS,CAACxK,YAAd,GAA6B,EAAjI,EAAsI;AACzI5I,UAAAA,GAAG,GAAGiW,YAAY,GAAG7C,SAAS,CAACxK,YAA/B;AACA4K,UAAAA,GAAG,GAAG,GAAN;AACH,SAHM,MAGA;AACH6zB,UAAAA,gBAAgB,CAACrgC,OAAjB,GAA2B,MAA3B;AACA;AACH;;AAEDzK,QAAAA,IAAI,CAACyF,SAAL,CAAe4B,cAAf,GAAgCwP,SAAhC;AACA7W,QAAAA,IAAI,CAACyF,SAAL,CAAe6B,aAAf,GAA+B2P,GAA/B;AACA6zB,QAAAA,gBAAgB,CAACrnC,GAAjB,GAAwBA,GAAG,GAAGkW,OAAP,GAAkB,IAAzC;AACA3Z,QAAAA,IAAI,CAACgE,kBAAL,CAAwBoC,KAAxB,CAA8BuD,IAA9B,GAAsC7J,IAAI,CAACsO,SAAL,CAAeyI,SAAf,EAA0BlN,IAA1B,GAAkCkN,SAAS,CAACtL,WAAV,GAAwB,CAA1D,GAA+D,EAAhE,GAAsE,IAA3G;AACAu/B,QAAAA,gBAAgB,CAACrgC,OAAjB,GAA2B,OAA3B;AACH,OAjCD,CAiCE;AAjCF,WAkCK,IAAIqgC,gBAAgB,CAACrgC,OAAjB,KAA6B,MAAjC,EAAyC;AAC1CqgC,QAAAA,gBAAgB,CAACrgC,OAAjB,GAA2B,MAA3B;AACH;AACJ,KAjtDS;AAmtDVwgC,IAAAA,sBAAsB,EAAE,gCAAU79B,CAAV,EAAa;AACjCA,MAAAA,CAAC,CAACC,cAAF;AACH,KArtDS;AAutDV69B,IAAAA,YAAY,EAAE,sBAAU99B,CAAV,EAAa;AACvBA,MAAAA,CAAC,CAACC,cAAF;AAEA,UAAMwJ,SAAS,GAAG7W,IAAI,CAACyF,SAAL,CAAe4B,cAAjC;AACA,UAAM4P,GAAG,GAAG,CAAC,IAAD,GAAQjX,IAAI,CAACyF,SAAL,CAAe6B,aAAvB,GAAuC,IAAnD;AACA,UAAMmS,MAAM,GAAG3Z,IAAI,CAACuW,UAAL,CAAgBQ,SAAS,CAAC/B,UAA1B,CAAf;AAEA,UAAMtP,MAAM,GAAG1F,IAAI,CAACoQ,aAAL,CAAmBuJ,MAAM,GAAG,IAAH,GAAU3Z,IAAI,CAAC+U,MAAL,CAAYgC,SAAS,CAAC/B,UAAtB,IAAoC,KAApC,GAA4C1V,OAAO,CAAC+Q,UAAvF,CAAf;AACA,UAAI,CAACsJ,MAAL,EAAajU,MAAM,CAACmO,SAAP,GAAmB,MAAnB;AAEb,UAAI3T,IAAI,CAACqE,aAAL,IAAsB,CAACrE,IAAI,CAACkY,cAAL,CAAoB1S,MAAM,CAACooB,SAA3B,EAAsC,WAAtC,CAA3B,EAA+E;AAE/E/W,MAAAA,SAAS,CAAC/B,UAAV,CAAqBzE,YAArB,CAAkC7K,MAAlC,EAA0CyR,GAAG,KAAK,GAAR,GAAcJ,SAAd,GAA0BA,SAAS,CAACnC,WAA9E;AACA1U,MAAAA,IAAI,CAAC+D,YAAL,CAAkBqC,KAAlB,CAAwBqE,OAAxB,GAAkC,MAAlC;AACAzK,MAAAA,IAAI,CAACyF,SAAL,CAAe4B,cAAf,GAAgC,IAAhC;AAEA,UAAMsJ,OAAO,GAAG8I,MAAM,GAAGjU,MAAH,GAAYA,MAAM,CAACsO,UAAzC;AACA9T,MAAAA,IAAI,CAACsQ,QAAL,CAAcK,OAAd,EAAuB,CAAvB,EAA0BA,OAA1B,EAAmC,CAAnC,EAjBuB,CAkBvB;;AACA3Q,MAAAA,IAAI,CAACkB,OAAL,CAAa4H,IAAb,CAAkB,KAAlB;AACH,KA3uDS;AA6uDV4zB,IAAAA,eAAe,EAAE,IA7uDP;AA8uDVE,IAAAA,gBAAgB,EAAE,IA9uDR;AA+uDVL,IAAAA,SAAS,EAAE,qBAAY;AACnB,UAAM4O,YAAY,GAAG/rC,OAAO,CAACkQ,MAAR,GAAiBtP,IAAI,CAACY,GAAtB,GAA4B5B,OAAO,CAACO,OAAR,CAAgB8P,OAAjE;;AACA,UAAI,CAACvP,IAAI,CAACy7B,IAAV,EAAgB;AACZ,aAAKmB,eAAL,GAAuB,IAAI/8B,EAAE,CAACyrC,cAAP,CAAsB,UAASC,OAAT,EAAkB;AAC3DrrC,UAAAA,IAAI,CAACw7B,oBAAL,CAA0B,CAAC,CAA3B,EAA8B6P,OAAO,CAAC,CAAD,CAArC;AACH,SAFsB,CAAvB;AAGH;AAED;;;AACArsC,MAAAA,OAAO,CAACO,OAAR,CAAgBsL,OAAhB,CAAwBsC,gBAAxB,CAAyC,WAAzC,EAAsD1B,KAAK,CAACwzB,oBAA5D,EAAkF,KAAlF;;AACAjgC,MAAAA,OAAO,CAACO,OAAR,CAAgB8B,SAAhB,CAA0B8L,gBAA1B,CAA2C,WAA3C,EAAwD1B,KAAK,CAACwzB,oBAA9D,EAAoF,KAApF;;AACAjgC,MAAAA,OAAO,CAACO,OAAR,CAAgBsL,OAAhB,CAAwBsC,gBAAxB,CAAyC,OAAzC,EAAkD1B,KAAK,CAACyzB,eAAxD,EAAyE,KAAzE;AACA;;AACAiM,MAAAA,YAAY,CAACh+B,gBAAb,CAA8B,WAA9B,EAA2C1B,KAAK,CAAC2zB,mBAAjD,EAAsE,KAAtE;AACA+L,MAAAA,YAAY,CAACh+B,gBAAb,CAA8B,OAA9B,EAAuC1B,KAAK,CAACm0B,eAA7C,EAA8D,KAA9D;AACAuL,MAAAA,YAAY,CAACh+B,gBAAb,CAA8BrN,IAAI,CAACy7B,IAAL,GAAY,WAAZ,GAA0B,OAAxD,EAAiE9vB,KAAK,CAAC22B,eAAvE,EAAwF,KAAxF;AACA+I,MAAAA,YAAY,CAACh+B,gBAAb,CAA8B,SAA9B,EAAyC1B,KAAK,CAACu3B,iBAA/C,EAAkE,KAAlE;AACAmI,MAAAA,YAAY,CAACh+B,gBAAb,CAA8B,OAA9B,EAAuC1B,KAAK,CAACk7B,eAA7C,EAA8D,KAA9D;AACAwE,MAAAA,YAAY,CAACh+B,gBAAb,CAA8B,OAA9B,EAAuC1B,KAAK,CAACs9B,eAA7C,EAA8D,KAA9D;AACAoC,MAAAA,YAAY,CAACh+B,gBAAb,CAA8B,MAA9B,EAAsC1B,KAAK,CAAC29B,cAA5C,EAA4D,KAA5D;AACA+B,MAAAA,YAAY,CAACh+B,gBAAb,CAA8B,KAA9B,EAAqC1B,KAAK,CAAC+9B,aAA3C,EAA0D,KAA1D;AACA2B,MAAAA,YAAY,CAACh+B,gBAAb,CAA8B,MAA9B,EAAsC1B,KAAK,CAACi+B,cAA5C,EAA4D,KAA5D;AACAyB,MAAAA,YAAY,CAACh+B,gBAAb,CAA8B,QAA9B,EAAwC1B,KAAK,CAAC07B,gBAA9C,EAAgE,KAAhE;AACAgE,MAAAA,YAAY,CAACh+B,gBAAb,CAA8B,OAA9B,EAAuC1B,KAAK,CAAC47B,eAA7C,EAA8D,KAA9D;AACA8D,MAAAA,YAAY,CAACh+B,gBAAb,CAA8B,MAA9B,EAAsC1B,KAAK,CAAC87B,cAA5C,EAA4D,KAA5D;AAEA;;AACA97B,MAAAA,KAAK,CAACyyB,gBAAN,GAAyB;AAAE3W,QAAAA,CAAC,EAAE9b,KAAK,CAACy/B,YAAN,CAAmB9gC,IAAnB,CAAwB,EAAxB,CAAL;AAAkCf,QAAAA,CAAC,EAAEoC,KAAK,CAACy/B,YAAN,CAAmB9gC,IAAnB,CAAwB,GAAxB,CAArC;AAAmEkhC,QAAAA,CAAC,EAAE7/B,KAAK,CAACy/B,YAAN,CAAmB9gC,IAAnB,CAAwB,GAAxB;AAAtE,OAAzB;AACA+gC,MAAAA,YAAY,CAACh+B,gBAAb,CAA8B,WAA9B,EAA2C1B,KAAK,CAACo/B,mBAAjD,EAAsE,KAAtE;;AACA7qC,MAAAA,IAAI,CAACgE,kBAAL,CAAwBmJ,gBAAxB,CAAyC,WAAzC,EAAsD1B,KAAK,CAACw/B,sBAA5D,EAAoF,KAApF;;AACAjrC,MAAAA,IAAI,CAACgE,kBAAL,CAAwBmJ,gBAAxB,CAAyC,OAAzC,EAAkD1B,KAAK,CAACyyB,gBAAN,CAAuB3W,CAAzE,EAA4E,KAA5E;;AACAvoB,MAAAA,OAAO,CAACO,OAAR,CAAgBqO,aAAhB,CAA8BT,gBAA9B,CAA+C,WAA/C,EAA4D1B,KAAK,CAACyyB,gBAAN,CAAuB70B,CAAnF,EAAsF,KAAtF;AACArK,MAAAA,OAAO,CAACO,OAAR,CAAgBsO,aAAhB,CAA8BV,gBAA9B,CAA+C,WAA/C,EAA4D1B,KAAK,CAACyyB,gBAAN,CAAuBoN,CAAnF,EAAsF,KAAtF;AAEA;;AACA,UAAItrC,IAAI,CAACd,OAAL,CAAasgC,KAAjB,EAAwB;AACpB2L,QAAAA,YAAY,CAACh+B,gBAAb,CAA8B,YAA9B,EAA4C1B,KAAK,CAAC2zB,mBAAlD,EAAuE;AAACmM,UAAAA,OAAO,EAAE,IAAV;AAAgB5V,UAAAA,UAAU,EAAE;AAA5B,SAAvE;AACH;AAED;;;AACA,UAAIv2B,OAAO,CAACgM,MAAR,KAAmB,MAAnB,IAA6B,CAAChM,OAAO,CAACysB,gBAA1C,EAA4D;AACxD7sB,QAAAA,OAAO,CAACO,OAAR,CAAgBqsB,IAAhB,CAAqBze,gBAArB,CAAsC,SAAtC,EAAiD1B,KAAK,CAACojB,mBAAvD,EAA4E,KAA5E;AACA7vB,QAAAA,OAAO,CAACO,OAAR,CAAgBqsB,IAAhB,CAAqBze,gBAArB,CAAsC,OAAtC,EAA+C1B,KAAK,CAACojB,mBAArD,EAA0E,KAA1E;AACA7vB,QAAAA,OAAO,CAACO,OAAR,CAAgBqsB,IAAhB,CAAqBze,gBAArB,CAAsC,OAAtC,EAA+C1B,KAAK,CAACojB,mBAArD,EAA0E,KAA1E;AACH;AAED;;;AACA,UAAI7vB,OAAO,CAACO,OAAR,CAAgBg+B,WAApB,EAAiC;AAC7B,YAAI,MAAM9vB,IAAN,CAAWrO,OAAO,CAACgM,MAAnB,KAA8BhM,OAAO,CAACosC,YAA1C,EAAwD;AACpDxsC,UAAAA,OAAO,CAACO,OAAR,CAAgBg+B,WAAhB,CAA4BpwB,gBAA5B,CAA6C,WAA7C,EAA0D1B,KAAK,CAACg8B,uBAAhE,EAAyF,KAAzF;AACH,SAFD,MAEO;AACH3nC,UAAAA,IAAI,CAACuL,QAAL,CAAcrM,OAAO,CAACO,OAAR,CAAgBg+B,WAA9B,EAA2C,kBAA3C;AACH;AACJ;AAED;;;AACA9xB,MAAAA,KAAK,CAACggC,qBAAN;AAEA;;;AACA,UAAI,CAAC3rC,IAAI,CAACy7B,IAAV,EAAgB,KAAKqB,gBAAL,GAAwB,IAAIj9B,EAAE,CAACyrC,cAAP,CAAsBprC,IAAI,CAAC42B,sBAA3B,CAAxB;AAEhB;;AACAj3B,MAAAA,EAAE,CAACwN,gBAAH,CAAoB,QAApB,EAA8B1B,KAAK,CAACgxB,eAApC,EAAqD,KAArD;;AACA,UAAIr9B,OAAO,CAAC0vB,aAAR,GAAwB,CAAC,CAA7B,EAAgC;AAC5BnvB,QAAAA,EAAE,CAACwN,gBAAH,CAAoB,QAApB,EAA8B1B,KAAK,CAACsjB,eAApC,EAAqD,KAArD;AACH;AACJ,KAjzDS;AAmzDV2c,IAAAA,YAAY,EAAE,wBAAY;AACtB,UAAMP,YAAY,GAAG/rC,OAAO,CAACkQ,MAAR,GAAiBtP,IAAI,CAACY,GAAtB,GAA4B5B,OAAO,CAACO,OAAR,CAAgB8P,OAAjE;AAEArQ,MAAAA,OAAO,CAACO,OAAR,CAAgBsL,OAAhB,CAAwB+qB,mBAAxB,CAA4C,WAA5C,EAAyDnqB,KAAK,CAACwzB,oBAA/D;;AACAjgC,MAAAA,OAAO,CAACO,OAAR,CAAgB8B,SAAhB,CAA0Bu0B,mBAA1B,CAA8C,WAA9C,EAA2DnqB,KAAK,CAACwzB,oBAAjE;;AACAjgC,MAAAA,OAAO,CAACO,OAAR,CAAgBsL,OAAhB,CAAwB+qB,mBAAxB,CAA4C,OAA5C,EAAqDnqB,KAAK,CAACyzB,eAA3D;AAEAiM,MAAAA,YAAY,CAACvV,mBAAb,CAAiC,WAAjC,EAA8CnqB,KAAK,CAAC2zB,mBAApD;AACA+L,MAAAA,YAAY,CAACvV,mBAAb,CAAiC,OAAjC,EAA0CnqB,KAAK,CAACm0B,eAAhD;AACAuL,MAAAA,YAAY,CAACvV,mBAAb,CAAiC91B,IAAI,CAACy7B,IAAL,GAAY,WAAZ,GAA0B,OAA3D,EAAoE9vB,KAAK,CAAC22B,eAA1E;AACA+I,MAAAA,YAAY,CAACvV,mBAAb,CAAiC,SAAjC,EAA4CnqB,KAAK,CAACu3B,iBAAlD;AACAmI,MAAAA,YAAY,CAACvV,mBAAb,CAAiC,OAAjC,EAA0CnqB,KAAK,CAACk7B,eAAhD;AACAwE,MAAAA,YAAY,CAACvV,mBAAb,CAAiC,OAAjC,EAA0CnqB,KAAK,CAACs9B,eAAhD;AACAoC,MAAAA,YAAY,CAACvV,mBAAb,CAAiC,MAAjC,EAAyCnqB,KAAK,CAAC29B,cAA/C;AACA+B,MAAAA,YAAY,CAACvV,mBAAb,CAAiC,KAAjC,EAAwCnqB,KAAK,CAAC+9B,aAA9C;AACA2B,MAAAA,YAAY,CAACvV,mBAAb,CAAiC,MAAjC,EAAyCnqB,KAAK,CAACi+B,cAA/C;AACAyB,MAAAA,YAAY,CAACvV,mBAAb,CAAiC,QAAjC,EAA2CnqB,KAAK,CAAC07B,gBAAjD;AAEAgE,MAAAA,YAAY,CAACvV,mBAAb,CAAiC,WAAjC,EAA8CnqB,KAAK,CAACo/B,mBAApD;;AACA7qC,MAAAA,IAAI,CAACgE,kBAAL,CAAwB4xB,mBAAxB,CAA4C,WAA5C,EAAyDnqB,KAAK,CAACw/B,sBAA/D;;AACAjrC,MAAAA,IAAI,CAACgE,kBAAL,CAAwB4xB,mBAAxB,CAA4C,OAA5C,EAAqDnqB,KAAK,CAACyyB,gBAAN,CAAuB3W,CAA5E;;AACAvoB,MAAAA,OAAO,CAACO,OAAR,CAAgBqO,aAAhB,CAA8BgoB,mBAA9B,CAAkD,WAAlD,EAA+DnqB,KAAK,CAACyyB,gBAAN,CAAuB70B,CAAtF;AACArK,MAAAA,OAAO,CAACO,OAAR,CAAgBsO,aAAhB,CAA8B+nB,mBAA9B,CAAkD,WAAlD,EAA+DnqB,KAAK,CAACyyB,gBAAN,CAAuBoN,CAAtF;AACA7/B,MAAAA,KAAK,CAACyyB,gBAAN,GAAyB,IAAzB;AAEAiN,MAAAA,YAAY,CAACvV,mBAAb,CAAiC,YAAjC,EAA+CnqB,KAAK,CAAC2zB,mBAArD,EAA0E;AAACmM,QAAAA,OAAO,EAAE,IAAV;AAAgB5V,QAAAA,UAAU,EAAE;AAA5B,OAA1E;AACAwV,MAAAA,YAAY,CAACvV,mBAAb,CAAiC,OAAjC,EAA0CnqB,KAAK,CAAC47B,eAAhD;AACA8D,MAAAA,YAAY,CAACvV,mBAAb,CAAiC,MAAjC,EAAyCnqB,KAAK,CAAC87B,cAA/C;AAEAvoC,MAAAA,OAAO,CAACO,OAAR,CAAgBqsB,IAAhB,CAAqBgK,mBAArB,CAAyC,SAAzC,EAAoDnqB,KAAK,CAACojB,mBAA1D;AACA7vB,MAAAA,OAAO,CAACO,OAAR,CAAgBqsB,IAAhB,CAAqBgK,mBAArB,CAAyC,OAAzC,EAAkDnqB,KAAK,CAACojB,mBAAxD;AACA7vB,MAAAA,OAAO,CAACO,OAAR,CAAgBqsB,IAAhB,CAAqBgK,mBAArB,CAAyC,OAAzC,EAAkDnqB,KAAK,CAACojB,mBAAxD;;AAEA,UAAI7vB,OAAO,CAACO,OAAR,CAAgBg+B,WAApB,EAAiC;AAC7Bv+B,QAAAA,OAAO,CAACO,OAAR,CAAgBg+B,WAAhB,CAA4B3H,mBAA5B,CAAgD,WAAhD,EAA6DnqB,KAAK,CAACg8B,uBAAnE;AACH;;AAED,UAAIh8B,KAAK,CAACixB,eAAV,EAA2B;AACvBjxB,QAAAA,KAAK,CAACixB,eAAN,CAAsBiP,SAAtB,CAAgC3sC,OAAO,CAACO,OAAR,CAAgB4G,YAAhD;;AACAsF,QAAAA,KAAK,CAACixB,eAAN,GAAwB,IAAxB;AACH;;AAED,UAAIjxB,KAAK,CAACmxB,gBAAV,EAA4B;AACxBnxB,QAAAA,KAAK,CAACmxB,gBAAN,CAAuB+O,SAAvB,CAAiC3sC,OAAO,CAACO,OAAR,CAAgBs9B,cAAjD;;AACApxB,QAAAA,KAAK,CAACmxB,gBAAN,GAAyB,IAAzB;AACH;;AAEDj9B,MAAAA,EAAE,CAACi2B,mBAAH,CAAuB,QAAvB,EAAiCnqB,KAAK,CAACgxB,eAAvC;;AACA98B,MAAAA,EAAE,CAACi2B,mBAAH,CAAuB,QAAvB,EAAiCnqB,KAAK,CAACsjB,eAAvC;AACH,KAp2DS;AAs2DV0c,IAAAA,qBAAqB,EAAE,iCAAY;AAC/B,UAAIpsC,kBAAkB,CAACyI,MAAnB,KAA8B,CAAlC,EAAqC;AACjCzI,QAAAA,kBAAkB,GAAG,IAArB;AACA;AACH;;AAEDoM,MAAAA,KAAK,CAACwrB,sBAAN,GAA+B,SAA/B;AACA,UAAM2U,SAAS,GAAGngC,KAAK,CAACqrB,qBAAN,GAA8B,EAAhD;AACA,UAAM+U,UAAU,GAAGpgC,KAAK,CAACpM,kBAAN,GAA2B;AAACysC,QAAAA,OAAO,EAAEzsC,kBAAkB,CAAC,CAAD;AAA5B,OAA9C;;AACA,WAAK,IAAIuI,CAAC,GAAG,CAAR,EAAWqB,GAAG,GAAG5J,kBAAkB,CAACyI,MAApC,EAA4CikC,IAA5C,EAAkDC,WAAvD,EAAoEpkC,CAAC,GAAGqB,GAAxE,EAA6ErB,CAAC,EAA9E,EAAkF;AAC9EokC,QAAAA,WAAW,GAAG3sC,kBAAkB,CAACuI,CAAD,CAAhC;AACAmkC,QAAAA,IAAI,GAAGC,WAAW,CAAC,CAAD,CAAX,GAAiB,CAAxB;AACAJ,QAAAA,SAAS,CAAC9iC,IAAV,CAAeijC,IAAf;AACAF,QAAAA,UAAU,CAACE,IAAD,CAAV,GAAmBC,WAAW,CAAC,CAAD,CAA9B;AACH;;AAEDJ,MAAAA,SAAS,CAACK,IAAV,CAAe,UAAU1kB,CAAV,EAAa+jB,CAAb,EAAgB;AAAE,eAAO/jB,CAAC,GAAG+jB,CAAX;AAAe,OAAhD,EAAkD11B,OAAlD,CAA0D,SAA1D;AACH;AAv3DS,GAAd;AA03DA;;AACA,MAAM7U,SAAS,GAAG;AACd;AACR;AACA;AACQf,IAAAA,IAAI,EAAEA,IAJQ;AAKdF,IAAAA,IAAI,EAAEA,IALQ;;AAOd;AACR;AACA;AACA;AACA;AACQg9B,IAAAA,MAAM,EAAE,IAZM;AAadsK,IAAAA,QAAQ,EAAE,IAbI;AAcd/H,IAAAA,WAAW,EAAE,IAdC;AAedU,IAAAA,OAAO,EAAE,IAfK;AAgBdwC,IAAAA,OAAO,EAAE,IAhBK;AAiBdgB,IAAAA,SAAS,EAAE,IAjBG;AAkBd2D,IAAAA,OAAO,EAAE,IAlBK;AAmBdmC,IAAAA,MAAM,EAAE,IAnBM;AAoBdI,IAAAA,KAAK,EAAE,IApBO;AAqBdnC,IAAAA,OAAO,EAAE,IArBK;AAsBdE,IAAAA,MAAM,EAAE,IAtBM;;AAwBd;AACR;AACA;AACA;AACA;AACQlM,IAAAA,QAAQ,EAAE,IA7BI;;AA+Bb;AACT;AACA;AACA;AACA;AACUiO,IAAAA,MAAM,EAAE,IApCI;;AAsCd;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQkB,IAAAA,MAAM,EAAE,IAhDM;AAiDdD,IAAAA,OAAO,EAAE,IAjDK;;AAmDd;AACR;AACA;AACA;AACA;AACA;AACQrI,IAAAA,UAAU,EAAE,IAzDE;;AA2Dd;AACR;AACA;AACA;AACA;AACA;AACA;AACQ50B,IAAAA,cAAc,EAAE,IAlEF;;AAoEd;AACR;AACA;AACA;AACA;AACQ0c,IAAAA,cAAc,EAAE,IAzEF;;AA2Ed;AACR;AACA;AACA;AACA;AACQC,IAAAA,gBAAgB,EAAE,IAhFJ;;AAkFd;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQgiB,IAAAA,kBAAkB,EAAE,IA/FN;;AAiGd;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQC,IAAAA,kBAAkB,EAAE,IA5GN;;AA8Gd;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACQC,IAAAA,kBAAkB,EAAE,IAtHN;;AAwHd;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQC,IAAAA,mBAAmB,EAAE,IArJP;;AAsJd;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQC,IAAAA,mBAAmB,EAAE,IAjLP;;AAkLd;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQC,IAAAA,mBAAmB,EAAE,IA1MP;;AA4Md;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACQC,IAAAA,aAAa,EAAE,IA5ND;;AA6Nb;AACT;AACA;AACA;AACQC,IAAAA,aAAa,EAAE,IAjOD;;AAkOb;AACT;AACA;AACA;AACQC,IAAAA,aAAa,EAAE,IAtOD;;AAwOd;AACR;AACA;AACA;AACA;AACA;AACA;AACQC,IAAAA,kBAAkB,EAAE,IA/ON;;AAgPd;AACR;AACA;AACA;AACQC,IAAAA,kBAAkB,EAAE,IApPN;;AAqPd;AACR;AACA;AACA;AACQC,IAAAA,kBAAkB,EAAE,IAzPN;;AA2Pd;AACR;AACA;AACQhR,IAAAA,cAAc,EAAE,IA9PF;;AAgQd;AACR;AACA;AACA;AACA;AACA;AACQiR,IAAAA,mBAAmB,EAAE,IAtQP;;AAwQd;AA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","sourcesContent":["/*\r\n * wysiwyg web editor\r\n *\r\n * suneditor.js\r\n * Copyright 2017 JiHong Lee.\r\n * MIT license.\r\n */\r\n'use strict';\r\n\r\nimport _Constructor from './constructor';\r\nimport _Context from './context';\r\nimport _history from './history';\r\nimport _util from './util';\r\nimport _notice from '../plugins/modules/_notice';\r\n\r\n/**\r\n * @description SunEditor constuctor function.\r\n * create core object and event registration.\r\n * core, event, functions\r\n * @param {Object} context\r\n * @param {Object} pluginCallButtons\r\n * @param {Object} plugins \r\n * @param {Object} lang\r\n * @param {Object} options\r\n * @param {Object} _responsiveButtons\r\n * @returns {Object} functions Object\r\n */\r\nexport default function (context, pluginCallButtons, plugins, lang, options, _responsiveButtons) {\r\n    const _d = context.element.originElement.ownerDocument || document;\r\n    const _w = _d.defaultView || window;\r\n    const util = _util;\r\n    const icons = options.icons;\r\n\r\n    /**\r\n     * @description editor core object\r\n     * should always bind this object when registering an event in the plug-in.\r\n     */\r\n    const core = {\r\n        _d: _d,\r\n        _w: _w,\r\n        _parser: new _w.DOMParser(),\r\n        _prevRtl: options.rtl,\r\n        _editorHeight: 0,\r\n        _editorHeightPadding: 0,\r\n        _listCamel: options.__listCommonStyle,\r\n        _listKebab: util.camelToKebabCase(options.__listCommonStyle),\r\n\r\n        /**\r\n         * @description Document object of the iframe if created as an iframe || _d\r\n         * @private\r\n         */\r\n        _wd: null,\r\n\r\n        /**\r\n         * @description Window object of the iframe if created as an iframe || _w\r\n         * @private\r\n         */\r\n        _ww: null,\r\n        \r\n        /**\r\n         * @description Closest ShadowRoot to editor if found\r\n         * @private\r\n         */\r\n        _shadowRoot: null,\r\n\r\n        /**\r\n         * @description Block controller mousedown events in \"shadowRoot\" environment\r\n         * @private\r\n         */\r\n        _shadowRootControllerEventTarget: null,\r\n\r\n        /**\r\n         * @description Util object\r\n         */\r\n        util: util,\r\n\r\n        /**\r\n         * @description Functions object\r\n         */\r\n        functions: null,\r\n\r\n        /**\r\n         * @description Editor options\r\n         */\r\n        options: null,\r\n\r\n        /**\r\n         * @description Computed style of the wysiwyg area (window.getComputedStyle(context.element.wysiwyg))\r\n         */\r\n        wwComputedStyle: null,\r\n\r\n        /**\r\n         * @description Notice object\r\n         */\r\n        notice: _notice,\r\n\r\n        /**\r\n         * @description Default icons object\r\n         */\r\n        icons: icons,\r\n\r\n        /**\r\n         * @description History object for undo, redo\r\n         */\r\n        history: null,\r\n        \r\n        /**\r\n         * @description Elements and user options parameters of the suneditor\r\n         */\r\n        context: context,\r\n\r\n        /**\r\n         * @description Plugin buttons\r\n         */\r\n        pluginCallButtons: pluginCallButtons,\r\n\r\n        /**\r\n         * @description Loaded plugins\r\n         */\r\n        plugins: plugins || {},\r\n\r\n        /**\r\n         * @description Whether the plugin is initialized\r\n         */\r\n        initPlugins: {},\r\n\r\n        /**\r\n         * @description Object for managing submenu elements\r\n         * @private\r\n         */\r\n        _targetPlugins: {},\r\n\r\n        /**\r\n         * @description Save rendered submenus and containers\r\n         * @private\r\n         */\r\n        _menuTray: {},\r\n\r\n        /**\r\n         * @description loaded language\r\n         */\r\n        lang: lang,\r\n\r\n        /**\r\n         * @description The selection node (core.getSelectionNode()) to which the effect was last applied\r\n         */\r\n        effectNode: null,\r\n\r\n        /**\r\n         * @description submenu element\r\n         */\r\n        submenu: null,\r\n\r\n        /**\r\n         * @description container element\r\n         */\r\n        container: null,\r\n\r\n        /**\r\n         * @description current subment name\r\n         * @private\r\n         */\r\n        _submenuName: '',\r\n\r\n        /**\r\n         * @description binded submenuOff method\r\n         * @private\r\n         */\r\n        _bindedSubmenuOff: null,\r\n\r\n        /**\r\n         * @description binded containerOff method\r\n         * @private\r\n         */\r\n        _bindedContainerOff: null,\r\n\r\n        /**\r\n         * @description active button element in submenu\r\n         */\r\n        submenuActiveButton: null,\r\n\r\n        /**\r\n         * @description active button element in container\r\n         */\r\n        containerActiveButton: null,\r\n\r\n        /**\r\n         * @description The elements array to be processed unvisible when the controllersOff function is executed (resizing, link modified button, table controller)\r\n         */\r\n        controllerArray: [],\r\n\r\n        /**\r\n         * @description The name of the plugin that called the currently active controller\r\n         */\r\n        currentControllerName: '',\r\n\r\n        /**\r\n         * @description The target element of current controller\r\n         */\r\n        currentControllerTarget: null,\r\n\r\n        /**\r\n         * @description The file component object of current selected file tag (getFileComponent)\r\n         */\r\n        currentFileComponentInfo: null,\r\n\r\n        /**\r\n         * @description An array of buttons whose class name is not \"se-code-view-enabled\"\r\n         */\r\n        codeViewDisabledButtons: [],\r\n\r\n        /**\r\n         * @description An array of buttons whose class name is not \"se-resizing-enabled\"\r\n         */\r\n        resizingDisabledButtons: [],\r\n\r\n        /**\r\n         * @description active more layer element in submenu\r\n         * @private\r\n         */\r\n        _moreLayerActiveButton: null,\r\n\r\n        /**\r\n         * @description Tag whitelist RegExp object used in \"_consistencyCheckOfHTML\" method\r\n         * ^(options._editorTagsWhitelist)$\r\n         * @private\r\n         */\r\n        _htmlCheckWhitelistRegExp: null,\r\n\r\n        /**\r\n         * @description Tag blacklist RegExp object used in \"_consistencyCheckOfHTML\" method\r\n         * @private\r\n         */\r\n         _htmlCheckBlacklistRegExp: null,\r\n\r\n        /**\r\n         * @description RegExp when using check disallowd tags. (b, i, ins, strike, s)\r\n         * @private\r\n         */\r\n        _disallowedTextTagsRegExp: null,\r\n\r\n        /**\r\n         * @description Editor tags whitelist (RegExp object)\r\n         * util.createTagsWhitelist(options._editorTagsWhitelist)\r\n         */\r\n        editorTagsWhitelistRegExp: null,\r\n\r\n        /**\r\n         * @description Editor tags blacklist (RegExp object)\r\n         * util.createTagsBlacklist(options.tagsBlacklist)\r\n         */\r\n        editorTagsBlacklistRegExp: null,\r\n\r\n        /**\r\n         * @description Tag whitelist when pasting (RegExp object)\r\n         * util.createTagsWhitelist(options.pasteTagsWhitelist)\r\n         */\r\n        pasteTagsWhitelistRegExp: null,\r\n\r\n        /**\r\n         * @description Tag blacklist when pasting (RegExp object)\r\n         * util.createTagsBlacklist(options.pasteTagsBlacklist)\r\n         */\r\n        pasteTagsBlacklistRegExp: null,\r\n\r\n        /**\r\n         * @description Boolean value of whether the editor has focus\r\n         */\r\n        hasFocus: false,\r\n\r\n        /**\r\n         * @description Boolean value of whether the editor is disabled\r\n         */\r\n        isDisabled: false,\r\n\r\n        /**\r\n         * @description Boolean value of whether the editor is readOnly\r\n         */\r\n        isReadOnly: false,\r\n\r\n        /**\r\n         * @description Attributes whitelist used by the cleanHTML method\r\n         * @private\r\n         */\r\n        _attributesWhitelistRegExp: null,\r\n        _attributesWhitelistRegExp_all_data: null,\r\n\r\n        /**\r\n         * @description Attributes blacklist used by the cleanHTML method\r\n         * @private\r\n         */\r\n        _attributesBlacklistRegExp: null,\r\n\r\n        /**\r\n         * @description Attributes of tags whitelist used by the cleanHTML method\r\n         * @private\r\n         */\r\n        _attributesTagsWhitelist: null,\r\n\r\n        /**\r\n         * @description Attributes of tags blacklist used by the cleanHTML method\r\n         * @private\r\n         */\r\n        _attributesTagsBlacklist: null,\r\n\r\n        /**\r\n         * @description binded controllersOff method\r\n         * @private\r\n         */\r\n        _bindControllersOff: null,\r\n\r\n        /**\r\n         * @description Is inline mode?\r\n         * @private\r\n         */\r\n        _isInline: null,\r\n\r\n        /**\r\n         * @description Is balloon|balloon-always mode?\r\n         * @private\r\n         */\r\n        _isBalloon: null,\r\n\r\n        /**\r\n         * @description Is balloon-always mode?\r\n         * @private\r\n         */\r\n        _isBalloonAlways: null,\r\n\r\n        /**\r\n         * @description Required value when using inline mode to sticky toolbar\r\n         * @private\r\n         */\r\n        _inlineToolbarAttr: {top: '', width: '', isShow: false},\r\n\r\n        /**\r\n         * @description Variable that controls the \"blur\" event in the editor of inline or balloon mode when the focus is moved to submenu\r\n         * @private\r\n         */\r\n        _notHideToolbar: false,\r\n\r\n        /**\r\n         * @description Variable value that sticky toolbar mode\r\n         * @private\r\n         */\r\n        _sticky: false,\r\n\r\n        /**\r\n         * @description Variables for controlling focus and blur events\r\n         * @private\r\n         */\r\n        _antiBlur: false,\r\n\r\n        /**\r\n         * @description Component line breaker element\r\n         * @private\r\n         */\r\n        _lineBreaker: null,\r\n        _lineBreakerButton: null,\r\n\r\n        /**\r\n         * @description If true, (initialize, reset) all indexes of image, video information\r\n         * @private\r\n         */\r\n        _componentsInfoInit: true,\r\n        _componentsInfoReset: false,\r\n\r\n        /**\r\n         * @description Plugins array with \"active\" method.\r\n         * \"activePlugins\" runs the \"add\" method when creating the editor.\r\n         */\r\n        activePlugins: null,\r\n\r\n        /**\r\n         * @description Information of tags that should maintain HTML structure, style, class name, etc. (In use by \"math\" plugin)\r\n         * When inserting \"html\" such as paste, it is executed on the \"html\" to be inserted. (core.cleanHTML)\r\n         * Basic Editor Actions:\r\n         * 1. All classes not starting with \"__se__\" or \"se-\" in the editor are removed.\r\n         * 2. The style of all tags except the \"span\" tag is removed from the editor.\r\n         * \"managedTagsInfo\" structure ex:\r\n         * managedTagsInfo: {\r\n         *   query: '.__se__xxx, se-xxx'\r\n         *   map: {\r\n         *     '__se__xxx': method.bind(core),\r\n         *     'se-xxx': method.bind(core),\r\n         *   }\r\n         * }\r\n         * @example\r\n         * Define in the following return format in the \"managedTagInfo\" function of the plugin.\r\n         * managedTagInfo() => {\r\n         *  return {\r\n         *    className: 'string', // Class name to identify the tag. (\"__se__xxx\", \"se-xxx\")\r\n         *    // Change the html of the \"element\". (\"element\" is the element found with \"className\".)\r\n         *    // \"method\" is executed by binding \"core\".\r\n         *    method: function (element) {\r\n         *      // this === core\r\n         *      element.innerHTML = // (rendered html);\r\n         *    }\r\n         *  }\r\n         * }\r\n         */\r\n        managedTagsInfo: null,\r\n\r\n        /**\r\n         * @description cashing: options.charCounterType === 'byte-html'\r\n         * @private\r\n         */\r\n        _charTypeHTML: false,\r\n\r\n        /**\r\n         * @description Array of \"checkFileInfo\" functions with the core bound\r\n         * (Plugins with \"checkFileInfo\" and \"resetFileInfo\" methods)\r\n         * \"fileInfoPlugins\" runs the \"add\" method when creating the editor.\r\n         * \"checkFileInfo\" method is always call just before the \"change\" event.\r\n         * @private\r\n         */\r\n        _fileInfoPluginsCheck: null,\r\n\r\n        /**\r\n         * @description Array of \"resetFileInfo\" functions with the core bound\r\n         * (Plugins with \"checkFileInfo\" and \"resetFileInfo\" methods)\r\n         * \"checkFileInfo\" method is always call just before the \"functions.setOptions\" method.\r\n         * @private\r\n         */\r\n        _fileInfoPluginsReset: null,\r\n\r\n        /**\r\n         * @description Variables for file component management\r\n         * @private\r\n         */\r\n        _fileManager: {\r\n            tags: null,\r\n            regExp: null,\r\n            queryString: null,\r\n            pluginRegExp: null,\r\n            pluginMap: null\r\n        },\r\n\r\n        /**\r\n         * @description Elements that need to change text or className for each selection change\r\n         * After creating the editor, \"activePlugins\" are added.\r\n         * @property {Element} STRONG bold button\r\n         * @property {Element} U underline button\r\n         * @property {Element} EM italic button\r\n         * @property {Element} DEL strike button\r\n         * @property {Element} SUB subscript button\r\n         * @property {Element} SUP superscript button\r\n         * @property {Element} OUTDENT outdent button\r\n         * @property {Element} INDENT indent button\r\n         */\r\n        commandMap: null,\r\n\r\n        /**\r\n         * @description CSS properties related to style tags \r\n         * @private\r\n         */\r\n        _commandMapStyles: {\r\n            STRONG: ['font-weight'],\r\n            U: ['text-decoration'],\r\n            EM: ['font-style'],\r\n            DEL: ['text-decoration']\r\n        },\r\n\r\n        /**\r\n         * @description Style button related to edit area\r\n         * @property {Element} fullScreen fullScreen button element\r\n         * @property {Element} showBlocks showBlocks button element\r\n         * @property {Element} codeView codeView button element\r\n         * @private\r\n         */\r\n        _styleCommandMap: null,\r\n\r\n        /**\r\n         * @private\r\n         */\r\n        _cleanStyleRegExp: {\r\n            span: new _w.RegExp('\\s*(font-family|font-size|color|background-color)\\s*:[^;]+(?!;)*', 'ig'),\r\n            format: new _w.RegExp('\\s*(text-align|margin-left|margin-right)\\s*:[^;]+(?!;)*', 'ig')\r\n        },\r\n\r\n        /**\r\n         * @description Variables used internally in editor operation\r\n         * @property {Boolean} isCodeView State of code view\r\n         * @property {Boolean} isFullScreen State of full screen\r\n         * @property {Number} innerHeight_fullScreen InnerHeight in editor when in full screen\r\n         * @property {Number} resizeClientY Remember the vertical size of the editor before resizing the editor (Used when calculating during resize operation)\r\n         * @property {Number} tabSize Indent size of tab (4)\r\n         * @property {Number} codeIndent Indent size of Code view mode (2)\r\n         * @property {Number} minResizingSize Minimum size of editing area when resized {Number} (.se-wrapper-inner {min-height: 65px;} || 65)\r\n         * @property {Array} currentNodes  An array of the current cursor's node structure\r\n         * @private\r\n         */\r\n        _variable: {\r\n            isChanged: false,\r\n            isCodeView: false,\r\n            isFullScreen: false,\r\n            innerHeight_fullScreen: 0,\r\n            resizeClientY: 0,\r\n            tabSize: 4,\r\n            codeIndent: 2,\r\n            minResizingSize: util.getNumber((context.element.wysiwygFrame.style.minHeight || '65'), 0),\r\n            currentNodes: [],\r\n            currentNodesMap: [],\r\n            _range: null,\r\n            _selectionNode: null,\r\n            _originCssText: context.element.topArea.style.cssText,\r\n            _bodyOverflow: '',\r\n            _editorAreaOriginCssText: '',\r\n            _wysiwygOriginCssText: '',\r\n            _codeOriginCssText: '',\r\n            _fullScreenAttrs: {sticky: false, balloon: false, inline: false},\r\n            _lineBreakComp: null,\r\n            _lineBreakDir: ''\r\n        },\r\n\r\n        /**\r\n         * @description Save the current buttons states to \"allCommandButtons\" object\r\n         * @private\r\n         */\r\n         _saveButtonStates: function () {\r\n            if (!this.allCommandButtons) this.allCommandButtons = {};\r\n\r\n            const currentButtons = this.context.element._buttonTray.querySelectorAll('.se-menu-list button[data-display]');\r\n            for (let i = 0, element, command; i < currentButtons.length; i++) {\r\n                element = currentButtons[i];\r\n                command = element.getAttribute('data-command');\r\n\r\n                this.allCommandButtons[command] = element;\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Recover the current buttons states from \"allCommandButtons\" object\r\n         * @private\r\n         */\r\n        _recoverButtonStates: function () {\r\n            if (this.allCommandButtons) {\r\n                const currentButtons = this.context.element._buttonTray.querySelectorAll('.se-menu-list button[data-display]'); \r\n                for (let i = 0, button, command, oldButton; i < currentButtons.length; i++) {\r\n                    button = currentButtons[i]; \r\n                    command = button.getAttribute('data-command');\r\n\r\n                    oldButton = this.allCommandButtons[command];\r\n                    if (oldButton) {\r\n                        button.parentElement.replaceChild(oldButton, button);\r\n                        if (this.context.tool[command]) this.context.tool[command] = oldButton;\r\n                    }\r\n                }   \r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description If the plugin is not added, add the plugin and call the 'add' function.\r\n         * If the plugin is added call callBack function.\r\n         * @param {String} pluginName The name of the plugin to call\r\n         * @param {function} callBackFunction Function to be executed immediately after module call\r\n         * @param {Element|null} _target Plugin target button (This is not necessary if you have a button list when creating the editor)\r\n         */\r\n        callPlugin: function (pluginName, callBackFunction, _target) {\r\n            _target = _target || pluginCallButtons[pluginName];\r\n\r\n            if (!this.plugins[pluginName]) {\r\n                throw Error('[SUNEDITOR.core.callPlugin.fail] The called plugin does not exist or is in an invalid format. (pluginName:\"' + pluginName + '\")');\r\n            } else if (!this.initPlugins[pluginName]) {\r\n                this.plugins[pluginName].add(this, _target);\r\n                this.initPlugins[pluginName] = true;\r\n            } else if (typeof this._targetPlugins[pluginName] === 'object' && !!_target) {\r\n                this.initMenuTarget(pluginName, _target, this._targetPlugins[pluginName]);\r\n            }\r\n\r\n            if (this.plugins[pluginName].active && !this.commandMap[pluginName] && !!_target) {\r\n                this.commandMap[pluginName] = _target;\r\n                this.activePlugins.push(pluginName);\r\n            }\r\n                \r\n            if (typeof callBackFunction === 'function') callBackFunction();\r\n        },\r\n\r\n        /**\r\n         * @description If the module is not added, add the module and call the 'add' function\r\n         * @param {Array} moduleArray module object's Array [dialog, resizing]\r\n         */\r\n        addModule: function (moduleArray) {\r\n            for (let i = 0, len = moduleArray.length, moduleName; i < len; i++) {\r\n                moduleName = moduleArray[i].name;\r\n                if (!this.plugins[moduleName]) {\r\n                    this.plugins[moduleName] = moduleArray[i];\r\n                }\r\n                if (!this.initPlugins[moduleName]) {\r\n                    this.initPlugins[moduleName] = true;\r\n                    if (typeof this.plugins[moduleName].add === 'function') this.plugins[moduleName].add(this);\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Gets the current editor-relative scroll offset.\r\n         * @returns {Object} {top, left}\r\n         */\r\n        getGlobalScrollOffset: function () {\r\n            let t = 0, l = 0;\r\n            let el = context.element.topArea;\r\n            while (el) {\r\n                t += el.scrollTop;\r\n                l += el.scrollLeft;\r\n                el = el.parentElement;\r\n            }\r\n            \r\n            el = this._shadowRoot ? this._shadowRoot.host : null;\r\n            while (el) {\r\n                t += el.scrollTop;\r\n                l += el.scrollLeft;\r\n                el = el.parentElement;\r\n            }\r\n\r\n            return {\r\n                top: t,\r\n                left: l\r\n            };\r\n        },\r\n\r\n        /**\r\n         * @description Method for managing submenu element.\r\n         * You must add the \"submenu\" element using the this method at custom plugin.\r\n         * @param {String} pluginName Plugin name\r\n         * @param {Element|null} target Target button\r\n         * @param {Element} menu Submenu element\r\n         */\r\n        initMenuTarget: function (pluginName, target, menu) {\r\n            if (!target) {\r\n                this._targetPlugins[pluginName] = menu;\r\n            } else {\r\n                context.element._menuTray.appendChild(menu);\r\n                this._targetPlugins[pluginName] = true;\r\n                this._menuTray[target.getAttribute('data-command')] = menu;\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Enable submenu\r\n         * @param {Element} element Submenu's button element to call\r\n         */\r\n        submenuOn: function (element) {\r\n            if (this._bindedSubmenuOff) this._bindedSubmenuOff();\r\n            if (this._bindControllersOff) this.controllersOff();\r\n\r\n            const submenuName = this._submenuName = element.getAttribute('data-command');\r\n            const menu = this.submenu = this._menuTray[submenuName];\r\n            this.submenuActiveButton = element;\r\n            this._setMenuPosition(element, menu);\r\n            \r\n            this._bindedSubmenuOff = this.submenuOff.bind(this);\r\n            this.addDocEvent('mousedown', this._bindedSubmenuOff, false);\r\n\r\n            if (this.plugins[submenuName].on) this.plugins[submenuName].on.call(this);\r\n            this._antiBlur = true;\r\n        },\r\n\r\n        /**\r\n         * @description Disable submenu\r\n         */\r\n        submenuOff: function () {\r\n            this.removeDocEvent('mousedown', this._bindedSubmenuOff);\r\n            this._bindedSubmenuOff = null;\r\n\r\n            if (this.submenu) {\r\n                this._submenuName = '';\r\n                this.submenu.style.display = 'none';\r\n                this.submenu = null;\r\n                util.removeClass(this.submenuActiveButton, 'on');\r\n                this.submenuActiveButton = null;\r\n                this._notHideToolbar = false;\r\n            }\r\n\r\n            this._antiBlur = false;\r\n        },\r\n\r\n        /**\r\n         * @description Disable more layer\r\n         */\r\n        moreLayerOff: function() {\r\n            if (this._moreLayerActiveButton) {\r\n                const layer = context.element.toolbar.querySelector('.' + this._moreLayerActiveButton.getAttribute('data-command'));\r\n                layer.style.display = 'none';\r\n                util.removeClass(this._moreLayerActiveButton, 'on');\r\n                this._moreLayerActiveButton = null;\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Enable container\r\n         * @param {Element} element Container's button element to call\r\n         */\r\n        containerOn: function (element) {\r\n            if (this._bindedContainerOff) this._bindedContainerOff();\r\n\r\n            const containerName = this._containerName = element.getAttribute('data-command');\r\n            const menu = this.container = this._menuTray[containerName];\r\n            this.containerActiveButton = element;\r\n            this._setMenuPosition(element, menu);\r\n            \r\n            this._bindedContainerOff = this.containerOff.bind(this);\r\n            this.addDocEvent('mousedown', this._bindedContainerOff, false);\r\n\r\n            if (this.plugins[containerName].on) this.plugins[containerName].on.call(this);\r\n            this._antiBlur = true;\r\n        },\r\n\r\n        /**\r\n         * @description Disable container\r\n         */\r\n        containerOff: function () {\r\n            this.removeDocEvent('mousedown', this._bindedContainerOff);\r\n            this._bindedContainerOff = null;\r\n\r\n            if (this.container) {\r\n                this._containerName = '';\r\n                this.container.style.display = 'none';\r\n                this.container = null;\r\n                util.removeClass(this.containerActiveButton, 'on');\r\n                this.containerActiveButton = null;\r\n                this._notHideToolbar = false;\r\n            }\r\n\r\n            this._antiBlur = false;\r\n        },\r\n\r\n        /**\r\n         * @description Set the menu position. (submenu, container)\r\n         * @param {*} element Button element\r\n         * @param {*} menu Menu element\r\n         * @private\r\n         */\r\n        _setMenuPosition: function (element, menu) {\r\n            menu.style.visibility = 'hidden';\r\n            menu.style.display = 'block';\r\n            menu.style.height = '';\r\n            util.addClass(element, 'on');\r\n\r\n            const toolbar = this.context.element.toolbar;\r\n            const toolbarW = toolbar.offsetWidth;\r\n            const toolbarOffset = event._getEditorOffsets(context.element.toolbar);\r\n            const menuW = menu.offsetWidth;\r\n            const l = element.parentElement.offsetLeft + 3;\r\n\r\n            // rtl\r\n            if (options.rtl) {\r\n                const elementW = element.offsetWidth;\r\n                const rtlW = menuW > elementW ? menuW - elementW : 0;\r\n                const rtlL = rtlW > 0 ? 0 : elementW - menuW;\r\n                menu.style.left = (l - rtlW + rtlL) + 'px';\r\n                if (toolbarOffset.left > event._getEditorOffsets(menu).left) {\r\n                    menu.style.left = '0px';\r\n                }\r\n            } else {\r\n                const overLeft = toolbarW <= menuW ? 0 : toolbarW - (l + menuW);\r\n                if (overLeft < 0) menu.style.left = (l + overLeft) + 'px';\r\n                else menu.style.left = l + 'px';\r\n            }\r\n\r\n            // get element top\r\n            let t = 0;\r\n            let offsetEl = element;\r\n            while (offsetEl && offsetEl !== toolbar) {\r\n                t += offsetEl.offsetTop;\r\n                offsetEl = offsetEl.offsetParent;\r\n            }\r\n\r\n            const bt = t;\r\n            if (this._isBalloon) {\r\n                t += toolbar.offsetTop + element.offsetHeight;\r\n            } else {\r\n                t -= element.offsetHeight;\r\n            }\r\n\r\n            // set menu position\r\n            const toolbarTop = toolbarOffset.top;\r\n            const menuHeight = menu.offsetHeight;\r\n            const scrollTop = this.getGlobalScrollOffset().top;\r\n\r\n            const menuHeight_bottom = _w.innerHeight - (toolbarTop - scrollTop + bt + element.parentElement.offsetHeight);\r\n            if (menuHeight_bottom < menuHeight) {\r\n                let menuTop = -1 * (menuHeight - bt + 3);\r\n                const insTop = toolbarTop - scrollTop + menuTop;\r\n                const menuHeight_top = menuHeight + (insTop < 0 ? insTop : 0);\r\n                \r\n                if (menuHeight_top > menuHeight_bottom) {\r\n                    menu.style.height = menuHeight_top + 'px';\r\n                    menuTop = -1 * (menuHeight_top - bt + 3);\r\n                } else {\r\n                    menu.style.height = menuHeight_bottom + 'px';\r\n                    menuTop = bt + element.parentElement.offsetHeight;\r\n                }\r\n\r\n                menu.style.top = menuTop + 'px';\r\n            } else {\r\n                menu.style.top = (bt + element.parentElement.offsetHeight) + 'px';\r\n            }\r\n\r\n            menu.style.visibility = '';\r\n        },\r\n\r\n        /**\r\n         * @description Show controller at editor area (controller elements, function, \"controller target element(@Required)\", \"controller name(@Required)\", etc..)\r\n         * @param {*} arguments controller elements, functions..\r\n         */\r\n        controllersOn: function () {\r\n            if (this._bindControllersOff) this._bindControllersOff();\r\n            this.controllerArray = [];\r\n\r\n            for (let i = 0, arg; i < arguments.length; i++) {\r\n                arg = arguments[i];\r\n                if (!arg) continue;\r\n                \r\n                if (typeof arg === 'string') {\r\n                    this.currentControllerName = arg;\r\n                    continue;\r\n                }\r\n                if (typeof arg === 'function') {\r\n                    this.controllerArray.push(arg);\r\n                    continue;\r\n                }\r\n                if (!util.hasClass(arg, 'se-controller')) {\r\n                    this.currentControllerTarget = arg;\r\n                    this.currentFileComponentInfo = this.getFileComponent(arg);\r\n                    continue;\r\n                }\r\n                if (arg.style) {\r\n                    arg.style.display = 'block';\r\n                    if (this._shadowRoot && this._shadowRootControllerEventTarget.indexOf(arg) === -1) {\r\n                        arg.addEventListener('mousedown', function (e) { e.preventDefault(); e.stopPropagation(); });\r\n                        this._shadowRootControllerEventTarget.push(arg);\r\n                    }\r\n                }\r\n                this.controllerArray.push(arg);\r\n            }\r\n\r\n            this._bindControllersOff = this.controllersOff.bind(this);\r\n            this.addDocEvent('mousedown', this._bindControllersOff, false);\r\n            this.addDocEvent('keydown', this._bindControllersOff, false);\r\n            this._antiBlur = true;\r\n\r\n            if (typeof functions.showController === 'function') functions.showController(this.currentControllerName, this.controllerArray, this);\r\n        },\r\n\r\n        /**\r\n         * @description Hide controller at editor area (link button, image resize button..)\r\n         * @param {KeyboardEvent|MouseEvent|null} e Event object when called from mousedown and keydown events registered in \"core.controllersOn\"\r\n         */\r\n        controllersOff: function (e) {\r\n            this._lineBreaker.style.display = 'none';\r\n            const len = this.controllerArray.length;\r\n\r\n            if (e && e.target && len > 0) {\r\n                for (let i = 0; i < len; i++) {\r\n                    if (typeof this.controllerArray[i].contains === 'function' && this.controllerArray[i].contains(e.target)) return;\r\n                }\r\n            }\r\n            \r\n            if (this._fileManager.pluginRegExp.test(this.currentControllerName) && e && e.type === 'keydown' && e.keyCode !== 27) return;\r\n            context.element.lineBreaker_t.style.display = context.element.lineBreaker_b.style.display = 'none';\r\n            this._variable._lineBreakComp = null;\r\n\r\n            this.currentControllerName = '';\r\n            this.currentControllerTarget = null;\r\n            this.currentFileComponentInfo = null;\r\n            this.effectNode = null;\r\n            if (!this._bindControllersOff) return;\r\n\r\n            this.removeDocEvent('mousedown', this._bindControllersOff);\r\n            this.removeDocEvent('keydown', this._bindControllersOff);\r\n            this._bindControllersOff = null;\r\n\r\n            if (len > 0) {\r\n                for (let i = 0; i < len; i++) {\r\n                    if (typeof this.controllerArray[i] === 'function') this.controllerArray[i]();\r\n                    else this.controllerArray[i].style.display = 'none';\r\n                }\r\n\r\n                this.controllerArray = [];\r\n            }\r\n\r\n            this._antiBlur = false;\r\n        },\r\n\r\n        /**\r\n         * @description Specify the position of the controller.\r\n         * @param {Element} controller Controller element.\r\n         * @param {Element} referEl Element that is the basis of the controller's position.\r\n         * @param {String} position Type of position (\"top\" | \"bottom\")\r\n         * When using the \"top\" position, there should not be an arrow on the controller.\r\n         * When using the \"bottom\" position there should be an arrow on the controller.\r\n         * @param {Object} addOffset These are the left and top values that need to be added specially. \r\n         * This argument is required. - {left: 0, top: 0}\r\n         * Please enter the value based on ltr mode.\r\n         * Calculated automatically in rtl mode.\r\n         */\r\n        setControllerPosition: function (controller, referEl, position, addOffset) {\r\n            if (options.rtl) addOffset.left *= -1;\r\n\r\n            const offset = util.getOffset(referEl, context.element.wysiwygFrame);\r\n            controller.style.visibility = 'hidden';\r\n            controller.style.display = 'block';\r\n\r\n            // Height value of the arrow element is 11px\r\n            const topMargin = position === 'top' ? -(controller.offsetHeight + 2) : (referEl.offsetHeight + 12);\r\n            controller.style.top = (offset.top + topMargin + addOffset.top) + 'px';\r\n\r\n            const l = offset.left - context.element.wysiwygFrame.scrollLeft + addOffset.left;\r\n            const controllerW = controller.offsetWidth;\r\n            const referElW = referEl.offsetWidth;\r\n            \r\n            const allow = util.hasClass(controller.firstElementChild, 'se-arrow') ? controller.firstElementChild : null;\r\n\r\n            // rtl (Width value of the arrow element is 22px)\r\n            if (options.rtl) {\r\n                const rtlW = (controllerW > referElW) ? controllerW - referElW : 0;\r\n                const rtlL = rtlW > 0 ? 0 : referElW - controllerW;\r\n                controller.style.left = (l - rtlW + rtlL) + 'px';\r\n                \r\n                if (rtlW > 0) {\r\n                    if (allow) allow.style.left = ((controllerW - 14 < 10 + rtlW) ? (controllerW - 14) : (10 + rtlW)) + 'px';\r\n                }\r\n                \r\n                const overSize = context.element.wysiwygFrame.offsetLeft - controller.offsetLeft;\r\n                if (overSize > 0) {\r\n                    controller.style.left = '0px';\r\n                    if (allow) allow.style.left = overSize + 'px';\r\n                }\r\n            } else {\r\n                controller.style.left = l + 'px';\r\n\r\n                const overSize = context.element.wysiwygFrame.offsetWidth - (controller.offsetLeft + controllerW);\r\n                if (overSize < 0) {\r\n                    controller.style.left = (controller.offsetLeft + overSize) + 'px';\r\n                    if (allow) allow.style.left = (20 - overSize) + 'px';\r\n                } else {\r\n                    if (allow) allow.style.left = '20px';\r\n                }\r\n            }\r\n\r\n            controller.style.visibility = '';\r\n        },\r\n\r\n        /**\r\n         * @description javascript execCommand\r\n         * @param {String} command javascript execCommand function property\r\n         * @param {Boolean|undefined} showDefaultUI javascript execCommand function property\r\n         * @param {String|undefined} value javascript execCommand function property\r\n         */\r\n        execCommand: function (command, showDefaultUI, value) {\r\n            this._wd.execCommand(command, showDefaultUI, (command === 'formatBlock' ? '<' + value + '>' : value));\r\n            // history stack\r\n            this.history.push(true);\r\n        },\r\n\r\n        /**\r\n         * @description Focus to wysiwyg area using \"native focus function\"\r\n         */\r\n        nativeFocus: function () {\r\n            this.__focus();\r\n            this._editorRange();\r\n        },\r\n\r\n        /**\r\n         * @description Focus method\r\n         * @private\r\n         */\r\n        __focus: function () {\r\n            const caption = util.getParentElement(this.getSelectionNode(), 'figcaption');\r\n            if (caption) {\r\n                caption.focus();\r\n            } else {\r\n                context.element.wysiwyg.focus();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Focus to wysiwyg area\r\n         */\r\n        focus: function () {\r\n            if (context.element.wysiwygFrame.style.display === 'none') return;\r\n\r\n            if (options.iframe) {\r\n                this.nativeFocus();\r\n            } else {\r\n                try {\r\n                    const range = this.getRange();\r\n                    if (range.startContainer === range.endContainer && util.isWysiwygDiv(range.startContainer)) {\r\n                        const currentNode = range.commonAncestorContainer.children[range.startOffset];\r\n                        if (!util.isFormatElement(currentNode) && !util.isComponent(currentNode)) {\r\n                            const format = util.createElement(options.defaultTag);\r\n                            const br = util.createElement('BR');\r\n                            format.appendChild(br);\r\n                            context.element.wysiwyg.insertBefore(format, currentNode);\r\n                            this.setRange(br, 0, br, 0);\r\n                            return;\r\n                        }\r\n                    }\r\n                    this.setRange(range.startContainer, range.startOffset, range.endContainer, range.endOffset);\r\n                } catch (e) {\r\n                    this.nativeFocus();\r\n                }\r\n            }\r\n\r\n            event._applyTagEffects();\r\n            if (this._isBalloon) event._toggleToolbarBalloon();\r\n        },\r\n\r\n        /**\r\n         * @description If \"focusEl\" is a component, then that component is selected; if it is a format element, the last text is selected\r\n         * If \"focusEdge\" is null, then selected last element\r\n         * @param {Element|null} focusEl Focus element\r\n         */\r\n        focusEdge: function (focusEl) {\r\n            if (!focusEl) focusEl = context.element.wysiwyg.lastElementChild;\r\n\r\n            const fileComponentInfo = this.getFileComponent(focusEl);\r\n            if (fileComponentInfo) {\r\n                this.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName);\r\n            } else if (focusEl) {\r\n                focusEl = util.getChildElement(focusEl, function (current) { return current.childNodes.length === 0 || current.nodeType === 3; }, true);\r\n                if (!focusEl) this.nativeFocus();\r\n                else this.setRange(focusEl, focusEl.textContent.length, focusEl, focusEl.textContent.length);\r\n            } else {\r\n                this.focus();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Focusout to wysiwyg area (.blur())\r\n         */\r\n        blur: function () {\r\n            if (options.iframe) {\r\n                context.element.wysiwygFrame.blur();\r\n            } else {\r\n                context.element.wysiwyg.blur();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Set current editor's range object and return.\r\n         * @param {Node} startCon The startContainer property of the selection object.\r\n         * @param {Number} startOff The startOffset property of the selection object.\r\n         * @param {Node} endCon The endContainer property of the selection object.\r\n         * @param {Number} endOff The endOffset property of the selection object.\r\n         * @returns {Object} Range object.\r\n         */\r\n        setRange: function (startCon, startOff, endCon, endOff) {\r\n            if (!startCon || !endCon) return;\r\n            if (startOff > startCon.textContent.length) startOff = startCon.textContent.length;\r\n            if (endOff > endCon.textContent.length) endOff = endCon.textContent.length;\r\n            if (util.isFormatElement(startCon)) {\r\n                startCon = startCon.childNodes[startOff] || startCon.childNodes[startOff - 1] || startCon;\r\n                startOff = startOff > 0 ? startCon.nodeType === 1 ? 1 : startCon.textContent ? startCon.textContent.length : 0 : 0;\r\n            }\r\n            if (util.isFormatElement(endCon)) {\r\n                endCon = endCon.childNodes[endOff] || endCon.childNodes[endOff - 1] || endCon;\r\n                endOff = endOff > 0 ? endCon.nodeType === 1 ? 1 : endCon.textContent ? endCon.textContent.length : 0 : 0;\r\n            }\r\n            \r\n            const range = this._wd.createRange();\r\n\r\n            try {\r\n                range.setStart(startCon, startOff);\r\n                range.setEnd(endCon, endOff);\r\n            } catch (error) {\r\n                console.warn('[SUNEDITOR.core.focus.error] ' + error);\r\n                this.nativeFocus();\r\n                return;\r\n            }\r\n\r\n            const selection = this.getSelection();\r\n\r\n            if (selection.removeAllRanges) {\r\n                selection.removeAllRanges();\r\n            }\r\n\r\n            selection.addRange(range);\r\n            this._rangeInfo(range, this.getSelection());\r\n            if (options.iframe) this.__focus();\r\n\r\n            return range;\r\n        },\r\n\r\n        /**\r\n         * @description Remove range object and button effect\r\n         */\r\n        removeRange: function () {\r\n            this._variable._range = null;\r\n            this._variable._selectionNode = null;\r\n            if (this.hasFocus) this.getSelection().removeAllRanges();\r\n            this._setKeyEffect([]);\r\n        },\r\n\r\n        /**\r\n         * @description Get current editor's range object\r\n         * @returns {Object}\r\n         */\r\n        getRange: function () {\r\n            const range = this._variable._range || this._createDefaultRange();\r\n            const selection = this.getSelection();\r\n            if (range.collapsed === selection.isCollapsed || !context.element.wysiwyg.contains(selection.focusNode)) return range;\r\n            \r\n            if (selection.rangeCount > 0) {\r\n                this._variable._range = selection.getRangeAt(0);\r\n                return this._variable._range;\r\n            } else {\r\n                const sc = selection.anchorNode, ec = selection.focusNode, so = selection.anchorOffset, eo = selection.focusOffset;\r\n                const compareValue = util.compareElements(sc, ec);\r\n                const rightDir = compareValue.ancestor && (compareValue.result === 0 ? so <= eo : compareValue.result > 1 ? true : false);\r\n                return this.setRange(\r\n                    rightDir ? sc : ec,\r\n                    rightDir ? so : eo,\r\n                    rightDir ? ec : sc,\r\n                    rightDir ? eo : so\r\n                );\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description If the \"range\" object is a non-editable area, add a line at the top of the editor and update the \"range\" object.\r\n         * Returns a new \"range\" or argument \"range\".\r\n         * @param {Object} range core.getRange()\r\n         * @param {Element|null} container If there is \"container\" argument, it creates a line in front of the container.\r\n         * @returns {Object} range\r\n         */\r\n        getRange_addLine: function (range, container) {\r\n            if (this._selectionVoid(range)) {\r\n                const wysiwyg = context.element.wysiwyg;\r\n                const op = util.createElement(options.defaultTag);\r\n                op.innerHTML = '<br>';\r\n                wysiwyg.insertBefore(op, container && container !== wysiwyg ? container.nextElementSibling : wysiwyg.firstElementChild);\r\n                this.setRange(op.firstElementChild, 0, op.firstElementChild, 1);\r\n                range = this._variable._range;\r\n            }\r\n            return range;\r\n        },\r\n\r\n        /**\r\n         * @description Get window selection obejct\r\n         * @returns {Object}\r\n         */\r\n        getSelection: function () {\r\n            return this._shadowRoot && this._shadowRoot.getSelection ? this._shadowRoot.getSelection() : this._ww.getSelection();\r\n        },\r\n\r\n        /**\r\n         * @description Get current select node\r\n         * @returns {Node}\r\n         */\r\n        getSelectionNode: function () {\r\n            if(!context.element.wysiwyg.contains(this._variable._selectionNode))this._editorRange();\r\n            if (!this._variable._selectionNode) {\r\n                const selectionNode = util.getChildElement(context.element.wysiwyg.firstChild, function (current) { return current.childNodes.length === 0 || current.nodeType === 3; }, false);\r\n                if (!selectionNode){\r\n                    this._editorRange();\r\n                } else {\r\n                    this._variable._selectionNode = selectionNode;\r\n                    return selectionNode;\r\n                }\r\n            }\r\n            return this._variable._selectionNode;\r\n        },\r\n\r\n        /**\r\n         * @description Saving the range object and the currently selected node of editor\r\n         * @private\r\n         */\r\n        _editorRange: function () {\r\n            const selection = this.getSelection();\r\n            if (!selection) return null;\r\n            let range = null;\r\n\r\n            if (selection.rangeCount > 0) {\r\n                range = selection.getRangeAt(0);\r\n            } else {\r\n                range = this._createDefaultRange();\r\n            }\r\n\r\n            if (util.isFormatElement(range.endContainer) && range.endOffset === 0) {\r\n                range = this.setRange(range.startContainer, range.startOffset, range.startContainer, range.startContainer.length);\r\n            }\r\n\r\n            this._rangeInfo(range, selection);\r\n        },\r\n\r\n        /**\r\n         * @description Set \"range\" and \"selection\" info.\r\n         * @param {Object} range range object.\r\n         * @param {Object} selection selection object.\r\n         */\r\n        _rangeInfo: function (range, selection) {\r\n            let selectionNode = null;\r\n            this._variable._range = range;\r\n\r\n            if (range.collapsed) {\r\n                if (util.isWysiwygDiv(range.commonAncestorContainer)) selectionNode = range.commonAncestorContainer.children[range.startOffset] || range.commonAncestorContainer;\r\n                else selectionNode = range.commonAncestorContainer;\r\n            } else {\r\n                selectionNode = selection.extentNode || selection.anchorNode;\r\n            }\r\n\r\n            this._variable._selectionNode = selectionNode;\r\n        },\r\n\r\n        /**\r\n         * @description Return the range object of editor's first child node\r\n         * @returns {Object}\r\n         * @private\r\n         */\r\n        _createDefaultRange: function () {\r\n            const wysiwyg = context.element.wysiwyg;\r\n            wysiwyg.focus();\r\n            const range = this._wd.createRange();\r\n\r\n            let focusEl = wysiwyg.firstElementChild;\r\n            if (!focusEl) {\r\n                focusEl = util.createElement(options.defaultTag);\r\n                focusEl.innerHTML = '<br>';\r\n                wysiwyg.appendChild(focusEl);\r\n            }\r\n\r\n            range.setStart(focusEl, 0);\r\n            range.setEnd(focusEl, 0);\r\n            \r\n            return range;\r\n        },\r\n\r\n        /**\r\n         * @description Returns true if there is no valid \"selection\".\r\n         * @param {Object} range core.getRange()\r\n         * @returns {Object} range\r\n         * @private\r\n         */\r\n        _selectionVoid: function (range) {\r\n            const comm = range.commonAncestorContainer;\r\n            return (util.isWysiwygDiv(range.startContainer) && util.isWysiwygDiv(range.endContainer)) || /FIGURE/i.test(comm.nodeName) || this._fileManager.regExp.test(comm.nodeName) || util.isMediaComponent(comm);\r\n        },\r\n\r\n        /**\r\n         * @description Reset range object to text node selected status.\r\n         * @returns {Boolean} Returns false if there is no valid selection.\r\n         * @private\r\n         */\r\n        _resetRangeToTextNode: function () {\r\n            const range = this.getRange();\r\n            if (this._selectionVoid(range)) return false;\r\n            \r\n            let startCon = range.startContainer;\r\n            let startOff = range.startOffset;\r\n            let endCon = range.endContainer;\r\n            let endOff = range.endOffset;\r\n            let tempCon, tempOffset, tempChild;\r\n\r\n            if (util.isFormatElement(startCon)) {\r\n                if (!startCon.childNodes[startOff]) {\r\n                    startCon = startCon.lastChild || startCon;\r\n                    startOff = startCon.textContent.length;\r\n                } else {\r\n                    startCon = startCon.childNodes[startOff] || startCon;\r\n                    startOff = 0;\r\n                }\r\n                while (startCon && startCon.nodeType === 1 && startCon.firstChild) {\r\n                    startCon = startCon.firstChild || startCon;\r\n                    startOff = 0;\r\n                }\r\n            }\r\n            if (util.isFormatElement(endCon)) {\r\n                endCon = endCon.childNodes[endOff] || endCon.lastChild || endCon;\r\n                while (endCon && endCon.nodeType === 1 && endCon.lastChild) {\r\n                    endCon = endCon.lastChild;\r\n                }\r\n                endOff = endCon.textContent.length;\r\n            }\r\n\r\n            // startContainer\r\n            tempCon = util.isWysiwygDiv(startCon) ? context.element.wysiwyg.firstChild : startCon;\r\n            tempOffset = startOff;\r\n\r\n            if (util.isBreak(tempCon) || (tempCon.nodeType === 1 && tempCon.childNodes.length > 0)) {\r\n                const onlyBreak = util.isBreak(tempCon);\r\n                if (!onlyBreak) {\r\n                    while (tempCon && !util.isBreak(tempCon) && tempCon.nodeType === 1) {\r\n                        tempCon = tempCon.childNodes[tempOffset] || tempCon.nextElementSibling || tempCon.nextSibling;\r\n                        tempOffset = 0;\r\n                    }\r\n    \r\n                    let format = util.getFormatElement(tempCon, null);\r\n                    if (format === util.getRangeFormatElement(format, null)) {\r\n                        format = util.createElement(util.getParentElement(tempCon, util.isCell) ? 'DIV' : options.defaultTag);\r\n                        tempCon.parentNode.insertBefore(format, tempCon);\r\n                        format.appendChild(tempCon);\r\n                    }\r\n                }\r\n\r\n                if (util.isBreak(tempCon)) {\r\n                    const emptyText = util.createTextNode(util.zeroWidthSpace);\r\n                    tempCon.parentNode.insertBefore(emptyText, tempCon);\r\n                    tempCon = emptyText;\r\n                    if (onlyBreak) {\r\n                        if (startCon === endCon) {\r\n                            endCon = tempCon;\r\n                            endOff = 1;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            // set startContainer\r\n            startCon = tempCon;\r\n            startOff = tempOffset;\r\n\r\n            // endContainer\r\n            tempCon = util.isWysiwygDiv(endCon) ? context.element.wysiwyg.lastChild : endCon;\r\n            tempOffset = endOff;\r\n\r\n            if (util.isBreak(tempCon) || (tempCon.nodeType === 1 && tempCon.childNodes.length > 0)) {\r\n                const onlyBreak = util.isBreak(tempCon);\r\n                if (!onlyBreak) {\r\n                    while (tempCon && !util.isBreak(tempCon) && tempCon.nodeType === 1) {\r\n                        tempChild = tempCon.childNodes;\r\n                        if (tempChild.length === 0) break;\r\n                        tempCon = tempChild[tempOffset > 0 ? tempOffset - 1 : tempOffset] || !/FIGURE/i.test(tempChild[0].nodeName) ? tempChild[0] : (tempCon.previousElementSibling || tempCon.previousSibling || startCon);\r\n                        tempOffset = tempOffset > 0 ? tempCon.textContent.length : tempOffset;\r\n                    }\r\n    \r\n                    let format = util.getFormatElement(tempCon, null);\r\n                    if (format === util.getRangeFormatElement(format, null)) {\r\n                        format = util.createElement(util.isCell(format) ? 'DIV' : options.defaultTag);\r\n                        tempCon.parentNode.insertBefore(format, tempCon);\r\n                        format.appendChild(tempCon);\r\n                    }\r\n                }\r\n\r\n                if (util.isBreak(tempCon)) {\r\n                    const emptyText = util.createTextNode(util.zeroWidthSpace);\r\n                    tempCon.parentNode.insertBefore(emptyText, tempCon);\r\n                    tempCon = emptyText;\r\n                    tempOffset = 1;\r\n                    if (onlyBreak && !tempCon.previousSibling) {\r\n                        util.removeItem(endCon);\r\n                    }\r\n                }\r\n            }\r\n\r\n            // set endContainer\r\n            endCon = tempCon;\r\n            endOff = tempOffset;\r\n\r\n            // set Range\r\n            this.setRange(startCon, startOff, endCon, endOff);\r\n            return true;\r\n        },\r\n\r\n        /**\r\n         * @description Returns a \"formatElement\"(util.isFormatElement) array from the currently selected range.\r\n         * @param {Function|null} validation The validation function. (Replaces the default validation function-util.isFormatElement(current))\r\n         * @returns {Array}\r\n         */\r\n        getSelectedElements: function (validation) {\r\n            if (!this._resetRangeToTextNode()) return [];\r\n            let range = this.getRange();\r\n\r\n            if (util.isWysiwygDiv(range.startContainer)) {\r\n                const children = context.element.wysiwyg.children;\r\n                if (children.length === 0) return [];\r\n                this.setRange(children[0], 0, children[children.length - 1], children[children.length - 1].textContent.trim().length);\r\n                range = this.getRange();\r\n            }\r\n\r\n            const startCon = range.startContainer;\r\n            const endCon = range.endContainer;\r\n            const commonCon = range.commonAncestorContainer;\r\n\r\n            // get line nodes\r\n            const lineNodes = util.getListChildren(commonCon, function (current) {\r\n                return validation ? validation(current) : util.isFormatElement(current);\r\n            });\r\n\r\n            if (!util.isWysiwygDiv(commonCon) && !util.isRangeFormatElement(commonCon)) lineNodes.unshift(util.getFormatElement(commonCon, null));\r\n            if (startCon === endCon || lineNodes.length === 1) return lineNodes;\r\n\r\n            let startLine = util.getFormatElement(startCon, null);\r\n            let endLine = util.getFormatElement(endCon, null);\r\n            let startIdx = null;\r\n            let endIdx = null;\r\n            \r\n            const onlyTable = function (current) {\r\n                return util.isTable(current) ? /^TABLE$/i.test(current.nodeName) : true;\r\n            };\r\n\r\n            let startRangeEl = util.getRangeFormatElement(startLine, onlyTable);\r\n            let endRangeEl = util.getRangeFormatElement(endLine, onlyTable);\r\n            if (util.isTable(startRangeEl) && util.isListCell(startRangeEl.parentNode)) startRangeEl = startRangeEl.parentNode;\r\n            if (util.isTable(endRangeEl) && util.isListCell(endRangeEl.parentNode)) endRangeEl = endRangeEl.parentNode;\r\n            \r\n            const sameRange = startRangeEl === endRangeEl;\r\n            for (let i = 0, len = lineNodes.length, line; i < len; i++) {\r\n                line = lineNodes[i];\r\n\r\n                if (startLine === line || (!sameRange && line === startRangeEl)) {\r\n                    startIdx = i;\r\n                    continue;\r\n                }\r\n\r\n                if (endLine === line || (!sameRange && line === endRangeEl)) {\r\n                    endIdx = i;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if (startIdx === null) startIdx = 0;\r\n            if (endIdx === null) endIdx = lineNodes.length - 1;\r\n\r\n            return lineNodes.slice(startIdx, endIdx + 1);\r\n        },\r\n\r\n        /**\r\n         * @description Get format elements and components from the selected area. (P, DIV, H[1-6], OL, UL, TABLE..)\r\n         * If some of the component are included in the selection, get the entire that component.\r\n         * @param {Boolean} removeDuplicate If true, if there is a parent and child tag among the selected elements, the child tag is excluded.\r\n         * @returns {Array}\r\n         */\r\n        getSelectedElementsAndComponents: function (removeDuplicate) {\r\n            const commonCon = this.getRange().commonAncestorContainer;\r\n            const myComponent = util.getParentElement(commonCon, util.isComponent);\r\n            const selectedLines = util.isTable(commonCon) ? \r\n                this.getSelectedElements(null) :\r\n                this.getSelectedElements(function (current) {\r\n                    const component = this.getParentElement(current, this.isComponent);\r\n                    return (this.isFormatElement(current) && (!component || component === myComponent)) || (this.isComponent(current) && !this.getFormatElement(current));\r\n                }.bind(util));\r\n            \r\n            if (removeDuplicate) {\r\n                for (let i = 0, len = selectedLines.length; i < len; i++) {\r\n                    for (let j = i - 1; j >= 0; j--) {\r\n                        if (selectedLines[j].contains(selectedLines[i])) {\r\n                            selectedLines.splice(i, 1);\r\n                            i--; len--;\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            return selectedLines;\r\n        },\r\n\r\n        /**\r\n         * @description Determine if this offset is the edge offset of container\r\n         * @param {Node} container The node of the selection object. (range.startContainer..)\r\n         * @param {Number} offset The offset of the selection object. (core.getRange().startOffset...)\r\n         * @param {String|undefined} dir Select check point - Both edge, Front edge or End edge. (\"front\": Front edge, \"end\": End edge, undefined: Both edge)\r\n         * @returns {Boolean}\r\n         */\r\n        isEdgePoint: function (container, offset, dir) {\r\n            return (dir !== 'end' && offset === 0) || ((!dir || dir !== 'front') && !container.nodeValue && offset === 1) || ((!dir || dir === 'end') && !!container.nodeValue && offset === container.nodeValue.length);\r\n        },\r\n\r\n        /**\r\n         * @description Check if the container and offset values are the edges of the format tag\r\n         * @param {Node} container The node of the selection object. (range.startContainer..)\r\n         * @param {Number} offset The offset of the selection object. (core.getRange().startOffset...)\r\n         * @param {String} dir Select check point - \"front\": Front edge, \"end\": End edge, undefined: Both edge.\r\n         * @returns {Array|null}\r\n         * @private\r\n         */\r\n        _isEdgeFormat: function (node, offset, dir) {\r\n            if (!this.isEdgePoint(node, offset, dir)) return false;\r\n\r\n            const result = [];\r\n            dir = dir === 'front' ? 'previousSibling' : 'nextSibling';\r\n            while (node && !util.isFormatElement(node) && !util.isWysiwygDiv(node)) {\r\n                if (!node[dir] || (util.isBreak(node[dir]) && !node[dir][dir])) {\r\n                    if (node.nodeType === 1) result.push(node.cloneNode(false));\r\n                    node = node.parentNode;\r\n                } else {\r\n                    return null;\r\n                }\r\n            }\r\n\r\n            return result;\r\n        },\r\n\r\n        /**\r\n         * @description Show loading box\r\n         */\r\n        showLoading: function () {\r\n            context.element.loading.style.display = 'block';\r\n        },\r\n\r\n        /**\r\n         * @description Close loading box\r\n         */\r\n        closeLoading: function () {\r\n            context.element.loading.style.display = 'none';\r\n        },\r\n\r\n        /**\r\n         * @description Append format element to sibling node of argument element.\r\n         * If the \"formatNodeName\" argument value is present, the tag of that argument value is inserted,\r\n         * If not, the currently selected format tag is inserted.\r\n         * @param {Element} element Insert as siblings of that element\r\n         * @param {String|Element|null} formatNode Node name or node obejct to be inserted\r\n         * @returns {Element}\r\n         */\r\n        appendFormatTag: function (element, formatNode) {\r\n            if (!element || !element.parentNode) return null;\r\n\r\n            const currentFormatEl = util.getFormatElement(this.getSelectionNode(), null);\r\n            let oFormat = null;\r\n            if (!util.isFormatElement(element) && util.isFreeFormatElement(currentFormatEl || element.parentNode)) {\r\n                oFormat = util.createElement('BR');\r\n            } else {\r\n                const oFormatName = formatNode ? (typeof formatNode === 'string' ? formatNode : formatNode.nodeName) : (util.isFormatElement(currentFormatEl) && !util.isRangeFormatElement(currentFormatEl) && !util.isFreeFormatElement(currentFormatEl)) ? currentFormatEl.nodeName : options.defaultTag;\r\n                oFormat = util.createElement(oFormatName);\r\n                oFormat.innerHTML = '<br>';\r\n                if ((formatNode && typeof formatNode !== 'string') || (!formatNode && util.isFormatElement(currentFormatEl))) {\r\n                    util.copyTagAttributes(oFormat, formatNode || currentFormatEl);\r\n                }\r\n            }\r\n\r\n            if (util.isCell(element)) element.insertBefore(oFormat, element.nextElementSibling);\r\n            else element.parentNode.insertBefore(oFormat, element.nextElementSibling);\r\n\r\n            return oFormat;\r\n        },\r\n\r\n        /**\r\n         * @description The method to insert a element and return. (used elements : table, hr, image, video)\r\n         * If \"element\" is \"HR\", insert and return the new line.\r\n         * @param {Element} element Element to be inserted\r\n         * @param {Boolean} notHistoryPush When true, it does not update the history stack and the selection object and return EdgeNodes (util.getEdgeChildNodes)\r\n         * @param {Boolean} checkCharCount If true, if \"options.maxCharCount\" is exceeded when \"element\" is added, null is returned without addition.\r\n         * @param {Boolean} notSelect If true, Do not automatically select the inserted component.\r\n         * @returns {Element}\r\n         */\r\n        insertComponent: function (element, notHistoryPush, checkCharCount, notSelect) {\r\n            if (this.isReadOnly || (checkCharCount && !this.checkCharCount(element, null))) {\r\n                return null;\r\n            }\r\n\r\n            const r = this.removeNode();\r\n            this.getRange_addLine(this.getRange(), r.container);\r\n            let oNode = null;\r\n            let selectionNode = this.getSelectionNode();\r\n            let formatEl = util.getFormatElement(selectionNode, null);\r\n\r\n            if (util.isListCell(formatEl)) {\r\n                this.insertNode(element, selectionNode === formatEl ? null : r.container.nextSibling, false);\r\n                if (!element.nextSibling) element.parentNode.appendChild(util.createElement('BR'));\r\n            } else {\r\n                if (this.getRange().collapsed && (r.container.nodeType === 3 || util.isBreak(r.container))) {\r\n                    const depthFormat = util.getParentElement(r.container, function (current) { return this.isRangeFormatElement(current); }.bind(util));\r\n                    oNode = util.splitElement(r.container, r.offset, !depthFormat ? 0 : util.getElementDepth(depthFormat) + 1);\r\n                    if (oNode) formatEl = oNode.previousSibling;\r\n                }\r\n                this.insertNode(element, util.isRangeFormatElement(formatEl) ? null : formatEl, false);\r\n                if (formatEl && util.onlyZeroWidthSpace(formatEl)) util.removeItem(formatEl);\r\n            }\r\n\r\n            if (!notSelect) {\r\n                this.setRange(element, 0, element, 0);\r\n                \r\n                const fileComponentInfo = this.getFileComponent(element);\r\n                if (fileComponentInfo) {\r\n                    this.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName);\r\n                } else if (oNode) {\r\n                    oNode = util.getEdgeChildNodes(oNode, null).sc || oNode;\r\n                    this.setRange(oNode, 0, oNode, 0);\r\n                }\r\n            }\r\n\r\n            // history stack\r\n            if (!notHistoryPush) this.history.push(1);\r\n\r\n            return oNode || element;\r\n        },\r\n\r\n        /**\r\n         * @description Gets the file component and that plugin name\r\n         * return: {target, component, pluginName} | null\r\n         * @param {Element} element Target element (figure tag, component div, file tag)\r\n         * @returns {Object|null}\r\n         */\r\n        getFileComponent: function (element) {\r\n            if (!this._fileManager.queryString || !element) return null;\r\n\r\n            let target, pluginName;\r\n            if (/^FIGURE$/i.test(element.nodeName) || /se-component/.test(element.className)) {\r\n                target = element.querySelector(this._fileManager.queryString);\r\n            }\r\n            if (!target && element.nodeName && this._fileManager.regExp.test(element.nodeName)) {\r\n                target = element;\r\n            }\r\n\r\n            if (target) {\r\n                pluginName = this._fileManager.pluginMap[target.nodeName.toLowerCase()];\r\n                if (pluginName) {\r\n                    return {\r\n                        target: target,\r\n                        component: util.getParentElement(target, util.isComponent),\r\n                        pluginName: pluginName\r\n                    };\r\n                }\r\n            }\r\n\r\n            return null;\r\n        },\r\n\r\n        /**\r\n         * @description The component(image, video) is selected and the resizing module is called.\r\n         * @param {Element} element Element tag (img, iframe, video)\r\n         * @param {String} pluginName Plugin name (image, video)\r\n         */\r\n        selectComponent: function (element, pluginName) {\r\n            if (util.isUneditableComponent(util.getParentElement(element, util.isComponent)) || util.isUneditableComponent(element)) return false;\r\n            if (!this.hasFocus) this.focus();\r\n            const plugin = this.plugins[pluginName];\r\n            if (!plugin) return;\r\n            _w.setTimeout(function () {\r\n                if (typeof plugin.select === 'function') this.callPlugin(pluginName, plugin.select.bind(this, element), null);\r\n                this._setComponentLineBreaker(element);\r\n            }.bind(this));\r\n        },\r\n\r\n        /**\r\n         * @description Set line breaker of component\r\n         * @param {Element} element Element tag (img, iframe, video)\r\n         * @private\r\n         */\r\n        _setComponentLineBreaker: function (element) {\r\n            // line breaker\r\n            this._lineBreaker.style.display = 'none';\r\n            const container = util.getParentElement(element, util.isComponent);\r\n            const t_style = context.element.lineBreaker_t.style;\r\n            const b_style = context.element.lineBreaker_b.style;\r\n            const target = this.context.resizing.resizeContainer.style.display === 'block' ? this.context.resizing.resizeContainer : element;\r\n\r\n            const isList = util.isListCell(container.parentNode);\r\n            let componentTop, wScroll, w;\r\n            // top\r\n            if (isList ? !container.previousSibling : !util.isFormatElement(container.previousElementSibling)) {\r\n                this._variable._lineBreakComp = container;\r\n                wScroll = context.element.wysiwyg.scrollTop;\r\n                componentTop = util.getOffset(element, context.element.wysiwygFrame).top + wScroll;\r\n                w = (target.offsetWidth / 2) / 2;\r\n\r\n                t_style.top = (componentTop - wScroll - 12) + 'px';\r\n                t_style.left = (util.getOffset(target).left + w) + 'px';\r\n                t_style.display = 'block';\r\n            } else {\r\n                t_style.display = 'none';\r\n            }\r\n            // bottom\r\n            if (isList ? !container.nextSibling : !util.isFormatElement(container.nextElementSibling)) {\r\n                if (!componentTop) {\r\n                    this._variable._lineBreakComp = container;\r\n                    wScroll = context.element.wysiwyg.scrollTop;\r\n                    componentTop = util.getOffset(element, context.element.wysiwygFrame).top + wScroll;\r\n                    w = (target.offsetWidth / 2) / 2;\r\n                }\r\n\r\n                b_style.top = (componentTop + target.offsetHeight - wScroll - 12) + 'px';\r\n                b_style.left = (util.getOffset(target).left + target.offsetWidth - w - 24) + 'px';\r\n                b_style.display = 'block';\r\n            } else {\r\n                b_style.display = 'none';\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Delete selected node and insert argument value node and return.\r\n         * If the \"afterNode\" exists, it is inserted after the \"afterNode\"\r\n         * Inserting a text node merges with both text nodes on both sides and returns a new \"{ container, startOffset, endOffset }\".\r\n         * @param {Node} oNode Element to be inserted\r\n         * @param {Node|null} afterNode If the node exists, it is inserted after the node\r\n         * @param {Boolean} checkCharCount If true, if \"options.maxCharCount\" is exceeded when \"element\" is added, null is returned without addition.\r\n         * @returns {Object|Node|null}\r\n         */\r\n        insertNode: function (oNode, afterNode, checkCharCount) {\r\n            if (this.isReadOnly || (checkCharCount && !this.checkCharCount(oNode, null))) {\r\n                return null;\r\n            }\r\n\r\n            let range = this.getRange();\r\n            let line = util.isListCell(range.commonAncestorContainer) ? range.commonAncestorContainer : util.getFormatElement(this.getSelectionNode(), null);\r\n            let insertListCell = util.isListCell(line) && (util.isListCell(oNode) || util.isList(oNode));\r\n            \r\n            let parentNode, originAfter, tempAfterNode, tempParentNode = null;\r\n            const freeFormat = util.isFreeFormatElement(line);\r\n            const isFormats = (!freeFormat && (util.isFormatElement(oNode) || util.isRangeFormatElement(oNode))) || util.isComponent(oNode);\r\n\r\n            if (insertListCell) {\r\n                tempAfterNode = afterNode || util.isList(oNode) ? line.lastChild : line.nextElementSibling;\r\n                tempParentNode = util.isList(oNode) ? line : (tempAfterNode || line).parentNode;\r\n            }\r\n\r\n            if (!afterNode && (isFormats || util.isComponent(oNode) || util.isMedia(oNode))) {\r\n                const isEdge = this.isEdgePoint(range.endContainer, range.endOffset, 'end');\r\n                const r = this.removeNode();\r\n                const container = r.container;\r\n                const prevContainer = (container === r.prevContainer && range.collapsed) ? null : r.prevContainer;\r\n\r\n                if (insertListCell && prevContainer) {\r\n                    tempParentNode = prevContainer.nodeType === 3 ? prevContainer.parentNode : prevContainer;\r\n                    if (tempParentNode.contains(container)) {\r\n                        let sameParent = true;\r\n                        tempAfterNode = container;\r\n                        while (tempAfterNode.parentNode && tempAfterNode.parentNode !== tempParentNode) {\r\n                            tempAfterNode = tempAfterNode.parentNode;\r\n                            sameParent = false;\r\n                        }\r\n                        if (sameParent && container === prevContainer) tempAfterNode = tempAfterNode.nextSibling;\r\n                    } else {\r\n                        tempAfterNode = null;\r\n                    }\r\n                } else if (insertListCell && util.isListCell(container) && !line.parentElement) {\r\n                    line = util.createElement('LI');\r\n                    tempParentNode.appendChild(line);\r\n                    container.appendChild(tempParentNode);\r\n                    tempAfterNode = null;\r\n                } else if (container.nodeType === 3 || util.isBreak(container) || insertListCell) {\r\n                    const depthFormat = util.getParentElement(container, function (current) { return this.isRangeFormatElement(current) || this.isListCell(current); }.bind(util));\r\n                    afterNode = util.splitElement(container, r.offset, !depthFormat ? 0 : util.getElementDepth(depthFormat) + 1);\r\n                    if (afterNode) {\r\n                        if (insertListCell) {\r\n                            if (line.contains(container)) {\r\n                                const subList = util.isList(line.lastElementChild);\r\n                                let newCell = null;\r\n                                if (!isEdge) {\r\n                                    newCell = line.cloneNode(false);\r\n                                    newCell.appendChild(afterNode.textContent.trim() ? afterNode : util.createTextNode(util.zeroWidthSpace));\r\n                                }\r\n                                if (subList) {\r\n                                    if (!newCell) {\r\n                                        newCell = line.cloneNode(false);\r\n                                        newCell.appendChild(util.createTextNode(util.zeroWidthSpace));\r\n                                    }\r\n                                    newCell.appendChild(line.lastElementChild);\r\n                                }\r\n                                if (newCell) {\r\n                                    line.parentNode.insertBefore(newCell, line.nextElementSibling);\r\n                                    tempAfterNode = afterNode = newCell;\r\n                                }\r\n                            }\r\n                        } else {\r\n                            afterNode = afterNode.previousSibling;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            range = (!afterNode && !isFormats) ? this.getRange_addLine(this.getRange(), null) : this.getRange();\r\n            const commonCon = range.commonAncestorContainer;\r\n            const startOff = range.startOffset;\r\n            const endOff = range.endOffset;\r\n            const formatRange = range.startContainer === commonCon && util.isFormatElement(commonCon);\r\n            const startCon = formatRange ? (commonCon.childNodes[startOff] || commonCon.childNodes[0] || range.startContainer) : range.startContainer;\r\n            const endCon = formatRange ? (commonCon.childNodes[endOff] || commonCon.childNodes[commonCon.childNodes.length - 1] || range.endContainer) : range.endContainer;\r\n\r\n            if (!insertListCell) {\r\n                if (!afterNode) {\r\n                    parentNode = startCon;\r\n                    if (startCon.nodeType === 3) {\r\n                        parentNode = startCon.parentNode;\r\n                    }\r\n    \r\n                    /** No Select range node */\r\n                    if (range.collapsed) {\r\n                        if (commonCon.nodeType === 3) {\r\n                            if (commonCon.textContent.length > endOff) afterNode = commonCon.splitText(endOff);\r\n                            else afterNode = commonCon.nextSibling;\r\n                        } else {\r\n                            if (!util.isBreak(parentNode)) {\r\n                                let c = parentNode.childNodes[startOff];\r\n                                const focusNode = (c && c.nodeType === 3 && util.onlyZeroWidthSpace(c) && util.isBreak(c.nextSibling)) ? c.nextSibling : c;\r\n                                if (focusNode) {\r\n                                    if (!focusNode.nextSibling) {\r\n                                        parentNode.removeChild(focusNode);\r\n                                        afterNode = null;\r\n                                    } else {\r\n                                        afterNode = (util.isBreak(focusNode) && !util.isBreak(oNode)) ? focusNode : focusNode.nextSibling;\r\n                                    }\r\n                                } else {\r\n                                    afterNode = null;\r\n                                }\r\n                            } else {\r\n                                afterNode = parentNode;\r\n                                parentNode = parentNode.parentNode;\r\n                            }\r\n                        }\r\n                    } else { /** Select range nodes */\r\n                        const isSameContainer = startCon === endCon;\r\n    \r\n                        if (isSameContainer) {\r\n                            if (this.isEdgePoint(endCon, endOff)) afterNode = endCon.nextSibling;\r\n                            else afterNode = endCon.splitText(endOff);\r\n    \r\n                            let removeNode = startCon;\r\n                            if (!this.isEdgePoint(startCon, startOff)) removeNode = startCon.splitText(startOff);\r\n    \r\n                            parentNode.removeChild(removeNode);\r\n                            if (parentNode.childNodes.length === 0 && isFormats) {\r\n                                parentNode.innerHTML = '<br>';\r\n                            }\r\n                        }\r\n                        else {\r\n                            const removedTag = this.removeNode();\r\n                            const container = removedTag.container;\r\n                            const prevContainer = removedTag.prevContainer;\r\n\r\n                            if (container && container.childNodes.length === 0 && isFormats) {\r\n                                if (util.isFormatElement(container)) {\r\n                                    container.innerHTML = '<br>';\r\n                                } else if (util.isRangeFormatElement(container)) {\r\n                                    container.innerHTML = '<' + options.defaultTag + '><br></' + options.defaultTag + '>';\r\n                                }\r\n                            }\r\n    \r\n                            if (util.isListCell(container) && oNode.nodeType === 3) {\r\n                                parentNode = container;\r\n                                afterNode = null;\r\n                            } else if (!isFormats && prevContainer) {\r\n                                parentNode = prevContainer.nodeType === 3 ? prevContainer.parentNode : prevContainer;\r\n                                if (parentNode.contains(container)) {\r\n                                    let sameParent = true;\r\n                                    afterNode = container;\r\n                                    while (afterNode.parentNode && afterNode.parentNode !== parentNode) {\r\n                                        afterNode = afterNode.parentNode;\r\n                                        sameParent = false;\r\n                                    }\r\n                                    if (sameParent && container === prevContainer) afterNode = afterNode.nextSibling;\r\n                                } else {\r\n                                    afterNode = null;\r\n                                }\r\n                            } else {\r\n                                afterNode = isFormats ? endCon : container === prevContainer ? container.nextSibling : container;\r\n                                parentNode = (!afterNode || !afterNode.parentNode) ? commonCon : afterNode.parentNode;\r\n                            }\r\n    \r\n                            while (afterNode && !util.isFormatElement(afterNode) && afterNode.parentNode !== commonCon) {\r\n                                afterNode = afterNode.parentNode;\r\n                            }\r\n                        }\r\n                    }\r\n                } else { // has afterNode\r\n                    parentNode = afterNode.parentNode;\r\n                    afterNode = afterNode.nextSibling;\r\n                    originAfter = true;\r\n                }\r\n            }\r\n\r\n            try {\r\n                // set node\r\n                if (!insertListCell) {\r\n                    if (util.isWysiwygDiv(afterNode) || parentNode === context.element.wysiwyg.parentNode) {\r\n                        parentNode = context.element.wysiwyg;\r\n                        afterNode = null;\r\n                    }\r\n    \r\n                    if (util.isFormatElement(oNode) || util.isRangeFormatElement(oNode) || (!util.isListCell(parentNode) && util.isComponent(oNode))) {\r\n                        const oldParent = parentNode;\r\n                        if (util.isList(afterNode)) {\r\n                            parentNode = afterNode;\r\n                            afterNode = null;\r\n                        } else if (util.isListCell(afterNode)) {\r\n                            parentNode = afterNode.previousElementSibling || afterNode;\r\n                        } else if (!originAfter && !afterNode) {\r\n                            const r = this.removeNode();\r\n                            const container = r.container.nodeType === 3 ? (util.isListCell(util.getFormatElement(r.container, null)) ? r.container : (util.getFormatElement(r.container, null) || r.container.parentNode)) : r.container;\r\n                            const rangeCon = util.isWysiwygDiv(container) || util.isRangeFormatElement(container);\r\n                            parentNode = rangeCon ? container : container.parentNode;\r\n                            afterNode = rangeCon ? null : container.nextSibling;\r\n                        }\r\n    \r\n                        if (oldParent.childNodes.length === 0 && parentNode !== oldParent) util.removeItem(oldParent);\r\n                    }\r\n    \r\n                    if (isFormats && !freeFormat && !util.isRangeFormatElement(parentNode) && !util.isListCell(parentNode) && !util.isWysiwygDiv(parentNode)) {\r\n                        afterNode = parentNode.nextElementSibling;\r\n                        parentNode = parentNode.parentNode;\r\n                    }\r\n    \r\n                    if (util.isWysiwygDiv(parentNode) && (oNode.nodeType === 3 || util.isBreak(oNode))) {\r\n                        const fNode = util.createElement(options.defaultTag);\r\n                        fNode.appendChild(oNode);\r\n                        oNode = fNode;\r\n                    }\r\n                }\r\n\r\n                // insert--\r\n                if (insertListCell) {\r\n                    if (!tempParentNode.parentNode) {\r\n                        parentNode = context.element.wysiwyg;\r\n                        afterNode = null;\r\n                    } else {\r\n                        parentNode = tempParentNode;\r\n                        afterNode = tempAfterNode;\r\n                    }\r\n                } else {\r\n                    afterNode = parentNode === afterNode ? parentNode.lastChild : afterNode;\r\n                }\r\n\r\n                if (util.isListCell(oNode) && !util.isList(parentNode)) {\r\n                    if (util.isListCell(parentNode)) {\r\n                        afterNode = parentNode.nextElementSibling;\r\n                        parentNode = parentNode.parentNode;\r\n                    } else {\r\n                        const ul = util.createElement('ol');\r\n                        parentNode.insertBefore(ul, afterNode);\r\n                        parentNode = ul;\r\n                        afterNode = null;\r\n                    }\r\n                    insertListCell = true;\r\n                }\r\n\r\n                parentNode.insertBefore(oNode, afterNode);\r\n\r\n                if (insertListCell) {\r\n                    if (util.onlyZeroWidthSpace(line.textContent.trim())) {\r\n                        util.removeItem(line);\r\n                        oNode = oNode.lastChild;\r\n                    } else {\r\n                        const chList = util.getArrayItem(line.children, util.isList);\r\n                        if (chList) {\r\n                            if (oNode !== chList) {\r\n                                oNode.appendChild(chList);\r\n                                oNode = chList.previousSibling;\r\n                            } else {\r\n                                parentNode.appendChild(oNode);\r\n                                oNode = parentNode;\r\n                            }\r\n\r\n                            if (util.onlyZeroWidthSpace(line.textContent.trim())) {\r\n                                util.removeItem(line);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            } catch (e) {\r\n                parentNode.appendChild(oNode);\r\n            } finally {\r\n                if ((util.isFormatElement(oNode) || util.isComponent(oNode)) && startCon === endCon) {\r\n                    const cItem = util.getFormatElement(commonCon, null);\r\n                    if (cItem && cItem.nodeType === 1 && util.isEmptyLine(cItem)) {\r\n                        util.removeItem(cItem);\r\n                    }\r\n                }\r\n\r\n                if (freeFormat && (util.isFormatElement(oNode) || util.isRangeFormatElement(oNode))) {\r\n                    oNode = this._setIntoFreeFormat(oNode);\r\n                }\r\n\r\n                if (!util.isComponent(oNode)) {\r\n                    let offset = 1;\r\n                    if (oNode.nodeType === 3) {\r\n                        const previous = oNode.previousSibling;\r\n                        const next = oNode.nextSibling;\r\n                        const previousText = (!previous ||  previous.nodeType === 1 || util.onlyZeroWidthSpace(previous)) ? '' : previous.textContent;\r\n                        const nextText = (!next || next.nodeType === 1 || util.onlyZeroWidthSpace(next)) ? '' : next.textContent;\r\n        \r\n                        if (previous && previousText.length > 0) {\r\n                            oNode.textContent = previousText + oNode.textContent;\r\n                            util.removeItem(previous);\r\n                        }\r\n        \r\n                        if (next && next.length > 0) {\r\n                            oNode.textContent += nextText;\r\n                            util.removeItem(next);\r\n                        }\r\n\r\n                        const newRange = {\r\n                            container: oNode,\r\n                            startOffset: previousText.length,\r\n                            endOffset: oNode.textContent.length - nextText.length\r\n                        };\r\n\r\n                        this.setRange(oNode, newRange.startOffset, oNode, newRange.endOffset);\r\n    \r\n                        return newRange;\r\n                    } else if (!util.isBreak(oNode) && !util.isListCell(oNode) && util.isFormatElement(parentNode)) {\r\n                        let zeroWidth = null;\r\n                        if (!oNode.previousSibling || util.isBreak(oNode.previousSibling)) {\r\n                            zeroWidth = util.createTextNode(util.zeroWidthSpace);\r\n                            oNode.parentNode.insertBefore(zeroWidth, oNode);\r\n                        }\r\n                        \r\n                        if (!oNode.nextSibling || util.isBreak(oNode.nextSibling)) {\r\n                            zeroWidth = util.createTextNode(util.zeroWidthSpace);\r\n                            oNode.parentNode.insertBefore(zeroWidth, oNode.nextSibling);\r\n                        }\r\n    \r\n                        if (util._isIgnoreNodeChange(oNode)) {\r\n                            oNode = oNode.nextSibling;\r\n                            offset = 0;\r\n                        }\r\n                    }\r\n    \r\n                    this.setRange(oNode, offset, oNode, offset);\r\n                }\r\n\r\n                // history stack\r\n                this.history.push(true);\r\n\r\n                return oNode;\r\n            }\r\n        },\r\n\r\n        _setIntoFreeFormat: function (oNode) {\r\n            const parentNode = oNode.parentNode;\r\n            let oNodeChildren, lastONode;\r\n            \r\n            while (util.isFormatElement(oNode) || util.isRangeFormatElement(oNode)) {\r\n                oNodeChildren = oNode.childNodes;\r\n                lastONode = null;\r\n                \r\n                while (oNodeChildren[0]) {\r\n                    lastONode = oNodeChildren[0];\r\n                    if (util.isFormatElement(lastONode) || util.isRangeFormatElement(lastONode)) {\r\n                        this._setIntoFreeFormat(lastONode);\r\n                        if (!oNode.parentNode) break;\r\n                        oNodeChildren = oNode.childNodes;\r\n                        continue;\r\n                    }\r\n                    \r\n                    parentNode.insertBefore(lastONode, oNode);\r\n                }\r\n                \r\n                if (oNode.childNodes.length === 0) util.removeItem(oNode);\r\n                oNode = util.createElement('BR');\r\n                parentNode.insertBefore(oNode, lastONode.nextSibling);\r\n            }\r\n\r\n            return oNode;\r\n        },\r\n\r\n        /**\r\n         * @description Delete the currently selected nodes and reset selection range\r\n         * Returns {container: \"the last element after deletion\", offset: \"offset\", prevContainer: \"previousElementSibling Of the deleted area\"}\r\n         * @returns {Object}\r\n         */\r\n        removeNode: function () {\r\n            this._resetRangeToTextNode();\r\n\r\n            const range = this.getRange();\r\n            let container, offset = 0;\r\n            let startCon = range.startContainer;\r\n            let endCon = range.endContainer;\r\n            let startOff = range.startOffset;\r\n            let endOff = range.endOffset;\r\n            const commonCon = (range.commonAncestorContainer.nodeType === 3 && range.commonAncestorContainer.parentNode === startCon.parentNode) ? startCon.parentNode : range.commonAncestorContainer;\r\n            if (commonCon === startCon && commonCon === endCon) {\r\n                startCon = commonCon.children[startOff];\r\n                endCon = commonCon.children[endOff];\r\n                startOff = endOff = 0;\r\n            }\r\n\r\n            let beforeNode = null;\r\n            let afterNode = null;\r\n\r\n            const childNodes = util.getListChildNodes(commonCon, null);\r\n            let startIndex = util.getArrayIndex(childNodes, startCon);\r\n            let endIndex = util.getArrayIndex(childNodes, endCon);\r\n\r\n            if (childNodes.length > 0 && startIndex > -1 && endIndex > -1) {\r\n                for (let i = startIndex + 1, startNode = startCon; i >= 0; i--) {\r\n                    if (childNodes[i] === startNode.parentNode && childNodes[i].firstChild === startNode && startOff === 0) {\r\n                        startIndex = i;\r\n                        startNode = startNode.parentNode;\r\n                    }\r\n                }\r\n    \r\n                for (let i = endIndex - 1, endNode = endCon; i > startIndex; i--) {\r\n                    if (childNodes[i] === endNode.parentNode && childNodes[i].nodeType === 1) {\r\n                        childNodes.splice(i, 1);\r\n                        endNode = endNode.parentNode;\r\n                        --endIndex;\r\n                    }\r\n                }\r\n            } else {\r\n                if (childNodes.length === 0) {\r\n                    if (util.isFormatElement(commonCon) || util.isRangeFormatElement(commonCon) || util.isWysiwygDiv(commonCon) || util.isBreak(commonCon) || util.isMedia(commonCon)) {\r\n                        return {\r\n                            container: commonCon,\r\n                            offset: 0\r\n                        };\r\n                    } else if (commonCon.nodeType === 3) {\r\n                        return {\r\n                            container: commonCon,\r\n                            offset: endOff\r\n                        };\r\n                    }\r\n                    childNodes.push(commonCon);\r\n                    startCon = endCon = commonCon;\r\n                } else {\r\n                    startCon = endCon = childNodes[0];\r\n                    if (util.isBreak(startCon) || util.onlyZeroWidthSpace(startCon)) {\r\n                        return {\r\n                            container: util.isMedia(commonCon) ? commonCon : startCon,\r\n                            offset: 0\r\n                        };\r\n                    }\r\n                }\r\n\r\n                startIndex = endIndex = 0;\r\n            }\r\n\r\n            for (let i = startIndex; i <= endIndex; i++) {\r\n                const item = childNodes[i];\r\n\r\n                if (item.length === 0 || (item.nodeType === 3 && item.data === undefined)) {\r\n                    this._nodeRemoveListItem(item);\r\n                    continue;\r\n                }\r\n\r\n                if (item === startCon) {\r\n                    if (startCon.nodeType === 1) {\r\n                        if (util.isComponent(startCon)) continue;\r\n                        else beforeNode = util.createTextNode(startCon.textContent);\r\n                    } else {\r\n                        if (item === endCon) {\r\n                            beforeNode = util.createTextNode(startCon.substringData(0, startOff) + endCon.substringData(endOff, (endCon.length - endOff)));\r\n                            offset = startOff;\r\n                        } else {\r\n                            beforeNode = util.createTextNode(startCon.substringData(0, startOff));\r\n                        }\r\n                    }\r\n\r\n                    if (beforeNode.length > 0) {\r\n                        startCon.data = beforeNode.data;\r\n                    } else {\r\n                        this._nodeRemoveListItem(startCon);\r\n                    }\r\n\r\n                    if (item === endCon) break;\r\n                    continue;\r\n                }\r\n\r\n                if (item === endCon) {\r\n                    if (endCon.nodeType === 1) {\r\n                        if (util.isComponent(endCon)) continue;\r\n                        else afterNode = util.createTextNode(endCon.textContent);\r\n                    } else {\r\n                        afterNode = util.createTextNode(endCon.substringData(endOff, (endCon.length - endOff)));\r\n                    }\r\n\r\n                    if (afterNode.length > 0) {\r\n                        endCon.data = afterNode.data;\r\n                    } else {\r\n                        this._nodeRemoveListItem(endCon);\r\n                    }\r\n\r\n                    continue;\r\n                }\r\n\r\n                this._nodeRemoveListItem(item);\r\n            }\r\n\r\n            const endUl = util.getParentElement(endCon, 'ul');\r\n            const startLi = util.getParentElement(startCon, 'li');\r\n            if (endUl && startLi && startLi.contains(endUl)) {\r\n                container = endUl.previousSibling;\r\n                offset = container.textContent.length;\r\n            } else {\r\n                container = endCon && endCon.parentNode ? endCon : startCon && startCon.parentNode ? startCon : (range.endContainer || range.startContainer);\r\n            }\r\n            \r\n            if (!util.isWysiwygDiv(container) && container.childNodes.length === 0) {\r\n                const rc = util.removeItemAllParents(container, null, null);\r\n                if (rc) container = rc.sc || rc.ec || context.element.wysiwyg;\r\n            }\r\n\r\n            // set range\r\n            this.setRange(container, offset, container, offset);\r\n            // history stack\r\n            this.history.push(true);\r\n\r\n            return {\r\n                container: container,\r\n                offset: offset,\r\n                prevContainer: startCon && startCon.parentNode ? startCon : null\r\n            };\r\n        },\r\n\r\n        _nodeRemoveListItem: function (item) {\r\n            const format = util.getFormatElement(item, null);\r\n            util.removeItem(item);\r\n\r\n            if(!util.isListCell(format)) return;\r\n            \r\n            util.removeItemAllParents(format, null, null);\r\n\r\n            if (format && util.isList(format.firstChild)) {\r\n                format.insertBefore(util.createTextNode(util.zeroWidthSpace), format.firstChild);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Appended all selected format Element to the argument element and insert\r\n         * @param {Element} rangeElement Element of wrap the arguments (BLOCKQUOTE...)\r\n         */\r\n        applyRangeFormatElement: function (rangeElement) {\r\n            this.getRange_addLine(this.getRange(), null);\r\n            const rangeLines = this.getSelectedElementsAndComponents(false);\r\n            if (!rangeLines || rangeLines.length === 0) return;\r\n\r\n            linesLoop:\r\n            for (let i = 0, len = rangeLines.length, line, nested, fEl, lEl, f, l; i < len; i++) {\r\n                line = rangeLines[i];\r\n                if (!util.isListCell(line)) continue;\r\n\r\n                nested = line.lastElementChild;\r\n                if (nested && util.isListCell(line.nextElementSibling) && rangeLines.indexOf(line.nextElementSibling) > -1) {\r\n                    lEl = nested.lastElementChild;\r\n                    if (rangeLines.indexOf(lEl) > -1) {\r\n                        let list = null;\r\n                        while ((list = lEl.lastElementChild)) {\r\n                            if (util.isList(list)) {\r\n                                if (rangeLines.indexOf(list.lastElementChild) > -1) {\r\n                                    lEl = list.lastElementChild;\r\n                                } else {\r\n                                    continue linesLoop;\r\n                                }\r\n                            }\r\n                        }\r\n\r\n                        fEl = nested.firstElementChild;\r\n                        f = rangeLines.indexOf(fEl);\r\n                        l = rangeLines.indexOf(lEl);\r\n                        rangeLines.splice(f, (l - f) + 1);\r\n                        len = rangeLines.length;\r\n                        continue;\r\n                    }\r\n                }\r\n            }\r\n\r\n            let last  = rangeLines[rangeLines.length - 1];\r\n            let standTag, beforeTag, pElement;\r\n\r\n            if (util.isRangeFormatElement(last) || util.isFormatElement(last)) {\r\n                standTag = last;\r\n            } else {\r\n                standTag = util.getRangeFormatElement(last, null) || util.getFormatElement(last, null);\r\n            }\r\n\r\n            if (util.isCell(standTag)) {\r\n                beforeTag = null;\r\n                pElement = standTag;\r\n            } else {\r\n                beforeTag = standTag.nextSibling;\r\n                pElement = standTag.parentNode;\r\n            }\r\n            \r\n            let parentDepth = util.getElementDepth(standTag);\r\n            let listParent = null;\r\n            const lineArr = [];\r\n            const removeItems = function (parent, origin, before) {\r\n                let cc = null;\r\n                if (parent !== origin && !util.isTable(origin)) {\r\n                    if (origin && util.getElementDepth(parent) === util.getElementDepth(origin)) return before;\r\n                    cc = util.removeItemAllParents(origin, null, parent);\r\n                }\r\n\r\n                return cc ? cc.ec : before;\r\n            };\r\n            \r\n            for (let i = 0, len = rangeLines.length, line, originParent, depth, before, nextLine, nextList, nested; i < len; i++) {\r\n                line = rangeLines[i];\r\n                originParent = line.parentNode;\r\n                if (!originParent || rangeElement.contains(originParent)) continue;\r\n\r\n                depth = util.getElementDepth(line);\r\n\r\n                if (util.isList(originParent)) {\r\n                    if (listParent === null) {\r\n                        if (nextList) {\r\n                            listParent = nextList;\r\n                            nested = true;\r\n                            nextList = null;\r\n                        } else {\r\n                            listParent = originParent.cloneNode(false);\r\n                        }\r\n                    }\r\n\r\n                    lineArr.push(line);\r\n                    nextLine = rangeLines[i + 1];\r\n\r\n                    if (i === len - 1 || (nextLine && nextLine.parentNode !== originParent)) {\r\n                        // nested list\r\n                        if (nextLine && line.contains(nextLine.parentNode)) {\r\n                            nextList = nextLine.parentNode.cloneNode(false);\r\n                        }\r\n\r\n                        let list = originParent.parentNode, p;\r\n                        while (util.isList(list)) {\r\n                            p = util.createElement(list.nodeName);\r\n                            p.appendChild(listParent);\r\n                            listParent = p;\r\n                            list = list.parentNode;\r\n                        }\r\n\r\n                        const edge = this.detachRangeFormatElement(originParent, lineArr, null, true, true);\r\n\r\n                        if (parentDepth >= depth) {\r\n                            parentDepth = depth;\r\n                            pElement = edge.cc;\r\n                            beforeTag = removeItems(pElement, originParent, edge.ec);\r\n                            if (beforeTag) pElement = beforeTag.parentNode;\r\n                        } else if (pElement === edge.cc) {\r\n                            beforeTag = edge.ec;\r\n                        }\r\n\r\n                        if (pElement !== edge.cc) {\r\n                            before = removeItems(pElement, edge.cc, before);\r\n                            if (before !== undefined) beforeTag = before;\r\n                            else beforeTag = edge.cc;\r\n                        }\r\n\r\n                        for (let c = 0, cLen = edge.removeArray.length; c < cLen; c++) {\r\n                            listParent.appendChild(edge.removeArray[c]);\r\n                        }\r\n\r\n                        if (!nested) rangeElement.appendChild(listParent);\r\n                        if (nextList) edge.removeArray[edge.removeArray.length - 1].appendChild(nextList);\r\n                        listParent = null;\r\n                        nested = false;\r\n                    }\r\n                } else {\r\n                    if (parentDepth >= depth) {\r\n                        parentDepth = depth;\r\n                        pElement = originParent;\r\n                        beforeTag = line.nextSibling;\r\n                    }\r\n                    \r\n                    rangeElement.appendChild(line);\r\n\r\n                    if (pElement !== originParent) {\r\n                        before = removeItems(pElement, originParent);\r\n                        if (before !== undefined) beforeTag = before;\r\n                    }\r\n                }\r\n            }\r\n\r\n            this.effectNode = null;\r\n            util.mergeSameTags(rangeElement, null, false);\r\n            util.mergeNestedTags(rangeElement, function (current) { return this.isList(current); }.bind(util));\r\n\r\n            // Nested list\r\n            if (beforeTag && util.getElementDepth(beforeTag) > 0 && (util.isList(beforeTag.parentNode) || util.isList(beforeTag.parentNode.parentNode))) {\r\n                const depthFormat = util.getParentElement(beforeTag, function (current) { return this.isRangeFormatElement(current) && !this.isList(current); }.bind(util));\r\n                const splitRange = util.splitElement(beforeTag, null, !depthFormat ? 0 : util.getElementDepth(depthFormat) + 1);\r\n                splitRange.parentNode.insertBefore(rangeElement, splitRange);\r\n            } else { // basic\r\n                pElement.insertBefore(rangeElement, beforeTag);\r\n                removeItems(rangeElement, beforeTag);\r\n            }\r\n\r\n            const edge = util.getEdgeChildNodes(rangeElement.firstElementChild, rangeElement.lastElementChild);\r\n            if (rangeLines.length > 1) {\r\n                this.setRange(edge.sc, 0, edge.ec, edge.ec.textContent.length);\r\n            } else {\r\n                this.setRange(edge.ec, edge.ec.textContent.length, edge.ec, edge.ec.textContent.length);\r\n            }\r\n\r\n            // history stack\r\n            this.history.push(false);\r\n        },\r\n\r\n        /**\r\n         * @description The elements of the \"selectedFormats\" array are detached from the \"rangeElement\" element. (\"LI\" tags are converted to \"P\" tags)\r\n         * When \"selectedFormats\" is null, all elements are detached and return {cc: parentNode, sc: nextSibling, ec: previousSibling, removeArray: [Array of removed elements]}.\r\n         * @param {Element} rangeElement Range format element (PRE, BLOCKQUOTE, OL, UL...)\r\n         * @param {Array|null} selectedFormats Array of format elements (P, DIV, LI...) to remove.\r\n         * If null, Applies to all elements and return {cc: parentNode, sc: nextSibling, ec: previousSibling}\r\n         * @param {Element|null} newRangeElement The node(rangeElement) to replace the currently wrapped node.\r\n         * @param {Boolean} remove If true, deleted without detached.\r\n         * @param {Boolean} notHistoryPush When true, it does not update the history stack and the selection object and return EdgeNodes (util.getEdgeChildNodes)\r\n         * @returns {Object}\r\n         */\r\n        detachRangeFormatElement: function (rangeElement, selectedFormats, newRangeElement, remove, notHistoryPush) {\r\n            const range = this.getRange();\r\n            const so = range.startOffset;\r\n            const eo = range.endOffset;\r\n\r\n            let children = util.getListChildNodes(rangeElement, function (current) { return current.parentNode === rangeElement; });\r\n            let parent = rangeElement.parentNode;\r\n            let firstNode = null;\r\n            let lastNode = null;\r\n            let rangeEl = rangeElement.cloneNode(false);\r\n            \r\n            const removeArray = [];\r\n            const newList = util.isList(newRangeElement);\r\n            let insertedNew = false;\r\n            let reset = false;\r\n            let moveComplete = false;\r\n\r\n            function appendNode (parent, insNode, sibling, originNode) {\r\n                if (util.onlyZeroWidthSpace(insNode)) insNode.innerHTML = util.zeroWidthSpace;\r\n\r\n                if (insNode.nodeType === 3) {\r\n                    parent.insertBefore(insNode, sibling);\r\n                    return insNode;\r\n                }\r\n                \r\n                const insChildren = (moveComplete ? insNode : originNode).childNodes;\r\n                let format = insNode.cloneNode(false);\r\n                let first = null;\r\n                let c = null;\r\n\r\n                while (insChildren[0]) {\r\n                    c = insChildren[0];\r\n                    if (util._notTextNode(c) && !util.isBreak(c) && !util.isListCell(format)) {\r\n                        if (format.childNodes.length > 0) {\r\n                            if (!first) first = format;\r\n                            parent.insertBefore(format, sibling);\r\n                            format = insNode.cloneNode(false);\r\n                        }\r\n                        parent.insertBefore(c, sibling);\r\n                        if (!first) first = c;\r\n                    } else {\r\n                        format.appendChild(c);\r\n                    }\r\n                }\r\n\r\n                if (format.childNodes.length > 0) {\r\n                    if (util.isListCell(parent) && util.isListCell(format) && util.isList(sibling)) {\r\n                        if (newList) {\r\n                            first = sibling;\r\n                            while(sibling) {\r\n                                format.appendChild(sibling);\r\n                                sibling = sibling.nextSibling;\r\n                            }\r\n                            parent.parentNode.insertBefore(format, parent.nextElementSibling);\r\n                        } else {\r\n                            const originNext = originNode.nextElementSibling;\r\n                            const detachRange = util.detachNestedList(originNode, false);\r\n                            if ((rangeElement !== detachRange) || (originNext !== originNode.nextElementSibling)) {\r\n                                const fChildren = format.childNodes;\r\n                                while (fChildren[0]) {\r\n                                    originNode.appendChild(fChildren[0]);\r\n                                }\r\n\r\n                                rangeElement = detachRange;\r\n                                reset = true;\r\n                            }\r\n                        }\r\n                    } else {\r\n                        parent.insertBefore(format, sibling);\r\n                    }\r\n\r\n                    if (!first) first = format;\r\n                }\r\n\r\n                return first;\r\n            }\r\n\r\n            // detach loop\r\n            for (let i = 0, len = children.length, insNode, lineIndex, next; i < len; i++) {\r\n                insNode = children[i];\r\n                if (insNode.nodeType === 3 && util.isList(rangeEl)) continue;\r\n                \r\n                moveComplete = false;\r\n                if (remove && i === 0) {\r\n                    if (!selectedFormats || selectedFormats.length === len || selectedFormats[0] === insNode) {\r\n                        firstNode = rangeElement.previousSibling;\r\n                    } else {\r\n                        firstNode = rangeEl;\r\n                    }\r\n                }\r\n\r\n                if (selectedFormats) lineIndex = selectedFormats.indexOf(insNode);\r\n                if (selectedFormats && lineIndex === -1) {\r\n                    if (!rangeEl) rangeEl = rangeElement.cloneNode(false);\r\n                    rangeEl.appendChild(insNode);\r\n                } else {\r\n                    if (selectedFormats) next = selectedFormats[lineIndex + 1];\r\n                    if (rangeEl && rangeEl.children.length > 0) {\r\n                        parent.insertBefore(rangeEl, rangeElement);\r\n                        rangeEl = null;\r\n                    }\r\n\r\n                    if (!newList && util.isListCell(insNode)) {\r\n                        if (next && util.getElementDepth(insNode) !== util.getElementDepth(next) && (util.isListCell(parent) || util.getArrayItem(insNode.children, util.isList, false))) {\r\n                            const insNext = insNode.nextElementSibling;\r\n                            const detachRange = util.detachNestedList(insNode, false);\r\n                            if ((rangeElement !== detachRange) || insNext !== insNode.nextElementSibling) {\r\n                                rangeElement = detachRange;\r\n                                reset = true;\r\n                            }\r\n                        } else {\r\n                            const inner = insNode;\r\n                            insNode = util.createElement(remove ? inner.nodeName : (util.isList(rangeElement.parentNode) || util.isListCell(rangeElement.parentNode)) ? 'LI' : util.isCell(rangeElement.parentNode) ? 'DIV' : options.defaultTag);\r\n                            const isCell = util.isListCell(insNode);\r\n                            const innerChildren = inner.childNodes;\r\n                            while (innerChildren[0]) {\r\n                                if (util.isList(innerChildren[0]) && !isCell) break;\r\n                                insNode.appendChild(innerChildren[0]);\r\n                            }\r\n                            util.copyFormatAttributes(insNode, inner);\r\n                            moveComplete = true;\r\n                        }\r\n                    } else {\r\n                        insNode = insNode.cloneNode(false);\r\n                    }\r\n\r\n                    if (!reset) {\r\n                        if (!remove) {\r\n                            if (newRangeElement) {\r\n                                if (!insertedNew) {\r\n                                    parent.insertBefore(newRangeElement, rangeElement);\r\n                                    insertedNew = true;\r\n                                }\r\n                                insNode = appendNode(newRangeElement, insNode, null, children[i]);\r\n                            } else {\r\n                                insNode = appendNode(parent, insNode, rangeElement, children[i]);\r\n                            }\r\n    \r\n                            if (!reset) {\r\n                                if (selectedFormats) {\r\n                                    lastNode = insNode;\r\n                                    if (!firstNode) {\r\n                                        firstNode = insNode;\r\n                                    }\r\n                                } else if (!firstNode) {\r\n                                    firstNode = lastNode = insNode;\r\n                                }\r\n                            }\r\n                        } else {\r\n                            removeArray.push(insNode);\r\n                            util.removeItem(children[i]);\r\n                        }\r\n\r\n                        if (reset) {\r\n                            reset = moveComplete = false;\r\n                            children = util.getListChildNodes(rangeElement, function (current) { return current.parentNode === rangeElement; });\r\n                            rangeEl = rangeElement.cloneNode(false);\r\n                            parent = rangeElement.parentNode;\r\n                            i = -1;\r\n                            len = children.length;\r\n                            continue;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            const rangeParent = rangeElement.parentNode;\r\n            let rangeRight = rangeElement.nextSibling;\r\n            if (rangeEl && rangeEl.children.length > 0) {\r\n                rangeParent.insertBefore(rangeEl, rangeRight);\r\n            }\r\n            \r\n            if (newRangeElement) firstNode = newRangeElement.previousSibling;\r\n            else if (!firstNode) firstNode = rangeElement.previousSibling;\r\n            rangeRight = rangeElement.nextSibling !== rangeEl ? rangeElement.nextSibling : rangeEl ? rangeEl.nextSibling : null;\r\n\r\n            if (rangeElement.children.length === 0 || rangeElement.textContent.length === 0) {\r\n                util.removeItem(rangeElement);\r\n            } else {\r\n                util.removeEmptyNode(rangeElement, null);\r\n            }\r\n\r\n            let edge = null;\r\n            if (remove) {\r\n                edge = {\r\n                    cc: rangeParent,\r\n                    sc: firstNode,\r\n                    ec: rangeRight,\r\n                    removeArray: removeArray\r\n                };\r\n            } else {\r\n                if (!firstNode) firstNode = lastNode;\r\n                if (!lastNode) lastNode = firstNode;\r\n                const childEdge = util.getEdgeChildNodes(firstNode, (lastNode.parentNode ? firstNode : lastNode));\r\n                edge = {\r\n                    cc: (childEdge.sc || childEdge.ec).parentNode,\r\n                    sc: childEdge.sc,\r\n                    ec: childEdge.ec\r\n                };\r\n            }\r\n\r\n            this.effectNode = null;\r\n            if (notHistoryPush) return edge;\r\n            \r\n            if (!remove && edge) {\r\n                if (!selectedFormats) {\r\n                    this.setRange(edge.sc, 0, edge.sc, 0);\r\n                } else {\r\n                    this.setRange(edge.sc, so, edge.ec, eo);\r\n                }\r\n            }\r\n\r\n            // history stack\r\n            this.history.push(false);\r\n        },\r\n\r\n        /**\r\n         * @description \"selectedFormats\" array are detached from the list element.\r\n         * The return value is applied when the first and last lines of \"selectedFormats\" are \"LI\" respectively.\r\n         * @param {Array} selectedFormats Array of format elements (LI, P...) to remove.\r\n         * @param {Boolean} remove If true, deleted without detached.\r\n         * @returns {Object} {sc: <LI>, ec: <LI>}.\r\n         */\r\n        detachList: function (selectedFormats, remove) {\r\n            let rangeArr = {};\r\n            let listFirst = false;\r\n            let listLast = false;\r\n            let first = null;\r\n            let last = null;\r\n            const passComponent = function (current) { return !this.isComponent(current); }.bind(util);\r\n\r\n            for (let i = 0, len = selectedFormats.length, r, o, lastIndex, isList; i < len; i++) {\r\n                lastIndex = i === len - 1;\r\n                o = util.getRangeFormatElement(selectedFormats[i], passComponent);\r\n                isList = util.isList(o);\r\n                if (!r && isList) {\r\n                    r = o;\r\n                    rangeArr = {r: r, f: [util.getParentElement(selectedFormats[i], 'LI')]};\r\n                    if (i === 0) listFirst = true;\r\n                } else if (r && isList) {\r\n                    if (r !== o) {\r\n                        const edge = this.detachRangeFormatElement(rangeArr.f[0].parentNode, rangeArr.f, null, remove, true);\r\n                        o = selectedFormats[i].parentNode;\r\n                        if (listFirst) {\r\n                            first = edge.sc;\r\n                            listFirst = false;\r\n                        }\r\n                        if (lastIndex) last = edge.ec;\r\n\r\n                        if (isList) {\r\n                            r = o;\r\n                            rangeArr = {r: r, f: [util.getParentElement(selectedFormats[i], 'LI')]};\r\n                            if (lastIndex) listLast = true;\r\n                        } else {\r\n                            r = null;\r\n                        }\r\n                    } else {\r\n                        rangeArr.f.push(util.getParentElement(selectedFormats[i], 'LI'));\r\n                        if (lastIndex) listLast = true;\r\n                    }\r\n                }\r\n\r\n                if (lastIndex && util.isList(r)) {\r\n                    const edge = this.detachRangeFormatElement(rangeArr.f[0].parentNode, rangeArr.f, null, remove, true);\r\n                    if (listLast || len === 1) last = edge.ec;\r\n                    if (listFirst) first = edge.sc || last;\r\n                }\r\n            }\r\n\r\n            return {\r\n                sc: first,\r\n                ec: last\r\n            };\r\n        },\r\n\r\n        /**\r\n         * @description Add, update, and delete nodes from selected text.\r\n         * 1. If there is a node in the \"appendNode\" argument, a node with the same tags and attributes as \"appendNode\" is added to the selection text.\r\n         * 2. If it is in the same tag, only the tag's attributes are changed without adding a tag.\r\n         * 3. If the \"appendNode\" argument is null, the node of the selection is update or remove without adding a new node.\r\n         * 4. The same style as the style attribute of the \"styleArray\" argument is deleted.\r\n         *    (Styles should be put with attribute names from css. [\"background-color\"])\r\n         * 5. The same class name as the class attribute of the \"styleArray\" argument is deleted.\r\n         *    (The class name is preceded by \".\" [\".className\"])\r\n         * 6. Use a list of styles and classes of \"appendNode\" in \"styleArray\" to avoid duplicate property values.\r\n         * 7. If a node with all styles and classes removed has the same tag name as \"appendNode\" or \"removeNodeArray\", or \"appendNode\" is null, that node is deleted.\r\n         * 8. Regardless of the style and class of the node, the tag with the same name as the \"removeNodeArray\" argument value is deleted.\r\n         * 9. If the \"strictRemove\" argument is true, only nodes with all styles and classes removed from the nodes of \"removeNodeArray\" are removed.\r\n         *10. It won't work if the parent node has the same class and same value style.\r\n         *    However, if there is a value in \"removeNodeArray\", it works and the text node is separated even if there is no node to replace.\r\n         * @param {Element|null} appendNode The element to be added to the selection. If it is null, only delete the node.\r\n         * @param {Array|null} styleArray The style or className attribute name Array to check (['font-size'], ['.className'], ['font-family', 'color', '.className']...])\r\n         * @param {Array|null} removeNodeArray An array of node names to remove types from, remove all formats when \"appendNode\" is null and there is an empty array or null value. (['span'], ['strong', 'em'] ...])\r\n         * @param {Boolean|null} strictRemove If true, only nodes with all styles and classes removed from the nodes of \"removeNodeArray\" are removed.\r\n         */\r\n        nodeChange: function (appendNode, styleArray, removeNodeArray, strictRemove) {\r\n            this._resetRangeToTextNode();\r\n            let range = this.getRange_addLine(this.getRange(), null);\r\n            styleArray = styleArray && styleArray.length > 0 ? styleArray : false;\r\n            removeNodeArray = removeNodeArray && removeNodeArray.length > 0 ? removeNodeArray : false;\r\n            \r\n            const isRemoveNode = !appendNode;\r\n            const isRemoveFormat = isRemoveNode && !removeNodeArray && !styleArray;\r\n            let startCon = range.startContainer;\r\n            let startOff = range.startOffset;\r\n            let endCon = range.endContainer;\r\n            let endOff = range.endOffset;\r\n\r\n            if ((isRemoveFormat && range.collapsed && util.isFormatElement(startCon.parentNode)) || (startCon === endCon && startCon.nodeType === 1 && util.isNonEditable(startCon))) {\r\n                const format = startCon.parentNode;\r\n                if (!util.isListCell(format) || !util.getValues(format.style).some(function(k) { return this._listKebab.indexOf(k) > -1; }.bind(this))) return;\r\n            }\r\n\r\n            if (range.collapsed && !isRemoveFormat) {\r\n                if (startCon.nodeType === 1 && !util.isBreak(startCon) && !util.isComponent(startCon)) {\r\n                    let afterNode = null;\r\n                    const focusNode = startCon.childNodes[startOff];\r\n\r\n                    if (focusNode) {\r\n                        if (!focusNode.nextSibling) {\r\n                            afterNode = null;\r\n                        } else {\r\n                            afterNode = util.isBreak(focusNode) ? focusNode : focusNode.nextSibling;\r\n                        }\r\n                    }\r\n\r\n                    const zeroWidth = util.createTextNode(util.zeroWidthSpace);\r\n                    startCon.insertBefore(zeroWidth, afterNode);\r\n                    this.setRange(zeroWidth, 1, zeroWidth, 1);\r\n\r\n                    range = this.getRange();\r\n                    startCon = range.startContainer;\r\n                    startOff = range.startOffset;\r\n                    endCon = range.endContainer;\r\n                    endOff = range.endOffset;\r\n                }\r\n            }\r\n\r\n            if (util.isFormatElement(startCon)) {\r\n                startCon = startCon.childNodes[startOff] || startCon.firstChild;\r\n                startOff = 0;\r\n            }\r\n            if (util.isFormatElement(endCon)) {\r\n                endCon = endCon.childNodes[endOff] || endCon.lastChild;\r\n                endOff = endCon.textContent.length;\r\n            }\r\n\r\n            if (isRemoveNode) {\r\n                appendNode = util.createElement('DIV');\r\n            }\r\n\r\n            const wRegExp = _w.RegExp;\r\n            const newNodeName = appendNode.nodeName;\r\n\r\n            /* checked same style property */\r\n            if (!isRemoveFormat && startCon === endCon && !removeNodeArray && appendNode) {\r\n                let sNode = startCon;\r\n                let checkCnt = 0;\r\n                const checkAttrs = [];\r\n                \r\n                const checkStyles = appendNode.style;\r\n                for (let i = 0, len = checkStyles.length; i < len; i++) {\r\n                    checkAttrs.push(checkStyles[i]);\r\n                }\r\n\r\n                const ckeckClasses = appendNode.classList;\r\n                for (let i = 0, len = ckeckClasses.length; i < len; i++) {\r\n                    checkAttrs.push('.' + ckeckClasses[i]);\r\n                }\r\n\r\n                if (checkAttrs.length > 0) {\r\n                    while(!util.isFormatElement(sNode) && !util.isWysiwygDiv(sNode)) {\r\n                        for (let i = 0; i < checkAttrs.length; i++) {\r\n                            if (sNode.nodeType === 1) {\r\n                                const s = checkAttrs[i];\r\n                                const classReg = /^\\./.test(s) ? new wRegExp('\\\\s*' + s.replace(/^\\./, '') + '(\\\\s+|$)', 'ig') : false;\r\n    \r\n                                const styleCheck = isRemoveNode ? !!sNode.style[s] : (!!sNode.style[s] && !!appendNode.style[s] && sNode.style[s] === appendNode.style[s]);\r\n                                const classCheck = classReg === false ? false : isRemoveNode ? !!sNode.className.match(classReg) : !!sNode.className.match(classReg) && !!appendNode.className.match(classReg);\r\n                                if (styleCheck || classCheck) {\r\n                                    checkCnt++;\r\n                                }\r\n                            }\r\n                        }\r\n                        sNode = sNode.parentNode;\r\n                    }\r\n    \r\n                    if (checkCnt >= checkAttrs.length) return;\r\n                }\r\n            }\r\n\r\n            let start = {}, end = {};\r\n            let newNode, styleRegExp = '', classRegExp = '', removeNodeRegExp = '';\r\n\r\n            if (styleArray) {\r\n                for (let i = 0, len = styleArray.length, s; i < len; i++) {\r\n                    s = styleArray[i];\r\n                    if (/^\\./.test(s)) {\r\n                        classRegExp += (classRegExp ? '|' : '\\\\s*(?:') + s.replace(/^\\./, '');\r\n                    } else {\r\n                        styleRegExp += (styleRegExp ? '|' : '(?:;|^|\\\\s)(?:') + s;\r\n                    }\r\n                }\r\n\r\n                if (styleRegExp) {\r\n                    styleRegExp += ')\\\\s*:[^;]*\\\\s*(?:;|$)';\r\n                    styleRegExp = new wRegExp(styleRegExp, 'ig');\r\n                }\r\n\r\n                if (classRegExp) {\r\n                    classRegExp += ')(?=\\\\s+|$)';\r\n                    classRegExp = new wRegExp(classRegExp, 'ig');\r\n                }\r\n            }\r\n\r\n            if (removeNodeArray) {\r\n                removeNodeRegExp = '^(?:' + removeNodeArray[0];\r\n                for (let i = 1; i < removeNodeArray.length; i++) {\r\n                    removeNodeRegExp += '|' + removeNodeArray[i];\r\n                }\r\n                removeNodeRegExp += ')$';\r\n                removeNodeRegExp = new wRegExp(removeNodeRegExp, 'i');\r\n            }\r\n\r\n            /** validation check function*/\r\n            const wBoolean = _w.Boolean;\r\n            const _removeCheck = {v: false};\r\n            const validation = function (checkNode) {\r\n                const vNode = checkNode.cloneNode(false);\r\n\r\n                // all path\r\n                if (vNode.nodeType === 3 || util.isBreak(vNode)) return vNode;\r\n                // all remove\r\n                if (isRemoveFormat) return null;\r\n\r\n                // remove node check\r\n                const tagRemove = (!removeNodeRegExp && isRemoveNode) || (removeNodeRegExp && removeNodeRegExp.test(vNode.nodeName));\r\n\r\n                // tag remove\r\n                if (tagRemove && !strictRemove) {\r\n                    _removeCheck.v = true;\r\n                    return null;\r\n                }\r\n\r\n                // style regexp\r\n                const originStyle = vNode.style.cssText;\r\n                let style = '';\r\n                if (styleRegExp && originStyle.length > 0) {\r\n                    style = originStyle.replace(styleRegExp, '').trim();\r\n                    if (style !== originStyle) _removeCheck.v = true;\r\n                }\r\n\r\n                // class check\r\n                const originClasses = vNode.className;\r\n                let classes = '';\r\n                if (classRegExp && originClasses.length > 0) {\r\n                    classes = originClasses.replace(classRegExp, '').trim();\r\n                    if (classes !== originClasses) _removeCheck.v = true;\r\n                }\r\n\r\n                // remove only\r\n                if (isRemoveNode) {\r\n                    if ((classRegExp || !originClasses) && (styleRegExp || !originStyle) && !style && !classes && tagRemove) {\r\n                        _removeCheck.v = true;\r\n                        return null;\r\n                    }\r\n                }\r\n\r\n                // change\r\n                if (style || classes || vNode.nodeName !== newNodeName || (wBoolean(styleRegExp) !== wBoolean(originStyle)) || (wBoolean(classRegExp) !== wBoolean(originClasses))) {\r\n                    if (styleRegExp && originStyle.length > 0) vNode.style.cssText = style;\r\n                    if (!vNode.style.cssText) {\r\n                        vNode.removeAttribute('style');\r\n                    }\r\n\r\n                    if (classRegExp && originClasses.length > 0) vNode.className = classes.trim();\r\n                    if (!vNode.className.trim()) {\r\n                        vNode.removeAttribute('class');\r\n                    }\r\n\r\n                    if (!vNode.style.cssText && !vNode.className && (vNode.nodeName === newNodeName || tagRemove)) {\r\n                        _removeCheck.v = true;\r\n                        return null;\r\n                    }\r\n\r\n                    return vNode;\r\n                }\r\n\r\n                _removeCheck.v = true;\r\n                return null;\r\n            };\r\n\r\n            // get line nodes\r\n            const lineNodes = this.getSelectedElements(null);\r\n            range = this.getRange();\r\n            startCon = range.startContainer;\r\n            startOff = range.startOffset;\r\n            endCon = range.endContainer;\r\n            endOff = range.endOffset;\r\n\r\n            if (!util.getFormatElement(startCon, null)) {\r\n                startCon = util.getChildElement(lineNodes[0], function (current) { return current.nodeType === 3; }, false);\r\n                startOff = 0;\r\n            }\r\n\r\n            if (!util.getFormatElement(endCon, null)) {\r\n                endCon = util.getChildElement(lineNodes[lineNodes.length - 1], function (current) { return current.nodeType === 3; }, false);\r\n                endOff = endCon.textContent.length;\r\n            }\r\n\r\n            \r\n            const oneLine = util.getFormatElement(startCon, null) === util.getFormatElement(endCon, null);\r\n            const endLength = lineNodes.length - (oneLine ? 0 : 1);\r\n\r\n            // node Changes\r\n            newNode = appendNode.cloneNode(false);\r\n\r\n            const isRemoveAnchor = isRemoveFormat || (isRemoveNode && (function (arr) {\r\n                for (let n = 0, len = arr.length; n < len; n++) {\r\n                    if (util._isMaintainedNode(arr[n]) || util._isSizeNode(arr[n])) return true;\r\n                }\r\n                return false;\r\n            })(removeNodeArray));\r\n\r\n            const isSizeNode = isRemoveNode || util._isSizeNode(newNode);\r\n            const _getMaintainedNode = this._util_getMaintainedNode.bind(util, isRemoveAnchor, isSizeNode);\r\n            const _isMaintainedNode = this._util_isMaintainedNode.bind(util, isRemoveAnchor, isSizeNode);\r\n\r\n            // one line\r\n            if (oneLine) {\r\n                if (this._resetCommonListCell(lineNodes[0], styleArray)) range = this.setRange(startCon, startOff, endCon, endOff);\r\n\r\n                const newRange = this._nodeChange_oneLine(lineNodes[0], newNode, validation, startCon, startOff, endCon, endOff, isRemoveFormat, isRemoveNode, range.collapsed, _removeCheck, _getMaintainedNode, _isMaintainedNode);\r\n                start.container = newRange.startContainer;\r\n                start.offset = newRange.startOffset;\r\n                end.container = newRange.endContainer;\r\n                end.offset = newRange.endOffset;\r\n                \r\n                if (start.container === end.container && util.onlyZeroWidthSpace(start.container)) {\r\n                    start.offset = end.offset = 1;\r\n                }\r\n                this._setCommonListStyle(newRange.ancestor, null);\r\n            } else { // multi line \r\n                let appliedCommonList = false;\r\n                if (endLength > 0 && this._resetCommonListCell(lineNodes[endLength], styleArray)) appliedCommonList = true;\r\n                if (this._resetCommonListCell(lineNodes[0], styleArray)) appliedCommonList = true;\r\n                if (appliedCommonList) this.setRange(startCon, startOff, endCon, endOff);\r\n\r\n                // end\r\n                if (endLength > 0) {\r\n                    newNode = appendNode.cloneNode(false);\r\n                    end = this._nodeChange_endLine(lineNodes[endLength], newNode, validation, endCon, endOff, isRemoveFormat, isRemoveNode, _removeCheck, _getMaintainedNode, _isMaintainedNode);\r\n                }\r\n\r\n                // mid\r\n                for (let i = endLength - 1, newRange; i > 0; i--) {\r\n                    this._resetCommonListCell(lineNodes[i], styleArray);\r\n                    newNode = appendNode.cloneNode(false);\r\n                    newRange = this._nodeChange_middleLine(lineNodes[i], newNode, validation, isRemoveFormat, isRemoveNode, _removeCheck, end.container);\r\n                    if (newRange.endContainer && newRange.ancestor.contains(newRange.endContainer)) {\r\n                        end.ancestor = null;\r\n                        end.container = newRange.endContainer;\r\n                    }\r\n                    this._setCommonListStyle(newRange.ancestor, null);\r\n                }\r\n\r\n                // start\r\n                newNode = appendNode.cloneNode(false);\r\n                start = this._nodeChange_startLine(lineNodes[0], newNode, validation, startCon, startOff, isRemoveFormat, isRemoveNode, _removeCheck, _getMaintainedNode, _isMaintainedNode, end.container);\r\n\r\n                if (start.endContainer) {\r\n                    end.ancestor = null;\r\n                    end.container = start.endContainer;\r\n                }\r\n\r\n                if (endLength <= 0) {\r\n                    end = start;\r\n                } else if (!end.container) {\r\n                    end.ancestor = null;\r\n                    end.container = start.container;\r\n                    end.offset = start.container.textContent.length;\r\n                }\r\n\r\n                this._setCommonListStyle(start.ancestor, null);\r\n                this._setCommonListStyle(end.ancestor || util.getFormatElement(end.container), null);\r\n            }\r\n\r\n            // set range\r\n            this.controllersOff();\r\n            this.setRange(start.container, start.offset, end.container, end.offset);\r\n\r\n            // history stack\r\n            this.history.push(false);\r\n        },\r\n\r\n        /**\r\n         * @description Reset common style of list cell\r\n         * @param {Element} el List cell element. <li>\r\n         * @param {Array|null} styleArray Style array\r\n         * @private\r\n         */\r\n        _resetCommonListCell: function (el, styleArray) {\r\n            if (!util.isListCell(el)) return;\r\n            if (!styleArray) styleArray = this._listKebab;\r\n\r\n            const children = util.getArrayItem((el).childNodes, function (current) { return !util.isBreak(current); }, true);\r\n            const elStyles = el.style;\r\n            \r\n            const ec = [], ek = [], elKeys = util.getValues(elStyles);\r\n            for (let i = 0, len = this._listKebab.length; i < len; i++) {\r\n                if (elKeys.indexOf(this._listKebab[i]) > -1 && styleArray.indexOf(this._listKebab[i]) > -1) {\r\n                    ec.push(this._listCamel[i]);\r\n                    ek.push(this._listKebab[i]);\r\n                }\r\n            }\r\n\r\n            if (!ec.length) return;\r\n\r\n            // reset cell style---\r\n            const refer = util.createElement('SPAN');\r\n            for (let i = 0, len = ec.length; i < len; i++) {\r\n                refer.style[ec[i]] = elStyles[ek[i]];\r\n                elStyles.removeProperty(ek[i]);\r\n            }\r\n\r\n            let sel = refer.cloneNode(false);\r\n            let r = null, appliedEl = false;\r\n            for (let i = 0, len = children.length, c, s; i < len; i++) {\r\n                c = children[i];\r\n                if (options._textTagsMap[c.nodeName.toLowerCase()]) continue;\r\n\r\n                s = util.getValues(c.style);\r\n                if (s.length === 0 || (ec.some(function (k) {return s.indexOf(k) === -1;}) && s.some(function(k) {ec.indexOf(k) > -1;}))) {\r\n                    r = c.nextSibling;\r\n                    sel.appendChild(c);\r\n                } else if (sel.childNodes.length > 0) {\r\n                    el.insertBefore(sel, r);\r\n                    sel = refer.cloneNode(false);\r\n                    r = null;\r\n                    appliedEl = true;\r\n                }\r\n            }\r\n            \r\n            if (sel.childNodes.length > 0) {\r\n                el.insertBefore(sel, r);\r\n                appliedEl = true;\r\n            }\r\n            if (!elStyles.length) {\r\n                el.removeAttribute('style');\r\n            }\r\n\r\n            return appliedEl;\r\n        },\r\n\r\n        /**\r\n         * @description If certain styles are applied to all child nodes of the list cell, the style of the list cell is also changed. (bold, color, size)\r\n         * @param {Element} el List cell element. <li>\r\n         * @param {Element|null} child Variable for recursive call. (\"null\" on the first call)\r\n         * @private\r\n         */\r\n        _setCommonListStyle: function (el, child) {\r\n            if (!util.isListCell(el)) return;\r\n            \r\n            const children = util.getArrayItem((child || el).childNodes, function (current) { return !util.isBreak(current); }, true);\r\n            child = children[0];\r\n            \r\n            if (!child || children.length > 1 || child.nodeType !== 1) return;\r\n            \r\n            // set cell style---\r\n            const childStyle = child.style;\r\n            const elStyle = el.style;\r\n            const nodeName = child.nodeName.toLowerCase();\r\n            let appliedEl = false;\r\n\r\n            // bold, italic\r\n            if (options._textTagsMap[nodeName] === options._defaultCommand.bold.toLowerCase()) elStyle.fontWeight = 'bold';\r\n            if (options._textTagsMap[nodeName] === options._defaultCommand.italic.toLowerCase()) elStyle.fontStyle = 'italic';\r\n\r\n            // styles\r\n            const cKeys = util.getValues(childStyle);\r\n            if (cKeys.length > 0) {\r\n                for (let i = 0, len = this._listCamel.length; i < len; i++) {\r\n                    if (cKeys.indexOf(this._listKebab[i]) > -1) {\r\n                        elStyle[this._listCamel[i]] = childStyle[this._listCamel[i]];\r\n                        childStyle.removeProperty(this._listKebab[i]);\r\n                        appliedEl = true;\r\n                    }\r\n                }\r\n            }\r\n\r\n            this._setCommonListStyle(el, child);\r\n            if (!appliedEl) return;\r\n\r\n            // common style\r\n            if (!childStyle.length) {\r\n                const ch = child.childNodes;\r\n                const p = child.parentNode;\r\n                const n = child.nextSibling;\r\n                while (ch.length > 0) {\r\n                    p.insertBefore(ch[0], n);\r\n                }\r\n                util.removeItem(child);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Strip remove node\r\n         * @param {Node} removeNode The remove node\r\n         * @private\r\n         */\r\n        _stripRemoveNode: function (removeNode) {\r\n            const element = removeNode.parentNode;\r\n            if (!removeNode || removeNode.nodeType === 3 || !element) return;\r\n            \r\n            const children = removeNode.childNodes;\r\n            while (children[0]) {\r\n                element.insertBefore(children[0], removeNode);\r\n            }\r\n\r\n            element.removeChild(removeNode);\r\n        },\r\n\r\n        /**\r\n         * @description Return the parent maintained tag. (bind and use a util object)\r\n         * @param {Element} element Element\r\n         * @returns {Element}\r\n         * @private\r\n         */\r\n        _util_getMaintainedNode: function (_isRemove, _isSizeNode, element) {\r\n            if (!element || _isRemove) return null;\r\n            return this.getParentElement(element, this._isMaintainedNode.bind(this)) || (!_isSizeNode ? this.getParentElement(element, this._isSizeNode.bind(this)) : null);\r\n        },\r\n\r\n        /**\r\n         * @description Check if element is a tag that should be persisted. (bind and use a util object)\r\n         * @param {Element} element Element\r\n         * @returns {Element}\r\n         * @private\r\n         */\r\n        _util_isMaintainedNode: function (_isRemove, _isSizeNode, element) {\r\n            if (!element || _isRemove || element.nodeType !== 1) return false;\r\n            const anchor = this._isMaintainedNode(element);\r\n            return this.getParentElement(element, this._isMaintainedNode.bind(this)) ? anchor : (anchor || (!_isSizeNode ? this._isSizeNode(element) : false));\r\n        },\r\n\r\n        /**\r\n         * @description wraps text nodes of line selected text.\r\n         * @param {Element} element The node of the line that contains the selected text node.\r\n         * @param {Element} newInnerNode The dom that will wrap the selected text area\r\n         * @param {Function} validation Check if the node should be stripped.\r\n         * @param {Node} startCon The startContainer property of the selection object.\r\n         * @param {Number} startOff The startOffset property of the selection object.\r\n         * @param {Node} endCon The endContainer property of the selection object.\r\n         * @param {Number} endOff The endOffset property of the selection object.\r\n         * @param {Boolean} isRemoveFormat Is the remove all formats command?\r\n         * @param {Boolean} isRemoveNode \"newInnerNode\" is remove node?\r\n         * @param {Boolean} collapsed range.collapsed\r\n         * @returns {{ancestor: *, startContainer: *, startOffset: *, endContainer: *, endOffset: *}}\r\n         * @private\r\n         */\r\n        _nodeChange_oneLine: function (element, newInnerNode, validation, startCon, startOff, endCon, endOff, isRemoveFormat, isRemoveNode, collapsed, _removeCheck, _getMaintainedNode, _isMaintainedNode) {\r\n            // not add tag\r\n            let parentCon = startCon.parentNode;\r\n            while (!parentCon.nextSibling && !parentCon.previousSibling && !util.isFormatElement(parentCon.parentNode) && !util.isWysiwygDiv(parentCon.parentNode)) {\r\n                if (parentCon.nodeName === newInnerNode.nodeName) break;\r\n                parentCon = parentCon.parentNode;\r\n            }\r\n\r\n            if (!isRemoveNode && parentCon === endCon.parentNode && parentCon.nodeName === newInnerNode.nodeName) {\r\n                if (util.onlyZeroWidthSpace(startCon.textContent.slice(0, startOff)) && util.onlyZeroWidthSpace(endCon.textContent.slice(endOff))) {\r\n                    const children = parentCon.childNodes;\r\n                    let sameTag = true;\r\n    \r\n                    for (let i = 0, len = children.length, c, s, e, z; i < len; i++) {\r\n                        c = children[i];\r\n                        z = !util.onlyZeroWidthSpace(c);\r\n                        if (c === startCon) {\r\n                            s = true;\r\n                            continue;\r\n                        }\r\n                        if (c === endCon) {\r\n                            e = true;\r\n                            continue;\r\n                        }\r\n                        if ((!s && z) || (s && e && z)) {\r\n                            sameTag = false;\r\n                            break;\r\n                        }\r\n                    }\r\n    \r\n                    if (sameTag) {\r\n                        util.copyTagAttributes(parentCon, newInnerNode);\r\n        \r\n                        return {\r\n                            ancestor: element,\r\n                            startContainer: startCon,\r\n                            startOffset: startOff,\r\n                            endContainer: endCon,\r\n                            endOffset: endOff\r\n                        };\r\n                    }\r\n                }\r\n            }\r\n\r\n            // add tag\r\n            _removeCheck.v = false;\r\n            const el = element;\r\n            const nNodeArray = [newInnerNode];\r\n            const pNode = element.cloneNode(false);\r\n            const isSameNode = startCon === endCon;\r\n            let startContainer = startCon;\r\n            let startOffset = startOff;\r\n            let endContainer = endCon;\r\n            let endOffset = endOff;\r\n            let startPass = false;\r\n            let endPass = false;\r\n            let pCurrent, newNode, appendNode, cssText, anchorNode;\r\n\r\n            const wRegExp = _w.RegExp;\r\n            function checkCss (vNode) {\r\n                const regExp = new wRegExp('(?:;|^|\\\\s)(?:' + cssText + 'null)\\\\s*:[^;]*\\\\s*(?:;|$)', 'ig');\r\n                let style = '';\r\n\r\n                if (regExp && vNode.style.cssText.length > 0) {\r\n                    style = regExp.test(vNode.style.cssText);\r\n                }\r\n            \r\n                return !style;\r\n            }\r\n\r\n            (function recursionFunc(current, ancestor) {\r\n                const childNodes = current.childNodes;\r\n\r\n                for (let i = 0, len = childNodes.length, vNode; i < len; i++) {\r\n                    let child = childNodes[i];\r\n                    if (!child) continue;\r\n                    let coverNode = ancestor;\r\n                    let cloneNode;\r\n\r\n                    // startContainer\r\n                    if (!startPass && child === startContainer) {\r\n                        let line = pNode;\r\n                        anchorNode = _getMaintainedNode(child);\r\n                        const prevNode = util.createTextNode(startContainer.nodeType === 1 ? '' : startContainer.substringData(0, startOffset));\r\n                        const textNode = util.createTextNode(startContainer.nodeType === 1 ? '' : startContainer.substringData(startOffset, \r\n                                isSameNode ? \r\n                                (endOffset >= startOffset ? endOffset - startOffset : startContainer.data.length - startOffset) : \r\n                                startContainer.data.length - startOffset)\r\n                            );\r\n\r\n                        if (anchorNode) {\r\n                            const a = _getMaintainedNode(ancestor);\r\n                            if (a && a.parentNode !== line) {\r\n                                let m = a;\r\n                                let p = null;\r\n                                while (m.parentNode !== line) {\r\n                                    ancestor = p = m.parentNode.cloneNode(false);\r\n                                    while(m.childNodes[0]) {\r\n                                        p.appendChild(m.childNodes[0]);\r\n                                    }\r\n                                    m.appendChild(p);\r\n                                    m = m.parentNode;\r\n                                }\r\n                                m.parentNode.appendChild(a);\r\n                            }\r\n                            anchorNode = anchorNode.cloneNode(false);\r\n                        }\r\n                        \r\n                        if (!util.onlyZeroWidthSpace(prevNode)) {\r\n                            ancestor.appendChild(prevNode);\r\n                        }\r\n\r\n                        const prevAnchorNode = _getMaintainedNode(ancestor);\r\n                        if (!!prevAnchorNode) anchorNode = prevAnchorNode;\r\n                        if (anchorNode) line = anchorNode;\r\n\r\n                        newNode = child;\r\n                        pCurrent = [];\r\n                        cssText = '';\r\n                        while (newNode !== line && newNode !== el && newNode !== null) {\r\n                            vNode = _isMaintainedNode(newNode) ? null : validation(newNode);\r\n                            if (vNode && newNode.nodeType === 1 && checkCss(newNode)) {\r\n                                pCurrent.push(vNode);\r\n                                cssText += newNode.style.cssText.substr(0, newNode.style.cssText.indexOf(':')) + '|';\r\n                            }\r\n                            newNode = newNode.parentNode;\r\n                        }\r\n\r\n                        const childNode = pCurrent.pop() || textNode;\r\n                        appendNode = newNode = childNode;\r\n                        while (pCurrent.length > 0) {\r\n                            newNode = pCurrent.pop();\r\n                            appendNode.appendChild(newNode);\r\n                            appendNode = newNode;\r\n                        }\r\n\r\n                        newInnerNode.appendChild(childNode);\r\n                        line.appendChild(newInnerNode);\r\n\r\n                        if (anchorNode && !_getMaintainedNode(endContainer)) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            pNode.appendChild(newInnerNode);\r\n                            nNodeArray.push(newInnerNode);\r\n                        }\r\n\r\n                        startContainer = textNode;\r\n                        startOffset = 0;\r\n                        startPass = true;\r\n\r\n                        if (newNode !== textNode) newNode.appendChild(startContainer);\r\n                        if (!isSameNode) continue;\r\n                    }\r\n\r\n                    // endContainer\r\n                    if (!endPass && child === endContainer) {\r\n                        anchorNode = _getMaintainedNode(child);\r\n                        const afterNode = util.createTextNode(endContainer.nodeType === 1 ? '' : endContainer.substringData(endOffset, (endContainer.length - endOffset)));\r\n                        const textNode = util.createTextNode(isSameNode || endContainer.nodeType === 1 ? '' : endContainer.substringData(0, endOffset));\r\n\r\n                        if (anchorNode) {\r\n                            anchorNode = anchorNode.cloneNode(false);\r\n                        } else if (_isMaintainedNode(newInnerNode.parentNode) && !anchorNode) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            pNode.appendChild(newInnerNode);\r\n                            nNodeArray.push(newInnerNode);\r\n                        }\r\n\r\n                        if (!util.onlyZeroWidthSpace(afterNode)) {\r\n                            newNode = child;\r\n                            cssText = '';\r\n                            pCurrent = [];\r\n                            const anchors = [];\r\n                            while (newNode !== pNode && newNode !== el && newNode !== null) {\r\n                                if (newNode.nodeType === 1 && checkCss(newNode)) {\r\n                                    if (_isMaintainedNode(newNode)) anchors.push(newNode.cloneNode(false));\r\n                                    else pCurrent.push(newNode.cloneNode(false));\r\n                                    cssText += newNode.style.cssText.substr(0, newNode.style.cssText.indexOf(':')) + '|';\r\n                                }\r\n                                newNode = newNode.parentNode;\r\n                            }\r\n                            pCurrent = pCurrent.concat(anchors);\r\n\r\n                            cloneNode = appendNode = newNode = pCurrent.pop() || afterNode;\r\n                            while (pCurrent.length > 0) {\r\n                                newNode = pCurrent.pop();\r\n                                appendNode.appendChild(newNode);\r\n                                appendNode = newNode;\r\n                            }\r\n\r\n                            pNode.appendChild(cloneNode);\r\n                            newNode.textContent = afterNode.data;\r\n                        }\r\n\r\n                        if (anchorNode && cloneNode) {\r\n                            const afterAnchorNode = _getMaintainedNode(cloneNode);\r\n                            if (afterAnchorNode) {\r\n                                anchorNode = afterAnchorNode;\r\n                            }\r\n                        }\r\n\r\n                        newNode = child;\r\n                        pCurrent = [];\r\n                        cssText = '';\r\n                        while (newNode !== pNode && newNode !== el && newNode !== null) {\r\n                            vNode = _isMaintainedNode(newNode) ? null : validation(newNode);\r\n                            if (vNode && newNode.nodeType === 1 && checkCss(newNode)) {\r\n                                pCurrent.push(vNode);\r\n                                cssText += newNode.style.cssText.substr(0, newNode.style.cssText.indexOf(':')) + '|';\r\n                            }\r\n                            newNode = newNode.parentNode;\r\n                        }\r\n\r\n                        const childNode = pCurrent.pop() || textNode;\r\n                        appendNode = newNode = childNode;\r\n                        while (pCurrent.length > 0) {\r\n                            newNode = pCurrent.pop();\r\n                            appendNode.appendChild(newNode);\r\n                            appendNode = newNode;\r\n                        }\r\n\r\n                        if (anchorNode) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            newInnerNode.appendChild(childNode);\r\n                            anchorNode.insertBefore(newInnerNode, anchorNode.firstChild);\r\n                            pNode.appendChild(anchorNode);\r\n                            nNodeArray.push(newInnerNode);\r\n                            anchorNode = null;\r\n                        } else {\r\n                            newInnerNode.appendChild(childNode);\r\n                        }\r\n\r\n                        endContainer = textNode;\r\n                        endOffset = textNode.data.length;\r\n                        endPass = true;\r\n\r\n                        if (!isRemoveFormat && collapsed) {\r\n                            newInnerNode = textNode;\r\n                            textNode.textContent = util.zeroWidthSpace;\r\n                        }\r\n\r\n                        if (newNode !== textNode) newNode.appendChild(endContainer);\r\n                        continue;\r\n                    }\r\n\r\n                    // other\r\n                    if (startPass) {\r\n                        if (child.nodeType === 1 && !util.isBreak(child)) {\r\n                            if (util._isIgnoreNodeChange(child)) {\r\n                                pNode.appendChild(child.cloneNode(true));\r\n                                if (!collapsed) {\r\n                                    newInnerNode = newInnerNode.cloneNode(false);\r\n                                    pNode.appendChild(newInnerNode);\r\n                                    nNodeArray.push(newInnerNode);\r\n                                }\r\n                            } else {\r\n                                recursionFunc(child, child);\r\n                            }\r\n                            continue;\r\n                        }\r\n\r\n                        newNode = child;\r\n                        pCurrent = [];\r\n                        cssText = '';\r\n                        const anchors = [];\r\n                        while (newNode.parentNode !== null && newNode !== el && newNode !== newInnerNode) {\r\n                            vNode = endPass ? newNode.cloneNode(false) : validation(newNode);\r\n                            if (newNode.nodeType === 1 && !util.isBreak(child) && vNode && checkCss(newNode)) {\r\n                                if (_isMaintainedNode(newNode)) {\r\n                                    if (!anchorNode) anchors.push(vNode);\r\n                                } else {\r\n                                    pCurrent.push(vNode);\r\n                                }\r\n                                cssText += newNode.style.cssText.substr(0, newNode.style.cssText.indexOf(':')) + '|';\r\n                            }\r\n                            newNode = newNode.parentNode;\r\n                        }\r\n                        pCurrent = pCurrent.concat(anchors);\r\n\r\n                        const childNode = pCurrent.pop() || child;\r\n                        appendNode = newNode = childNode;\r\n                        while (pCurrent.length > 0) {\r\n                            newNode = pCurrent.pop();\r\n                            appendNode.appendChild(newNode);\r\n                            appendNode = newNode;\r\n                        }\r\n                        \r\n                        if (_isMaintainedNode(newInnerNode.parentNode) && !_isMaintainedNode(childNode) && !util.onlyZeroWidthSpace(newInnerNode)) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            pNode.appendChild(newInnerNode);\r\n                            nNodeArray.push(newInnerNode);\r\n                        }\r\n                        \r\n                        if (!endPass && !anchorNode && _isMaintainedNode(childNode)) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            const aChildren = childNode.childNodes;\r\n                            for (let a = 0, aLen = aChildren.length; a < aLen; a++) {\r\n                                newInnerNode.appendChild(aChildren[a]);\r\n                            }\r\n                            childNode.appendChild(newInnerNode);\r\n                            pNode.appendChild(childNode);\r\n                            nNodeArray.push(newInnerNode);\r\n                            if (newInnerNode.children.length > 0) ancestor = newNode;\r\n                            else ancestor = newInnerNode;\r\n                        } else if (childNode === child) {\r\n                            if (!endPass) ancestor = newInnerNode;\r\n                            else ancestor = pNode;\r\n                        } else if (endPass) {\r\n                            pNode.appendChild(childNode);\r\n                            ancestor = newNode;\r\n                        } else {\r\n                            newInnerNode.appendChild(childNode);\r\n                            ancestor = newNode;\r\n                        }\r\n\r\n                        if (anchorNode && child.nodeType === 3) {\r\n                            if (_getMaintainedNode(child)) {\r\n                                const ancestorAnchorNode = util.getParentElement(ancestor, function (current) {return this._isMaintainedNode(current.parentNode) || current.parentNode === pNode;}.bind(util));\r\n                                anchorNode.appendChild(ancestorAnchorNode);\r\n                                newInnerNode = ancestorAnchorNode.cloneNode(false);\r\n                                nNodeArray.push(newInnerNode);\r\n                                pNode.appendChild(newInnerNode);\r\n                            } else {\r\n                                anchorNode = null;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    cloneNode = child.cloneNode(false);\r\n                    ancestor.appendChild(cloneNode);\r\n                    if (child.nodeType === 1 && !util.isBreak(child)) coverNode = cloneNode;\r\n\r\n                    recursionFunc(child, coverNode);\r\n                }\r\n            })(element, pNode);\r\n\r\n            // not remove tag\r\n            if (isRemoveNode && !isRemoveFormat && !_removeCheck.v) {\r\n                return {\r\n                    ancestor: element,\r\n                    startContainer: startCon,\r\n                    startOffset: startOff,\r\n                    endContainer: endCon,\r\n                    endOffset: endOff\r\n                };\r\n            }\r\n\r\n            isRemoveFormat = isRemoveFormat && isRemoveNode;\r\n\r\n            if (isRemoveFormat) {\r\n                for (let i = 0; i < nNodeArray.length; i++) {\r\n                    let removeNode = nNodeArray[i];\r\n                    let textNode, textNode_s, textNode_e;\r\n                    \r\n                    if (collapsed) {\r\n                        textNode = util.createTextNode(util.zeroWidthSpace);\r\n                        pNode.replaceChild(textNode, removeNode);\r\n                    } else {\r\n                        const rChildren = removeNode.childNodes;\r\n                        textNode_s = rChildren[0];\r\n                        while (rChildren[0]) {\r\n                            textNode_e = rChildren[0];\r\n                            pNode.insertBefore(textNode_e, removeNode);\r\n                        }\r\n                        util.removeItem(removeNode);\r\n                    }\r\n\r\n                    if (i === 0) {\r\n                        if (collapsed) {\r\n                            startContainer = endContainer = textNode;\r\n                        } else {\r\n                            startContainer = textNode_s;\r\n                            endContainer = textNode_e;\r\n                        }\r\n                    }\r\n                }\r\n            } else {\r\n                if (isRemoveNode) {\r\n                    for (let i = 0; i < nNodeArray.length; i++) {\r\n                        this._stripRemoveNode(nNodeArray[i]);\r\n                    }\r\n                }\r\n                \r\n                if (collapsed) {\r\n                    startContainer = endContainer = newInnerNode;\r\n                }\r\n            }\r\n\r\n            util.removeEmptyNode(pNode, newInnerNode);\r\n\r\n            if (collapsed) {\r\n                startOffset = startContainer.textContent.length;\r\n                endOffset = endContainer.textContent.length;\r\n            }\r\n\r\n            // endContainer reset\r\n            const endConReset = isRemoveFormat || endContainer.textContent.length === 0;\r\n\r\n            if (!util.isBreak(endContainer) && endContainer.textContent.length === 0) {\r\n                util.removeItem(endContainer);\r\n                endContainer = startContainer;\r\n            }\r\n            endOffset = endConReset ? endContainer.textContent.length : endOffset;\r\n\r\n            // node change\r\n            const newStartOffset = {s: 0, e: 0};\r\n            const startPath = util.getNodePath(startContainer, pNode, newStartOffset);\r\n\r\n            const mergeEndCon = !endContainer.parentNode;\r\n            if (mergeEndCon) endContainer = startContainer;\r\n            const newEndOffset = {s: 0, e: 0};\r\n            const endPath = util.getNodePath(endContainer , pNode, (!mergeEndCon && !endConReset) ? newEndOffset : null);\r\n\r\n            startOffset += newStartOffset.s;\r\n            endOffset = (collapsed ? startOffset : mergeEndCon ? startContainer.textContent.length : endConReset ? endOffset + newStartOffset.s : endOffset + newEndOffset.s);\r\n\r\n            // tag merge\r\n            const newOffsets = util.mergeSameTags(pNode, [startPath, endPath], true);\r\n\r\n            element.parentNode.replaceChild(pNode, element);\r\n\r\n            startContainer = util.getNodeFromPath(startPath, pNode);\r\n            endContainer = util.getNodeFromPath(endPath, pNode);\r\n\r\n            return {\r\n                ancestor: pNode,\r\n                startContainer: startContainer,\r\n                startOffset: startOffset + newOffsets[0],\r\n                endContainer: endContainer,\r\n                endOffset: endOffset + newOffsets[1]\r\n            };\r\n        },\r\n\r\n        /**\r\n         * @description wraps first line selected text.\r\n         * @param {Element} element The node of the line that contains the selected text node.\r\n         * @param {Element} newInnerNode The dom that will wrap the selected text area\r\n         * @param {Function} validation Check if the node should be stripped.\r\n         * @param {Node} startCon The startContainer property of the selection object.\r\n         * @param {Number} startOff The startOffset property of the selection object.\r\n         * @param {Boolean} isRemoveFormat Is the remove all formats command?\r\n         * @param {Boolean} isRemoveNode \"newInnerNode\" is remove node?\r\n         * @returns {null|Node} If end container is renewed, returned renewed node\r\n         * @returns {Object} { ancestor, container, offset, endContainer }\r\n         * @private\r\n         */\r\n        _nodeChange_startLine: function (element, newInnerNode, validation, startCon, startOff, isRemoveFormat, isRemoveNode, _removeCheck, _getMaintainedNode, _isMaintainedNode, _endContainer) {\r\n            // not add tag\r\n            let parentCon = startCon.parentNode;\r\n            while (!parentCon.nextSibling && !parentCon.previousSibling && !util.isFormatElement(parentCon.parentNode) && !util.isWysiwygDiv(parentCon.parentNode)) {\r\n                if (parentCon.nodeName === newInnerNode.nodeName) break;\r\n                parentCon = parentCon.parentNode;\r\n            }\r\n\r\n            if (!isRemoveNode && parentCon.nodeName === newInnerNode.nodeName && !util.isFormatElement(parentCon) && !parentCon.nextSibling && util.onlyZeroWidthSpace(startCon.textContent.slice(0, startOff))) {\r\n                let sameTag = true;\r\n                let s = startCon.previousSibling;\r\n                while (s) {\r\n                    if (!util.onlyZeroWidthSpace(s)) {\r\n                        sameTag = false;\r\n                        break;\r\n                    }\r\n                    s = s.previousSibling;\r\n                }\r\n\r\n                if (sameTag) {\r\n                    util.copyTagAttributes(parentCon, newInnerNode);\r\n    \r\n                    return {\r\n                        ancestor: element,\r\n                        container: startCon,\r\n                        offset: startOff\r\n                    };\r\n                }\r\n            }\r\n\r\n            // add tag\r\n            _removeCheck.v = false;\r\n            const el = element;\r\n            const nNodeArray = [newInnerNode];\r\n            const pNode = element.cloneNode(false);\r\n\r\n            let container = startCon;\r\n            let offset = startOff;\r\n            let passNode = false;\r\n            let pCurrent, newNode, appendNode, anchorNode;\r\n\r\n            (function recursionFunc(current, ancestor) {\r\n                const childNodes = current.childNodes;\r\n\r\n                for (let i = 0, len = childNodes.length, vNode, cloneChild; i < len; i++) {\r\n                    const child = childNodes[i];\r\n                    if (!child) continue;\r\n                    let coverNode = ancestor;\r\n\r\n                    if (passNode && !util.isBreak(child)) {\r\n                        if (child.nodeType === 1) {\r\n                            if (util._isIgnoreNodeChange(child)) {\r\n                                newInnerNode = newInnerNode.cloneNode(false);\r\n                                cloneChild = child.cloneNode(true);\r\n                                pNode.appendChild(cloneChild);\r\n                                pNode.appendChild(newInnerNode);\r\n                                nNodeArray.push(newInnerNode);\r\n\r\n                                // end container\r\n                                if (_endContainer && child.contains(_endContainer)) {\r\n                                    const endPath = util.getNodePath(_endContainer, child);\r\n                                    _endContainer = util.getNodeFromPath(endPath, cloneChild);\r\n                                }\r\n                            } else {\r\n                                recursionFunc(child, child);\r\n                            }\r\n                            continue;\r\n                        }\r\n\r\n                        newNode = child;\r\n                        pCurrent = [];\r\n                        const anchors = [];\r\n                        while (newNode.parentNode !== null && newNode !== el && newNode !== newInnerNode) {\r\n                            vNode = validation(newNode);\r\n                            if (newNode.nodeType === 1 && vNode) {\r\n                                if (_isMaintainedNode(newNode)) {\r\n                                    if (!anchorNode) anchors.push(vNode);\r\n                                } else {\r\n                                    pCurrent.push(vNode);\r\n                                }\r\n                            }\r\n                            newNode = newNode.parentNode;\r\n                        }\r\n                        pCurrent = pCurrent.concat(anchors);\r\n\r\n                        const isTopNode = pCurrent.length > 0;\r\n                        const childNode = pCurrent.pop() || child;\r\n                        appendNode = newNode = childNode;\r\n                        while (pCurrent.length > 0) {\r\n                            newNode = pCurrent.pop();\r\n                            appendNode.appendChild(newNode);\r\n                            appendNode = newNode;\r\n                        }\r\n\r\n                        if (_isMaintainedNode(newInnerNode.parentNode) && !_isMaintainedNode(childNode)) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            pNode.appendChild(newInnerNode);\r\n                            nNodeArray.push(newInnerNode);\r\n                        }\r\n                        \r\n                        if (!anchorNode && _isMaintainedNode(childNode)) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            const aChildren = childNode.childNodes;\r\n                            for (let a = 0, aLen = aChildren.length; a < aLen; a++) {\r\n                                newInnerNode.appendChild(aChildren[a]);\r\n                            }\r\n                            childNode.appendChild(newInnerNode);\r\n                            pNode.appendChild(childNode);\r\n                            ancestor = !_isMaintainedNode(newNode) ? newNode : newInnerNode;\r\n                            nNodeArray.push(newInnerNode);\r\n                        } else if (isTopNode) {\r\n                            newInnerNode.appendChild(childNode);\r\n                            ancestor = newNode;\r\n                        } else {\r\n                            ancestor = newInnerNode;\r\n                        }\r\n\r\n                        if (anchorNode && child.nodeType === 3) {\r\n                            if (_getMaintainedNode(child)) {\r\n                                const ancestorAnchorNode = util.getParentElement(ancestor, function (current) {return this._isMaintainedNode(current.parentNode) || current.parentNode === pNode;}.bind(util));\r\n                                anchorNode.appendChild(ancestorAnchorNode);\r\n                                newInnerNode = ancestorAnchorNode.cloneNode(false);\r\n                                nNodeArray.push(newInnerNode);\r\n                                pNode.appendChild(newInnerNode);\r\n                            } else {\r\n                                anchorNode = null;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    // startContainer\r\n                    if (!passNode && child === container) {\r\n                        let line = pNode;\r\n                        anchorNode = _getMaintainedNode(child);\r\n                        const prevNode = util.createTextNode(container.nodeType === 1 ? '' : container.substringData(0, offset));\r\n                        const textNode = util.createTextNode(container.nodeType === 1 ? '' : container.substringData(offset, (container.length - offset)));\r\n\r\n                        if (anchorNode) {\r\n                            const a = _getMaintainedNode(ancestor);\r\n                            if (a && a.parentNode !== line) {\r\n                                let m = a;\r\n                                let p = null;\r\n                                while (m.parentNode !== line) {\r\n                                    ancestor = p = m.parentNode.cloneNode(false);\r\n                                    while(m.childNodes[0]) {\r\n                                        p.appendChild(m.childNodes[0]);\r\n                                    }\r\n                                    m.appendChild(p);\r\n                                    m = m.parentNode;\r\n                                }\r\n                                m.parentNode.appendChild(a);\r\n                            }\r\n                            anchorNode = anchorNode.cloneNode(false);\r\n                        }\r\n\r\n                        if (!util.onlyZeroWidthSpace(prevNode)) {\r\n                            ancestor.appendChild(prevNode);\r\n                        }\r\n\r\n                        const prevAnchorNode = _getMaintainedNode(ancestor);\r\n                        if (!!prevAnchorNode) anchorNode = prevAnchorNode;\r\n                        if (anchorNode) line = anchorNode;\r\n\r\n                        newNode = ancestor;\r\n                        pCurrent = [];\r\n                        while (newNode !== line && newNode !== null) {\r\n                            vNode = validation(newNode);\r\n                            if (newNode.nodeType === 1 && vNode) {\r\n                                pCurrent.push(vNode);\r\n                            }\r\n                            newNode = newNode.parentNode;\r\n                        }\r\n\r\n                        const childNode = pCurrent.pop() || ancestor;\r\n                        appendNode = newNode = childNode;\r\n                        while (pCurrent.length > 0) {\r\n                            newNode = pCurrent.pop();\r\n                            appendNode.appendChild(newNode);\r\n                            appendNode = newNode;\r\n                        }\r\n\r\n                        if (childNode !== ancestor) {\r\n                            newInnerNode.appendChild(childNode);\r\n                            ancestor = newNode;\r\n                        } else {\r\n                            ancestor = newInnerNode;\r\n                        }\r\n\r\n                        if (util.isBreak(child)) newInnerNode.appendChild(child.cloneNode(false));\r\n                        line.appendChild(newInnerNode);\r\n\r\n                        container = textNode;\r\n                        offset = 0;\r\n                        passNode = true;\r\n\r\n                        ancestor.appendChild(container);\r\n                        continue;\r\n                    }\r\n\r\n                    vNode = !passNode ? child.cloneNode(false) : validation(child);\r\n                    if (vNode) {\r\n                        ancestor.appendChild(vNode);\r\n                        if (child.nodeType === 1 && !util.isBreak(child)) coverNode = vNode;\r\n                    }\r\n\r\n                    recursionFunc(child, coverNode);\r\n                }\r\n            })(element, pNode);\r\n\r\n            // not remove tag\r\n            if (isRemoveNode && !isRemoveFormat && !_removeCheck.v) {\r\n                return {\r\n                    ancestor: element,\r\n                    container: startCon,\r\n                    offset: startOff,\r\n                    endContainer: _endContainer\r\n                };\r\n            }\r\n\r\n            isRemoveFormat = isRemoveFormat && isRemoveNode;\r\n\r\n            if (isRemoveFormat) {\r\n                for (let i = 0; i < nNodeArray.length; i++) {\r\n                    let removeNode = nNodeArray[i];\r\n\r\n                    const rChildren = removeNode.childNodes;\r\n                    const textNode = rChildren[0];\r\n                    while (rChildren[0]) {\r\n                        pNode.insertBefore(rChildren[0], removeNode);\r\n                    }\r\n                    util.removeItem(removeNode);\r\n\r\n                    if (i === 0) container = textNode;\r\n                }\r\n            } else if (isRemoveNode) {\r\n                newInnerNode = newInnerNode.firstChild;\r\n                for (let i = 0; i < nNodeArray.length; i++) {\r\n                    this._stripRemoveNode(nNodeArray[i]);\r\n                }\r\n            }\r\n\r\n            if (!isRemoveFormat && pNode.childNodes.length === 0) {\r\n                if (element.childNodes) {\r\n                    container = element.childNodes[0];\r\n                } else {\r\n                    container = util.createTextNode(util.zeroWidthSpace);\r\n                    element.appendChild(container);\r\n                }\r\n            } else {\r\n                util.removeEmptyNode(pNode, newInnerNode);\r\n\r\n                if (util.onlyZeroWidthSpace(pNode.textContent)) {\r\n                    container = pNode.firstChild;\r\n                    offset = 0;\r\n                }\r\n\r\n                // node change\r\n                const offsets = {s: 0, e: 0};\r\n                const path = util.getNodePath(container, pNode, offsets);\r\n                offset += offsets.s;\r\n\r\n                // tag merge\r\n                const newOffsets = util.mergeSameTags(pNode, [path], true);\r\n\r\n                element.parentNode.replaceChild(pNode, element);\r\n\r\n                container = util.getNodeFromPath(path, pNode);\r\n                offset += newOffsets[0];\r\n            }\r\n\r\n            return {\r\n                ancestor: pNode,\r\n                container: container,\r\n                offset: offset,\r\n                endContainer: _endContainer\r\n            };\r\n        },\r\n\r\n        /**\r\n         * @description wraps mid lines selected text.\r\n         * @param {Element} element The node of the line that contains the selected text node.\r\n         * @param {Element} newInnerNode The dom that will wrap the selected text area\r\n         * @param {Function} validation Check if the node should be stripped.\r\n         * @param {Boolean} isRemoveFormat Is the remove all formats command?\r\n         * @param {Boolean} isRemoveNode \"newInnerNode\" is remove node?\r\n         * @param {Node} _endContainer Offset node of last line already modified (end.container)\r\n         * @returns {Object} { ancestor, endContainer: \"If end container is renewed, returned renewed node\" }\r\n         * @private\r\n         */\r\n        _nodeChange_middleLine: function (element, newInnerNode, validation, isRemoveFormat, isRemoveNode, _removeCheck, _endContainer) {\r\n            // not add tag\r\n            if (!isRemoveNode) {\r\n                // end container path\r\n                let endPath = null;\r\n                if (_endContainer && element.contains(_endContainer)) endPath = util.getNodePath(_endContainer, element);\r\n\r\n                const tempNode = element.cloneNode(true);\r\n                const newNodeName = newInnerNode.nodeName;\r\n                const newCssText = newInnerNode.style.cssText;\r\n                const newClass = newInnerNode.className;\r\n\r\n                let children = tempNode.childNodes;\r\n                let i = 0, len = children.length;\r\n                for (let child; i < len; i++) {\r\n                    child = children[i];\r\n                    if (child.nodeType === 3) break;\r\n                    if (child.nodeName === newNodeName) {\r\n                        child.style.cssText += newCssText;\r\n                        util.addClass(child, newClass);\r\n                    } else if (!util.isBreak(child) && util._isIgnoreNodeChange(child)) {\r\n                        continue;\r\n                    } else if (len === 1) {\r\n                        children = child.childNodes;\r\n                        len = children.length;\r\n                        i = -1;\r\n                        continue;\r\n                    } else {\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                if (len > 0 && i === len) {\r\n                    element.innerHTML = tempNode.innerHTML;\r\n                    return {\r\n                        ancestor: element,\r\n                        endContainer: endPath ? util.getNodeFromPath(endPath, element) : null\r\n                    };\r\n                }\r\n            }\r\n\r\n            // add tag\r\n            _removeCheck.v = false;\r\n            const pNode = element.cloneNode(false);\r\n            const nNodeArray = [newInnerNode];\r\n            let noneChange = true;\r\n\r\n            (function recursionFunc(current, ancestor) {\r\n                const childNodes = current.childNodes;\r\n\r\n                for (let i = 0, len = childNodes.length, vNode, cloneChild; i < len; i++) {\r\n                    let child = childNodes[i];\r\n                    if (!child) continue;\r\n                    let coverNode = ancestor;\r\n\r\n                    if (!util.isBreak(child) && util._isIgnoreNodeChange(child)) {\r\n                        if (newInnerNode.childNodes.length > 0) {\r\n                            pNode.appendChild(newInnerNode);\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                        }\r\n                        \r\n                        cloneChild = child.cloneNode(true);\r\n                        pNode.appendChild(cloneChild);\r\n                        pNode.appendChild(newInnerNode);\r\n                        nNodeArray.push(newInnerNode);\r\n                        ancestor = newInnerNode;\r\n\r\n                        // end container\r\n                        if (_endContainer && child.contains(_endContainer)) {\r\n                            const endPath = util.getNodePath(_endContainer, child);\r\n                            _endContainer = util.getNodeFromPath(endPath, cloneChild);\r\n                        }\r\n\r\n                        continue;\r\n                    } else {\r\n                        vNode = validation(child);\r\n                        if (vNode) {\r\n                            noneChange = false;\r\n                            ancestor.appendChild(vNode);\r\n                            if (child.nodeType === 1) coverNode = vNode;\r\n                        }\r\n                    }\r\n\r\n                    if (!util.isBreak(child)) recursionFunc(child, coverNode);\r\n                }\r\n            })(element, newInnerNode);\r\n\r\n            // not remove tag\r\n            if (noneChange || (isRemoveNode && !isRemoveFormat && !_removeCheck.v)) return { ancestor: element, endContainer: _endContainer };\r\n\r\n            pNode.appendChild(newInnerNode);\r\n\r\n            if (isRemoveFormat && isRemoveNode) {\r\n                for (let i = 0; i < nNodeArray.length; i++) {\r\n                    let removeNode = nNodeArray[i];\r\n                    \r\n                    const rChildren = removeNode.childNodes;\r\n                    while (rChildren[0]) {\r\n                        pNode.insertBefore(rChildren[0], removeNode);\r\n                    }\r\n                    util.removeItem(removeNode);\r\n                }\r\n            } else if (isRemoveNode) {\r\n                newInnerNode = newInnerNode.firstChild;\r\n                for (let i = 0; i < nNodeArray.length; i++) {\r\n                    this._stripRemoveNode(nNodeArray[i]);\r\n                }\r\n            }\r\n\r\n            util.removeEmptyNode(pNode, newInnerNode);\r\n            util.mergeSameTags(pNode, null, true);\r\n\r\n            // node change\r\n            element.parentNode.replaceChild(pNode, element);\r\n            return { ancestor: pNode, endContainer: _endContainer };\r\n        },\r\n\r\n        /**\r\n         * @description wraps last line selected text.\r\n         * @param {Element} element The node of the line that contains the selected text node.\r\n         * @param {Element} newInnerNode The dom that will wrap the selected text area\r\n         * @param {Function} validation Check if the node should be stripped.\r\n         * @param {Node} endCon The endContainer property of the selection object.\r\n         * @param {Number} endOff The endOffset property of the selection object.\r\n         * @param {Boolean} isRemoveFormat Is the remove all formats command?\r\n         * @param {Boolean} isRemoveNode \"newInnerNode\" is remove node?\r\n         * @returns {Object} { ancestor, container, offset }\r\n         * @private\r\n         */\r\n        _nodeChange_endLine: function (element, newInnerNode, validation, endCon, endOff, isRemoveFormat, isRemoveNode, _removeCheck, _getMaintainedNode, _isMaintainedNode) {\r\n            // not add tag\r\n            let parentCon = endCon.parentNode;\r\n            while (!parentCon.nextSibling && !parentCon.previousSibling && !util.isFormatElement(parentCon.parentNode) && !util.isWysiwygDiv(parentCon.parentNode)) {\r\n                if (parentCon.nodeName === newInnerNode.nodeName) break;\r\n                parentCon = parentCon.parentNode;\r\n            }\r\n            \r\n            if (!isRemoveNode && parentCon.nodeName === newInnerNode.nodeName && !util.isFormatElement(parentCon) && !parentCon.previousSibling && util.onlyZeroWidthSpace(endCon.textContent.slice(endOff))) {\r\n                let sameTag = true;\r\n                let e = endCon.nextSibling;\r\n                while (e) {\r\n                    if (!util.onlyZeroWidthSpace(e)) {\r\n                        sameTag = false;\r\n                        break;\r\n                    }\r\n                    e = e.nextSibling;\r\n                }\r\n\r\n                if (sameTag) {\r\n                    util.copyTagAttributes(parentCon, newInnerNode);\r\n    \r\n                    return {\r\n                        ancestor: element,\r\n                        container: endCon,\r\n                        offset: endOff\r\n                    };\r\n                }\r\n            }\r\n\r\n            // add tag\r\n            _removeCheck.v = false;\r\n            const el = element;\r\n            const nNodeArray = [newInnerNode];\r\n            const pNode = element.cloneNode(false);\r\n\r\n            let container = endCon;\r\n            let offset = endOff;\r\n            let passNode = false;\r\n            let pCurrent, newNode, appendNode, anchorNode;\r\n\r\n            (function recursionFunc(current, ancestor) {\r\n                const childNodes = current.childNodes;\r\n\r\n                for (let i = childNodes.length - 1, vNode; 0 <= i; i--) {\r\n                    const child = childNodes[i];\r\n                    if (!child) continue;\r\n                    let coverNode = ancestor;\r\n\r\n                    if (passNode && !util.isBreak(child)) {\r\n                        if (child.nodeType === 1) {\r\n                            if (util._isIgnoreNodeChange(child)) {\r\n                                newInnerNode = newInnerNode.cloneNode(false);\r\n                                const cloneChild = child.cloneNode(true);\r\n                                pNode.insertBefore(cloneChild, ancestor);\r\n                                pNode.insertBefore(newInnerNode, cloneChild);\r\n                                nNodeArray.push(newInnerNode);\r\n                            } else {\r\n                                recursionFunc(child, child);\r\n                            }\r\n                            continue;\r\n                        }\r\n\r\n                        newNode = child;\r\n                        pCurrent = [];\r\n                        const anchors = [];\r\n                        while (newNode.parentNode !== null && newNode !== el && newNode !== newInnerNode) {\r\n                            vNode = validation(newNode);\r\n                            if (vNode && newNode.nodeType === 1) {\r\n                                if (_isMaintainedNode(newNode)) {\r\n                                    if (!anchorNode) anchors.push(vNode);\r\n                                } else {\r\n                                    pCurrent.push(vNode);\r\n                                }\r\n                            }\r\n                            newNode = newNode.parentNode;\r\n                        }\r\n                        pCurrent = pCurrent.concat(anchors);\r\n\r\n                        const isTopNode = pCurrent.length > 0;\r\n                        const childNode = pCurrent.pop() || child;\r\n                        appendNode = newNode = childNode;\r\n                        while (pCurrent.length > 0) {\r\n                            newNode = pCurrent.pop();\r\n                            appendNode.appendChild(newNode);\r\n                            appendNode = newNode;\r\n                        }\r\n\r\n                        if (_isMaintainedNode(newInnerNode.parentNode) && !_isMaintainedNode(childNode)) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            pNode.insertBefore(newInnerNode, pNode.firstChild);\r\n                            nNodeArray.push(newInnerNode);\r\n                        }\r\n\r\n                        if (!anchorNode && _isMaintainedNode(childNode)) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            const aChildren = childNode.childNodes;\r\n                            for (let a = 0, aLen = aChildren.length; a < aLen; a++) {\r\n                                newInnerNode.appendChild(aChildren[a]);\r\n                            }\r\n                            childNode.appendChild(newInnerNode);\r\n                            pNode.insertBefore(childNode, pNode.firstChild);\r\n                            nNodeArray.push(newInnerNode);\r\n                            if (newInnerNode.children.length > 0) ancestor = newNode;\r\n                            else ancestor = newInnerNode;\r\n                        } else if (isTopNode) {\r\n                            newInnerNode.insertBefore(childNode, newInnerNode.firstChild);\r\n                            ancestor = newNode;\r\n                        } else {\r\n                            ancestor = newInnerNode;\r\n                        }\r\n\r\n                        if (anchorNode && child.nodeType === 3) {\r\n                            if (_getMaintainedNode(child)) {\r\n                                const ancestorAnchorNode = util.getParentElement(ancestor, function (current) {return this._isMaintainedNode(current.parentNode) || current.parentNode === pNode;}.bind(util));\r\n                                anchorNode.appendChild(ancestorAnchorNode);\r\n                                newInnerNode = ancestorAnchorNode.cloneNode(false);\r\n                                nNodeArray.push(newInnerNode);\r\n                                pNode.insertBefore(newInnerNode, pNode.firstChild);\r\n                            } else {\r\n                                anchorNode = null;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    // endContainer\r\n                    if (!passNode && child === container) {\r\n                        anchorNode = _getMaintainedNode(child);\r\n                        const afterNode = util.createTextNode(container.nodeType === 1 ? '' : container.substringData(offset, (container.length - offset)));\r\n                        const textNode = util.createTextNode(container.nodeType === 1 ? '' : container.substringData(0, offset));\r\n\r\n                        if (anchorNode) {\r\n                            anchorNode = anchorNode.cloneNode(false);\r\n                            const a = _getMaintainedNode(ancestor);\r\n                            if (a && a.parentNode !== pNode) {\r\n                                let m = a;\r\n                                let p = null;\r\n                                while (m.parentNode !== pNode) {\r\n                                    ancestor = p = m.parentNode.cloneNode(false);\r\n                                    while(m.childNodes[0]) {\r\n                                        p.appendChild(m.childNodes[0]);\r\n                                    }\r\n                                    m.appendChild(p);\r\n                                    m = m.parentNode;\r\n                                }\r\n                                m.parentNode.insertBefore(a, m.parentNode.firstChild);\r\n                            }\r\n                            anchorNode = anchorNode.cloneNode(false);\r\n                        } else if (_isMaintainedNode(newInnerNode.parentNode) && !anchorNode) {\r\n                            newInnerNode = newInnerNode.cloneNode(false);\r\n                            pNode.appendChild(newInnerNode);\r\n                            nNodeArray.push(newInnerNode);\r\n                        }\r\n\r\n                        if (!util.onlyZeroWidthSpace(afterNode)) {\r\n                            ancestor.insertBefore(afterNode, ancestor.firstChild);\r\n                        }\r\n\r\n                        newNode = ancestor;\r\n                        pCurrent = [];\r\n                        while (newNode !== pNode && newNode !== null) {\r\n                            vNode = _isMaintainedNode(newNode) ? null : validation(newNode);\r\n                            if (vNode && newNode.nodeType === 1) {\r\n                                pCurrent.push(vNode);\r\n                            }\r\n                            newNode = newNode.parentNode;\r\n                        }\r\n\r\n                        const childNode = pCurrent.pop() || ancestor;\r\n                        appendNode = newNode = childNode;\r\n                        while (pCurrent.length > 0) {\r\n                            newNode = pCurrent.pop();\r\n                            appendNode.appendChild(newNode);\r\n                            appendNode = newNode;\r\n                        }\r\n\r\n                        if (childNode !== ancestor) {\r\n                            newInnerNode.insertBefore(childNode, newInnerNode.firstChild);\r\n                            ancestor = newNode;\r\n                        } else {\r\n                            ancestor = newInnerNode;\r\n                        }\r\n\r\n                        if (util.isBreak(child)) newInnerNode.appendChild(child.cloneNode(false));\r\n                        \r\n                        if (anchorNode) {\r\n                            anchorNode.insertBefore(newInnerNode, anchorNode.firstChild);\r\n                            pNode.insertBefore(anchorNode, pNode.firstChild);\r\n                            anchorNode = null;\r\n                        } else {\r\n                            pNode.insertBefore(newInnerNode, pNode.firstChild);\r\n                        }\r\n\r\n                        container = textNode;\r\n                        offset = textNode.data.length;\r\n                        passNode = true;\r\n\r\n                        ancestor.insertBefore(container, ancestor.firstChild);\r\n                        continue;\r\n                    }\r\n\r\n                    vNode = !passNode ? child.cloneNode(false) : validation(child);\r\n                    if (vNode) {\r\n                        ancestor.insertBefore(vNode, ancestor.firstChild);\r\n                        if (child.nodeType === 1 && !util.isBreak(child)) coverNode = vNode;\r\n                    }\r\n\r\n                    recursionFunc(child, coverNode);\r\n                }\r\n            })(element, pNode);\r\n\r\n            // not remove tag\r\n            if (isRemoveNode && !isRemoveFormat && !_removeCheck.v) {\r\n                return {\r\n                    ancestor: element,\r\n                    container: endCon,\r\n                    offset: endOff\r\n                };\r\n            }\r\n\r\n            isRemoveFormat = isRemoveFormat && isRemoveNode;\r\n\r\n            if (isRemoveFormat) {\r\n                for (let i = 0; i < nNodeArray.length; i++) {\r\n                    let removeNode = nNodeArray[i];\r\n                    \r\n                    const rChildren = removeNode.childNodes;\r\n                    let textNode = null;\r\n                    while (rChildren[0]) {\r\n                        textNode = rChildren[0];\r\n                        pNode.insertBefore(textNode, removeNode);\r\n                    }\r\n                    util.removeItem(removeNode);\r\n\r\n                    if (i === nNodeArray.length - 1) {\r\n                        container = textNode;\r\n                        offset = textNode.textContent.length;\r\n                    }\r\n                }\r\n            } else if (isRemoveNode) {\r\n                newInnerNode = newInnerNode.firstChild;\r\n                for (let i = 0; i < nNodeArray.length; i++) {\r\n                    this._stripRemoveNode(nNodeArray[i]);\r\n                }\r\n            }\r\n\r\n            if (!isRemoveFormat && pNode.childNodes.length === 0) {\r\n                if (element.childNodes) {\r\n                    container = element.childNodes[0];\r\n                } else {\r\n                    container = util.createTextNode(util.zeroWidthSpace);\r\n                    element.appendChild(container);\r\n                }\r\n            } else {\r\n                if (!isRemoveNode && newInnerNode.textContent.length === 0) {\r\n                    util.removeEmptyNode(pNode, null);\r\n                    return {\r\n                        ancestor: null,\r\n                        container: null,\r\n                        offset: 0\r\n                    };\r\n                }\r\n\r\n                util.removeEmptyNode(pNode, newInnerNode);\r\n\r\n                if (util.onlyZeroWidthSpace(pNode.textContent)) {\r\n                    container = pNode.firstChild;\r\n                    offset = container.textContent.length;\r\n                } else if (util.onlyZeroWidthSpace(container)) {\r\n                    container = newInnerNode;\r\n                    offset = 1;\r\n                }\r\n                \r\n                // node change\r\n                const offsets = {s: 0, e: 0};\r\n                const path = util.getNodePath(container, pNode, offsets);\r\n                offset += offsets.s;\r\n\r\n                // tag merge\r\n                const newOffsets = util.mergeSameTags(pNode, [path], true);\r\n\r\n                element.parentNode.replaceChild(pNode, element);\r\n\r\n                container = util.getNodeFromPath(path, pNode);\r\n                offset += newOffsets[0];\r\n            }\r\n\r\n            return {\r\n                ancestor: pNode,\r\n                container: container,\r\n                offset: container.nodeType === 1 && offset === 1 ? container.childNodes.length : offset\r\n            };\r\n        },\r\n\r\n        /**\r\n         * @description Run plugin calls and basic commands.\r\n         * @param {String} command Command string\r\n         * @param {String} display Display type string ('command', 'submenu', 'dialog', 'container')\r\n         * @param {Element} target The element of command button\r\n         */\r\n        actionCall: function (command, display, target) {\r\n            // call plugins\r\n            if (display) {\r\n                if (/more/i.test(display)) {\r\n                    if (target !== this._moreLayerActiveButton) {\r\n                        const layer = context.element.toolbar.querySelector('.' + command);\r\n                        if (layer) {\r\n                            if (this._moreLayerActiveButton) this.moreLayerOff();\r\n\r\n                            this._moreLayerActiveButton = target;\r\n                            layer.style.display = 'block';\r\n\r\n                            event._showToolbarBalloon();\r\n                            event._showToolbarInline();\r\n                        }\r\n                        util.addClass(target, 'on');\r\n                    } else {\r\n                        const layer = context.element.toolbar.querySelector('.' + this._moreLayerActiveButton.getAttribute('data-command'));\r\n                        if (layer) {\r\n                            this.moreLayerOff();\r\n\r\n                            event._showToolbarBalloon();\r\n                            event._showToolbarInline();\r\n                        }        \r\n                    }\r\n                    return;\r\n                }\r\n                \r\n                if (/container/.test(display) && (this._menuTray[command] === null || target !== this.containerActiveButton)) {\r\n                    this.callPlugin(command, this.containerOn.bind(this, target), target);\r\n                    return;\r\n                } \r\n                \r\n                if (this.isReadOnly && util.arrayIncludes(this.resizingDisabledButtons, target)) return;\r\n                if (/submenu/.test(display) && (this._menuTray[command] === null || target !== this.submenuActiveButton)) {\r\n                    this.callPlugin(command, this.submenuOn.bind(this, target), target);\r\n                    return;\r\n                } else if (/dialog/.test(display)) {\r\n                    this.callPlugin(command, this.plugins[command].open.bind(this), target);\r\n                    return;\r\n                } else if (/command/.test(display)) {\r\n                    this.callPlugin(command, this.plugins[command].action.bind(this), target);\r\n                } else if (/fileBrowser/.test(display)) {\r\n                    this.callPlugin(command, this.plugins[command].open.bind(this, null), target);\r\n                }\r\n            } // default command\r\n            else if (command) {\r\n                this.commandHandler(target, command);\r\n            }\r\n\r\n            if (/submenu/.test(display)) {\r\n                this.submenuOff();\r\n            } else if (!/command/.test(display)) {\r\n                this.submenuOff();\r\n                this.containerOff();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Execute command of command button(All Buttons except submenu and dialog)\r\n         * (selectAll, codeView, fullScreen, indent, outdent, undo, redo, removeFormat, print, preview, showBlocks, save, bold, underline, italic, strike, subscript, superscript, copy, cut, paste)\r\n         * @param {Element|null} target The element of command button\r\n         * @param {String} command Property of command button (data-value)\r\n         */\r\n        commandHandler: function (target, command) {\r\n            if (core.isReadOnly && !/copy|cut|selectAll|codeView|fullScreen|print|preview|showBlocks/.test(command)) return;\r\n            switch (command) {\r\n                case 'copy':\r\n                case 'cut':\r\n                    this.execCommand(command);\r\n                    break;\r\n                case 'paste':\r\n                    break;\r\n                case 'selectAll':\r\n                    this.containerOff();\r\n                    const wysiwyg = context.element.wysiwyg;\r\n                    let first = util.getChildElement(wysiwyg.firstChild, function (current) { return current.childNodes.length === 0 || current.nodeType === 3; }, false) || wysiwyg.firstChild;\r\n                    let last = util.getChildElement(wysiwyg.lastChild, function (current) { return current.childNodes.length === 0 || current.nodeType === 3; }, true) || wysiwyg.lastChild;\r\n                    if (!first || !last) return;\r\n                    if (util.isMedia(first)) {\r\n                        const info = this.getFileComponent(first);\r\n                        const br = util.createElement('BR');\r\n                        const format = util.createElement(options.defaultTag);\r\n                        format.appendChild(br);\r\n                        first = info ? info.component : first;\r\n                        first.parentNode.insertBefore(format, first);\r\n                        first = br;\r\n                    }\r\n                    if (util.isMedia(last)) {\r\n                        const br = util.createElement('BR');\r\n                        const format = util.createElement(options.defaultTag);\r\n                        format.appendChild(br);\r\n                        wysiwyg.appendChild(format);\r\n                        last = br;\r\n                    }\r\n                    event._showToolbarBalloon(this.setRange(first, 0, last, last.textContent.length));\r\n                    break;\r\n                case 'codeView':\r\n                    this.toggleCodeView();\r\n                    break;\r\n                case 'fullScreen':\r\n                    this.toggleFullScreen(target);\r\n                    break;\r\n                case 'indent':\r\n                case 'outdent':\r\n                    this.indent(command);\r\n                    break;\r\n                case 'undo':\r\n                    this.history.undo();\r\n                    break;\r\n                case 'redo':\r\n                    this.history.redo();\r\n                    break;\r\n                case 'removeFormat':\r\n                    this.removeFormat();\r\n                    this.focus();\r\n                    break;\r\n                case 'print':\r\n                    this.print();\r\n                    break;\r\n                case 'preview':\r\n                    this.preview();\r\n                    break;\r\n                case 'showBlocks':\r\n                    this.toggleDisplayBlocks();\r\n                    break;\r\n                case 'dir':\r\n                    this.setDir(options.rtl ? 'ltr' : 'rtl');\r\n                    break;\r\n                case 'dir_ltr':\r\n                    this.setDir('ltr');\r\n                    break;\r\n                case 'dir_rtl':\r\n                    this.setDir('rtl');\r\n                    break;\r\n                case 'save':\r\n                    if (typeof options.callBackSave === 'function') {\r\n                        options.callBackSave(this.getContents(false), this._variable.isChanged);\r\n                    } else if (this._variable.isChanged && typeof functions.save === 'function') {\r\n                        functions.save();\r\n                    } else {\r\n                        throw Error('[SUNEDITOR.core.commandHandler.fail] Please register call back function in creation option. (callBackSave : Function)');\r\n                    }\r\n\r\n                    this._variable.isChanged = false;\r\n                    if (context.tool.save) context.tool.save.setAttribute('disabled', true);\r\n                    break;\r\n                default : // 'STRONG', 'U', 'EM', 'DEL', 'SUB', 'SUP'..\r\n                    command = options._defaultCommand[command.toLowerCase()] || command;\r\n                    if (!this.commandMap[command]) this.commandMap[command] = target;\r\n\r\n                    const nodesMap = this._variable.currentNodesMap;\r\n                    const cmd = nodesMap.indexOf(command) > -1 ? null : util.createElement(command);\r\n                    let removeNode = command;\r\n\r\n                    if (/^SUB$/i.test(command) && nodesMap.indexOf('SUP') > -1) {\r\n                        removeNode = 'SUP';\r\n                    } else if (/^SUP$/i.test(command) && nodesMap.indexOf('SUB') > -1) {\r\n                        removeNode = 'SUB';\r\n                    }\r\n\r\n                    this.nodeChange(cmd, this._commandMapStyles[command] || null, [removeNode], false);\r\n                    this.focus();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Remove format of the currently selected range\r\n         */\r\n        removeFormat: function () {\r\n            this.nodeChange(null, null, null, null);\r\n        },\r\n\r\n        /**\r\n         * @description This method implements indentation to selected range.\r\n         * Setted \"margin-left\" to \"25px\" in the top \"P\" tag of the parameter node.\r\n         * @param {String} command Separator (\"indent\" or \"outdent\")\r\n         */\r\n        indent: function (command) {\r\n            const range = this.getRange();\r\n            const rangeLines = this.getSelectedElements(null);\r\n            const cells = [];\r\n            const shift = 'indent' !== command;\r\n            const marginDir = options.rtl ? 'marginRight' : 'marginLeft';\r\n            let sc = range.startContainer;\r\n            let ec = range.endContainer;\r\n            let so = range.startOffset;\r\n            let eo = range.endOffset;\r\n\r\n            for (let i = 0, len = rangeLines.length, f, margin; i < len; i++) {\r\n                f = rangeLines[i];\r\n                if (!util.isListCell(f) || !this.plugins.list) {\r\n                    margin = /\\d+/.test(f.style[marginDir]) ? util.getNumber(f.style[marginDir], 0) : 0;\r\n                    if (shift) {\r\n                        margin -= 25;\r\n                    } else {\r\n                        margin += 25;\r\n                    }\r\n                    util.setStyle(f, marginDir, (margin <= 0 ? '' : margin + 'px'));\r\n                } else {\r\n                    if (shift || f.previousElementSibling) {\r\n                        cells.push(f);\r\n                    }\r\n                }\r\n            }\r\n\r\n            // list cells\r\n            if (cells.length > 0) {\r\n                this.plugins.list.editInsideList.call(this, shift, cells);\r\n            }\r\n\r\n            this.effectNode = null;\r\n            this.setRange(sc, so, ec, eo);\r\n\r\n            // history stack\r\n            this.history.push(false);\r\n        },\r\n\r\n        /**\r\n         * @description Add or remove the class name of \"body\" so that the code block is visible\r\n         */\r\n        toggleDisplayBlocks: function () {\r\n            const wysiwyg = context.element.wysiwyg;\r\n            util.toggleClass(wysiwyg, 'se-show-block');\r\n            if (util.hasClass(wysiwyg, 'se-show-block')) {\r\n                util.addClass(this._styleCommandMap.showBlocks, 'active');\r\n            } else {\r\n                util.removeClass(this._styleCommandMap.showBlocks, 'active');\r\n            }\r\n            this._resourcesStateChange();\r\n        },\r\n\r\n        /**\r\n         * @description Changes to code view or wysiwyg view\r\n         */\r\n        toggleCodeView: function () {\r\n            const isCodeView = this._variable.isCodeView;\r\n            this.controllersOff();\r\n            util.setDisabledButtons(!isCodeView, this.codeViewDisabledButtons);\r\n\r\n            if (isCodeView) {\r\n                if (!util.isNonEditable(context.element.wysiwygFrame)) this._setCodeDataToEditor();\r\n                context.element.wysiwygFrame.scrollTop = 0;\r\n                context.element.code.style.display = 'none';\r\n                context.element.wysiwygFrame.style.display = 'block';\r\n\r\n                this._variable._codeOriginCssText = this._variable._codeOriginCssText.replace(/(\\s?display(\\s+)?:(\\s+)?)[a-zA-Z]+(?=;)/, 'display: none');\r\n                this._variable._wysiwygOriginCssText = this._variable._wysiwygOriginCssText.replace(/(\\s?display(\\s+)?:(\\s+)?)[a-zA-Z]+(?=;)/, 'display: block');\r\n\r\n                if (options.height === 'auto' && !options.codeMirrorEditor) context.element.code.style.height = '0px';\r\n                \r\n                this._variable.isCodeView = false;\r\n                \r\n                if (!this._variable.isFullScreen) {\r\n                    this._notHideToolbar = false;\r\n                    if (/balloon|balloon-always/i.test(options.mode)) {\r\n                        context.element._arrow.style.display = '';\r\n                        this._isInline = false;\r\n                        this._isBalloon = true;\r\n                        event._hideToolbar();    \r\n                    }\r\n                }\r\n\r\n                this.nativeFocus();\r\n                util.removeClass(this._styleCommandMap.codeView, 'active');\r\n\r\n                // history stack\r\n                if (!util.isNonEditable(context.element.wysiwygFrame)) {\r\n                    this.history.push(false);\r\n                    this.history._resetCachingButton();\r\n                }\r\n            } else {\r\n                this._setEditorDataToCodeView();\r\n                this._variable._codeOriginCssText = this._variable._codeOriginCssText.replace(/(\\s?display(\\s+)?:(\\s+)?)[a-zA-Z]+(?=;)/, 'display: block');\r\n                this._variable._wysiwygOriginCssText = this._variable._wysiwygOriginCssText.replace(/(\\s?display(\\s+)?:(\\s+)?)[a-zA-Z]+(?=;)/, 'display: none');\r\n\r\n                if (this._variable.isFullScreen) context.element.code.style.height = '100%';\r\n                else if (options.height === 'auto' && !options.codeMirrorEditor) context.element.code.style.height = context.element.code.scrollHeight > 0 ? (context.element.code.scrollHeight + 'px') : 'auto';\r\n                \r\n                if (options.codeMirrorEditor) options.codeMirrorEditor.refresh();\r\n                \r\n                this._variable.isCodeView = true;\r\n\r\n                if (!this._variable.isFullScreen) {\r\n                    this._notHideToolbar = true;\r\n                    if (this._isBalloon) {\r\n                        context.element._arrow.style.display = 'none';\r\n                        context.element.toolbar.style.left = '';\r\n                        this._isInline = true;\r\n                        this._isBalloon = false;\r\n                        event._showToolbarInline();\r\n                    }\r\n                }\r\n                \r\n                this._variable._range = null;\r\n                context.element.code.focus();\r\n                util.addClass(this._styleCommandMap.codeView, 'active');\r\n            }\r\n\r\n            this._checkPlaceholder();\r\n            if (this.isReadOnly) util.setDisabledButtons(true, this.resizingDisabledButtons);\r\n\r\n            // user event\r\n            if (typeof functions.toggleCodeView === 'function') functions.toggleCodeView(this._variable.isCodeView, this);\r\n        },\r\n\r\n        /**\r\n         * @description Convert the data of the code view and put it in the WYSIWYG area.\r\n         * @private\r\n         */\r\n        _setCodeDataToEditor: function () {\r\n            const code_html = this._getCodeView();\r\n\r\n            if (options.fullPage) {\r\n                const parseDocument = this._parser.parseFromString(code_html, 'text/html');\r\n                const headChildren = parseDocument.head.children;\r\n\r\n                for (let i = 0, len = headChildren.length; i < len; i++) {\r\n                    if (/^script$/i.test(headChildren[i].tagName)) {\r\n                        parseDocument.head.removeChild(headChildren[i]);\r\n                        i--, len--;\r\n                    }\r\n                }\r\n\r\n                let headers = parseDocument.head.innerHTML;\r\n                if (!parseDocument.head.querySelector('link[rel=\"stylesheet\"]') || (this.options.height === 'auto' && !parseDocument.head.querySelector('style'))) {\r\n                    headers += util._setIframeCssTags(this.options);\r\n                }\r\n\r\n                this._wd.head.innerHTML = headers;\r\n                this._wd.body.innerHTML = this.convertContentsForEditor(parseDocument.body.innerHTML);\r\n\r\n                const attrs = parseDocument.body.attributes;\r\n                for (let i = 0, len = attrs.length; i < len; i++) {\r\n                    if (attrs[i].name === 'contenteditable') continue;\r\n                    this._wd.body.setAttribute(attrs[i].name, attrs[i].value);\r\n                }\r\n                if (!util.hasClass(this._wd.body, 'sun-editor-editable')) {\r\n                    const editableClasses = options._editableClass.split(' ');\r\n                    for (let i = 0; i < editableClasses.length; i++) {\r\n                        util.addClass(this._wd.body, options._editableClass[i]);\r\n                    }\r\n                }\r\n            } else {\r\n                context.element.wysiwyg.innerHTML = code_html.length > 0 ? this.convertContentsForEditor(code_html) : '<' + options.defaultTag + '><br></' + options.defaultTag + '>';\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Convert the data of the WYSIWYG area and put it in the code view area.\r\n         * @private\r\n         */\r\n        _setEditorDataToCodeView: function () {\r\n            const codeContents = this.convertHTMLForCodeView(context.element.wysiwyg, false);\r\n            let codeValue = '';\r\n\r\n            if (options.fullPage) {\r\n                const attrs = util.getAttributesToString(this._wd.body, null);\r\n                codeValue = '<!DOCTYPE html>\\n<html>\\n' + this._wd.head.outerHTML.replace(/>(?!\\n)/g, '>\\n') + '<body ' + attrs + '>\\n' + codeContents + '</body>\\n</html>';\r\n            } else {\r\n                codeValue = codeContents;\r\n            }\r\n\r\n            context.element.code.style.display = 'block';\r\n            context.element.wysiwygFrame.style.display = 'none';\r\n\r\n            this._setCodeView(codeValue);\r\n        },\r\n\r\n        /**\r\n         * @description Changes to full screen or default screen\r\n         * @param {Element|null} element full screen button\r\n         */\r\n        toggleFullScreen: function (element) {\r\n            const topArea = context.element.topArea;\r\n            const toolbar = context.element.toolbar;\r\n            const editorArea = context.element.editorArea;\r\n            const wysiwygFrame = context.element.wysiwygFrame;\r\n            const code = context.element.code;\r\n            const _var = this._variable;\r\n            this.controllersOff();\r\n            \r\n            const wasToolbarHidden = (toolbar.style.display === 'none' || (this._isInline && !this._inlineToolbarAttr.isShow));\r\n\r\n            if (!_var.isFullScreen) {\r\n                _var.isFullScreen = true;\r\n                \r\n                _var._fullScreenAttrs.inline = this._isInline;\r\n                _var._fullScreenAttrs.balloon = this._isBalloon;\r\n\r\n                if (this._isInline || this._isBalloon) {\r\n                    this._isInline = false;\r\n                    this._isBalloon = false;\r\n                }\r\n                \r\n                if (!!options.toolbarContainer) context.element.relative.insertBefore(toolbar, editorArea);\r\n\r\n                topArea.style.position = 'fixed';\r\n                topArea.style.top = '0';\r\n                topArea.style.left = '0';\r\n                topArea.style.width = '100%';\r\n                topArea.style.maxWidth = '100%';\r\n                topArea.style.height = '100%';\r\n                topArea.style.zIndex = '2147483647';\r\n\r\n                if (context.element._stickyDummy.style.display !== ('none' && '')) {\r\n                    _var._fullScreenAttrs.sticky = true;\r\n                    context.element._stickyDummy.style.display = 'none';\r\n                    util.removeClass(toolbar, 'se-toolbar-sticky');\r\n                }\r\n\r\n                _var._bodyOverflow = _d.body.style.overflow;\r\n                _d.body.style.overflow = 'hidden';\r\n\r\n                _var._editorAreaOriginCssText = editorArea.style.cssText;\r\n                _var._wysiwygOriginCssText = wysiwygFrame.style.cssText;\r\n                _var._codeOriginCssText = code.style.cssText;\r\n\r\n                editorArea.style.cssText = toolbar.style.cssText = '';\r\n                wysiwygFrame.style.cssText = (wysiwygFrame.style.cssText.match(/\\s?display(\\s+)?:(\\s+)?[a-zA-Z]+;/) || [''])[0];\r\n                code.style.cssText = (code.style.cssText.match(/\\s?display(\\s+)?:(\\s+)?[a-zA-Z]+;/) || [''])[0];\r\n                toolbar.style.width = wysiwygFrame.style.height = code.style.height = '100%';\r\n                toolbar.style.position = 'relative';\r\n                toolbar.style.display = 'block';\r\n\r\n                _var.innerHeight_fullScreen = (_w.innerHeight - toolbar.offsetHeight);\r\n                editorArea.style.height = (_var.innerHeight_fullScreen - options.fullScreenOffset) + 'px';\r\n\r\n                if (element) util.changeElement(element.firstElementChild, icons.reduction);\r\n\r\n                if (options.iframe && options.height === 'auto') {\r\n                    editorArea.style.overflow = 'auto';\r\n                    this._iframeAutoHeight();\r\n                }\r\n\r\n                context.element.topArea.style.marginTop = options.fullScreenOffset + 'px';\r\n                util.addClass(this._styleCommandMap.fullScreen, 'active');\r\n            } else {\r\n                _var.isFullScreen = false;\r\n\r\n                wysiwygFrame.style.cssText = _var._wysiwygOriginCssText;\r\n                code.style.cssText = _var._codeOriginCssText;\r\n                toolbar.style.cssText = '';\r\n                editorArea.style.cssText = _var._editorAreaOriginCssText;\r\n                topArea.style.cssText = _var._originCssText;\r\n                _d.body.style.overflow = _var._bodyOverflow;\r\n\r\n                if (options.height === 'auto' && !options.codeMirrorEditor) event._codeViewAutoHeight();\r\n\r\n                if (!!options.toolbarContainer) options.toolbarContainer.appendChild(toolbar);\r\n\r\n                if (options.stickyToolbar > -1) {\r\n                    util.removeClass(toolbar, 'se-toolbar-sticky');\r\n                }\r\n\r\n                if (_var._fullScreenAttrs.sticky && !options.toolbarContainer) {\r\n                    _var._fullScreenAttrs.sticky = false;\r\n                    context.element._stickyDummy.style.display = 'block';\r\n                    util.addClass(toolbar, \"se-toolbar-sticky\");\r\n                }\r\n\r\n                this._isInline = _var._fullScreenAttrs.inline;\r\n                this._isBalloon = _var._fullScreenAttrs.balloon;\r\n                if (this._isInline) event._showToolbarInline();\r\n                if (!!options.toolbarContainer) util.removeClass(toolbar, 'se-toolbar-balloon');\r\n\r\n                event.onScroll_window();\r\n                if (element) util.changeElement(element.firstElementChild, icons.expansion);\r\n\r\n                context.element.topArea.style.marginTop = '';\r\n                util.removeClass(this._styleCommandMap.fullScreen, 'active');\r\n            }\r\n\r\n            if (wasToolbarHidden) functions.toolbar.hide();\r\n\r\n            // user event\r\n            if (typeof functions.toggleFullScreen === 'function') functions.toggleFullScreen(this._variable.isFullScreen, this);\r\n        },\r\n\r\n        /**\r\n         * @description Prints the current contents of the editor.\r\n         */\r\n        print: function () {\r\n            const iframe = util.createElement('IFRAME');\r\n            iframe.style.display = 'none';\r\n            _d.body.appendChild(iframe);\r\n\r\n            const contentsHTML = options.printTemplate ? options.printTemplate.replace(/\\{\\{\\s*contents\\s*\\}\\}/i, this.getContents(true)) : this.getContents(true);\r\n            const printDocument = util.getIframeDocument(iframe);\r\n            const wDoc = this._wd;\r\n\r\n            if (options.iframe) {\r\n                const arrts = options._printClass !== null ? 'class=\"' + options._printClass + '\"' : options.fullPage ? util.getAttributesToString(wDoc.body, ['contenteditable']) : 'class=\"' + options._editableClass + '\"';\r\n\r\n                printDocument.write('' +\r\n                    '<!DOCTYPE html><html>' +\r\n                    '<head>' +\r\n                    wDoc.head.innerHTML +\r\n                    '</head>' +\r\n                    '<body ' + arrts + '>' + contentsHTML + '</body>' +\r\n                    '</html>'\r\n                );\r\n            } else {\r\n                const links = _d.head.getElementsByTagName('link');\r\n                const styles = _d.head.getElementsByTagName('style');\r\n                let linkHTML = '';\r\n                for (let i = 0, len = links.length; i < len; i++) {\r\n                    linkHTML += links[i].outerHTML;\r\n                }\r\n                for (let i = 0, len = styles.length; i < len; i++) {\r\n                    linkHTML += styles[i].outerHTML;\r\n                }\r\n\r\n                printDocument.write('' +\r\n                    '<!DOCTYPE html><html>' +\r\n                    '<head>' +\r\n                    linkHTML +\r\n                    '</head>' +\r\n                    '<body class=\"' + (options._printClass !== null ? options._printClass : options._editableClass) + '\">' + contentsHTML + '</body>' +\r\n                    '</html>'\r\n                );\r\n            }\r\n\r\n            this.showLoading();\r\n            _w.setTimeout(function () {\r\n                try {\r\n                    iframe.focus();\r\n                    // IE or Edge, Chromium\r\n                    if (util.isIE_Edge || util.isChromium || !!_d.documentMode || !!_w.StyleMedia) {\r\n                        try {\r\n                            iframe.contentWindow.document.execCommand('print', false, null);\r\n                        } catch (e) {\r\n                            iframe.contentWindow.print();\r\n                        }\r\n                    } else {\r\n                        // Other browsers\r\n                        iframe.contentWindow.print();\r\n                    }\r\n                } catch (error) {\r\n                    throw Error('[SUNEDITOR.core.print.fail] error: ' + error);\r\n                } finally {\r\n                    core.closeLoading();\r\n                    util.removeItem(iframe);\r\n                }\r\n            }, 1000);\r\n        },\r\n\r\n        /**\r\n         * @description Open the preview window.\r\n         */\r\n        preview: function () {\r\n            core.submenuOff();\r\n            core.containerOff();\r\n            core.controllersOff();\r\n            \r\n            const contentsHTML = options.previewTemplate ? options.previewTemplate.replace(/\\{\\{\\s*contents\\s*\\}\\}/i, this.getContents(true)) : this.getContents(true);\r\n            const windowObject = _w.open('', '_blank');\r\n            windowObject.mimeType = 'text/html';\r\n            const wDoc = this._wd;\r\n\r\n            if (options.iframe) {\r\n                const arrts = options._printClass !== null ? 'class=\"' + options._printClass + '\"' : options.fullPage ? util.getAttributesToString(wDoc.body, ['contenteditable']) : 'class=\"' + options._editableClass + '\"';\r\n\r\n                windowObject.document.write('' +\r\n                    '<!DOCTYPE html><html>' +\r\n                    '<head>' +\r\n                    wDoc.head.innerHTML +\r\n                    '<style>body {overflow:auto !important; margin: 10px auto !important; height:auto !important; outline:1px dashed #ccc;}</style>' +\r\n                    '</head>' +\r\n                    '<body ' + arrts + '>' + contentsHTML + '</body>' +\r\n                    '</html>'\r\n                );\r\n            } else {\r\n                const links = _d.head.getElementsByTagName('link');\r\n                const styles = _d.head.getElementsByTagName('style');\r\n                let linkHTML = '';\r\n                for (let i = 0, len = links.length; i < len; i++) {\r\n                    linkHTML += links[i].outerHTML;\r\n                }\r\n                for (let i = 0, len = styles.length; i < len; i++) {\r\n                    linkHTML += styles[i].outerHTML;\r\n                }\r\n                \r\n                windowObject.document.write('' +\r\n                    '<!DOCTYPE html><html>' +\r\n                    '<head>' +\r\n                    '<meta charset=\"utf-8\" />' +\r\n                    '<meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">' +\r\n                    '<title>' + lang.toolbar.preview + '</title>' +\r\n                    linkHTML +\r\n                    '</head>' +\r\n                    '<body class=\"' + (options._printClass !== null ? options._printClass : options._editableClass) + '\" style=\"margin:10px auto !important; height:auto !important; outline:1px dashed #ccc;\">' + contentsHTML + '</body>' +\r\n                    '</html>'\r\n                );\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Set direction to \"rtl\" or \"ltr\".\r\n         * @param {String} dir \"rtl\" or \"ltr\"\r\n         */\r\n        setDir: function (dir) {\r\n            const rtl = dir === 'rtl';\r\n            const changeDir = this._prevRtl !== rtl;\r\n            this._prevRtl = options.rtl = rtl;\r\n\r\n            if (changeDir) {\r\n                // align buttons\r\n                if (this.plugins.align) {\r\n                    this.plugins.align.exchangeDir.call(this);\r\n                }\r\n                // indent buttons\r\n                if (context.tool.indent) util.changeElement(context.tool.indent.firstElementChild, icons.indent);\r\n                if (context.tool.outdent) util.changeElement(context.tool.outdent.firstElementChild, icons.outdent);\r\n            }\r\n\r\n            const el = context.element;\r\n            if (rtl) {\r\n                util.addClass(el.topArea, 'se-rtl');\r\n                util.addClass(el.wysiwygFrame, 'se-rtl');\r\n            } else {\r\n                util.removeClass(el.topArea, 'se-rtl');\r\n                util.removeClass(el.wysiwygFrame, 'se-rtl');\r\n            }\r\n\r\n            const lineNodes = util.getListChildren(el.wysiwyg, function (current) {\r\n                return util.isFormatElement(current) && (current.style.marginRight || current.style.marginLeft || current.style.textAlign);\r\n            });\r\n\r\n            for (let i = 0, len = lineNodes.length, n, l, r; i < len; i++) {\r\n                n = lineNodes[i];\r\n                // indent margin\r\n                r = n.style.marginRight;\r\n                l = n.style.marginLeft;\r\n                if (r || l) {\r\n                    n.style.marginRight = l;\r\n                    n.style.marginLeft = r;\r\n                }\r\n                // text align\r\n                r = n.style.textAlign;\r\n                if (r === 'left') n.style.textAlign = 'right';\r\n                else if (r === 'right') n.style.textAlign = 'left';\r\n            }\r\n\r\n            const tool = context.tool;\r\n            if (tool.dir) {\r\n                util.changeTxt(tool.dir.querySelector('.se-tooltip-text'), lang.toolbar[options.rtl ? 'dir_ltr' : 'dir_rtl']);\r\n                util.changeElement(tool.dir.firstElementChild, icons[options.rtl ? 'dir_ltr' : 'dir_rtl']);\r\n            }\r\n\r\n            if (tool.dir_ltr) {\r\n                if (rtl) util.removeClass(tool.dir_ltr, 'active');\r\n                else util.addClass(tool.dir_ltr, 'active');\r\n            }\r\n\r\n            if (tool.dir_rtl) {\r\n                if (rtl) util.addClass(tool.dir_rtl, 'active');\r\n                else util.removeClass(tool.dir_rtl, 'active');\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Sets the HTML string\r\n         * @param {String|undefined} html HTML string\r\n         */\r\n        setContents: function (html) {\r\n            this.removeRange();\r\n            \r\n            const convertValue = (html === null || html === undefined) ? '' : this.convertContentsForEditor(html);\r\n            this._resetComponents();\r\n\r\n            if (!this._variable.isCodeView) {\r\n                context.element.wysiwyg.innerHTML = convertValue;\r\n                // history stack\r\n                this.history.push(false);\r\n            } else {\r\n                const value = this.convertHTMLForCodeView(convertValue, false);\r\n                this._setCodeView(value);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Sets the contents of the iframe's head tag and body tag when using the \"iframe\" or \"fullPage\" option.\r\n         * @param {Object} ctx { head: HTML string, body: HTML string}\r\n         */\r\n        setIframeContents: function (ctx) {\r\n            if (!options.iframe) return false;\r\n            if (ctx.head) this._wd.head.innerHTML = ctx.head.replace(/<script[\\s\\S]*>[\\s\\S]*<\\/script>/gi, '');\r\n            if (ctx.body) this._wd.body.innerHTML = this.convertContentsForEditor(ctx.body);\r\n        },\r\n\r\n        /**\r\n         * @description Gets the current contents\r\n         * @param {Boolean} onlyContents Return only the contents of the body without headers when the \"fullPage\" option is true\r\n         * @returns {Object}\r\n         */\r\n        getContents: function (onlyContents) {\r\n            const contents = this.convertHTMLForCodeView(context.element.wysiwyg, true);\r\n            const renderHTML = util.createElement('DIV');\r\n            renderHTML.innerHTML = contents;\r\n\r\n            const figcaptions = util.getListChildren(renderHTML, function (current) {\r\n                return /FIGCAPTION/i.test(current.nodeName);\r\n            });\r\n\r\n            for (let i = 0, len = figcaptions.length; i < len; i++) {\r\n                figcaptions[i].removeAttribute('contenteditable');\r\n            }\r\n\r\n            if (options.fullPage && !onlyContents) {\r\n                const attrs = util.getAttributesToString(this._wd.body, ['contenteditable']);\r\n                return '<!DOCTYPE html><html>' + this._wd.head.outerHTML + '<body ' + attrs + '>' + renderHTML.innerHTML + '</body></html>';\r\n            } else {\r\n                return renderHTML.innerHTML;\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Gets the current contents with containing parent div(div.sun-editor-editable).\r\n         * <div class=\"sun-editor-editable\">{contents}</div>\r\n         * @param {Boolean} onlyContents Return only the contents of the body without headers when the \"fullPage\" option is true\r\n         * @returns {String}\r\n         */\r\n        getFullContents: function (onlyContents) {\r\n            return '<div class=\"sun-editor-editable' + (options.rtl ? ' se-rtl' : '') + '\">' + this.getContents(onlyContents) + '</div>';\r\n        },\r\n\r\n        /**\r\n         * @description Returns HTML string according to tag type and configuration.\r\n         * Use only \"cleanHTML\"\r\n         * @param {Node} node Node\r\n         * @param {Boolean} requireFormat If true, text nodes that do not have a format node is wrapped with the format tag.\r\n         * @private\r\n         */\r\n        _makeLine: function (node, requireFormat) {\r\n            const defaultTag = options.defaultTag;\r\n            // element\r\n            if (node.nodeType === 1) {\r\n                if (util._disallowedTags(node)) return '';\r\n\r\n                const ch = util.getListChildNodes(node, function(current) { return util.isSpanWithoutAttr(current); }) || [];\r\n                for (let i = ch.length - 1; i >= 0; i--) {\r\n                    ch[i].outerHTML = ch[i].innerHTML;\r\n                }\r\n\r\n                if (!requireFormat || (util.isFormatElement(node) || util.isRangeFormatElement(node) || util.isComponent(node) || util.isMedia(node) || (util.isAnchor(node) && util.isMedia(node.firstElementChild)))) {\r\n                    return util.isSpanWithoutAttr(node) ? node.innerHTML : node.outerHTML;\r\n                } else {\r\n                    return '<' + defaultTag + '>' + (util.isSpanWithoutAttr(node) ? node.innerHTML : node.outerHTML) + '</' + defaultTag + '>';\r\n                }\r\n            }\r\n            // text\r\n            if (node.nodeType === 3) {\r\n                if (!requireFormat) return util._HTMLConvertor(node.textContent);\r\n                const textArray = node.textContent.split(/\\n/g);\r\n                let html = '';\r\n                for (let i = 0, tLen = textArray.length, text; i < tLen; i++) {\r\n                    text = textArray[i].trim();\r\n                    if (text.length > 0) html += '<' + defaultTag + '>' + util._HTMLConvertor(text) + '</' + defaultTag + '>';\r\n                }\r\n                return html;\r\n            }\r\n            // comments\r\n            if (node.nodeType === 8 && this._allowHTMLComments) {\r\n                return '<!--' + node.textContent.trim() + '-->';\r\n            }\r\n\r\n            return '';\r\n        },\r\n\r\n        /**\r\n         * @description Removes attribute values such as style and converts tags that do not conform to the \"html5\" standard.\r\n         * @param {String} text \r\n         * @returns {String} HTML string\r\n         * @private\r\n         */\r\n        _tagConvertor: function (text) {\r\n            if (!this._disallowedTextTagsRegExp) return text;\r\n\r\n            const ec = options._textTagsMap;\r\n            return text.replace(this._disallowedTextTagsRegExp, function (m, t, n, p) {\r\n                return t + (typeof ec[n] === 'string' ? ec[n] : n) + (p ? ' ' + p : '');\r\n            });\r\n        },\r\n\r\n        /**\r\n         * @description Delete disallowed tags\r\n         * @param {String} html HTML string\r\n         * @returns {String}\r\n         * @private\r\n         */\r\n        _deleteDisallowedTags: function (html) {\r\n            return html\r\n                .replace(/\\n/g, '')\r\n                .replace(/<(script|style)[\\s\\S]*>[\\s\\S]*<\\/(script|style)>/gi, '')\r\n                .replace(/<[a-z0-9]+\\:[a-z0-9]+[^>^\\/]*>[^>]*<\\/[a-z0-9]+\\:[a-z0-9]+>/gi, '')\r\n                .replace(this.editorTagsWhitelistRegExp, '')\r\n                .replace(this.editorTagsBlacklistRegExp, '');\r\n        },\r\n\r\n        _cleanStyle: function (m, v, name) {\r\n            const sv = m.match(/style\\s*=\\s*(?:\"|')[^\"']*(?:\"|')/);\r\n            if (sv) {\r\n                if (!v) v = [];\r\n                const style = sv[0].replace(/&quot;/g, '').match(this._cleanStyleRegExp[name]);\r\n                if (style) {\r\n                    const allowedStyle = [];\r\n                    for (let i = 0, len = style.length, r; i < len; i++) {\r\n                        r = style[i].match(/(.+)(:)([^:]+$)/);\r\n                        if (r && !/inherit|initial/i.test(r[3])) {\r\n                            const k = util.kebabToCamelCase(r[1].trim());\r\n                            const v = this.wwComputedStyle[k].replace(/\"/g, '');\r\n                            const c = r[3].trim();\r\n                            switch (k) {\r\n                                case 'fontFamily':\r\n                                    if (!options.plugins.font || options.font.indexOf(c) === -1) continue;\r\n                                    break;\r\n                                case 'fontSize':\r\n                                    if (!options.plugins.fontSize) continue;\r\n                                    break;\r\n                                case 'color':\r\n                                    if (!options.plugins.fontColor || /rgba\\(([0-9]+\\s*,\\s*){3}0\\)|windowtext/i.test(c)) continue;\r\n                                    break;\r\n                                case 'backgroundColor':\r\n                                    if (!options.plugins.hiliteColor || /rgba\\(([0-9]+\\s*,\\s*){3}0\\)|windowtext/i.test(c)) continue;\r\n                                    break;\r\n                            }\r\n                            \r\n                            if (v !== c) {\r\n                                allowedStyle.push(r[0]);\r\n                            }\r\n                        }\r\n                    }\r\n                    if (allowedStyle.length > 0) v.push('style=\"' + allowedStyle.join(';') + '\"');\r\n                }\r\n            }\r\n\r\n            return v;\r\n        },\r\n\r\n        /**\r\n         * @description Tag and tag attribute check RegExp function. (used by \"cleanHTML\" and \"convertContentsForEditor\")\r\n         * @param {Boolean} lowLevelCheck Row level check\r\n         * @param {String} m RegExp value\r\n         * @param {String} t RegExp value\r\n         * @returns {String}\r\n         * @private\r\n         */\r\n        _cleanTags: function (lowLevelCheck, m, t) {\r\n            if (/^<[a-z0-9]+\\:[a-z0-9]+/i.test(m)) return m;\r\n\r\n            let v = null;\r\n            const tagName = t.match(/(?!<)[a-zA-Z0-9\\-]+/)[0].toLowerCase();\r\n\r\n            // blacklist\r\n            const bAttr = this._attributesTagsBlacklist[tagName];\r\n            m = m.replace(/\\s(?:on[a-z]+)\\s*=\\s*(\")[^\"]*\\1/ig, '');\r\n            if (bAttr) m = m.replace(bAttr, '');\r\n            else m = m.replace(this._attributesBlacklistRegExp, '');\r\n\r\n            // whitelist\r\n            const wAttr = this._attributesTagsWhitelist[tagName];\r\n            if (wAttr) v = m.match(wAttr);\r\n            else v = m.match(lowLevelCheck ? this._attributesWhitelistRegExp : this._attributesWhitelistRegExp_all_data);\r\n\r\n            // attribute\r\n            if (lowLevelCheck) {\r\n                if (tagName === 'a') {\r\n                    const sv = m.match(/(?:(?:id|name)\\s*=\\s*(?:\"|')[^\"']*(?:\"|'))/g);\r\n                    if (sv) {\r\n                        if (!v) v = [];\r\n                        v.push(sv[0]);\r\n                    }\r\n                } else if (!v || !/style=/i.test(v.toString())) {\r\n                    if (tagName === 'span') {\r\n                        v = this._cleanStyle(m, v, 'span');\r\n                    } else if (/^(P|DIV|H[1-6]|PRE)$/i.test(tagName)) {\r\n                        v = this._cleanStyle(m, v, 'format');\r\n                    }\r\n                }\r\n            } else {\r\n                const sv = m.match(/style\\s*=\\s*(?:\"|')[^\"']*(?:\"|')/);\r\n                if (sv && !v) v = [sv[0]];\r\n                else if (sv && !v.some(function (v) { return /^style/.test(v.trim()); })) v.push(sv[0]);\r\n            }\r\n\r\n            // img\r\n            if (tagName === 'img') {\r\n                let w = '', h = '';\r\n                const sv = m.match(/style\\s*=\\s*(?:\"|')[^\"']*(?:\"|')/);\r\n                if (!v) v = [];\r\n                if (sv) {\r\n                    w = sv[0].match(/width:(.+);/);\r\n                    w = util.getNumber(w ? w[1] : '', -1) || '';\r\n                    h = sv[0].match(/height:(.+);/);\r\n                    h = util.getNumber(h ? h[1] : '', -1) || '';\r\n                } \r\n                \r\n                if (!w || !h) {\r\n                    const avw = m.match(/width\\s*=\\s*((?:\"|')[^\"']*(?:\"|'))/);\r\n                    const avh = m.match(/height\\s*=\\s*((?:\"|')[^\"']*(?:\"|'))/);\r\n                    if (avw || avh) {\r\n                        w = !w ? util.getNumber(avw ? avw[1] : '') || '' : w;\r\n                        h = !h ? util.getNumber(avh ? avh[1] : '') || '' : h;\r\n                    }\r\n                }\r\n                v.push('data-origin=\"' + (w + ',' + h) + '\"');\r\n            }\r\n\r\n            if (v) {\r\n                for (let i = 0, len = v.length; i < len; i++) {\r\n                    if (lowLevelCheck && /^class=\"(?!(__se__|se-|katex))/.test(v[i].trim())) continue;\r\n                    t += ' ' + (/^(?:href|src)\\s*=\\s*('|\"|\\s)*javascript\\s*\\:/i.test(v[i].trim()) ? '' : v[i]);\r\n                }\r\n            }\r\n\r\n            return t;\r\n        },\r\n\r\n        /**\r\n         * @description Determines if formatting is required and returns a domTree\r\n         * @param {Element} dom documentFragment\r\n         * @returns {Element}\r\n         * @private\r\n         */\r\n        _editFormat: function (dom) {\r\n            let value = '', f;\r\n            const tempTree = dom.childNodes;\r\n            for (let i = 0, len = tempTree.length, n; i < len; i++) {\r\n                n = tempTree[i];\r\n                if (!util.isFormatElement(n) && !util.isRangeFormatElement(n) && !util.isComponent(n) && !/meta/i.test(n.nodeName)) {\r\n                    if (!f) f = util.createElement(options.defaultTag);\r\n                    f.appendChild(n);\r\n                    i--; len--;\r\n                } else {\r\n                    if (f) {\r\n                        value += f.outerHTML;\r\n                        f = null;\r\n                    }\r\n                    value += n.outerHTML;\r\n                }\r\n            }\r\n\r\n            if (f) value += f.outerHTML;\r\n\r\n            return _d.createRange().createContextualFragment(value);\r\n        },\r\n\r\n        _convertListCell: function (domTree) {\r\n            let html = '';\r\n\r\n            for (let i = 0, len = domTree.length, node; i < len; i++) {\r\n                node = domTree[i];\r\n                if (node.nodeType === 1) {\r\n                    if (util.isList(node)) {\r\n                        html += node.innerHTML;\r\n                    } else if (util.isListCell(node)) {\r\n                        html += node.outerHTML;\r\n                    } else if (util.isFormatElement(node)) {\r\n                        html += '<li>' +(node.innerHTML.trim() || '<br>') + '</li>';\r\n                    } else if (util.isRangeFormatElement(node) && !util.isTable(node)) {\r\n                        html += this._convertListCell(node);\r\n                    } else {\r\n                        html += '<li>' + node.outerHTML + '</li>';\r\n                    }\r\n                } else {\r\n                    html += '<li>' + (node.textContent || '<br>') + '</li>';\r\n                }\r\n            }\r\n\r\n            return html;\r\n        },\r\n\r\n        _isFormatData: function (domTree) {\r\n            let requireFormat = false;\r\n\r\n            for (let i = 0, len = domTree.length, t; i < len; i++) {\r\n                t = domTree[i];\r\n                if (t.nodeType === 1 && !util.isTextStyleElement(t) && !util.isBreak(t) && !util._disallowedTags(t)) {\r\n                    requireFormat = true;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            return requireFormat;\r\n        },\r\n\r\n        /**\r\n         * @description Gets the clean HTML code for editor\r\n         * @param {String} html HTML string\r\n         * @param {String|RegExp|null} whitelist Regular expression of allowed tags.\r\n         * RegExp object is create by util.createTagsWhitelist method. (core.pasteTagsWhitelistRegExp)\r\n         * @param {String|RegExp|null} blacklist Regular expression of disallowed tags.\r\n         * RegExp object is create by util.createTagsBlacklist method. (core.pasteTagsBlacklistRegExp)\r\n         * @returns {String}\r\n         */\r\n        cleanHTML: function (html, whitelist, blacklist) {\r\n            html = this._deleteDisallowedTags(this._parser.parseFromString(html, 'text/html').body.innerHTML).replace(/(<[a-zA-Z0-9\\-]+)[^>]*(?=>)/g, this._cleanTags.bind(this, true)).replace(/^.+\\x3C!--StartFragment--\\>|\\x3C!--EndFragment-->.+$/g, '');\r\n\r\n            const dom = _d.createRange().createContextualFragment(html);\r\n            try {\r\n                util._consistencyCheckOfHTML(dom, this._htmlCheckWhitelistRegExp, this._htmlCheckBlacklistRegExp, true);\r\n            } catch (error) {\r\n                console.warn('[SUNEDITOR.cleanHTML.consistencyCheck.fail] ' + error);\r\n            }\r\n            \r\n            if (this.managedTagsInfo && this.managedTagsInfo.query) {\r\n                const textCompList = dom.querySelectorAll(this.managedTagsInfo.query);\r\n                for (let i = 0, len = textCompList.length, initMethod, classList; i < len; i++) {\r\n                    classList = [].slice.call(textCompList[i].classList);\r\n                    for (let c = 0, cLen = classList.length; c < cLen; c++) {\r\n                        initMethod = this.managedTagsInfo.map[classList[c]];\r\n                        if (initMethod) {\r\n                            initMethod(textCompList[i]);\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            let domTree = dom.childNodes;\r\n            let cleanHTML = '';\r\n            const requireFormat = this._isFormatData(domTree);\r\n\r\n            if(requireFormat) {\r\n                domTree = this._editFormat(dom).childNodes;\r\n            }\r\n\r\n            for (let i = 0, len = domTree.length; i < len; i++) {\r\n                cleanHTML += this._makeLine(domTree[i], requireFormat);\r\n            }\r\n\r\n            cleanHTML = util.htmlRemoveWhiteSpace(cleanHTML);\r\n            if (!cleanHTML) {\r\n                cleanHTML = html;\r\n            } else {\r\n                if (whitelist) cleanHTML = cleanHTML.replace(typeof whitelist === 'string' ? util.createTagsWhitelist(whitelist) : whitelist, '');\r\n                if (blacklist) cleanHTML = cleanHTML.replace(typeof blacklist === 'string' ? util.createTagsBlacklist(blacklist) : blacklist, '');\r\n            }\r\n\r\n            return this._tagConvertor(cleanHTML);\r\n        },\r\n\r\n        /**\r\n         * @description Converts contents into a format that can be placed in an editor\r\n         * @param {String} contents contents\r\n         * @returns {String}\r\n         */\r\n        convertContentsForEditor: function (contents) {\r\n            contents = this._deleteDisallowedTags(this._parser.parseFromString(contents, 'text/html').body.innerHTML).replace(/(<[a-zA-Z0-9\\-]+)[^>]*(?=>)/g, this._cleanTags.bind(this, false));\r\n            const dom = _d.createRange().createContextualFragment(contents);\r\n\r\n            try {\r\n                util._consistencyCheckOfHTML(dom, this._htmlCheckWhitelistRegExp, this._htmlCheckBlacklistRegExp, false);\r\n            } catch (error) {\r\n                console.warn('[SUNEDITOR.convertContentsForEditor.consistencyCheck.fail] ' + error);\r\n            }\r\n\r\n            if (this.managedTagsInfo && this.managedTagsInfo.query) {\r\n                const textCompList = dom.querySelectorAll(this.managedTagsInfo.query);\r\n                for (let i = 0, len = textCompList.length, initMethod, classList; i < len; i++) {\r\n                    classList = [].slice.call(textCompList[i].classList);\r\n                    for (let c = 0, cLen = classList.length; c < cLen; c++) {\r\n                        initMethod = this.managedTagsInfo.map[classList[c]];\r\n                        if (initMethod) {\r\n                            initMethod(textCompList[i]);\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            \r\n            const domTree = dom.childNodes;\r\n            let cleanHTML = '', p = null;\r\n            for (let i = 0, t; i < domTree.length; i++) {\r\n                t = domTree[i];\r\n\r\n                if (!util.isFormatElement(t) && !util.isRangeFormatElement(t) && !util.isComponent(t) && !util.isMedia(t) && t.nodeType !== 8) {\r\n                    if (!p) p = util.createElement(options.defaultTag);\r\n                    p.appendChild(t);\r\n                    i--;\r\n                    if (domTree[i + 1] && !util.isFormatElement(domTree[i + 1])) {\r\n                        continue;\r\n                    } else {\r\n                        t = p;\r\n                        p = null;\r\n                    }\r\n                }\r\n\r\n                if (p) {\r\n                    cleanHTML += this._makeLine(p, true);\r\n                    p = null;\r\n                }\r\n                cleanHTML += this._makeLine(t, true);\r\n            }\r\n            if (p) cleanHTML += this._makeLine(p, true);\r\n\r\n            if (cleanHTML.length === 0) return '<' + options.defaultTag + '><br></' + options.defaultTag + '>';\r\n\r\n            cleanHTML = util.htmlRemoveWhiteSpace(cleanHTML);\r\n            return this._tagConvertor(cleanHTML);\r\n        },\r\n\r\n        /**\r\n         * @description Converts wysiwyg area element into a format that can be placed in an editor of code view mode\r\n         * @param {Element|String} html WYSIWYG element (context.element.wysiwyg) or HTML string.\r\n         * @param {Boolean} comp If true, does not line break and indentation of tags.\r\n         * @returns {String}\r\n         */\r\n        convertHTMLForCodeView: function (html, comp) {\r\n            let returnHTML = '';\r\n            const wRegExp = _w.RegExp;\r\n            const brReg = new wRegExp('^(BLOCKQUOTE|PRE|TABLE|THEAD|TBODY|TR|TH|TD|OL|UL|IMG|IFRAME|VIDEO|AUDIO|FIGURE|FIGCAPTION|HR|BR|CANVAS|SELECT)$', 'i');\r\n            const wDoc = typeof html === 'string' ? _d.createRange().createContextualFragment(html) : html;\r\n            const isFormat = function (current) { return this.isFormatElement(current) || this.isComponent(current); }.bind(util);\r\n            const brChar = comp ? '' : '\\n';\r\n\r\n            let indentSize = comp ? 0 : this._variable.codeIndent * 1;\r\n            indentSize = indentSize > 0 ? new _w.Array(indentSize + 1).join(' ') : '';\r\n\r\n            (function recursionFunc (element, indent) {\r\n                const children = element.childNodes;\r\n                const elementRegTest = brReg.test(element.nodeName);\r\n                const elementIndent = (elementRegTest ? indent : '');\r\n\r\n                for (let i = 0, len = children.length, node, br, lineBR, nodeRegTest, tag, tagIndent; i < len; i++) {\r\n                    node = children[i];\r\n                    nodeRegTest = brReg.test(node.nodeName);\r\n                    br = nodeRegTest ? brChar : '';\r\n                    lineBR = isFormat(node) && !elementRegTest && !/^(TH|TD)$/i.test(element.nodeName) ? brChar : '';\r\n\r\n                    if (node.nodeType === 8) {\r\n                        returnHTML += '\\n<!-- ' + node.textContent.trim() + ' -->' + br;\r\n                        continue;\r\n                    }\r\n                    if (node.nodeType === 3) {\r\n                        if (!util.isList(node.parentElement)) returnHTML += util._HTMLConvertor(/^\\n+$/.test(node.data) ? '' : node.data);\r\n                        continue;\r\n                    }\r\n                    if (node.childNodes.length === 0) {\r\n                        returnHTML += (/^HR$/i.test(node.nodeName) ? brChar : '') + (/^PRE$/i.test(node.parentElement.nodeName) && /^BR$/i.test(node.nodeName) ? '' : elementIndent) + node.outerHTML + br;\r\n                        continue;\r\n                    }\r\n\r\n                    if (!node.outerHTML) { // IE\r\n                        returnHTML += new _w.XMLSerializer().serializeToString(node);\r\n                    } else {\r\n                        tag = node.nodeName.toLowerCase();\r\n                        tagIndent = elementIndent || nodeRegTest ? indent : '';\r\n                        returnHTML += (lineBR || (elementRegTest ? '' : br)) + tagIndent + node.outerHTML.match(wRegExp('<' + tag + '[^>]*>', 'i'))[0] + br;\r\n                        recursionFunc(node, indent + indentSize, '');\r\n                        returnHTML += (/\\n$/.test(returnHTML) ? tagIndent : '') + '</' + tag + '>' + (lineBR || br || elementRegTest ? brChar : '' || /^(TH|TD)$/i.test(node.nodeName) ? brChar : '');\r\n                    }\r\n                }\r\n            }(wDoc, ''));\r\n\r\n            return returnHTML.trim() + brChar;\r\n        },\r\n\r\n        /**\r\n         * @description Add an event to document.\r\n         * When created as an Iframe, the same event is added to the document in the Iframe.\r\n         * @param {String} type Event type\r\n         * @param {Function} listener Event listener\r\n         * @param {Boolean} useCapture Use event capture\r\n         */\r\n        addDocEvent: function (type, listener, useCapture) {\r\n            _d.addEventListener(type, listener, useCapture);\r\n            if (options.iframe) {\r\n                this._wd.addEventListener(type, listener);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Remove events from document.\r\n        * When created as an Iframe, the event of the document inside the Iframe is also removed.\r\n         * @param {String} type Event type\r\n         * @param {Function} listener Event listener\r\n         */\r\n        removeDocEvent: function (type, listener) {\r\n            _d.removeEventListener(type, listener);\r\n            if (options.iframe) {\r\n                this._wd.removeEventListener(type, listener);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description The current number of characters is counted and displayed.\r\n         * @param {String} inputText Text added.\r\n         * @returns {Boolean}\r\n         * @private\r\n         */\r\n        _charCount: function (inputText) {\r\n            const maxCharCount = options.maxCharCount;\r\n            const countType = options.charCounterType;\r\n            let nextCharCount = 0;\r\n            if (!!inputText) nextCharCount = this.getCharLength(inputText, countType);\r\n\r\n            this._setCharCount();\r\n\r\n            if (maxCharCount > 0) {\r\n                let over = false;\r\n                const count = functions.getCharCount(countType);\r\n                \r\n                if (count > maxCharCount) {\r\n                    over = true;\r\n                    if (nextCharCount > 0) {\r\n                        this._editorRange();\r\n                        const range = this.getRange();\r\n                        const endOff = range.endOffset - 1;\r\n                        const text = this.getSelectionNode().textContent;\r\n                        const slicePosition = range.endOffset - (count - maxCharCount);\r\n    \r\n                        this.getSelectionNode().textContent = text.slice(0, slicePosition < 0 ? 0 : slicePosition) + text.slice(range.endOffset, text.length);\r\n                        this.setRange(range.endContainer, endOff, range.endContainer, endOff);\r\n                    }\r\n                } else if ((count + nextCharCount) > maxCharCount) {\r\n                    over = true;\r\n                }\r\n\r\n                if (over) {\r\n                    this._callCounterBlink();\r\n                    if (nextCharCount > 0) return false;\r\n                }\r\n            }\r\n\r\n            return true;\r\n        },\r\n\r\n        /**\r\n         * @description When \"element\" is added, if it is greater than \"options.maxCharCount\", false is returned.\r\n         * @param {Node|String} element Element node or String.\r\n         * @param {String|null} charCounterType charCounterType. If it is null, the options.charCounterType\r\n         * @returns {Boolean}\r\n         */\r\n        checkCharCount: function (element, charCounterType) {\r\n            if (options.maxCharCount) {\r\n                const countType = charCounterType || options.charCounterType;\r\n                const length = this.getCharLength((typeof element === 'string' ? element : (this._charTypeHTML && element.nodeType === 1) ? element.outerHTML : element.textContent), countType);\r\n                if (length > 0 && length + functions.getCharCount(countType) > options.maxCharCount) {\r\n                    this._callCounterBlink();\r\n                    return false;\r\n                }\r\n            }\r\n            return true;\r\n        },\r\n\r\n        /**\r\n         * @description Get the length of the content.\r\n         * Depending on the option, the length of the character is taken. (charCounterType)\r\n         * @param {String} content Content to count\r\n         * @param {String} charCounterType options.charCounterType\r\n         * @returns {Number}\r\n         */\r\n        getCharLength: function (content, charCounterType) {\r\n            return /byte/.test(charCounterType) ? util.getByteLength(content) : content.length;\r\n        },\r\n\r\n        /**\r\n         * @description Reset buttons of the responsive toolbar.\r\n         */\r\n        resetResponsiveToolbar: function () {\r\n            core.controllersOff();\r\n\r\n            const responsiveSize = event._responsiveButtonSize;\r\n            if (responsiveSize) {\r\n                let w = 0;\r\n                if ((core._isBalloon || core._isInline) && options.toolbarWidth === 'auto') {\r\n                    w = context.element.topArea.offsetWidth;\r\n                } else {\r\n                    w = context.element.toolbar.offsetWidth;\r\n                }\r\n\r\n                let responsiveWidth = 'default';\r\n                for (let i = 1, len = responsiveSize.length; i < len; i++) {\r\n                    if (w < responsiveSize[i]) {\r\n                        responsiveWidth = responsiveSize[i] + '';\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                if (event._responsiveCurrentSize !== responsiveWidth) {\r\n                    event._responsiveCurrentSize = responsiveWidth;\r\n                    functions.setToolbarButtons(event._responsiveButtons[responsiveWidth]);\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Set the char count to charCounter element textContent.\r\n         * @private\r\n         */\r\n        _setCharCount: function () {\r\n            if (context.element.charCounter) {\r\n                _w.setTimeout(function () { context.element.charCounter.textContent = functions.getCharCount(options.charCounterType); });\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description The character counter blinks.\r\n         * @private\r\n         */\r\n        _callCounterBlink: function () {\r\n            const charWrapper = context.element.charWrapper;\r\n            if (charWrapper && !util.hasClass(charWrapper, 'se-blink')) {\r\n                util.addClass(charWrapper, 'se-blink');\r\n                _w.setTimeout(function () {\r\n                    util.removeClass(charWrapper, 'se-blink');\r\n                }, 600);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Check the components such as image and video and modify them according to the format.\r\n         * @private\r\n         */\r\n        _checkComponents: function () {\r\n            for (let i = 0, len = this._fileInfoPluginsCheck.length; i < len; i++) {\r\n                this._fileInfoPluginsCheck[i]();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Initialize the information of the components.\r\n         * @private\r\n         */\r\n        _resetComponents: function () {\r\n            for (let i = 0, len = this._fileInfoPluginsReset.length; i < len; i++) {\r\n                this._fileInfoPluginsReset[i]();\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Set method in the code view area\r\n         * @param {String} value HTML string\r\n         * @private\r\n         */\r\n        _setCodeView: function (value) {\r\n            if (options.codeMirrorEditor) {\r\n                options.codeMirrorEditor.getDoc().setValue(value);\r\n            } else {\r\n                context.element.code.value = value;\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Get method in the code view area\r\n         * @private\r\n         */\r\n        _getCodeView: function () {\r\n            return options.codeMirrorEditor ? options.codeMirrorEditor.getDoc().getValue() : context.element.code.value;\r\n        },\r\n\r\n        /**\r\n         * @description remove class, display text.\r\n         * @param {Array|null} ignoredList Igonred button list\r\n         */\r\n        _setKeyEffect: function (ignoredList) {\r\n            const commandMap = this.commandMap;\r\n            const activePlugins = this.activePlugins;\r\n\r\n            for (let key in commandMap) {\r\n                if (ignoredList.indexOf(key) > -1 || !util.hasOwn(commandMap, key)) continue;\r\n                if (activePlugins.indexOf(key) > -1) {\r\n                    plugins[key].active.call(this, null);\r\n                } else if (commandMap.OUTDENT && /^OUTDENT$/i.test(key)) {\r\n                    if (!util.isImportantDisabled(commandMap.OUTDENT)) commandMap.OUTDENT.setAttribute('disabled', true);\r\n                } else if (commandMap.INDENT && /^INDENT$/i.test(key)) {\r\n                    if (!util.isImportantDisabled(commandMap.INDENT)) commandMap.INDENT.removeAttribute('disabled');\r\n                } else {\r\n                    util.removeClass(commandMap[key], 'active');\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Initializ core variable\r\n         * @param {Boolean} reload Is relooad?\r\n         * @param {String} _initHTML initial html string\r\n         * @private\r\n         */\r\n        _init: function (reload, _initHTML) {\r\n            const wRegExp = _w.RegExp;\r\n            this._ww = options.iframe ? context.element.wysiwygFrame.contentWindow : _w;\r\n            this._wd = _d;\r\n            this._charTypeHTML = options.charCounterType === 'byte-html';\r\n            this.wwComputedStyle = _w.getComputedStyle(context.element.wysiwyg);\r\n            this._editorHeight = context.element.wysiwygFrame.offsetHeight;\r\n            this._editorHeightPadding = util.getNumber(this.wwComputedStyle.getPropertyValue('padding-top')) + util.getNumber(this.wwComputedStyle.getPropertyValue('padding-bottom'));\r\n\r\n            if (!options.iframe && typeof _w.ShadowRoot === 'function') {\r\n                let child = context.element.wysiwygFrame;\r\n                while (child) {\r\n                    if (child.shadowRoot) {\r\n                        this._shadowRoot = child.shadowRoot;\r\n                        break;\r\n                    } else if (child instanceof _w.ShadowRoot) {\r\n                        this._shadowRoot = child;\r\n                        break;\r\n                    }\r\n                    child = child.parentNode;\r\n                }\r\n                if (this._shadowRoot) this._shadowRootControllerEventTarget = [];\r\n            }\r\n\r\n            // set disallow text nodes\r\n            const disallowTextTags = _w.Object.keys(options._textTagsMap);\r\n            const allowTextTags = !options.addTagsWhitelist ? [] : options.addTagsWhitelist.split('|').filter(function (v) { return /b|i|ins|s|strike/i.test(v); });\r\n            for (let i = 0; i < allowTextTags.length; i++) {\r\n                disallowTextTags.splice(disallowTextTags.indexOf(allowTextTags[i].toLowerCase()), 1);\r\n            }\r\n            this._disallowedTextTagsRegExp = disallowTextTags.length === 0 ? null : new wRegExp('(<\\\\/?)(' + disallowTextTags.join('|') + ')\\\\b\\\\s*([^>^<]+)?\\\\s*(?=>)', 'gi');\r\n\r\n            // set whitelist\r\n            const getRegList = function (str, str2) { return !str ? '^' : (str === '*' ? '[a-z-]+' : (!str2 ? str : (str + '|' + str2))); };\r\n            // tags\r\n            const defaultAttr = 'contenteditable|colspan|rowspan|target|href|download|rel|src|alt|class|type|controls|origin-size';\r\n            const dataAttr = 'data-format|data-size|data-file-size|data-file-name|data-origin|data-align|data-image-link|data-rotate|data-proportion|data-percentage|data-exp|data-font-size';\r\n            this._allowHTMLComments = options._editorTagsWhitelist.indexOf('//') > -1 || options._editorTagsWhitelist === '*';\r\n            // html check\r\n            this._htmlCheckWhitelistRegExp = new wRegExp('^(' + getRegList(options._editorTagsWhitelist.replace('|//', ''), '') + ')$', 'i');\r\n            this._htmlCheckBlacklistRegExp = new wRegExp('^(' + (options.tagsBlacklist || '^') + ')$', 'i');\r\n            // tags\r\n            this.editorTagsWhitelistRegExp = util.createTagsWhitelist(getRegList(options._editorTagsWhitelist.replace('|//', '|<!--|-->'), ''));\r\n            this.editorTagsBlacklistRegExp = util.createTagsBlacklist(options.tagsBlacklist.replace('|//', '|<!--|-->'));\r\n            // paste tags\r\n            this.pasteTagsWhitelistRegExp = util.createTagsWhitelist(getRegList(options.pasteTagsWhitelist, ''));\r\n            this.pasteTagsBlacklistRegExp = util.createTagsBlacklist(options.pasteTagsBlacklist);\r\n            // attributes\r\n            const regEndStr = '\\\\s*=\\\\s*(\\\")[^\\\"]*\\\\1';\r\n            const _wAttr = options.attributesWhitelist;\r\n            let tagsAttr = {};\r\n            let allAttr = '';\r\n            if (!!_wAttr) {\r\n                for (let k in _wAttr) {\r\n                    if (!util.hasOwn(_wAttr, k) || /^on[a-z]+$/i.test(_wAttr[k])) continue;\r\n                    if (k === 'all') {\r\n                        allAttr = getRegList(_wAttr[k], defaultAttr);\r\n                    } else {\r\n                        tagsAttr[k] = new wRegExp('\\\\s(?:' + getRegList(_wAttr[k], '') + ')' + regEndStr, 'ig');\r\n                    }\r\n                }\r\n            }\r\n            \r\n            this._attributesWhitelistRegExp = new wRegExp('\\\\s(?:' + (allAttr || defaultAttr + '|' + dataAttr) + ')' + regEndStr, 'ig');\r\n            this._attributesWhitelistRegExp_all_data = new wRegExp('\\\\s(?:' + ((allAttr || defaultAttr) + '|data-[a-z0-9\\\\-]+') + ')' + regEndStr, 'ig');\r\n            this._attributesTagsWhitelist = tagsAttr;\r\n\r\n            // blacklist\r\n            const _bAttr = options.attributesBlacklist;\r\n            tagsAttr = {};\r\n            allAttr = '';\r\n            if (!!_bAttr) {\r\n                for (let k in _bAttr) {\r\n                    if (!util.hasOwn(_bAttr, k)) continue;\r\n                    if (k === 'all') {\r\n                        allAttr = getRegList(_bAttr[k], '');\r\n                    } else {\r\n                        tagsAttr[k] = new wRegExp('\\\\s(?:' + getRegList(_bAttr[k], '') + ')' + regEndStr, 'ig');\r\n                    }\r\n                }\r\n            }\r\n\r\n            this._attributesBlacklistRegExp = new wRegExp('\\\\s(?:' + (allAttr || '^') + ')' + regEndStr, 'ig');\r\n            this._attributesTagsBlacklist = tagsAttr;\r\n\r\n            // set modes\r\n            this._isInline = /inline/i.test(options.mode);\r\n            this._isBalloon = /balloon|balloon-always/i.test(options.mode);\r\n            this._isBalloonAlways = /balloon-always/i.test(options.mode);\r\n\r\n            // caching buttons\r\n            this._cachingButtons();\r\n\r\n            // file components\r\n            this._fileInfoPluginsCheck = [];\r\n            this._fileInfoPluginsReset = [];\r\n\r\n            // text components\r\n            this.managedTagsInfo = { query: '', map: {} };\r\n            const managedClass = [];\r\n\r\n            // Command and file plugins registration\r\n            this.activePlugins = [];\r\n            this._fileManager.tags = [];\r\n            this._fileManager.pluginMap = {};\r\n\r\n            let filePluginRegExp = [];\r\n            let plugin, button;\r\n            for (let key in plugins) {\r\n                if (!util.hasOwn(plugins, key)) continue;\r\n                plugin = plugins[key];\r\n                button = pluginCallButtons[key];\r\n                if ((plugin.active || plugin.action) && button) {\r\n                    this.callPlugin(key, null, button);\r\n                }\r\n                if (typeof plugin.checkFileInfo === 'function' && typeof plugin.resetFileInfo === 'function') {\r\n                    this.callPlugin(key, null, button);\r\n                    this._fileInfoPluginsCheck.push(plugin.checkFileInfo.bind(this));\r\n                    this._fileInfoPluginsReset.push(plugin.resetFileInfo.bind(this));\r\n                }\r\n                if (_w.Array.isArray(plugin.fileTags)) {\r\n                    const fileTags = plugin.fileTags;\r\n                    this.callPlugin(key, null, button);\r\n                    this._fileManager.tags = this._fileManager.tags.concat(fileTags);\r\n                    filePluginRegExp.push(key);\r\n                    for (let tag = 0, tLen = fileTags.length; tag < tLen; tag++) {\r\n                        this._fileManager.pluginMap[fileTags[tag].toLowerCase()] = key;\r\n                    }\r\n                }\r\n                if (plugin.managedTags) {\r\n                    const info = plugin.managedTags();\r\n                    managedClass.push('.' + info.className);\r\n                    this.managedTagsInfo.map[info.className] = info.method.bind(this);\r\n                }\r\n            }\r\n\r\n            this.managedTagsInfo.query = managedClass.toString();\r\n            this._fileManager.queryString = this._fileManager.tags.join(',');\r\n            this._fileManager.regExp = new wRegExp('^(' +  (this._fileManager.tags.join('|') || '^') + ')$', 'i');\r\n            this._fileManager.pluginRegExp = new wRegExp('^(' +  (filePluginRegExp.length === 0 ? '^' : filePluginRegExp.join('|')) + ')$', 'i');\r\n            \r\n            // cache editor's element\r\n            this._variable._originCssText = context.element.topArea.style.cssText;\r\n            this._placeholder = context.element.placeholder;\r\n            this._lineBreaker = context.element.lineBreaker;\r\n            this._lineBreakerButton = this._lineBreaker.querySelector('button');\r\n\r\n            // Excute history function\r\n            this.history = _history(this, this._onChange_historyStack.bind(this));\r\n\r\n            // register notice module\r\n            this.addModule([_notice]);\r\n\r\n            // Init, validate\r\n            if (options.iframe) {\r\n                this._wd = context.element.wysiwygFrame.contentDocument;\r\n                context.element.wysiwyg = this._wd.body;\r\n                if (options._editorStyles.editor) context.element.wysiwyg.style.cssText = options._editorStyles.editor;\r\n                if (options.height === 'auto') this._iframeAuto = this._wd.body;\r\n            }\r\n            \r\n            this._initWysiwygArea(reload, _initHTML);\r\n        },\r\n\r\n        /**\r\n         * @description Caching basic buttons to use\r\n         * @private\r\n         */\r\n        _cachingButtons: function () {\r\n            this.codeViewDisabledButtons = context.element._buttonTray.querySelectorAll('.se-menu-list button[data-display]:not([class~=\"se-code-view-enabled\"]):not([data-display=\"MORE\"])');\r\n            this.resizingDisabledButtons = context.element._buttonTray.querySelectorAll('.se-menu-list button[data-display]:not([class~=\"se-resizing-enabled\"]):not([data-display=\"MORE\"])');\r\n\r\n            this._saveButtonStates();\r\n\r\n            const tool = context.tool;\r\n            this.commandMap = {\r\n                OUTDENT: tool.outdent,\r\n                INDENT: tool.indent\r\n            };\r\n            this.commandMap[options.textTags.bold.toUpperCase()] = tool.bold;\r\n            this.commandMap[options.textTags.underline.toUpperCase()] = tool.underline;\r\n            this.commandMap[options.textTags.italic.toUpperCase()] = tool.italic;\r\n            this.commandMap[options.textTags.strike.toUpperCase()] = tool.strike;\r\n            this.commandMap[options.textTags.sub.toUpperCase()] = tool.subscript;\r\n            this.commandMap[options.textTags.sup.toUpperCase()] = tool.superscript;\r\n            \r\n            this._styleCommandMap = {\r\n                fullScreen: tool.fullScreen,\r\n                showBlocks: tool.showBlocks,\r\n                codeView: tool.codeView\r\n            };\r\n        },\r\n\r\n        /**\r\n         * @description Initializ wysiwyg area (Only called from core._init)\r\n         * @param {Boolean} reload Is relooad?\r\n         * @param {String} _initHTML initial html string\r\n         * @private\r\n         */\r\n        _initWysiwygArea: function (reload, _initHTML) {\r\n            context.element.wysiwyg.innerHTML = reload ? _initHTML : this.convertContentsForEditor(typeof _initHTML === 'string' ? _initHTML : context.element.originElement.value);\r\n        },\r\n\r\n        /**\r\n         * @description Called when there are changes to tags in the wysiwyg region.\r\n         * @private\r\n         */\r\n        _resourcesStateChange: function () {\r\n            this._iframeAutoHeight();\r\n            this._checkPlaceholder();\r\n        },\r\n\r\n        /**\r\n         * @description Called when after execute \"history.push\"\r\n         * @private\r\n         */\r\n        _onChange_historyStack: function () {\r\n            if (this.hasFocus) event._applyTagEffects();\r\n            this._variable.isChanged = true;\r\n            if (context.tool.save) context.tool.save.removeAttribute('disabled');\r\n            // user event\r\n            if (functions.onChange) functions.onChange(this.getContents(true), this);\r\n            if (context.element.toolbar.style.display === 'block') event._showToolbarBalloon();\r\n        },\r\n\r\n        /**\r\n         * @description Modify the height value of the iframe when the height of the iframe is automatic.\r\n         * @private\r\n         */\r\n        _iframeAutoHeight: function () {\r\n            if (this._iframeAuto) {\r\n                _w.setTimeout(function () { \r\n                    const h = core._iframeAuto.offsetHeight;\r\n                    context.element.wysiwygFrame.style.height = h + 'px';\r\n                    if (util.isIE) core.__callResizeFunction(h, null);\r\n                });\r\n            } else if (util.isIE) {\r\n                core.__callResizeFunction(context.element.wysiwygFrame.offsetHeight, null);\r\n            }\r\n        },\r\n\r\n        __callResizeFunction: function (h, resizeObserverEntry) {\r\n            h = h === -1 ? (resizeObserverEntry.borderBoxSize ? resizeObserverEntry.borderBoxSize[0].blockSize : (resizeObserverEntry.contentRect.height + this._editorHeightPadding)) : h;\r\n            if (this._editorHeight !== h) {\r\n                if (typeof functions.onResizeEditor === 'function') functions.onResizeEditor(h, this._editorHeight, core, resizeObserverEntry);\r\n                this._editorHeight = h;\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Set display property when there is placeholder.\r\n         * @private\r\n         */\r\n        _checkPlaceholder: function () {\r\n            if (this._placeholder) {\r\n                if (this._variable.isCodeView) {\r\n                    this._placeholder.style.display = 'none';\r\n                    return;\r\n                }\r\n\r\n                const wysiwyg = context.element.wysiwyg;\r\n                if (!util.onlyZeroWidthSpace(wysiwyg.textContent) || wysiwyg.querySelector(util._allowedEmptyNodeList) || (wysiwyg.innerText.match(/\\n/g) || '').length > 1) {\r\n                    this._placeholder.style.display = 'none';\r\n                } else {\r\n                    this._placeholder.style.display = 'block';\r\n                }\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description If there is no default format, add a format and move \"selection\".\r\n         * @param {String|null} formatName Format tag name (default: 'P')\r\n         * @returns {undefined|null}\r\n         * @private\r\n         */\r\n        _setDefaultFormat: function (formatName) {\r\n            if (this._fileManager.pluginRegExp.test(this.currentControllerName)) return;\r\n\r\n            const range = this.getRange();\r\n            const commonCon = range.commonAncestorContainer;\r\n            const startCon = range.startContainer;\r\n            const rangeEl = util.getRangeFormatElement(commonCon, null);\r\n            let focusNode, offset, format;\r\n\r\n            const fileComponent = util.getParentElement(commonCon, util.isComponent);\r\n            if (fileComponent && !util.isTable(fileComponent)) {\r\n                return;\r\n            } else if (commonCon.nodeType === 1 && commonCon.getAttribute('data-se-embed') === 'true') {\r\n                let el = commonCon.nextElementSibling;\r\n                if (!util.isFormatElement(el)) el = this.appendFormatTag(commonCon, options.defaultTag);\r\n                this.setRange(el.firstChild, 0, el.firstChild, 0);\r\n                return;\r\n            }\r\n\r\n            if ((util.isRangeFormatElement(startCon) || util.isWysiwygDiv(startCon)) && (util.isComponent(startCon.children[range.startOffset]) || util.isComponent(startCon.children[range.startOffset - 1]))) return;\r\n            if (util.getParentElement(commonCon, util.isNotCheckingNode)) return null;\r\n\r\n            if (rangeEl) {\r\n                format = util.createElement(formatName || options.defaultTag);\r\n                format.innerHTML = rangeEl.innerHTML;\r\n                if (format.childNodes.length === 0) format.innerHTML = util.zeroWidthSpace;\r\n\r\n                rangeEl.innerHTML = format.outerHTML;\r\n                format = rangeEl.firstChild;\r\n                focusNode = util.getEdgeChildNodes(format, null).sc;\r\n\r\n                if (!focusNode) {\r\n                    focusNode = util.createTextNode(util.zeroWidthSpace);\r\n                    format.insertBefore(focusNode, format.firstChild);\r\n                }\r\n                \r\n                offset = focusNode.textContent.length;\r\n                this.setRange(focusNode, offset, focusNode, offset);\r\n                return;\r\n            }\r\n\r\n            if(util.isRangeFormatElement(commonCon) && (commonCon.childNodes.length <= 1)) {\r\n                let br = null;\r\n                if (commonCon.childNodes.length === 1 && util.isBreak(commonCon.firstChild)) {\r\n                    br = commonCon.firstChild;\r\n                } else {\r\n                    br = util.createTextNode(util.zeroWidthSpace);\r\n                    commonCon.appendChild(br);\r\n                }\r\n\r\n                this.setRange(br, 1, br, 1);\r\n                return;\r\n            }\r\n\r\n            this.execCommand('formatBlock', false, (formatName || options.defaultTag));\r\n            focusNode = util.getEdgeChildNodes(commonCon, commonCon);\r\n            focusNode = focusNode ? focusNode.ec : commonCon;\r\n\r\n            format = util.getFormatElement(focusNode, null);\r\n            if (!format) {\r\n                this.removeRange();\r\n                this._editorRange();\r\n                return;\r\n            }\r\n            \r\n            if (util.isBreak(format.nextSibling)) util.removeItem(format.nextSibling);\r\n            if (util.isBreak(format.previousSibling)) util.removeItem(format.previousSibling);\r\n            if (util.isBreak(focusNode)) {\r\n                const zeroWidth = util.createTextNode(util.zeroWidthSpace);\r\n                focusNode.parentNode.insertBefore(zeroWidth, focusNode);\r\n                focusNode = zeroWidth;\r\n            }\r\n\r\n            this.effectNode = null;\r\n            this.nativeFocus();\r\n        },\r\n\r\n        /**\r\n         * @description Initialization after \"setOptions\"\r\n         * @param {Object} el context.element\r\n         * @param {String} _initHTML Initial html string\r\n         * @private\r\n         */\r\n        _setOptionsInit: function (el, _initHTML) {\r\n            this.context = context = _Context(el.originElement, this._getConstructed(el), options);\r\n            this._componentsInfoReset = true;\r\n            this._editorInit(true, _initHTML);\r\n        },\r\n\r\n        /**\r\n         * @description Initializ editor\r\n         * @param {Boolean} reload Is relooad?\r\n         * @param {String} _initHTML initial html string\r\n         * @private\r\n         */\r\n        _editorInit: function (reload, _initHTML) {\r\n            // initialize core and add event listeners\r\n            this._init(reload, _initHTML);\r\n            event._addEvent();\r\n            this._setCharCount();\r\n            event._offStickyToolbar();\r\n            event.onResize_window();\r\n\r\n            // toolbar visibility\r\n            context.element.toolbar.style.visibility = '';\r\n\r\n            this._checkComponents();\r\n            this._componentsInfoInit = false;\r\n            this._componentsInfoReset = false;\r\n\r\n            this.history.reset(true);\r\n            this._resourcesStateChange();\r\n\r\n            _w.setTimeout(function () {\r\n                // observer\r\n                if (event._resizeObserver) event._resizeObserver.observe(context.element.wysiwygFrame);\r\n                if (event._toolbarObserver) event._toolbarObserver.observe(context.element._toolbarShadow);\r\n                // user event\r\n                if (typeof functions.onload === 'function') functions.onload(core, reload);\r\n            });\r\n        },\r\n\r\n        /**\r\n         * @description Create and return an object to cache the new context.\r\n         * @param {Element} contextEl context.element\r\n         * @returns {Object}\r\n         * @private\r\n         */\r\n        _getConstructed: function (contextEl) {\r\n            return {\r\n                _top: contextEl.topArea,\r\n                _relative: contextEl.relative,\r\n                _toolBar: contextEl.toolbar,\r\n                _toolbarShadow: contextEl._toolbarShadow,\r\n                _menuTray: contextEl._menuTray,\r\n                _editorArea: contextEl.editorArea,\r\n                _wysiwygArea: contextEl.wysiwygFrame,\r\n                _codeArea: contextEl.code,\r\n                _placeholder: contextEl.placeholder,\r\n                _resizingBar: contextEl.resizingBar,\r\n                _navigation: contextEl.navigation,\r\n                _charCounter: contextEl.charCounter,\r\n                _charWrapper: contextEl.charWrapper,\r\n                _loading: contextEl.loading,\r\n                _lineBreaker: contextEl.lineBreaker,\r\n                _lineBreaker_t: contextEl.lineBreaker_t,\r\n                _lineBreaker_b: contextEl.lineBreaker_b,\r\n                _resizeBack: contextEl.resizeBackground,\r\n                _stickyDummy: contextEl._stickyDummy,\r\n                _arrow: contextEl._arrow\r\n            };\r\n        }\r\n    };\r\n\r\n    /**\r\n     * @description event function\r\n     */\r\n    const event = {\r\n        _IEisComposing: false, // In IE, there is no \"e.isComposing\" in the key-up event.\r\n        _lineBreakerBind: null,\r\n        _responsiveCurrentSize: 'default',\r\n        _responsiveButtonSize: null,\r\n        _responsiveButtons: null,\r\n        _directionKeyCode: new _w.RegExp('^(8|13|3[2-9]|40|46)$'),\r\n        _nonTextKeyCode: new _w.RegExp('^(8|13|1[6-9]|20|27|3[3-9]|40|45|46|11[2-9]|12[0-3]|144|145)$'),\r\n        _historyIgnoreKeyCode: new _w.RegExp('^(1[6-9]|20|27|3[3-9]|40|45|11[2-9]|12[0-3]|144|145)$'),\r\n        _onButtonsCheck: new _w.RegExp('^(' + _w.Object.keys(options._textTagsMap).join('|') + ')$', 'i'),\r\n        _frontZeroWidthReg: new _w.RegExp(util.zeroWidthSpace + '+', ''),\r\n        _keyCodeShortcut: {\r\n            65: 'A',\r\n            66: 'B',\r\n            83: 'S',\r\n            85: 'U',\r\n            73: 'I',\r\n            89: 'Y',\r\n            90: 'Z',\r\n            219: '[',\r\n            221: ']'\r\n        },\r\n\r\n        _shortcutCommand: function (keyCode, shift) {\r\n            let command = null;\r\n            const keyStr = event._keyCodeShortcut[keyCode];\r\n\r\n            switch (keyStr) {\r\n                case 'A':\r\n                    command = 'selectAll';\r\n                    break;\r\n                case 'B':\r\n                    if (options.shortcutsDisable.indexOf('bold') === -1) {\r\n                        command = 'bold';\r\n                    }\r\n                    break;\r\n                case 'S':\r\n                    if (shift && options.shortcutsDisable.indexOf('strike') === -1) {\r\n                        command = 'strike';\r\n                    } else if (!shift && options.shortcutsDisable.indexOf('save') === -1) {\r\n                        command = 'save';\r\n                    }\r\n                    break;\r\n                case 'U':\r\n                    if (options.shortcutsDisable.indexOf('underline') === -1) {\r\n                        command = 'underline';\r\n                    }\r\n                    break;\r\n                case 'I':\r\n                    if (options.shortcutsDisable.indexOf('italic') === -1) {\r\n                        command = 'italic';\r\n                    }\r\n                    break;\r\n                case 'Z':\r\n                    if (options.shortcutsDisable.indexOf('undo') === -1) {\r\n                        if (shift) {\r\n                            command = 'redo';\r\n                        } else {\r\n                            command = 'undo';\r\n                        }\r\n                    }\r\n                    break;\r\n                case 'Y':\r\n                    if (options.shortcutsDisable.indexOf('undo') === -1) {\r\n                        command = 'redo';\r\n                    }\r\n                    break;\r\n                case '[':\r\n                    if (options.shortcutsDisable.indexOf('indent') === -1) {\r\n                        command = options.rtl ? 'indent' : 'outdent';\r\n                    }\r\n                    break;\r\n                case ']':\r\n                    if (options.shortcutsDisable.indexOf('indent') === -1) {\r\n                        command = options.rtl ? 'outdent' : 'indent';\r\n                    }\r\n                    break;\r\n            }\r\n\r\n            if (!command) return !!keyStr;\r\n\r\n            core.commandHandler(core.commandMap[command], command);\r\n            return true;\r\n        },\r\n\r\n        _applyTagEffects: function () {\r\n            let selectionNode = core.getSelectionNode();\r\n            if (selectionNode === core.effectNode) return;\r\n            core.effectNode = selectionNode;\r\n\r\n            const marginDir = options.rtl ? 'marginRight' : 'marginLeft';\r\n            const commandMap = core.commandMap;\r\n            const classOnCheck = event._onButtonsCheck;\r\n            const commandMapNodes = [];\r\n            const currentNodes = [];\r\n\r\n            const activePlugins = core.activePlugins;\r\n            const cLen = activePlugins.length;\r\n            let nodeName = '';\r\n\r\n            while (selectionNode.firstChild) {\r\n                selectionNode = selectionNode.firstChild;\r\n            }\r\n\r\n            for (let element = selectionNode; !util.isWysiwygDiv(element); element = element.parentNode) {\r\n                if (!element) break;\r\n                if (element.nodeType !== 1 || util.isBreak(element)) continue;\r\n                nodeName = element.nodeName.toUpperCase();\r\n                currentNodes.push(nodeName);\r\n\r\n                /* Active plugins */\r\n                if (!core.isReadOnly) {\r\n                    for (let c = 0, name; c < cLen; c++) {\r\n                        name = activePlugins[c];\r\n                        if (commandMapNodes.indexOf(name) === -1 && plugins[name].active.call(core, element)) {\r\n                            commandMapNodes.push(name);\r\n                        }\r\n                    }\r\n                }\r\n\r\n                if (util.isFormatElement(element)) {\r\n                    /* Outdent */\r\n                    if (commandMapNodes.indexOf('OUTDENT') === -1 && commandMap.OUTDENT && !util.isImportantDisabled(commandMap.OUTDENT)) {\r\n                        if (util.isListCell(element) || (element.style[marginDir] && util.getNumber(element.style[marginDir], 0) > 0)) {\r\n                            commandMapNodes.push('OUTDENT');\r\n                            commandMap.OUTDENT.removeAttribute('disabled');\r\n                        }\r\n                    }\r\n\r\n                    /* Indent */\r\n                    if (commandMapNodes.indexOf('INDENT') === -1 && commandMap.INDENT && !util.isImportantDisabled(commandMap.INDENT)) {\r\n                        commandMapNodes.push('INDENT');\r\n                        if (util.isListCell(element) && !element.previousElementSibling) {\r\n                            commandMap.INDENT.setAttribute('disabled', true);\r\n                        } else {\r\n                            commandMap.INDENT.removeAttribute('disabled');\r\n                        }\r\n                    }\r\n\r\n                    continue;\r\n                }\r\n\r\n                /** default active buttons [strong, ins, em, del, sub, sup] */\r\n                if (classOnCheck && classOnCheck.test(nodeName)) {\r\n                    commandMapNodes.push(nodeName);\r\n                    util.addClass(commandMap[nodeName], 'active');\r\n                }\r\n            }\r\n\r\n            core._setKeyEffect(commandMapNodes);\r\n\r\n            /** save current nodes */\r\n            core._variable.currentNodes = currentNodes.reverse();\r\n            core._variable.currentNodesMap = commandMapNodes;\r\n\r\n            /**  Displays the current node structure to resizingBar */\r\n            if (options.showPathLabel) context.element.navigation.textContent = core._variable.currentNodes.join(' > ');\r\n        },\r\n\r\n        _cancelCaptionEdit: function () {\r\n            this.setAttribute('contenteditable', false);\r\n            this.removeEventListener('blur', event._cancelCaptionEdit);\r\n        },\r\n\r\n        _buttonsEventHandler: function (e) {\r\n            let target = e.target;\r\n            if (core._bindControllersOff) e.stopPropagation();\r\n\r\n            if (/^(input|textarea|select|option)$/i.test(target.nodeName)) {\r\n                core._antiBlur = false;\r\n            } else {\r\n                e.preventDefault();\r\n            }\r\n\r\n            if (util.getParentElement(target, '.se-submenu')) {\r\n                e.stopPropagation();\r\n                core._notHideToolbar = true;\r\n            } else {\r\n                let command = target.getAttribute('data-command');\r\n                let className = target.className;\r\n    \r\n                while (!command && !/se-menu-list/.test(className) && !/sun-editor-common/.test(className)) {\r\n                    target = target.parentNode;\r\n                    command = target.getAttribute('data-command');\r\n                    className = target.className;\r\n                }\r\n    \r\n                if (command === core._submenuName || command === core._containerName) {\r\n                    e.stopPropagation();\r\n                }\r\n            }\r\n        },\r\n\r\n        onClick_toolbar: function (e) {\r\n            let target = e.target;\r\n            let display = target.getAttribute('data-display');\r\n            let command = target.getAttribute('data-command');\r\n            let className = target.className;\r\n            core.controllersOff();\r\n\r\n            while (target.parentNode && !command && !/se-menu-list/.test(className) && !/se-toolbar/.test(className)) {\r\n                target = target.parentNode;\r\n                command = target.getAttribute('data-command');\r\n                display = target.getAttribute('data-display');\r\n                className = target.className;\r\n            }\r\n\r\n            if (!command && !display) return;\r\n            if (target.disabled) return;\r\n\r\n            core.actionCall(command, display, target);\r\n        },\r\n\r\n        onMouseDown_wysiwyg: function (e) {\r\n            if (core.isReadOnly || util.isNonEditable(context.element.wysiwyg)) return;\r\n\r\n            // user event\r\n            if (typeof functions.onMouseDown === 'function' && functions.onMouseDown(e, core) === false) return;\r\n            \r\n            const tableCell = util.getParentElement(e.target, util.isCell);\r\n            if (tableCell) {\r\n                const tablePlugin = core.plugins.table;\r\n                if (tablePlugin && tableCell !== tablePlugin._fixedCell && !tablePlugin._shift) {\r\n                    core.callPlugin('table', function () {\r\n                        tablePlugin.onTableCellMultiSelect.call(core, tableCell, false);\r\n                    }, null);\r\n                }\r\n            }\r\n\r\n            if (core._isBalloon) {\r\n                event._hideToolbar();\r\n            }\r\n\r\n            if (/FIGURE/i.test(e.target.nodeName)) e.preventDefault();\r\n        },\r\n\r\n        onClick_wysiwyg: function (e) {\r\n            const targetElement = e.target;\r\n\r\n            if (core.isReadOnly) {\r\n                e.preventDefault();\r\n                if (util.isAnchor(targetElement)){\r\n                    _w.open(targetElement.href, targetElement.target);\r\n                }\r\n                return false;\r\n            }\r\n\r\n            if (util.isNonEditable(context.element.wysiwyg)) return;\r\n\r\n            // user event\r\n            if (typeof functions.onClick === 'function' && functions.onClick(e, core) === false) return;\r\n\r\n            const fileComponentInfo = core.getFileComponent(targetElement);\r\n            if (fileComponentInfo) {\r\n                e.preventDefault();\r\n                core.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName);\r\n                return;\r\n            }\r\n\r\n            const figcaption = util.getParentElement(targetElement, 'FIGCAPTION');\r\n            if (figcaption && (util.isNonEditable(figcaption) || !figcaption.getAttribute(\"contenteditable\"))) {\r\n                e.preventDefault();\r\n                figcaption.setAttribute('contenteditable', true);\r\n                figcaption.focus();\r\n\r\n                if (core._isInline && !core._inlineToolbarAttr.isShow) {\r\n                    event._showToolbarInline();\r\n\r\n                    const hideToolbar = function () {\r\n                        event._hideToolbar();\r\n                        figcaption.removeEventListener('blur', hideToolbar);\r\n                    };\r\n\r\n                    figcaption.addEventListener('blur', hideToolbar);\r\n                }\r\n            }\r\n\r\n            _w.setTimeout(core._editorRange.bind(core));\r\n            core._editorRange();\r\n\r\n            const selectionNode = core.getSelectionNode();\r\n            const formatEl = util.getFormatElement(selectionNode, null);\r\n            const rangeEl = util.getRangeFormatElement(selectionNode, null);\r\n            if (!formatEl && !util.isNonEditable(targetElement) && !util.isList(rangeEl)) {\r\n                const range = core.getRange();\r\n                if (util.getFormatElement(range.startContainer) === util.getFormatElement(range.endContainer)) {\r\n                    if (util.isList(rangeEl)) {\r\n                        e.preventDefault();\r\n                        const oLi = util.createElement('LI');\r\n                        const prevLi = selectionNode.nextElementSibling;\r\n                        oLi.appendChild(selectionNode);\r\n                        rangeEl.insertBefore(oLi, prevLi);\r\n                        core.focus();\r\n                    } else if (!util.isWysiwygDiv(selectionNode) && !util.isComponent(selectionNode) && (!util.isTable(selectionNode) || util.isCell(selectionNode)) && core._setDefaultFormat(util.isRangeFormatElement(rangeEl) ? 'DIV' : options.defaultTag) !== null) {\r\n                        e.preventDefault();\r\n                        core.focus();\r\n                    } else {\r\n                        event._applyTagEffects();\r\n                    }\r\n                }\r\n            } else {\r\n                event._applyTagEffects();\r\n            }\r\n\r\n            if (core._isBalloon) _w.setTimeout(event._toggleToolbarBalloon);\r\n        },\r\n\r\n        _balloonDelay: null,\r\n        _showToolbarBalloonDelay: function () {\r\n            if (event._balloonDelay) {\r\n                _w.clearTimeout(event._balloonDelay);\r\n            }\r\n\r\n            event._balloonDelay = _w.setTimeout(function () {\r\n                _w.clearTimeout(this._balloonDelay);\r\n                this._balloonDelay = null;\r\n                this._showToolbarBalloon();\r\n            }.bind(event), 350);\r\n        },\r\n\r\n        _toggleToolbarBalloon: function () {\r\n            core._editorRange();\r\n            const range = core.getRange();\r\n            if (core._bindControllersOff || (!core._isBalloonAlways && range.collapsed)) event._hideToolbar();\r\n            else event._showToolbarBalloon(range);\r\n        },\r\n\r\n        _showToolbarBalloon: function (rangeObj) {\r\n            if (!core._isBalloon) return;\r\n\r\n            const range = rangeObj || core.getRange();\r\n            const toolbar = context.element.toolbar;\r\n            const topArea = context.element.topArea;\r\n            const selection = core.getSelection();\r\n\r\n            let isDirTop;\r\n            if (core._isBalloonAlways && range.collapsed) {\r\n                isDirTop = true;\r\n            } else if (selection.focusNode === selection.anchorNode) {\r\n                isDirTop = selection.focusOffset < selection.anchorOffset;\r\n            } else {\r\n                const childNodes = util.getListChildNodes(range.commonAncestorContainer, null);\r\n                isDirTop = util.getArrayIndex(childNodes, selection.focusNode) < util.getArrayIndex(childNodes, selection.anchorNode);\r\n            }\r\n\r\n            let rects = range.getClientRects();\r\n            rects = rects[isDirTop ? 0 : rects.length - 1];\r\n\r\n            const globalScroll = core.getGlobalScrollOffset();\r\n            let scrollLeft = globalScroll.left;\r\n            let scrollTop = globalScroll.top;\r\n\r\n            const editorWidth = topArea.offsetWidth;\r\n            const offsets = event._getEditorOffsets(null);\r\n            const stickyTop = offsets.top;\r\n            const editorLeft = offsets.left;\r\n            \r\n            toolbar.style.top = '-10000px';\r\n            toolbar.style.visibility = 'hidden';\r\n            toolbar.style.display = 'block';\r\n\r\n            if (!rects) {\r\n                const node = core.getSelectionNode();\r\n                if (util.isFormatElement(node)) {\r\n                    const zeroWidth = util.createTextNode(util.zeroWidthSpace);\r\n                    core.insertNode(zeroWidth, null, false);\r\n                    core.setRange(zeroWidth, 1, zeroWidth, 1);\r\n                    core._editorRange();\r\n                    rects = core.getRange().getClientRects();\r\n                    rects = rects[isDirTop ? 0 : rects.length - 1];\r\n                }\r\n\r\n                if (!rects) {\r\n                    const nodeOffset = util.getOffset(node, context.element.wysiwygFrame);\r\n                    rects = {\r\n                        left: nodeOffset.left,\r\n                        top: nodeOffset.top,\r\n                        right: nodeOffset.left,\r\n                        bottom: nodeOffset.top + node.offsetHeight,\r\n                        noText: true\r\n                    };\r\n                    scrollLeft = 0;\r\n                    scrollTop = 0;\r\n                }\r\n\r\n                isDirTop = true;\r\n            }\r\n\r\n            const arrowMargin = _w.Math.round(context.element._arrow.offsetWidth / 2);\r\n            const toolbarWidth = toolbar.offsetWidth;\r\n            const toolbarHeight = toolbar.offsetHeight;\r\n            const iframeRects = /iframe/i.test(context.element.wysiwygFrame.nodeName) ? context.element.wysiwygFrame.getClientRects()[0] : null;\r\n            if (iframeRects) {\r\n                rects = {\r\n                    left: rects.left + iframeRects.left,\r\n                    top: rects.top + iframeRects.top,\r\n                    right: rects.right + iframeRects.right - iframeRects.width,\r\n                    bottom: rects.bottom + iframeRects.bottom - iframeRects.height\r\n                };\r\n            }\r\n            \r\n            event._setToolbarOffset(isDirTop, rects, toolbar, editorLeft, editorWidth, scrollLeft, scrollTop, stickyTop, arrowMargin);\r\n            if (toolbarWidth !== toolbar.offsetWidth || toolbarHeight !== toolbar.offsetHeight) {\r\n                event._setToolbarOffset(isDirTop, rects, toolbar, editorLeft, editorWidth, scrollLeft, scrollTop, stickyTop, arrowMargin);\r\n            }\r\n\r\n            if (options.toolbarContainer) {\r\n                const editorParent = topArea.parentElement;\r\n\r\n                let container = options.toolbarContainer;\r\n                let left = container.offsetLeft;\r\n                let top = container.offsetTop;\r\n\r\n                while(!container.parentElement.contains(editorParent) || !/^(BODY|HTML)$/i.test(container.parentElement.nodeName)) {\r\n                    container = container.offsetParent;\r\n                    left += container.offsetLeft;\r\n                    top += container.offsetTop;\r\n                }\r\n\r\n                toolbar.style.left = (toolbar.offsetLeft - left + topArea.offsetLeft) + 'px';\r\n                toolbar.style.top = (toolbar.offsetTop - top + topArea.offsetTop) + 'px';\r\n            }\r\n\r\n            toolbar.style.visibility = '';\r\n        },\r\n\r\n        _setToolbarOffset: function (isDirTop, rects, toolbar, editorLeft, editorWidth, scrollLeft, scrollTop, stickyTop, arrowMargin) {\r\n            const padding = 1;\r\n            const toolbarWidth = toolbar.offsetWidth;\r\n            const toolbarHeight = rects.noText && !isDirTop ? 0 : toolbar.offsetHeight;\r\n\r\n            const absoluteLeft = (isDirTop ? rects.left : rects.right) - editorLeft - (toolbarWidth / 2) + scrollLeft;\r\n            const overRight = absoluteLeft + toolbarWidth - editorWidth;\r\n            \r\n            let t = (isDirTop ? rects.top - toolbarHeight - arrowMargin : rects.bottom + arrowMargin) - (rects.noText ? 0 : stickyTop) + scrollTop;\r\n            let l = absoluteLeft < 0 ? padding : overRight < 0 ? absoluteLeft : absoluteLeft - overRight - padding - 1;\r\n\r\n            let resetTop = false;\r\n            const space = t + (isDirTop ? (event._getEditorOffsets(null).top) : (toolbar.offsetHeight - context.element.wysiwyg.offsetHeight));\r\n            if (!isDirTop && space > 0 && event._getPageBottomSpace() < space) {\r\n                isDirTop = true;\r\n                resetTop = true;\r\n            } else if (isDirTop && _d.documentElement.offsetTop > space) {\r\n                isDirTop = false;\r\n                resetTop = true;\r\n            }\r\n\r\n            if (resetTop) t = (isDirTop ? rects.top - toolbarHeight - arrowMargin : rects.bottom + arrowMargin) - (rects.noText ? 0 : stickyTop) + scrollTop;\r\n\r\n            toolbar.style.left = _w.Math.floor(l) + 'px';\r\n            toolbar.style.top = _w.Math.floor(t) + 'px';\r\n\r\n            if (isDirTop) {\r\n                util.removeClass(context.element._arrow, 'se-arrow-up');\r\n                util.addClass(context.element._arrow, 'se-arrow-down');\r\n                context.element._arrow.style.top = toolbarHeight + 'px';\r\n            } else {\r\n                util.removeClass(context.element._arrow, 'se-arrow-down');\r\n                util.addClass(context.element._arrow, 'se-arrow-up');\r\n                context.element._arrow.style.top = -arrowMargin + 'px';\r\n            }\r\n\r\n            const arrow_left = _w.Math.floor((toolbarWidth / 2) + (absoluteLeft - l));\r\n            context.element._arrow.style.left = (arrow_left + arrowMargin > toolbar.offsetWidth ? toolbar.offsetWidth - arrowMargin : arrow_left < arrowMargin ? arrowMargin : arrow_left) + 'px';\r\n        },\r\n\r\n        _showToolbarInline: function () {\r\n            if (!core._isInline) return;\r\n\r\n            const toolbar = context.element.toolbar;\r\n            if (options.toolbarContainer) toolbar.style.position = 'relative';\r\n            else toolbar.style.position = 'absolute';\r\n            \r\n            toolbar.style.visibility = 'hidden';\r\n            toolbar.style.display = 'block';\r\n            core._inlineToolbarAttr.width = toolbar.style.width = options.toolbarWidth;\r\n            core._inlineToolbarAttr.top = toolbar.style.top = (options.toolbarContainer ? 0 : (-1 - toolbar.offsetHeight)) + 'px';\r\n            \r\n            if (typeof functions.showInline === 'function') functions.showInline(toolbar, context, core);\r\n\r\n            event.onScroll_window();\r\n            core._inlineToolbarAttr.isShow = true;\r\n            toolbar.style.visibility = '';\r\n        },\r\n\r\n        _hideToolbar: function () {\r\n            if (!core._notHideToolbar && !core._variable.isFullScreen) {\r\n                context.element.toolbar.style.display = 'none';\r\n                core._inlineToolbarAttr.isShow = false;\r\n            }\r\n        },\r\n\r\n        onInput_wysiwyg: function (e) {\r\n            if (core.isReadOnly || core.isDisabled) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                core.history.go(core.history.getCurrentIndex());\r\n                return false;\r\n            }\r\n\r\n            core._editorRange();\r\n\r\n            // user event\r\n            if (typeof functions.onInput === 'function' && functions.onInput(e, core) === false) return;\r\n\r\n            const data = (e.data === null ? '' : e.data === undefined ? ' ' : e.data) || '';       \r\n            if (!core._charCount(data)) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                return false;\r\n            }\r\n\r\n            // history stack\r\n            core.history.push(true);\r\n        },\r\n\r\n        _isUneditableNode: function (range, isFront) {\r\n            const container = isFront ? range.startContainer : range.endContainer;\r\n            const offset = isFront ? range.startOffset : range.endOffset;\r\n            const siblingKey = isFront ? 'previousSibling' : 'nextSibling';\r\n            const isElement = container.nodeType === 1;\r\n            let siblingNode;\r\n\r\n            if (isElement) {\r\n                siblingNode = event._isUneditableNode_getSibling(container.childNodes[offset], siblingKey, container);\r\n                return siblingNode && siblingNode.nodeType === 1 && siblingNode.getAttribute('contenteditable') === 'false';\r\n            } else {\r\n                siblingNode = event._isUneditableNode_getSibling(container, siblingKey, container);\r\n                return core.isEdgePoint(container, offset, isFront ? 'front' : 'end') && (siblingNode && siblingNode.nodeType === 1 && siblingNode.getAttribute('contenteditable') === 'false');\r\n            }\r\n        },\r\n\r\n        _isUneditableNode_getSibling: function (selectNode, siblingKey, container) {\r\n            if (!selectNode) return null;\r\n            let siblingNode = selectNode[siblingKey];\r\n\r\n            if (!siblingNode) {\r\n                siblingNode = util.getFormatElement(container);\r\n                siblingNode = siblingNode ? siblingNode[siblingKey] : null;\r\n                if (siblingNode && !util.isComponent(siblingNode)) siblingNode = siblingKey === 'previousSibling' ? siblingNode.firstElementChild : siblingNode.lastElementChild;\r\n                else return null;\r\n            }\r\n\r\n            return siblingNode;\r\n        },\r\n\r\n        _onShortcutKey: false,\r\n        onKeyDown_wysiwyg: function (e) {\r\n            const keyCode = e.keyCode;\r\n            const shift = e.shiftKey;\r\n            const ctrl = e.ctrlKey || e.metaKey || keyCode === 91 || keyCode === 92 || keyCode === 224;\r\n            const alt = e.altKey;\r\n            event._IEisComposing = keyCode === 229;\r\n\r\n            if (!ctrl && core.isReadOnly && !event._directionKeyCode.test(keyCode)) {\r\n                e.preventDefault();\r\n                return false;\r\n            }\r\n\r\n            core.submenuOff();\r\n\r\n            if (core._isBalloon) {\r\n                event._hideToolbar();\r\n            }\r\n\r\n            // user event\r\n            if (typeof functions.onKeyDown === 'function' && functions.onKeyDown(e, core) === false) return;\r\n\r\n            /** Shortcuts */\r\n            if (ctrl && event._shortcutCommand(keyCode, shift)) {\r\n                event._onShortcutKey = true;\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                return false;\r\n            } else if (event._onShortcutKey) {\r\n                event._onShortcutKey = false;\r\n            }\r\n\r\n            /** default key action */\r\n            let selectionNode = core.getSelectionNode();\r\n            const range = core.getRange();\r\n            const selectRange = !range.collapsed || range.startContainer !== range.endContainer;\r\n            const fileComponentName = core._fileManager.pluginRegExp.test(core.currentControllerName) ? core.currentControllerName : '';\r\n            let formatEl = util.getFormatElement(selectionNode, null) || selectionNode;\r\n            let rangeEl = util.getRangeFormatElement(formatEl, null);\r\n\r\n            switch (keyCode) {\r\n                case 8: /** backspace key */\r\n                    if (!selectRange) {\r\n                        if (fileComponentName) {\r\n                            e.preventDefault();\r\n                            e.stopPropagation();\r\n                            core.plugins[fileComponentName].destroy.call(core);\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    if (selectRange && event._hardDelete()) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        break;\r\n                    }\r\n\r\n                    if (!util.isFormatElement(formatEl) && !context.element.wysiwyg.firstElementChild && !util.isComponent(selectionNode) && core._setDefaultFormat(options.defaultTag) !== null) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        return false;\r\n                    }\r\n\r\n                    if (!selectRange && !formatEl.previousElementSibling && (range.startOffset === 0 && !selectionNode.previousSibling && !util.isListCell(formatEl) && \r\n                     (util.isFormatElement(formatEl) && (!util.isFreeFormatElement(formatEl) || util.isClosureFreeFormatElement(formatEl))))) {\r\n                        // closure range\r\n                        if (util.isClosureRangeFormatElement(formatEl.parentNode)) {\r\n                            e.preventDefault();\r\n                            e.stopPropagation();\r\n                            return false;\r\n                        }\r\n                        // maintain default format\r\n                        if (util.isWysiwygDiv(formatEl.parentNode) && formatEl.childNodes.length <= 1 && (!formatEl.firstChild || util.onlyZeroWidthSpace(formatEl.textContent))) {\r\n                            e.preventDefault();\r\n                            e.stopPropagation();\r\n\r\n                            if (formatEl.nodeName.toUpperCase() === options.defaultTag.toUpperCase()) {\r\n                                formatEl.innerHTML = '<br>';\r\n                                const attrs = formatEl.attributes;\r\n                                while (attrs[0]) {\r\n                                    formatEl.removeAttribute(attrs[0].name);\r\n                                }\r\n                            } else {\r\n                                const defaultFormat = util.createElement(options.defaultTag);\r\n                                defaultFormat.innerHTML = '<br>';\r\n                                formatEl.parentElement.replaceChild(defaultFormat, formatEl);\r\n                            }\r\n\r\n                            core.nativeFocus();\r\n                            return false;\r\n                        }\r\n                    }\r\n\r\n                    // clean remove tag\r\n                    if (formatEl && range.startContainer === range.endContainer && selectionNode.nodeType === 3 && !util.isFormatElement(selectionNode.parentNode)) {\r\n                        if (range.collapsed ? selectionNode.textContent.length === 1 : (range.endOffset - range.startOffset) === selectionNode.textContent.length) {\r\n                            e.preventDefault();\r\n\r\n                            let offset = null;\r\n                            let prev = selectionNode.parentNode.previousSibling;\r\n                            const next = selectionNode.parentNode.nextSibling;\r\n                            if (!prev) {\r\n                                if (!next) {\r\n                                    prev = util.createElement('BR');\r\n                                    formatEl.appendChild(prev);\r\n                                } else {\r\n                                    prev = next;\r\n                                    offset = 0;\r\n                                }\r\n                            }\r\n\r\n                            selectionNode.textContent = '';\r\n                            util.removeItemAllParents(selectionNode, null, formatEl);\r\n                            offset = typeof offset === 'number' ? offset : prev.nodeType === 3 ? prev.textContent.length : 1;\r\n                            core.setRange(prev, offset, prev, offset);\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    // tag[contenteditable=\"false\"]\r\n                    if (event._isUneditableNode(range, true)) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        break;\r\n                    }\r\n\r\n                    // nested list\r\n                    const commonCon = range.commonAncestorContainer;\r\n                    formatEl = util.getFormatElement(range.startContainer, null);\r\n                    rangeEl = util.getRangeFormatElement(formatEl, null);\r\n                    if (rangeEl && formatEl && !util.isCell(rangeEl) && !/^FIGCAPTION$/i.test(rangeEl.nodeName)) {\r\n                        if (util.isListCell(formatEl) && util.isList(rangeEl) && (util.isListCell(rangeEl.parentNode) || formatEl.previousElementSibling) && (selectionNode === formatEl || (selectionNode.nodeType === 3 && (!selectionNode.previousSibling || util.isList(selectionNode.previousSibling)))) &&\r\n                         (util.getFormatElement(range.startContainer, null) !== util.getFormatElement(range.endContainer, null) ? rangeEl.contains(range.startContainer) : (range.startOffset === 0  && range.collapsed))) {\r\n                            if (range.startContainer !== range.endContainer) {\r\n                                e.preventDefault();\r\n\r\n                                core.removeNode();\r\n                                if (range.startContainer.nodeType === 3) {\r\n                                    core.setRange(range.startContainer, range.startContainer.textContent.length, range.startContainer, range.startContainer.textContent.length);\r\n                                }\r\n                                // history stack\r\n                                core.history.push(true);\r\n                            } else {\r\n                                let prev = formatEl.previousElementSibling || rangeEl.parentNode;\r\n                                if (util.isListCell(prev)) {\r\n                                    e.preventDefault();\r\n\r\n                                    let prevLast = prev;\r\n                                    if (!prev.contains(formatEl) && util.isListCell(prevLast) && util.isList(prevLast.lastElementChild)) {\r\n                                        prevLast = prevLast.lastElementChild.lastElementChild;\r\n                                        while (util.isListCell(prevLast) && util.isList(prevLast.lastElementChild)) {\r\n                                            prevLast = prevLast.lastElementChild && prevLast.lastElementChild.lastElementChild;\r\n                                        }\r\n                                        prev = prevLast;\r\n                                    }\r\n\r\n                                    let con = prev === rangeEl.parentNode ? rangeEl.previousSibling : prev.lastChild;\r\n                                    if (!con) {\r\n                                        con = util.createTextNode(util.zeroWidthSpace);\r\n                                        rangeEl.parentNode.insertBefore(con, rangeEl.parentNode.firstChild);\r\n                                    }\r\n                                    const offset = con.nodeType === 3 ? con.textContent.length : 1;\r\n                                    const children = formatEl.childNodes;\r\n                                    let after = con;\r\n                                    let child = children[0];\r\n                                    while ((child = children[0])) {\r\n                                        prev.insertBefore(child, after.nextSibling);\r\n                                        after = child;\r\n                                    }\r\n\r\n                                    util.removeItem(formatEl);\r\n                                    if (rangeEl.children.length === 0) util.removeItem(rangeEl);\r\n\r\n                                    core.setRange(con, offset, con, offset);\r\n                                    // history stack\r\n                                    core.history.push(true);\r\n                                }\r\n                            }\r\n                            \r\n                            break;\r\n                        }\r\n\r\n                        // detach range\r\n                        if (!selectRange && range.startOffset === 0) {\r\n                            let detach = true;\r\n                            let comm = commonCon;\r\n                            while (comm && comm !== rangeEl && !util.isWysiwygDiv(comm)) {\r\n                                if (comm.previousSibling) {\r\n                                    if (comm.previousSibling.nodeType === 1 || !util.onlyZeroWidthSpace(comm.previousSibling.textContent.trim())) {\r\n                                        detach = false;\r\n                                        break;\r\n                                    }\r\n                                }\r\n                                comm = comm.parentNode;\r\n                            }\r\n    \r\n                            if (detach && rangeEl.parentNode) {\r\n                                e.preventDefault();\r\n                                core.detachRangeFormatElement(rangeEl, (util.isListCell(formatEl) ? [formatEl] : null), null, false, false);\r\n                                // history stack\r\n                                core.history.push(true);\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    // component\r\n                    if (!selectRange && formatEl && (range.startOffset === 0 || (selectionNode === formatEl ? !!formatEl.childNodes[range.startOffset] : false))) {\r\n                        const sel = selectionNode === formatEl ? formatEl.childNodes[range.startOffset] : selectionNode;\r\n                        const prev = formatEl.previousSibling;\r\n                        // select file component\r\n                        const ignoreZWS = (commonCon.nodeType === 3 || util.isBreak(commonCon)) && !commonCon.previousSibling && range.startOffset === 0;\r\n                        if (!sel.previousSibling && (util.isComponent(commonCon.previousSibling) || (ignoreZWS && util.isComponent(prev)))) {\r\n                            const fileComponentInfo = core.getFileComponent(prev);\r\n                            if (fileComponentInfo) {\r\n                                e.preventDefault();\r\n                                e.stopPropagation();\r\n                                if (formatEl.textContent.length === 0) util.removeItem(formatEl);\r\n                                if (core.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName) === false) core.blur();\r\n                            } else if (util.isComponent(prev)) {\r\n                                e.preventDefault();\r\n                                e.stopPropagation();\r\n                                util.removeItem(prev);\r\n                            }\r\n                            break;\r\n                        }\r\n                        // delete nonEditable\r\n                        if (util.isNonEditable(sel.previousSibling)) {\r\n                            e.preventDefault();\r\n                            e.stopPropagation();\r\n                            util.removeItem(sel.previousSibling);\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    break;\r\n                case 46: /** delete key */\r\n                    if (fileComponentName) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        core.plugins[fileComponentName].destroy.call(core);\r\n                        break;\r\n                    }\r\n\r\n                    if (selectRange && event._hardDelete()) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        break;\r\n                    }\r\n\r\n                    // tag[contenteditable=\"false\"]\r\n                    if (event._isUneditableNode(range, false)) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        break;\r\n                    }\r\n\r\n                    // component\r\n                    if ((util.isFormatElement(selectionNode) || selectionNode.nextSibling === null || (util.onlyZeroWidthSpace(selectionNode.nextSibling) && selectionNode.nextSibling.nextSibling === null)) && range.startOffset === selectionNode.textContent.length) {\r\n                        const nextEl = formatEl.nextElementSibling;\r\n                        if (!nextEl) break;\r\n                        if (util.isComponent(nextEl)) {\r\n                            e.preventDefault();\r\n\r\n                            if (util.onlyZeroWidthSpace(formatEl)) {\r\n                                util.removeItem(formatEl);\r\n                                // table component\r\n                                if (util.isTable(nextEl)) {\r\n                                    let cell = util.getChildElement(nextEl, util.isCell, false);\r\n                                    cell = cell.firstElementChild || cell;\r\n                                    core.setRange(cell, 0, cell, 0);\r\n                                    break;\r\n                                }\r\n                            }\r\n\r\n                            // select file component\r\n                            const fileComponentInfo = core.getFileComponent(nextEl);\r\n                            if (fileComponentInfo) {\r\n                                e.stopPropagation();\r\n                                if (core.selectComponent(fileComponentInfo.target, fileComponentInfo.pluginName) === false) core.blur();\r\n                            } else if (util.isComponent(nextEl)) {\r\n                                e.stopPropagation();\r\n                                util.removeItem(nextEl);\r\n                            }\r\n\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    if (!selectRange && (core.isEdgePoint(range.endContainer, range.endOffset) || (selectionNode === formatEl ? !!formatEl.childNodes[range.startOffset] : false))) {\r\n                        const sel = selectionNode === formatEl ? formatEl.childNodes[range.startOffset] || selectionNode : selectionNode;\r\n                        // delete nonEditable\r\n                        if (sel && util.isNonEditable(sel.nextSibling)) {\r\n                            e.preventDefault();\r\n                            e.stopPropagation();\r\n                            util.removeItem(sel.nextSibling);\r\n                            break;\r\n                        } else if (util.isComponent(sel)) {\r\n                            e.preventDefault();\r\n                            e.stopPropagation();\r\n                            util.removeItem(sel);\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    // nested list\r\n                    formatEl = util.getFormatElement(range.startContainer, null);\r\n                    rangeEl = util.getRangeFormatElement(formatEl, null);\r\n                    if (util.isListCell(formatEl) && util.isList(rangeEl) && (selectionNode === formatEl || (selectionNode.nodeType === 3 && (!selectionNode.nextSibling || util.isList(selectionNode.nextSibling)) &&\r\n                     (util.getFormatElement(range.startContainer, null) !== util.getFormatElement(range.endContainer, null) ? rangeEl.contains(range.endContainer) : (range.endOffset === selectionNode.textContent.length && range.collapsed))))) {\r\n                        if (range.startContainer !== range.endContainer) core.removeNode();\r\n                        \r\n                        let next = util.getArrayItem(formatEl.children, util.isList, false);\r\n                        next = next || formatEl.nextElementSibling || rangeEl.parentNode.nextElementSibling;\r\n                        if (next && (util.isList(next) || util.getArrayItem(next.children, util.isList, false))) {\r\n                            e.preventDefault();\r\n\r\n                            let con, children;\r\n                            if (util.isList(next)) {\r\n                                const child = next.firstElementChild;\r\n                                children = child.childNodes;\r\n                                con = children[0];\r\n                                while (children[0]) {\r\n                                    formatEl.insertBefore(children[0], next);\r\n                                }\r\n                                util.removeItem(child);\r\n                            } else {\r\n                                con = next.firstChild;\r\n                                children = next.childNodes;\r\n                                while (children[0]) {\r\n                                    formatEl.appendChild(children[0]);\r\n                                }\r\n                                util.removeItem(next);\r\n                            }\r\n                            core.setRange(con, 0, con, 0);\r\n                            // history stack\r\n                            core.history.push(true);\r\n                        }\r\n                        break;\r\n                    }\r\n\r\n                    break;\r\n                case 9: /** tab key */\r\n                    if (fileComponentName || options.tabDisable) break;\r\n                    e.preventDefault();\r\n                    if (ctrl || alt || util.isWysiwygDiv(selectionNode)) break;\r\n\r\n                    const isEdge = (!range.collapsed || core.isEdgePoint(range.startContainer, range.startOffset));            \r\n                    const selectedFormats = core.getSelectedElements(null);\r\n                    selectionNode = core.getSelectionNode();\r\n                    const cells = [];\r\n                    let lines = [];\r\n                    let fc = util.isListCell(selectedFormats[0]), lc = util.isListCell(selectedFormats[selectedFormats.length - 1]);\r\n                    let r = {sc: range.startContainer, so: range.startOffset, ec: range.endContainer, eo: range.endOffset};\r\n                    for (let i = 0, len = selectedFormats.length, f; i < len; i++) {\r\n                        f = selectedFormats[i];\r\n                        if (util.isListCell(f)) {\r\n                            if (!f.previousElementSibling && !shift) {\r\n                                continue;\r\n                            } else {\r\n                                cells.push(f);\r\n                            }\r\n                        } else {\r\n                            lines.push(f);\r\n                        }\r\n                    }\r\n                    \r\n                    // Nested list\r\n                    if (cells.length > 0 && isEdge && core.plugins.list) {\r\n                        r = core.plugins.list.editInsideList.call(core, shift, cells);\r\n                    } else {\r\n                        // table\r\n                        const tableCell = util.getParentElement(selectionNode, util.isCell);\r\n                        if (tableCell && isEdge) {\r\n                            const table = util.getParentElement(tableCell, 'table');\r\n                            const cells = util.getListChildren(table, util.isCell);\r\n                            let idx = shift ? util.prevIdx(cells, tableCell) : util.nextIdx(cells, tableCell);\r\n\r\n                            if (idx === cells.length && !shift) idx = 0;\r\n                            if (idx === -1 && shift) idx = cells.length - 1;\r\n\r\n                            let moveCell = cells[idx];\r\n                            if (!moveCell) break;\r\n                            moveCell = moveCell.firstElementChild || moveCell;\r\n                            core.setRange(moveCell, 0, moveCell, 0);\r\n                            break;\r\n                        }\r\n\r\n                        lines = lines.concat(cells);\r\n                        fc = lc = null;\r\n                    }\r\n\r\n                    // Lines tab(4)\r\n                    if (lines.length > 0) {\r\n                        if (!shift) {\r\n                            const tabText = util.createTextNode(new _w.Array(core._variable.tabSize + 1).join('\\u00A0'));\r\n                            if (lines.length === 1) {\r\n                                const textRange = core.insertNode(tabText, null, true);\r\n                                if (!textRange) return false;\r\n                                if (!fc) {\r\n                                    r.sc = tabText;\r\n                                    r.so = textRange.endOffset;\r\n                                }\r\n                                if (!lc) {\r\n                                    r.ec = tabText;\r\n                                    r.eo = textRange.endOffset;\r\n                                }\r\n                            } else {\r\n                                const len = lines.length - 1;\r\n                                for (let i = 0, child; i <= len; i++) {\r\n                                    child = lines[i].firstChild;\r\n                                    if (!child) continue;\r\n    \r\n                                    if (util.isBreak(child)) {\r\n                                        lines[i].insertBefore(tabText.cloneNode(false), child);\r\n                                    } else {\r\n                                        child.textContent = tabText.textContent + child.textContent;\r\n                                    }\r\n                                }\r\n    \r\n                                const firstChild = util.getChildElement(lines[0], 'text', false);\r\n                                const endChild = util.getChildElement(lines[len], 'text', true);\r\n                                if (!fc && firstChild) {\r\n                                    r.sc = firstChild;\r\n                                    r.so = 0;\r\n                                }\r\n                                if (!lc && endChild) {\r\n                                    r.ec = endChild;\r\n                                    r.eo = endChild.textContent.length;\r\n                                }\r\n                            }\r\n                        } else {\r\n                            const len = lines.length - 1;\r\n                            for (let i = 0, line; i <= len; i++) {\r\n                                line = lines[i].childNodes;\r\n                                for (let c = 0, cLen = line.length, child; c < cLen; c++) {\r\n                                    child = line[c];\r\n                                    if (!child) break;\r\n                                    if (util.onlyZeroWidthSpace(child)) continue;\r\n        \r\n                                    if (/^\\s{1,4}$/.test(child.textContent)) {\r\n                                        util.removeItem(child);\r\n                                    } else if (/^\\s{1,4}/.test(child.textContent)) {\r\n                                        child.textContent = child.textContent.replace(/^\\s{1,4}/, '');\r\n                                    }\r\n                                    \r\n                                    break;\r\n                                }\r\n                            }\r\n    \r\n                            const firstChild = util.getChildElement(lines[0], 'text', false);\r\n                            const endChild = util.getChildElement(lines[len], 'text', true);\r\n                            if (!fc && firstChild) {\r\n                                r.sc = firstChild;\r\n                                r.so = 0;\r\n                            }\r\n                            if (!lc && endChild) {\r\n                                r.ec = endChild;\r\n                                r.eo = endChild.textContent.length;\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    core.setRange(r.sc, r.so, r.ec, r.eo);\r\n                    // history stack\r\n                    core.history.push(false);\r\n                    \r\n                    break;\r\n                case 13: /** enter key */\r\n                    const freeFormatEl = util.getFreeFormatElement(selectionNode, null);\r\n\r\n                    if (core._charTypeHTML) {\r\n                        let enterHTML = '';\r\n                        if ((!shift && freeFormatEl) || shift) {\r\n                            enterHTML = '<br>';\r\n                        } else {\r\n                            enterHTML = '<' + formatEl.nodeName + '><br></' + formatEl.nodeName + '>';\r\n                        }\r\n\r\n                        if (!core.checkCharCount(enterHTML, 'byte-html')) {\r\n                            e.preventDefault();\r\n                            return false;\r\n                        }\r\n                    }\r\n\r\n                    if (!shift) {\r\n                        const formatInners = core._isEdgeFormat(range.endContainer, range.endOffset, 'end');\r\n                        if ((formatInners && /^H[1-6]$/i.test(formatEl.nodeName)) || /^HR$/i.test(formatEl.nodeName)) {\r\n                            e.preventDefault();\r\n                            let temp = null;\r\n                            const newFormat = core.appendFormatTag(formatEl, options.defaultTag);\r\n\r\n                            if (formatInners && formatInners.length > 0) {\r\n                                temp = formatInners.pop();\r\n                                const innerNode = temp;\r\n                                while(formatInners.length > 0) {\r\n                                    temp = temp.appendChild(formatInners.pop());\r\n                                }\r\n                                newFormat.appendChild(innerNode);\r\n                            }\r\n\r\n                            temp = !temp ? newFormat.firstChild : temp.appendChild(newFormat.firstChild);\r\n                            core.setRange(temp, 0, temp, 0);\r\n                            break;\r\n                        } else if (options.lineAttrReset && formatEl && !util.isListCell(formatEl)) {\r\n                            e.preventDefault();\r\n                            e.stopPropagation();\r\n\r\n                            let newEl;\r\n                            if (!range.collapsed) {\r\n                                const isMultiLine = util.getFormatElement(range.startContainer, null) !== util.getFormatElement(range.endContainer, null);\r\n                                const r = core.removeNode();\r\n                                if (isMultiLine) {\r\n                                    newEl = util.getFormatElement(r.container, null);\r\n\r\n                                    if (!r.prevContainer) {\r\n                                        const newFormat = formatEl.cloneNode(false);\r\n                                        newFormat.innerHTML = '<br>';\r\n                                        newEl.parentNode.insertBefore(newFormat, newEl);\r\n                                    } else if (newEl !== formatEl && newEl.nextElementSibling === formatEl) {\r\n                                        newEl = formatEl;\r\n                                    }\r\n                                } else {\r\n                                    newEl = util.splitElement(r.container, r.offset, 0);\r\n                                }\r\n                            } else {\r\n                                if (util.onlyZeroWidthSpace(formatEl)) newEl = core.appendFormatTag(formatEl, formatEl.cloneNode(false));\r\n                                else newEl = util.splitElement(range.endContainer, range.endOffset, 0);\r\n                            }\r\n\r\n                            const resetAttr = options.lineAttrReset === '*' ? null : options.lineAttrReset;\r\n                            const attrs = newEl.attributes;\r\n                            let i = 0;\r\n                            while (attrs[i]) {\r\n                                if (resetAttr && resetAttr.test(attrs[i].name)) {\r\n                                    i++;\r\n                                    continue;\r\n                                }\r\n                                newEl.removeAttribute(attrs[i].name);\r\n                            }\r\n                            core.setRange(newEl.firstChild, 0, newEl.firstChild, 0);\r\n\r\n                            break;\r\n                        }\r\n\r\n                        if (freeFormatEl) {\r\n                            e.preventDefault();\r\n                            const selectionFormat = selectionNode === freeFormatEl;\r\n                            const wSelection = core.getSelection();\r\n                            const children = selectionNode.childNodes, offset = wSelection.focusOffset, prev = selectionNode.previousElementSibling, next = selectionNode.nextSibling;\r\n    \r\n                            if (!util.isClosureFreeFormatElement(freeFormatEl) && !!children && ((selectionFormat && range.collapsed && children.length - 1 <= offset + 1 && util.isBreak(children[offset]) && (!children[offset + 1] || ((!children[offset + 2] || util.onlyZeroWidthSpace(children[offset + 2].textContent)) && children[offset + 1].nodeType === 3 && util.onlyZeroWidthSpace(children[offset + 1].textContent))) &&  offset > 0 && util.isBreak(children[offset - 1])) ||\r\n                              (!selectionFormat && util.onlyZeroWidthSpace(selectionNode.textContent) && util.isBreak(prev) && (util.isBreak(prev.previousSibling) || !util.onlyZeroWidthSpace(prev.previousSibling.textContent)) && (!next || (!util.isBreak(next) && util.onlyZeroWidthSpace(next.textContent)))))) {\r\n                                if (selectionFormat) util.removeItem(children[offset - 1]);\r\n                                else util.removeItem(selectionNode);\r\n                                const newEl = core.appendFormatTag(freeFormatEl, (util.isFormatElement(freeFormatEl.nextElementSibling) && !util.isRangeFormatElement(freeFormatEl.nextElementSibling)) ? freeFormatEl.nextElementSibling : null);\r\n                                util.copyFormatAttributes(newEl, freeFormatEl);\r\n                                core.setRange(newEl, 1, newEl, 1);\r\n                                break;\r\n                            }\r\n                            \r\n                            if (selectionFormat) {\r\n                                functions.insertHTML(((range.collapsed && util.isBreak(range.startContainer.childNodes[range.startOffset - 1])) ? '<br>' : '<br><br>'), true, false);\r\n    \r\n                                let focusNode = wSelection.focusNode;\r\n                                const wOffset = wSelection.focusOffset;\r\n                                if (freeFormatEl === focusNode) {\r\n                                    focusNode = focusNode.childNodes[wOffset - offset > 1 ? wOffset - 1 : wOffset];\r\n                                }\r\n    \r\n                                core.setRange(focusNode, 1, focusNode, 1);\r\n                            } else {\r\n                                const focusNext = wSelection.focusNode.nextSibling;\r\n                                const br = util.createElement('BR');\r\n                                core.insertNode(br, null, false);\r\n    \r\n                                const brPrev = br.previousSibling, brNext = br.nextSibling;\r\n                                if (!util.isBreak(focusNext) && !util.isBreak(brPrev) && (!brNext || util.onlyZeroWidthSpace(brNext))) {\r\n                                    br.parentNode.insertBefore(br.cloneNode(false), br);\r\n                                    core.setRange(br, 1, br, 1);\r\n                                } else {\r\n                                    core.setRange(brNext, 0, brNext, 0);\r\n                                }\r\n                            }\r\n    \r\n                            event._onShortcutKey = true;\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    if (selectRange) break;\r\n                    \r\n                    if (rangeEl && formatEl && !util.isCell(rangeEl) && !/^FIGCAPTION$/i.test(rangeEl.nodeName)) {\r\n                        const range = core.getRange();\r\n                        if(core.isEdgePoint(range.endContainer, range.endOffset) && util.isList(selectionNode.nextSibling)) {\r\n                            e.preventDefault();\r\n                            const newEl = util.createElement('LI');\r\n                            const br = util.createElement('BR');\r\n                            newEl.appendChild(br);\r\n\r\n                            formatEl.parentNode.insertBefore(newEl, formatEl.nextElementSibling);\r\n                            newEl.appendChild(selectionNode.nextSibling);\r\n                            \r\n                            core.setRange(br, 1, br, 1);\r\n                            break;\r\n                        }\r\n\r\n                        if ((range.commonAncestorContainer.nodeType === 3 ? !range.commonAncestorContainer.nextElementSibling : true) && util.onlyZeroWidthSpace(formatEl.innerText.trim())) {\r\n                            e.preventDefault();\r\n                            let newEl = null;\r\n\r\n                            if (util.isListCell(rangeEl.parentNode)) {\r\n                                rangeEl = formatEl.parentNode.parentNode.parentNode;\r\n                                newEl = util.splitElement(formatEl, null, util.getElementDepth(formatEl) - 2);\r\n                                if (!newEl) {\r\n                                    const newListCell = util.createElement('LI');\r\n                                    newListCell.innerHTML = '<br>';\r\n                                    rangeEl.insertBefore(newListCell, newEl);\r\n                                    newEl = newListCell;\r\n                                }\r\n                            } else {\r\n                                const newFormat = util.isCell(rangeEl.parentNode) ? 'DIV' : util.isList(rangeEl.parentNode) ? 'LI' : (util.isFormatElement(rangeEl.nextElementSibling) && !util.isRangeFormatElement(rangeEl.nextElementSibling)) ? rangeEl.nextElementSibling.nodeName : (util.isFormatElement(rangeEl.previousElementSibling) && !util.isRangeFormatElement(rangeEl.previousElementSibling)) ? rangeEl.previousElementSibling.nodeName : options.defaultTag;\r\n                                newEl = util.createElement(newFormat);\r\n                                const edge = core.detachRangeFormatElement(rangeEl, [formatEl], null, true, true);\r\n                                edge.cc.insertBefore(newEl, edge.ec);\r\n                            }\r\n                            \r\n                            newEl.innerHTML = '<br>';\r\n                            util.removeItemAllParents(formatEl, null, null);\r\n                            core.setRange(newEl, 1, newEl, 1);\r\n                            break;\r\n                        }\r\n                    }\r\n\r\n                    if (rangeEl && util.getParentElement(rangeEl, 'FIGCAPTION') && util.getParentElement(rangeEl, util.isList)) {\r\n                        e.preventDefault();\r\n                        formatEl = core.appendFormatTag(formatEl, null);\r\n                        core.setRange(formatEl, 0, formatEl, 0);\r\n                    }\r\n\r\n                    if (fileComponentName) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        const compContext = context[fileComponentName];\r\n                        const container = compContext._container;\r\n                        const sibling = container.previousElementSibling || container.nextElementSibling;\r\n\r\n                        let newEl = null;\r\n                        if (util.isListCell(container.parentNode)) {\r\n                            newEl = util.createElement('BR');\r\n                        } else {\r\n                            newEl = util.createElement((util.isFormatElement(sibling) && !util.isRangeFormatElement(sibling)) ? sibling.nodeName : options.defaultTag);\r\n                            newEl.innerHTML = '<br>';\r\n                        }\r\n\r\n                        container.parentNode.insertBefore(newEl, container);\r\n                        \r\n                        core.callPlugin(fileComponentName, function () {\r\n                            if (core.selectComponent(compContext._element, fileComponentName) === false) core.blur();\r\n                        }, null);\r\n                    }\r\n                    \r\n                    break;\r\n                case 27:\r\n                    if (fileComponentName) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        core.controllersOff();\r\n                        return false;\r\n                    }\r\n                    break;\r\n            }\r\n\r\n            if (shift && keyCode === 16) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                const tablePlugin = core.plugins.table;\r\n                if (tablePlugin && !tablePlugin._shift && !tablePlugin._ref) {\r\n                    const cell = util.getParentElement(formatEl, util.isCell);\r\n                    if (cell) {\r\n                        tablePlugin.onTableCellMultiSelect.call(core, cell, true);\r\n                        return;\r\n                    }\r\n                }\r\n            } else if (shift && (util.isOSX_IOS ? alt : ctrl) && keyCode === 32) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                const nbsp = core.insertNode(util.createTextNode('\\u00a0'));\r\n                if (nbsp && nbsp.container) {\r\n                    core.setRange(nbsp.container, nbsp.endOffset, nbsp.container, nbsp.endOffset);\r\n                    return;\r\n                }\r\n            }\r\n\r\n            if (util.isIE && !ctrl && !alt && !selectRange && !event._nonTextKeyCode.test(keyCode) && util.isBreak(range.commonAncestorContainer)) {\r\n                const zeroWidth = util.createTextNode(util.zeroWidthSpace);\r\n                core.insertNode(zeroWidth, null, false);\r\n                core.setRange(zeroWidth, 1, zeroWidth, 1);\r\n            }\r\n        },\r\n\r\n        onKeyUp_wysiwyg: function (e) {\r\n            if (event._onShortcutKey) return;\r\n\r\n            core._editorRange();\r\n            const keyCode = e.keyCode;\r\n            const ctrl = e.ctrlKey || e.metaKey || keyCode === 91 || keyCode === 92 || keyCode === 224;\r\n            const alt = e.altKey;\r\n\r\n            if (core.isReadOnly) {\r\n                if (!ctrl && event._directionKeyCode.test(keyCode)) event._applyTagEffects();\r\n                return;\r\n            }\r\n\r\n            const range = core.getRange();\r\n            let selectionNode = core.getSelectionNode();\r\n\r\n            if (core._isBalloon && ((core._isBalloonAlways && keyCode !== 27) || !range.collapsed)) {\r\n                if (core._isBalloonAlways) {\r\n                    if (keyCode !== 27) event._showToolbarBalloonDelay();\r\n                } else {\r\n                    event._showToolbarBalloon();\r\n                    return;\r\n                }\r\n            }\r\n\r\n            /** when format tag deleted */\r\n            if (keyCode === 8 && util.isWysiwygDiv(selectionNode) && selectionNode.textContent === '' && selectionNode.children.length === 0) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n\r\n                selectionNode.innerHTML = '';\r\n\r\n                const oFormatTag = util.createElement(util.isFormatElement(core._variable.currentNodes[0]) ? core._variable.currentNodes[0] : options.defaultTag);\r\n                oFormatTag.innerHTML = '<br>';\r\n\r\n                selectionNode.appendChild(oFormatTag);\r\n                core.setRange(oFormatTag, 0, oFormatTag, 0);\r\n                event._applyTagEffects();\r\n\r\n                core.history.push(false);\r\n                return;\r\n            }\r\n\r\n            const formatEl = util.getFormatElement(selectionNode, null);\r\n            const rangeEl = util.getRangeFormatElement(selectionNode, null);\r\n            if (!formatEl && range.collapsed && !util.isComponent(selectionNode) && !util.isList(selectionNode) && core._setDefaultFormat(util.isRangeFormatElement(rangeEl) ? 'DIV' : options.defaultTag) !== null) {\r\n                selectionNode = core.getSelectionNode();\r\n            }\r\n\r\n            if (event._directionKeyCode.test(keyCode)) {\r\n                event._applyTagEffects();\r\n            }\r\n\r\n            const textKey = !ctrl && !alt && !event._nonTextKeyCode.test(keyCode);\r\n            if (textKey && selectionNode.nodeType === 3 && util.zeroWidthRegExp.test(selectionNode.textContent) && !(e.isComposing !== undefined ? e.isComposing : event._IEisComposing)) {\r\n                let so = range.startOffset, eo = range.endOffset;\r\n                const frontZeroWidthCnt = (selectionNode.textContent.substring(0, eo).match(event._frontZeroWidthReg) || '').length;\r\n                so = range.startOffset - frontZeroWidthCnt;\r\n                eo = range.endOffset - frontZeroWidthCnt;\r\n                selectionNode.textContent = selectionNode.textContent.replace(util.zeroWidthRegExp, '');\r\n                core.setRange(selectionNode, so < 0 ? 0 : so, selectionNode, eo < 0 ? 0 : eo);\r\n            }\r\n\r\n            core._charCount('');\r\n\r\n            // user event\r\n            if (typeof functions.onKeyUp === 'function' && functions.onKeyUp(e, core) === false) return;\r\n\r\n            // history stack\r\n            if (!ctrl && !alt && !event._historyIgnoreKeyCode.test(keyCode)) {\r\n                core.history.push(true);\r\n            }\r\n        },\r\n\r\n        onScroll_wysiwyg: function (e) {\r\n            core.controllersOff();\r\n            if (core._isBalloon) event._hideToolbar();\r\n\r\n            // user event\r\n            if (typeof functions.onScroll === 'function') functions.onScroll(e, core);\r\n        },\r\n\r\n        onFocus_wysiwyg: function (e) {\r\n            if (core._antiBlur) return;\r\n            core.hasFocus = true;\r\n            _w.setTimeout(event._applyTagEffects);\r\n            \r\n            if (core._isInline) event._showToolbarInline();\r\n\r\n            // user event\r\n            if (typeof functions.onFocus === 'function') functions.onFocus(e, core);\r\n        },\r\n\r\n        onBlur_wysiwyg: function (e) {\r\n            if (core._antiBlur || core._variable.isCodeView) return;\r\n            core.hasFocus = false;\r\n            core.effectNode = null;\r\n            core.controllersOff();\r\n            if (core._isInline || core._isBalloon) event._hideToolbar();\r\n\r\n            core._setKeyEffect([]);\r\n\r\n            core._variable.currentNodes = [];\r\n            core._variable.currentNodesMap = [];\r\n            if (options.showPathLabel) context.element.navigation.textContent = '';\r\n\r\n            // user event\r\n            if (typeof functions.onBlur === 'function') functions.onBlur(e, core);\r\n        },\r\n\r\n        onMouseDown_resizingBar: function (e) {\r\n            e.stopPropagation();\r\n\r\n            core.submenuOff();\r\n            core.controllersOff();\r\n\r\n            core._variable.resizeClientY = e.clientY;\r\n            context.element.resizeBackground.style.display = 'block';\r\n\r\n            function closureFunc() {\r\n                context.element.resizeBackground.style.display = 'none';\r\n                _d.removeEventListener('mousemove', event._resize_editor);\r\n                _d.removeEventListener('mouseup', closureFunc);\r\n            }\r\n\r\n            _d.addEventListener('mousemove', event._resize_editor);\r\n            _d.addEventListener('mouseup', closureFunc);\r\n        },\r\n\r\n        _resize_editor: function (e) {\r\n            const resizeInterval = context.element.editorArea.offsetHeight + (e.clientY - core._variable.resizeClientY);\r\n            const h = (resizeInterval < core._variable.minResizingSize ? core._variable.minResizingSize : resizeInterval);\r\n            context.element.wysiwygFrame.style.height = context.element.code.style.height = h + 'px';\r\n            core._variable.resizeClientY = e.clientY;\r\n            if (util.isIE) core.__callResizeFunction(h, null);\r\n        },\r\n\r\n        onResize_window: function () {\r\n            if (util.isIE) core.resetResponsiveToolbar();\r\n\r\n            if (context.element.toolbar.offsetWidth === 0) return;\r\n\r\n            if (context.fileBrowser && context.fileBrowser.area.style.display === 'block') {\r\n                context.fileBrowser.body.style.maxHeight = (_w.innerHeight - context.fileBrowser.header.offsetHeight - 50) + 'px';\r\n            }\r\n\r\n            if (core.submenuActiveButton && core.submenu) {\r\n                core._setMenuPosition(core.submenuActiveButton, core.submenu);\r\n            }\r\n\r\n            if (core._variable.isFullScreen) {\r\n                core._variable.innerHeight_fullScreen += (_w.innerHeight - context.element.toolbar.offsetHeight) - core._variable.innerHeight_fullScreen;\r\n                context.element.editorArea.style.height = core._variable.innerHeight_fullScreen + 'px';\r\n                return;\r\n            }\r\n\r\n            if (core._variable.isCodeView && core._isInline) {\r\n                event._showToolbarInline();\r\n                return;\r\n            }\r\n            \r\n            core._iframeAutoHeight();\r\n\r\n            if (core._sticky) {\r\n                context.element.toolbar.style.width = (context.element.topArea.offsetWidth - 2) + 'px';\r\n                event.onScroll_window();\r\n            }\r\n        },\r\n\r\n        onScroll_window: function () {\r\n            if (core._variable.isFullScreen || context.element.toolbar.offsetWidth === 0 || options.stickyToolbar < 0) return;\r\n\r\n            const element = context.element;\r\n            const editorHeight = element.editorArea.offsetHeight;\r\n            const y = (this.scrollY || _d.documentElement.scrollTop) + options.stickyToolbar;\r\n            const editorTop = event._getEditorOffsets(options.toolbarContainer).top - (core._isInline ? element.toolbar.offsetHeight : 0);\r\n            const inlineOffset = core._isInline && (y - editorTop) > 0 ? y - editorTop - context.element.toolbar.offsetHeight : 0;\r\n            \r\n            if (y < editorTop) {\r\n                event._offStickyToolbar();\r\n            }\r\n            else if (y + core._variable.minResizingSize >= editorHeight + editorTop) {\r\n                if (!core._sticky) event._onStickyToolbar(inlineOffset);\r\n                element.toolbar.style.top = (inlineOffset + editorHeight + editorTop + options.stickyToolbar - y - core._variable.minResizingSize) + 'px';\r\n            }\r\n            else if (y >= editorTop) {\r\n                event._onStickyToolbar(inlineOffset);\r\n            }\r\n        },\r\n\r\n        _getEditorOffsets: function (container) {\r\n            let offsetEl = container || context.element.topArea;\r\n            let t = 0, l = 0, s = 0;\r\n\r\n            while (offsetEl) {\r\n                t += offsetEl.offsetTop;\r\n                l += offsetEl.offsetLeft;\r\n                s += offsetEl.scrollTop;\r\n                offsetEl = offsetEl.offsetParent;\r\n            }\r\n\r\n            return {\r\n                top: t,\r\n                left: l,\r\n                scroll: s\r\n            };\r\n        },\r\n\r\n        _getPageBottomSpace: function () {\r\n            return _d.documentElement.scrollHeight - (event._getEditorOffsets(null).top + context.element.topArea.offsetHeight);\r\n        },\r\n\r\n        _onStickyToolbar: function (inlineOffset) {\r\n            const element = context.element;\r\n\r\n            if (!core._isInline && !options.toolbarContainer) {\r\n                element._stickyDummy.style.height = element.toolbar.offsetHeight + 'px';\r\n                element._stickyDummy.style.display = 'block';\r\n            }\r\n\r\n            element.toolbar.style.top = (options.stickyToolbar + inlineOffset) + 'px';\r\n            element.toolbar.style.width = core._isInline ? core._inlineToolbarAttr.width : element.toolbar.offsetWidth + 'px';\r\n            util.addClass(element.toolbar, 'se-toolbar-sticky');\r\n            core._sticky = true;\r\n        },\r\n\r\n        _offStickyToolbar: function () {\r\n            const element = context.element;\r\n\r\n            element._stickyDummy.style.display = 'none';\r\n            element.toolbar.style.top = core._isInline ? core._inlineToolbarAttr.top : '';\r\n            element.toolbar.style.width = core._isInline ? core._inlineToolbarAttr.width : '';\r\n            element.editorArea.style.marginTop = '';\r\n\r\n            util.removeClass(element.toolbar, 'se-toolbar-sticky');\r\n            core._sticky = false;\r\n        },\r\n\r\n        _codeViewAutoHeight: function () {\r\n            if (core._variable.isFullScreen) return;\r\n            context.element.code.style.height = context.element.code.scrollHeight + 'px';\r\n        },\r\n\r\n        // FireFox - table delete, Chrome - image, video, audio\r\n        _hardDelete: function () {\r\n            const range = core.getRange();\r\n            const sc = range.startContainer;\r\n            const ec = range.endContainer;\r\n            \r\n            // table\r\n            const sCell = util.getRangeFormatElement(sc);\r\n            const eCell = util.getRangeFormatElement(ec);\r\n            const sIsCell = util.isCell(sCell);\r\n            const eIsCell = util.isCell(eCell);\r\n            const ancestor = range.commonAncestorContainer;\r\n            if (((sIsCell && !sCell.previousElementSibling && !sCell.parentElement.previousElementSibling) || (eIsCell && !eCell.nextElementSibling && !eCell.parentElement.nextElementSibling)) && sCell !== eCell) {\r\n                if (!sIsCell) {\r\n                    util.removeItem(util.getParentElement(eCell, function(current) {return ancestor === current.parentNode;}));\r\n                } else if (!eIsCell) {\r\n                    util.removeItem(util.getParentElement(sCell, function(current) {return ancestor === current.parentNode;}));\r\n                } else {\r\n                    util.removeItem(util.getParentElement(sCell, function(current) {return ancestor === current.parentNode;}));\r\n                    core.nativeFocus();\r\n                    return true;\r\n                }\r\n            }\r\n\r\n            // component\r\n            const sComp = sc.nodeType === 1 ? util.getParentElement(sc, '.se-component') : null;\r\n            const eComp = ec.nodeType === 1 ? util.getParentElement(ec, '.se-component') : null;\r\n            if (sComp) util.removeItem(sComp);\r\n            if (eComp) util.removeItem(eComp);\r\n\r\n            return false;\r\n        },\r\n\r\n        onPaste_wysiwyg: function (e) {\r\n            const clipboardData = util.isIE ? _w.clipboardData : e.clipboardData;\r\n            if (!clipboardData) return true;\r\n            return event._dataTransferAction('paste', e, clipboardData);\r\n        },\r\n\r\n        _setClipboardComponent: function (e, info, clipboardData) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            clipboardData.setData('text/html', info.component.outerHTML);\r\n        },\r\n\r\n        onCopy_wysiwyg: function (e) {\r\n            const clipboardData = util.isIE ? _w.clipboardData : e.clipboardData;\r\n            \r\n            // user event\r\n            if (typeof functions.onCopy === 'function' && !functions.onCopy(e, clipboardData, core)) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                return false;\r\n            }\r\n\r\n            const info = core.currentFileComponentInfo;\r\n            if (info && !util.isIE) {\r\n                event._setClipboardComponent(e, info, clipboardData);\r\n                util.addClass(info.component, 'se-component-copy');\r\n                // copy effect\r\n                _w.setTimeout(function () {\r\n                    util.removeClass(info.component, 'se-component-copy');\r\n                }, 150);\r\n            }\r\n        },\r\n\r\n        onSave_wysiwyg: function (content) {\r\n            // user event\r\n            if (typeof functions.onSave === 'function') {\r\n                functions.onSave(content, core);\r\n                return;\r\n            }\r\n        },\r\n\r\n        onCut_wysiwyg: function (e) {\r\n            const clipboardData = util.isIE ? _w.clipboardData : e.clipboardData;\r\n\r\n            // user event\r\n            if (typeof functions.onCut === 'function' && !functions.onCut(e, clipboardData, core)) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                return false;\r\n            }\r\n\r\n            const info = core.currentFileComponentInfo;\r\n            if (info && !util.isIE) {\r\n                event._setClipboardComponent(e, info, clipboardData);\r\n                util.removeItem(info.component);\r\n                core.controllersOff();\r\n            }\r\n\r\n            _w.setTimeout(function () {\r\n                // history stack\r\n                core.history.push(false);\r\n            });\r\n        },\r\n\r\n        onDrop_wysiwyg: function (e) {\r\n            if (core.isReadOnly || util.isIE) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                return false;\r\n            }\r\n\r\n            const dataTransfer = e.dataTransfer;\r\n            if (!dataTransfer) return true;\r\n\r\n            core.removeNode();\r\n            event._setDropLocationSelection(e);\r\n            return event._dataTransferAction('drop', e, dataTransfer);\r\n        },\r\n\r\n        _setDropLocationSelection: function (e) {\r\n            if (e.rangeParent) {\r\n                core.setRange(e.rangeParent, e.rangeOffset, e.rangeParent, e.rangeOffset);\r\n            } else if (core._wd.caretRangeFromPoint) {\r\n                const r = core._wd.caretRangeFromPoint(e.clientX, e.clientY);\r\n                core.setRange(r.startContainer, r.startOffset, r.endContainer, r.endOffset);\r\n            } else {\r\n                const r = core.getRange();\r\n                core.setRange(r.startContainer, r.startOffset, r.endContainer, r.endOffset);\r\n            }\r\n        },\r\n\r\n        _dataTransferAction: function (type, e, data) {\r\n            let plainText, cleanData;\r\n            if (util.isIE) {\r\n                plainText = data.getData('Text');\r\n                \r\n                const range = core.getRange();\r\n                const tempDiv = util.createElement('DIV');\r\n                const tempRange = {\r\n                    sc: range.startContainer,\r\n                    so: range.startOffset,\r\n                    ec: range.endContainer,\r\n                    eo: range.endOffset\r\n                };\r\n\r\n                tempDiv.setAttribute('contenteditable', true);\r\n                tempDiv.style.cssText = 'position:absolute; top:0; left:0; width:1px; height:1px; overflow:hidden;';\r\n                \r\n                context.element.relative.appendChild(tempDiv);\r\n                tempDiv.focus();\r\n\r\n                _w.setTimeout(function () {\r\n                    cleanData = tempDiv.innerHTML;\r\n                    util.removeItem(tempDiv);\r\n                    core.setRange(tempRange.sc, tempRange.so, tempRange.ec, tempRange.eo);\r\n                    event._setClipboardData(type, e, plainText, cleanData, data);\r\n                });\r\n\r\n                return true;\r\n            } else {\r\n                plainText = data.getData('text/plain');\r\n                cleanData = data.getData('text/html');\r\n                if (event._setClipboardData(type, e, plainText, cleanData, data) === false) {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    return false;\r\n                }\r\n            }\r\n        },\r\n\r\n        _setClipboardData: function (type, e, plainText, cleanData, data) {\r\n            // MS word, OneNode, Excel\r\n            const MSData = /class=[\"']*Mso(Normal|List)/i.test(cleanData) || /content=[\"']*Word.Document/i.test(cleanData) || /content=[\"']*OneNote.File/i.test(cleanData) || /content=[\"']*Excel.Sheet/i.test(cleanData);\r\n            const onlyText = !cleanData;\r\n\r\n            if (!onlyText) {\r\n                if (MSData) {\r\n                    cleanData = cleanData.replace(/\\n/g, ' ');\r\n                    plainText = plainText.replace(/\\n/g, ' ');\r\n                } else {\r\n                    cleanData = (plainText === cleanData ? plainText : cleanData).replace(/\\n/g, '<br>');\r\n                }\r\n                cleanData = core.cleanHTML(cleanData, core.pasteTagsWhitelistRegExp, core.pasteTagsBlacklistRegExp);\r\n            } else {\r\n                cleanData = util._HTMLConvertor(plainText).replace(/\\n/g, '<br>');\r\n            }\r\n\r\n            const maxCharCount = core._charCount(core._charTypeHTML ? cleanData : plainText);\r\n            // user event - paste\r\n            if (type === 'paste' && typeof functions.onPaste === 'function') {\r\n                const value = functions.onPaste(e, cleanData, maxCharCount, core);\r\n                if (!value) return false;\r\n                if (typeof value === 'string') cleanData = value;\r\n            }\r\n            // user event - drop\r\n            if (type === 'drop' && typeof functions.onDrop === 'function') {\r\n                const value = functions.onDrop(e, cleanData, maxCharCount, core);\r\n                if (!value) return false;\r\n                if (typeof value === 'string') cleanData = value;\r\n            }\r\n\r\n            // files\r\n            const files = data.files;\r\n            if (files.length > 0 && !MSData) {\r\n                if (/^image/.test(files[0].type) && core.plugins.image) {\r\n                    functions.insertImage(files);\r\n                }\r\n                return false;\r\n            }\r\n\r\n            if (!maxCharCount) {\r\n                return false;\r\n            }\r\n\r\n            if (cleanData) {\r\n                functions.insertHTML(cleanData, true, false);\r\n                return false;\r\n            }\r\n        },\r\n\r\n        onMouseMove_wysiwyg: function (e) {\r\n            if (core.isDisabled || core.isReadOnly) return false;\r\n            const component = util.getParentElement(e.target, util.isComponent);\r\n            const lineBreakerStyle = core._lineBreaker.style;\r\n            \r\n            if (component && !core.currentControllerName) {\r\n                const ctxEl = context.element;\r\n                let scrollTop = 0;\r\n                let el = ctxEl.wysiwyg;\r\n                do {\r\n                    scrollTop += el.scrollTop;\r\n                    el = el.parentElement;\r\n                } while (el && !/^(BODY|HTML)$/i.test(el.nodeName));\r\n\r\n                const wScroll = ctxEl.wysiwyg.scrollTop;\r\n                const offsets = event._getEditorOffsets(null);\r\n                const componentTop = util.getOffset(component, ctxEl.wysiwygFrame).top + wScroll;\r\n                const y = e.pageY + scrollTop + (options.iframe && !options.toolbarContainer ? ctxEl.toolbar.offsetHeight : 0);\r\n                const c = componentTop + (options.iframe ? scrollTop : offsets.top);\r\n\r\n                const isList = util.isListCell(component.parentNode);\r\n                let dir = '', top = '';\r\n                if ((isList ? !component.previousSibling : !util.isFormatElement(component.previousElementSibling)) && y < (c + 20)) {\r\n                    top = componentTop;\r\n                    dir = 't';\r\n                } else if ((isList ? !component.nextSibling : !util.isFormatElement(component.nextElementSibling)) && y > (c + component.offsetHeight - 20)) {\r\n                    top = componentTop + component.offsetHeight;\r\n                    dir = 'b';\r\n                } else {\r\n                    lineBreakerStyle.display = 'none';\r\n                    return;\r\n                }\r\n\r\n                core._variable._lineBreakComp = component;\r\n                core._variable._lineBreakDir = dir;\r\n                lineBreakerStyle.top = (top - wScroll) + 'px';\r\n                core._lineBreakerButton.style.left = (util.getOffset(component).left + (component.offsetWidth / 2) - 15) + 'px';\r\n                lineBreakerStyle.display = 'block';\r\n            } // off line breaker\r\n            else if (lineBreakerStyle.display !== 'none') {\r\n                lineBreakerStyle.display = 'none';\r\n            }\r\n        },\r\n\r\n        _onMouseDown_lineBreak: function (e) {\r\n            e.preventDefault();\r\n        },\r\n\r\n        _onLineBreak: function (e) {\r\n            e.preventDefault();\r\n            \r\n            const component = core._variable._lineBreakComp;\r\n            const dir = !this ? core._variable._lineBreakDir : this;\r\n            const isList = util.isListCell(component.parentNode);\r\n\r\n            const format = util.createElement(isList ? 'BR' : util.isCell(component.parentNode) ? 'DIV' : options.defaultTag);\r\n            if (!isList) format.innerHTML = '<br>';\r\n\r\n            if (core._charTypeHTML && !core.checkCharCount(format.outerHTML, 'byte-html')) return;\r\n\r\n            component.parentNode.insertBefore(format, dir === 't' ? component : component.nextSibling);\r\n            core._lineBreaker.style.display = 'none';\r\n            core._variable._lineBreakComp = null;\r\n\r\n            const focusEl = isList ? format : format.firstChild;\r\n            core.setRange(focusEl, 1, focusEl, 1);\r\n            // history stack\r\n            core.history.push(false);\r\n        },\r\n\r\n        _resizeObserver: null,\r\n        _toolbarObserver: null,\r\n        _addEvent: function () {\r\n            const eventWysiwyg = options.iframe ? core._ww : context.element.wysiwyg;\r\n            if (!util.isIE) {\r\n                this._resizeObserver = new _w.ResizeObserver(function(entries) {\r\n                    core.__callResizeFunction(-1, entries[0]);\r\n                });\r\n            }\r\n\r\n            /** toolbar event */\r\n            context.element.toolbar.addEventListener('mousedown', event._buttonsEventHandler, false);\r\n            context.element._menuTray.addEventListener('mousedown', event._buttonsEventHandler, false);\r\n            context.element.toolbar.addEventListener('click', event.onClick_toolbar, false);\r\n            /** editor area */\r\n            eventWysiwyg.addEventListener('mousedown', event.onMouseDown_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('click', event.onClick_wysiwyg, false);\r\n            eventWysiwyg.addEventListener(util.isIE ? 'textinput' : 'input', event.onInput_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('keydown', event.onKeyDown_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('keyup', event.onKeyUp_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('paste', event.onPaste_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('copy', event.onCopy_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('cut', event.onCut_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('drop', event.onDrop_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('scroll', event.onScroll_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('focus', event.onFocus_wysiwyg, false);\r\n            eventWysiwyg.addEventListener('blur', event.onBlur_wysiwyg, false);\r\n\r\n            /** line breaker */\r\n            event._lineBreakerBind = { a: event._onLineBreak.bind(''), t: event._onLineBreak.bind('t'), b: event._onLineBreak.bind('b') };\r\n            eventWysiwyg.addEventListener('mousemove', event.onMouseMove_wysiwyg, false);\r\n            core._lineBreakerButton.addEventListener('mousedown', event._onMouseDown_lineBreak, false);\r\n            core._lineBreakerButton.addEventListener('click', event._lineBreakerBind.a, false);\r\n            context.element.lineBreaker_t.addEventListener('mousedown', event._lineBreakerBind.t, false);\r\n            context.element.lineBreaker_b.addEventListener('mousedown', event._lineBreakerBind.b, false);\r\n\r\n            /** Events are registered only when there is a table plugin.  */\r\n            if (core.plugins.table) {\r\n                eventWysiwyg.addEventListener('touchstart', event.onMouseDown_wysiwyg, {passive: true, useCapture: false});\r\n            }\r\n            \r\n            /** code view area auto line */\r\n            if (options.height === 'auto' && !options.codeMirrorEditor) {\r\n                context.element.code.addEventListener('keydown', event._codeViewAutoHeight, false);\r\n                context.element.code.addEventListener('keyup', event._codeViewAutoHeight, false);\r\n                context.element.code.addEventListener('paste', event._codeViewAutoHeight, false);\r\n            }\r\n\r\n            /** resizingBar */\r\n            if (context.element.resizingBar) {\r\n                if (/\\d+/.test(options.height) && options.resizeEnable) {\r\n                    context.element.resizingBar.addEventListener('mousedown', event.onMouseDown_resizingBar, false);\r\n                } else {\r\n                    util.addClass(context.element.resizingBar, 'se-resizing-none');\r\n                }\r\n            }\r\n            \r\n            /** set response toolbar */\r\n            event._setResponsiveToolbar();\r\n\r\n            /** responsive toolbar observer */\r\n            if (!util.isIE) this._toolbarObserver = new _w.ResizeObserver(core.resetResponsiveToolbar);\r\n            \r\n            /** window event */\r\n            _w.addEventListener('resize', event.onResize_window, false);\r\n            if (options.stickyToolbar > -1) {\r\n                _w.addEventListener('scroll', event.onScroll_window, false);\r\n            }\r\n        },\r\n\r\n        _removeEvent: function () {\r\n            const eventWysiwyg = options.iframe ? core._ww : context.element.wysiwyg;\r\n\r\n            context.element.toolbar.removeEventListener('mousedown', event._buttonsEventHandler);\r\n            context.element._menuTray.removeEventListener('mousedown', event._buttonsEventHandler);\r\n            context.element.toolbar.removeEventListener('click', event.onClick_toolbar);\r\n\r\n            eventWysiwyg.removeEventListener('mousedown', event.onMouseDown_wysiwyg);\r\n            eventWysiwyg.removeEventListener('click', event.onClick_wysiwyg);\r\n            eventWysiwyg.removeEventListener(util.isIE ? 'textinput' : 'input', event.onInput_wysiwyg);\r\n            eventWysiwyg.removeEventListener('keydown', event.onKeyDown_wysiwyg);\r\n            eventWysiwyg.removeEventListener('keyup', event.onKeyUp_wysiwyg);\r\n            eventWysiwyg.removeEventListener('paste', event.onPaste_wysiwyg);\r\n            eventWysiwyg.removeEventListener('copy', event.onCopy_wysiwyg);\r\n            eventWysiwyg.removeEventListener('cut', event.onCut_wysiwyg);\r\n            eventWysiwyg.removeEventListener('drop', event.onDrop_wysiwyg);\r\n            eventWysiwyg.removeEventListener('scroll', event.onScroll_wysiwyg);\r\n\r\n            eventWysiwyg.removeEventListener('mousemove', event.onMouseMove_wysiwyg);\r\n            core._lineBreakerButton.removeEventListener('mousedown', event._onMouseDown_lineBreak);\r\n            core._lineBreakerButton.removeEventListener('click', event._lineBreakerBind.a);\r\n            context.element.lineBreaker_t.removeEventListener('mousedown', event._lineBreakerBind.t);\r\n            context.element.lineBreaker_b.removeEventListener('mousedown', event._lineBreakerBind.b);\r\n            event._lineBreakerBind = null;\r\n            \r\n            eventWysiwyg.removeEventListener('touchstart', event.onMouseDown_wysiwyg, {passive: true, useCapture: false});\r\n            eventWysiwyg.removeEventListener('focus', event.onFocus_wysiwyg);\r\n            eventWysiwyg.removeEventListener('blur', event.onBlur_wysiwyg);\r\n\r\n            context.element.code.removeEventListener('keydown', event._codeViewAutoHeight);\r\n            context.element.code.removeEventListener('keyup', event._codeViewAutoHeight);\r\n            context.element.code.removeEventListener('paste', event._codeViewAutoHeight);\r\n            \r\n            if (context.element.resizingBar) {\r\n                context.element.resizingBar.removeEventListener('mousedown', event.onMouseDown_resizingBar);\r\n            }\r\n            \r\n            if (event._resizeObserver) {\r\n                event._resizeObserver.unobserve(context.element.wysiwygFrame);\r\n                event._resizeObserver = null;\r\n            }\r\n\r\n            if (event._toolbarObserver) {\r\n                event._toolbarObserver.unobserve(context.element._toolbarShadow);\r\n                event._toolbarObserver = null;\r\n            }\r\n\r\n            _w.removeEventListener('resize', event.onResize_window);\r\n            _w.removeEventListener('scroll', event.onScroll_window);\r\n        },\r\n\r\n        _setResponsiveToolbar: function () {\r\n            if (_responsiveButtons.length === 0) {\r\n                _responsiveButtons = null;\r\n                return;\r\n            }\r\n\r\n            event._responsiveCurrentSize = 'default';\r\n            const sizeArray = event._responsiveButtonSize = [];\r\n            const buttonsObj = event._responsiveButtons = {default: _responsiveButtons[0]};\r\n            for (let i = 1, len = _responsiveButtons.length, size, buttonGroup; i < len; i++) {\r\n                buttonGroup = _responsiveButtons[i];\r\n                size = buttonGroup[0] * 1;\r\n                sizeArray.push(size);\r\n                buttonsObj[size] = buttonGroup[1];\r\n            }\r\n\r\n            sizeArray.sort(function (a, b) { return a - b; }).unshift('default');\r\n        }\r\n    };\r\n\r\n    /** functions */\r\n    const functions = {\r\n        /**\r\n         * @description Core, Util object\r\n         */\r\n        core: core,\r\n        util: util,\r\n\r\n        /**\r\n         * @description Event functions\r\n         * @param {Object} e Event Object\r\n         * @param {Object} core Core object\r\n         */\r\n        onload: null,\r\n        onScroll: null,\r\n        onMouseDown: null,\r\n        onClick: null,\r\n        onInput: null,\r\n        onKeyDown: null,\r\n        onKeyUp: null,\r\n        onCopy: null,\r\n        onCut: null,\r\n        onFocus: null,\r\n        onBlur: null,\r\n\r\n        /**\r\n         * @description Event functions\r\n         * @param {String} contents Current contents\r\n         * @param {Object} core Core object\r\n         */\r\n        onChange: null,\r\n\r\n         /**\r\n         * @description Event functions\r\n         * @param {String} contents Current contents\r\n         * @param {Object} core Core object\r\n         */\r\n          onSave: null,\r\n\r\n        /**\r\n         * @description Event functions (drop, paste)\r\n         * When false is returned, the default behavior is stopped.\r\n         * If the string is returned, the cleanData value is modified to the return value.\r\n         * @param {Object} e Event object.\r\n         * @param {String} cleanData HTML string modified for editor format.\r\n         * @param {Boolean} maxChartCount option (true if max character is exceeded)\r\n         * @param {Object} core Core object\r\n         * @returns {Boolean|String}\r\n         */\r\n        onDrop: null,\r\n        onPaste: null,\r\n\r\n        /**\r\n         * @description Called just before the inline toolbar is positioned and displayed on the screen.\r\n         * @param {Element} toolbar Toolbar Element\r\n         * @param {Object} context The editor's context object (editor.getContext())\r\n         * @param {Object} core Core object\r\n         */\r\n        showInline: null,\r\n\r\n        /**\r\n         * @description Called just after the controller is positioned and displayed on the screen.\r\n         * controller - editing elements displayed on the screen [image resizing, table editor, link editor..]]\r\n         * @param {String} name The name of the plugin that called the controller\r\n         * @param {Array} controllers Array of Controller elements\r\n         * @param {Object} core Core object\r\n         */\r\n        showController: null,\r\n\r\n        /**\r\n         * @description An event when toggling between code view and wysiwyg view.\r\n         * @param {Boolean} isCodeView Whether the current code view mode\r\n         * @param {Object} core Core object\r\n         */\r\n        toggleCodeView: null,\r\n\r\n        /**\r\n         * @description An event when toggling full screen.\r\n         * @param {Boolean} isFullScreen Whether the current full screen mode\r\n         * @param {Object} core Core object\r\n         */\r\n        toggleFullScreen: null,\r\n\r\n        /**\r\n         * @description It replaces the default callback function of the image upload\r\n         * @param {Object} response Response object\r\n         * @param {Object} info Input information\r\n         * - linkValue: Link url value\r\n         * - linkNewWindow: Open in new window Check Value\r\n         * - inputWidth: Value of width input\r\n         * - inputHeight: Value of height input\r\n         * - align: Align Check Value\r\n         * - isUpdate: Update image if true, create image if false\r\n         * - element: If isUpdate is true, the currently selected image.\r\n         * @param {Object} core Core object\r\n         */\r\n        imageUploadHandler: null,\r\n\r\n        /**\r\n         * @description It replaces the default callback function of the video upload\r\n         * @param xmlHttp xmlHttpRequest object\r\n         * @param info Input information\r\n         * - inputWidth: Value of width input\r\n         * - inputHeight: Value of height input\r\n         * - align: Align Check Value\r\n         * - isUpdate: Update video if true, create video if false\r\n         * - element: If isUpdate is true, the currently selected video.\r\n         * @param core Core object\r\n         */\r\n        videoUploadHandler: null,\r\n\r\n        /**\r\n         * @description It replaces the default callback function of the audio upload\r\n         * @param xmlHttp xmlHttpRequest object\r\n         * @param info Input information\r\n         * - isUpdate: Update audio if true, create audio if false\r\n         * - element: If isUpdate is true, the currently selected audio.\r\n         * @param core Core object\r\n         */\r\n        audioUploadHandler: null,\r\n\r\n        /**\r\n         * @description Called before the image is uploaded\r\n         * If true is returned, the internal upload process runs normally.\r\n         * If false is returned, no image upload is performed.\r\n         * If new fileList are returned,  replaced the previous fileList\r\n         * If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n         * @param {Array} files Files array\r\n         * @param {Object} info info: {\r\n         * - linkValue: Link url value\r\n         * - linkNewWindow: Open in new window Check Value\r\n         * - inputWidth: Value of width input\r\n         * - inputHeight: Value of height input\r\n         * - align: Align Check Value\r\n         * - isUpdate: Update image if true, create image if false\r\n         * - element: If isUpdate is true, the currently selected image.\r\n         * }\r\n         * @param {Object} core Core object\r\n         * @param {Function} uploadHandler If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n         *                \"uploadHandler\" is an upload function with \"core\" and \"info\" bound.\r\n         *                [upload files] : uploadHandler(files or [new File(...),])\r\n         *                [error]        : uploadHandler(\"Error message\")\r\n         *                [Just finish]  : uploadHandler()\r\n         *                [directly register] : uploadHandler(response) // Same format as \"imageUploadUrl\" response\r\n         *                                   ex) {\r\n         *                                      // \"errorMessage\": \"insert error message\",\r\n         *                                      \"result\": [ { \"url\": \"...\", \"name\": \"...\", \"size\": \"999\" }, ]\r\n         *                                   }\r\n         * @returns {Boolean|Array|undefined}\r\n         */\r\n        onImageUploadBefore: null,\r\n        /**\r\n         * @description Called before the video is uploaded\r\n         * If true is returned, the internal upload process runs normally.\r\n         * If false is returned, no video(iframe, video) upload is performed.\r\n         * If new fileList are returned,  replaced the previous fileList\r\n         * If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n         * @param {Array} files Files array\r\n         * @param {Object} info info: {\r\n         * - inputWidth: Value of width input\r\n         * - inputHeight: Value of height input\r\n         * - align: Align Check Value\r\n         * - isUpdate: Update video if true, create video if false\r\n         * - element: If isUpdate is true, the currently selected video.\r\n         * }\r\n         * @param {Object} core Core object\r\n         * @param {Function} uploadHandler If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n         *                \"uploadHandler\" is an upload function with \"core\" and \"info\" bound.\r\n         *                [upload files] : uploadHandler(files or [new File(...),])\r\n         *                [error]        : uploadHandler(\"Error message\")\r\n         *                [Just finish]  : uploadHandler()\r\n         *                [directly register] : uploadHandler(response) // Same format as \"videoUploadUrl\" response\r\n         *                                   ex) {\r\n         *                                      // \"errorMessage\": \"insert error message\",\r\n         *                                      \"result\": [ { \"url\": \"...\", \"name\": \"...\", \"size\": \"999\" }, ]\r\n         *                                   }\r\n         * @returns {Boolean|Array|undefined}\r\n         */\r\n        onVideoUploadBefore: null,\r\n        /**\r\n         * @description Called before the audio is uploaded\r\n         * If true is returned, the internal upload process runs normally.\r\n         * If false is returned, no audio upload is performed.\r\n         * If new fileList are returned,  replaced the previous fileList\r\n         * If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n         * @param {Array} files Files array\r\n         * @param {Object} info info: {\r\n         * - isUpdate: Update audio if true, create audio if false\r\n         * - element: If isUpdate is true, the currently selected audio.\r\n         * }\r\n         * @param {Object} core Core object\r\n         * @param {Function} uploadHandler If undefined is returned, it waits until \"uploadHandler\" is executed.\r\n         *                \"uploadHandler\" is an upload function with \"core\" and \"info\" bound.\r\n         *                [upload files] : uploadHandler(files or [new File(...),])\r\n         *                [error]        : uploadHandler(\"Error message\")\r\n         *                [Just finish]  : uploadHandler()\r\n         *                [directly register] : uploadHandler(response) // Same format as \"audioUploadUrl\" response\r\n         *                                   ex) {\r\n         *                                      // \"errorMessage\": \"insert error message\",\r\n         *                                      \"result\": [ { \"url\": \"...\", \"name\": \"...\", \"size\": \"999\" }, ]\r\n         *                                   }\r\n         * @returns {Boolean|Array|undefined}\r\n         */\r\n        onAudioUploadBefore: null,\r\n\r\n        /**\r\n         * @description Called when the image is uploaded, updated, deleted\r\n         * @param {Element} targetElement Target element\r\n         * @param {Number} index Uploaded index\r\n         * @param {String} state Upload status ('create', 'update', 'delete')\r\n         * @param {Object} info Image info object\r\n         * - index: data index\r\n         * - name: file name\r\n         * - size: file size\r\n         * - select: select function\r\n         * - delete: delete function\r\n         * - element: target element\r\n         * - src: src attribute of tag\r\n         * @param {Number} remainingFilesCount Count of remaining files to upload (0 when added as a url)\r\n         * @param {Object} core Core object\r\n         */\r\n        onImageUpload: null,\r\n         /**\r\n         * @description Called when the video(iframe, video) is is uploaded, updated, deleted\r\n         * -- arguments is same \"onImageUpload\" --\r\n         */\r\n        onVideoUpload: null,\r\n         /**\r\n         * @description Called when the audio is is uploaded, updated, deleted\r\n         * -- arguments is same \"onImageUpload\" --\r\n         */\r\n        onAudioUpload: null,\r\n\r\n        /**\r\n         * @description Called when the image is upload failed\r\n         * @param {String} errorMessage Error message\r\n         * @param {Object} result Response Object\r\n         * @param {Object} core Core object\r\n         * @returns {Boolean}\r\n         */\r\n        onImageUploadError: null,\r\n        /**\r\n         * @description Called when the video(iframe, video) upload failed\r\n         * -- arguments is same \"onImageUploadError\" --\r\n         */\r\n        onVideoUploadError: null,\r\n        /**\r\n         * @description Called when the audio upload failed\r\n         * -- arguments is same \"onImageUploadError\" --\r\n         */\r\n        onAudioUploadError: null,\r\n\r\n        /**\r\n         * @description Called when the editor is resized using the bottom bar\r\n         */\r\n        onResizeEditor: null,\r\n\r\n        /**\r\n         * @description Called after the \"setToolbarButtons\" invocation.\r\n         * Can be used to tweak buttons properties (useful for custom buttons)\r\n         * @param {Array} buttonList Button list \r\n         * @param {Object} core Core object\r\n         */\r\n        onSetToolbarButtons: null,\r\n\r\n        /**\r\n         * @description Reset the buttons on the toolbar. (Editor is not reloaded)\r\n         * You cannot set a new plugin for the button.\r\n         * @param {Array} buttonList Button list \r\n         */\r\n        setToolbarButtons: function (buttonList) {\r\n            core.submenuOff();\r\n            core.containerOff();\r\n            core.moreLayerOff();\r\n            \r\n            const newToolbar = _Constructor._createToolBar(_d, buttonList, core.plugins, options);\r\n            _responsiveButtons = newToolbar.responsiveButtons;\r\n            event._setResponsiveToolbar();\r\n\r\n            context.element.toolbar.replaceChild(newToolbar._buttonTray, context.element._buttonTray);\r\n            const newContext = _Context(context.element.originElement, core._getConstructed(context.element), options);\r\n\r\n            context.element = newContext.element;\r\n            context.tool = newContext.tool;\r\n            if (options.iframe) context.element.wysiwyg = core._wd.body;\r\n\r\n            core._recoverButtonStates();\r\n            core._cachingButtons();\r\n            core.history._resetCachingButton();\r\n\r\n            core.effectNode = null;\r\n            if (core.hasFocus) event._applyTagEffects();\r\n            if (core.isReadOnly) util.setDisabledButtons(true, core.resizingDisabledButtons);\r\n            if (typeof functions.onSetToolbarButtons === 'function') functions.onSetToolbarButtons(newToolbar._buttonTray.querySelectorAll('button'), core);\r\n        },\r\n\r\n        /**\r\n         * @description Add or reset option property (Editor is reloaded)\r\n         * @param {Object} _options Options\r\n         */\r\n        setOptions: function (_options) {\r\n            event._removeEvent();\r\n            core._resetComponents();\r\n            \r\n            util.removeClass(core._styleCommandMap.showBlocks, 'active');\r\n            util.removeClass(core._styleCommandMap.codeView, 'active');\r\n            core._variable.isCodeView = false;\r\n            core._iframeAuto = null;\r\n\r\n            core.plugins = _options.plugins || core.plugins;\r\n            const mergeOptions = [options, _options].reduce(function (init, option) {\r\n                for (let key in option) {\r\n                    if (!util.hasOwn(option, key)) continue;\r\n                    if (key === 'plugins' && option[key] && init[key]) {\r\n                        let i = init[key], o = option[key];\r\n                        i = i.length ? i : _w.Object.keys(i).map(function(name) { return i[name]; });\r\n                        o = o.length ? o : _w.Object.keys(o).map(function(name) { return o[name]; });\r\n                        init[key] = (o.filter(function(val) { return i.indexOf(val) === -1; })).concat(i);\r\n                    } else {\r\n                        init[key] = option[key];\r\n                    }\r\n                }\r\n                return init;\r\n            }, {});\r\n\r\n            const el = context.element;\r\n            const _initHTML = el.wysiwyg.innerHTML;\r\n\r\n            // set option\r\n            const cons = _Constructor._setOptions(mergeOptions, context, options);\r\n\r\n            if (cons.callButtons) {\r\n                pluginCallButtons = cons.callButtons;\r\n                core.initPlugins = {};\r\n            }\r\n\r\n            if (cons.plugins) {\r\n                core.plugins = plugins = cons.plugins;\r\n            }\r\n\r\n            // reset context\r\n            if (el._menuTray.children.length === 0) this._menuTray = {};\r\n            _responsiveButtons = cons.toolbar.responsiveButtons;\r\n            core.options = options = mergeOptions;\r\n            core.lang = lang = options.lang;\r\n\r\n            if (options.iframe) {\r\n                el.wysiwygFrame.addEventListener('load', function () {\r\n                    util._setIframeDocument(this, options);\r\n                    core._setOptionsInit(el, _initHTML);\r\n                });\r\n            }\r\n\r\n            el.editorArea.appendChild(el.wysiwygFrame);\r\n\r\n            if (!options.iframe) {\r\n                core._setOptionsInit(el, _initHTML);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Set \"options.defaultStyle\" style.\r\n         * Define the style of the edit area\r\n         * It can also be defined with the \"setOptions\" method, but the \"setDefaultStyle\" method does not render the editor again.\r\n         * @param {String} style Style string\r\n         */\r\n        setDefaultStyle: function (style) {\r\n            const newStyles = options._editorStyles = util._setDefaultOptionStyle(options, style);\r\n            const el = context.element;\r\n\r\n            // top area\r\n            el.topArea.style.cssText = newStyles.top;\r\n            // code view\r\n            el.code.style.cssText = options._editorStyles.frame;\r\n            el.code.style.display = 'none';\r\n            if (options.height === 'auto') {\r\n                el.code.style.overflow = 'hidden';\r\n            } else {\r\n                el.code.style.overflow = '';\r\n            }\r\n            // wysiwyg frame\r\n            if (!options.iframe) {\r\n                el.wysiwygFrame.style.cssText = newStyles.frame + newStyles.editor;\r\n            } else {\r\n                el.wysiwygFrame.style.cssText = newStyles.frame;\r\n                el.wysiwyg.style.cssText = newStyles.editor;\r\n            }\r\n        },\r\n\r\n        /**\r\n         * @description Open a notice area\r\n         * @param {String} message Notice message\r\n         */\r\n        noticeOpen: function (message) {\r\n            core.notice.open.call(core, message);\r\n        },\r\n\r\n        /**\r\n         * @description Close a notice area\r\n         */\r\n        noticeClose: function () {\r\n            core.notice.close.call(core);\r\n        },\r\n\r\n        /**\r\n         * @description Copying the contents of the editor to the original textarea and execute onSave callback\r\n         */\r\n        save: function () {\r\n            const contents = core.getContents(false);\r\n            context.element.originElement.value = contents;\r\n            event.onSave_wysiwyg(contents, core);\r\n        },\r\n\r\n        /**\r\n         * @description Gets the suneditor's context object. Contains settings, plugins, and cached element objects\r\n         * @returns {Object}\r\n         */\r\n        getContext: function () {\r\n            return context;\r\n        },\r\n\r\n        /**\r\n         * @description Gets the contents of the suneditor\r\n         * @param {Boolean} onlyContents - Return only the contents of the body without headers when the \"fullPage\" option is true\r\n         * @returns {String}\r\n         */\r\n        getContents: function (onlyContents) {\r\n            return core.getContents(onlyContents);\r\n        },\r\n\r\n        /**\r\n         * @description Gets only the text of the suneditor contents\r\n         * @returns {String}\r\n         */\r\n        getText: function () {\r\n            return context.element.wysiwyg.textContent;\r\n        },\r\n\r\n        /**\r\n         * @description Get the editor's number of characters or binary data size.\r\n         * You can use the \"charCounterType\" option format.\r\n         * @param {String|null} charCounterType options - charCounterType ('char', 'byte', 'byte-html')\r\n         * If argument is no value, the currently set \"charCounterType\" option is used.\r\n         * @returns {Number}\r\n         */\r\n        getCharCount: function (charCounterType) {\r\n            charCounterType = typeof charCounterType === 'string' ? charCounterType : options.charCounterType;\r\n            return core.getCharLength((core._charTypeHTML ? context.element.wysiwyg.innerHTML : context.element.wysiwyg.textContent), charCounterType);\r\n        },\r\n\r\n        /**\r\n         * @description Gets uploaded images informations\r\n         * - index: data index\r\n         * - name: file name\r\n         * - size: file size\r\n         * - select: select function\r\n         * - delete: delete function\r\n         * - element: target element\r\n         * - src: src attribute of tag\r\n         * @returns {Array}\r\n         */\r\n        getImagesInfo: function () {\r\n            return context.image ? context.image._infoList : [];\r\n        },\r\n        \r\n        /**\r\n         * @description Gets uploaded files(plugin using fileManager) information list.\r\n         * image: [img], video: [video, iframe], audio: [audio]\r\n         * When the argument value is 'image', it is the same function as \"getImagesInfo\".\r\n         * - index: data index\r\n         * - name: file name\r\n         * - size: file size\r\n         * - select: select function\r\n         * - delete: delete function\r\n         * - element: target element\r\n         * - src: src attribute of tag\r\n         * @param {String} pluginName Plugin name (image, video, audio)\r\n         * @returns {Array}\r\n         */\r\n        getFilesInfo: function (pluginName) {\r\n            return context[pluginName] ? context[pluginName]._infoList : [];\r\n        },\r\n\r\n        /**\r\n         * @description Upload images using image plugin\r\n         * @param {FileList} files FileList\r\n         */\r\n        insertImage: function (files) {\r\n            if (!core.plugins.image || !files) return;\r\n\r\n            if (!core.initPlugins.image) core.callPlugin('image', core.plugins.image.submitAction.bind(core, files), null);\r\n            else core.plugins.image.submitAction.call(core, files);\r\n            core.focus();\r\n        },\r\n\r\n        /**\r\n         * @description Inserts an HTML element or HTML string or plain string at the current cursor position\r\n         * @param {Element|String} html HTML Element or HTML string or plain string\r\n         * @param {Boolean} notCleaningData If true, inserts the HTML string without refining it with core.cleanHTML.\r\n         * @param {Boolean} checkCharCount If true, if \"options.maxCharCount\" is exceeded when \"element\" is added, null is returned without addition.\r\n         * @param {Boolean} rangeSelection If true, range select the inserted node.\r\n         */\r\n        insertHTML: function (html, notCleaningData, checkCharCount, rangeSelection) {\r\n            if (!context.element.wysiwygFrame.contains(core.getSelection().focusNode)) core.focus();\r\n\r\n            if (typeof html === 'string') {\r\n                if (!notCleaningData) html = core.cleanHTML(html, null, null);\r\n                try {\r\n                    if (util.isListCell(util.getFormatElement(core.getSelectionNode(), null))) {\r\n                        const dom = _d.createRange().createContextualFragment(html);\r\n                        const domTree = dom.childNodes;\r\n                        if (core._isFormatData(domTree)) html = core._convertListCell(domTree);\r\n                    }\r\n\r\n                    const dom = _d.createRange().createContextualFragment(html);\r\n                    const domTree = dom.childNodes;\r\n\r\n                    if (checkCharCount) {\r\n                        const type = core._charTypeHTML ? 'outerHTML' : 'textContent';\r\n                        let checkHTML = '';\r\n                        for (let i = 0, len = domTree.length; i < len; i++) {\r\n                            checkHTML += domTree[i][type];\r\n                        }\r\n                        if (!core.checkCharCount(checkHTML, null)) return;\r\n                    }\r\n\r\n                    let c, a, t, prev, firstCon;\r\n                    while ((c = domTree[0])) {\r\n                        if (prev && prev.nodeType === 3 && a && a.nodeType === 1 && util.isBreak(c)) {\r\n                            prev = c;\r\n                            util.removeItem(c);\r\n                            continue;\r\n                        }\r\n                        t = core.insertNode(c, a, false);\r\n                        a = t.container || t;\r\n                        if (!firstCon) firstCon = t;\r\n                        prev = c;\r\n                    }\r\n\r\n                    if (prev.nodeType === 3 && a.nodeType === 1) a = prev;\r\n                    const offset = a.nodeType === 3 ? (t.endOffset || a.textContent.length): a.childNodes.length;\r\n                    if (rangeSelection) core.setRange(firstCon.container || firstCon, firstCon.startOffset || 0, a, offset);\r\n                    else core.setRange(a, offset, a, offset);\r\n                } catch (error) {\r\n                    if (core.isDisabled || core.isReadOnly) return;\r\n                    console.warn('[SUNEDITOR.insertHTML.fail] ' + error);\r\n                    core.execCommand('insertHTML', false, html);\r\n                }\r\n            } else {\r\n                if (util.isComponent(html)) {\r\n                    core.insertComponent(html, false, checkCharCount, false);\r\n                } else {\r\n                    let afterNode = null;\r\n                    if (util.isFormatElement(html) || util.isMedia(html)) {\r\n                        afterNode = util.getFormatElement(core.getSelectionNode(), null);\t\r\n                    }\r\n                    core.insertNode(html, afterNode, checkCharCount);\r\n                }\r\n            }\r\n            \r\n            core.effectNode = null;\r\n            core.focus();\r\n\r\n            // history stack\r\n            core.history.push(false);\r\n        },\r\n\r\n        /**\r\n         * @description Change the contents of the suneditor\r\n         * @param {String|undefined} contents Contents to Input\r\n         */\r\n        setContents: function (contents) {\r\n            core.setContents(contents);\r\n        },\r\n\r\n        /**\r\n         * @description Add contents to the suneditor\r\n         * @param {String} contents Contents to Input\r\n         */\r\n        appendContents: function (contents) {\r\n            const convertValue = core.convertContentsForEditor(contents);\r\n            \r\n            if (!core._variable.isCodeView) {\r\n                const temp = util.createElement('DIV');\r\n                temp.innerHTML = convertValue;\r\n\r\n                const wysiwyg = context.element.wysiwyg;\r\n                const children = temp.children;\r\n                for (let i = 0, len = children.length; i < len; i++) {\r\n                    if (children[i]) {\r\n                        wysiwyg.appendChild(children[i]);         \r\n                    }\r\n                }\r\n            } else {\r\n                core._setCodeView(core._getCodeView() + '\\n' + core.convertHTMLForCodeView(convertValue, false));\r\n            }\r\n\r\n            // history stack\r\n            core.history.push(false);\r\n        },\r\n\r\n        /**\r\n         * @description Switch to or off \"ReadOnly\" mode.\r\n         * @param {Boolean} value \"readOnly\" boolean value.\r\n         */\r\n        readOnly: function (value) {\r\n            core.isReadOnly = value;\r\n            \r\n            util.setDisabledButtons(!!value, core.resizingDisabledButtons);\r\n\r\n            if (value) {\r\n                /** off menus */\r\n                core.controllersOff();\r\n                if (core.submenuActiveButton && core.submenuActiveButton.disabled) core.submenuOff();\r\n                if (core._moreLayerActiveButton && core._moreLayerActiveButton.disabled) core.moreLayerOff();\r\n                if (core.containerActiveButton && core.containerActiveButton.disabled) core.containerOff();\r\n                if (core.modalForm) core.plugins.dialog.close.call(core);\r\n\r\n                context.element.code.setAttribute(\"readOnly\", \"true\");\r\n                util.addClass(context.element.wysiwygFrame, 'se-read-only');\r\n            } else {\r\n                context.element.code.removeAttribute(\"readOnly\");\r\n                util.removeClass(context.element.wysiwygFrame, 'se-read-only');\r\n            }\r\n\r\n            if (options.codeMirrorEditor) options.codeMirrorEditor.setOption('readOnly', !!value);\r\n        },\r\n\r\n        /**\r\n         * @description Disable the suneditor\r\n         */\r\n        disable: function () {\r\n            this.toolbar.disable();\r\n            this.wysiwyg.disable();\r\n        },\r\n\r\n        /**\r\n         * @description Provided for backward compatibility and will be removed in 3.0.0 version\r\n         */\r\n         disabled: function () {\r\n            this.disable();\r\n        },\r\n\r\n        /**\r\n         * @description Enable the suneditor\r\n         */\r\n        enable: function () {\r\n            this.toolbar.enable();\r\n            this.wysiwyg.enable();\r\n        },\r\n\r\n        /**\r\n         * @description Provided for backward compatibility and will be removed in 3.0.0 version\r\n         */\r\n         enabled: function () {\r\n            this.enable();\r\n        },\r\n\r\n        /**\r\n         * @description Show the suneditor\r\n         */\r\n        show: function () {\r\n            const topAreaStyle = context.element.topArea.style;\r\n            if (topAreaStyle.display === 'none') topAreaStyle.display = options.display;\r\n        },\r\n\r\n        /**\r\n         * @description Hide the suneditor\r\n         */\r\n        hide: function () {\r\n            context.element.topArea.style.display = 'none';\r\n        },\r\n\r\n        /**\r\n         * @description Destroy the suneditor\r\n         */\r\n        destroy: function () {\r\n            /** off menus */\r\n            core.submenuOff();\r\n            core.containerOff();\r\n            core.controllersOff();\r\n            if (core.notice) core.notice.close.call(core);\r\n            if (core.modalForm) core.plugins.dialog.close.call(core);\r\n\r\n            /** remove history */\r\n            core.history._destroy();\r\n\r\n            /** remove event listeners */\r\n            event._removeEvent();\r\n            \r\n            /** remove element */\r\n            util.removeItem(context.element.toolbar);\r\n            util.removeItem(context.element.topArea);\r\n\r\n            /** remove object reference */\r\n            for (let k in core.functions) { if (util.hasOwn(core, k)) delete core.functions[k]; }\r\n            for (let k in core) { if (util.hasOwn(core, k)) delete core[k]; }\r\n            for (let k in event) { if (util.hasOwn(event, k)) delete event[k]; }\r\n            for (let k in context) { if (util.hasOwn(context, k)) delete context[k]; }\r\n            for (let k in pluginCallButtons) { if (util.hasOwn(pluginCallButtons, k)) delete pluginCallButtons[k]; }\r\n            \r\n            /** remove user object */\r\n            for (let k in this) { if (util.hasOwn(this, k)) delete this[k]; }\r\n        },\r\n\r\n        /**\r\n         * @description Toolbar methods\r\n         */\r\n        toolbar: {\r\n            /**\r\n             * @description Disable the toolbar\r\n             */\r\n            disable: function () {\r\n                /** off menus */\r\n                core.submenuOff();\r\n                core.moreLayerOff();\r\n                core.containerOff();\r\n\r\n                context.tool.cover.style.display = 'block';\r\n            },\r\n\r\n            /**\r\n             * @description Provided for backward compatibility and will be removed in 3.0.0 version\r\n             */\r\n            disabled: function () {\r\n                this.disable();\r\n            },\r\n\r\n            /**\r\n             * @description Enable the toolbar\r\n             */\r\n            enable: function () {\r\n                context.tool.cover.style.display = 'none';\r\n            },\r\n\r\n            /**\r\n             * @description Provided for backward compatibility and will be removed in 3.0.0 version\r\n             */\r\n             enabled: function () {\r\n                this.enable();\r\n            },\r\n\r\n            /**\r\n             * @description Show the toolbar\r\n             */\r\n            show: function () {\r\n                if (core._isInline) {\r\n                    event._showToolbarInline();\r\n                } else {\r\n                    context.element.toolbar.style.display = '';\r\n                    context.element._stickyDummy.style.display = '';\r\n                }\r\n            },\r\n\r\n            /**\r\n             * @description Hide the toolbar\r\n             */\r\n            hide: function () {\r\n                if (core._isInline) {\r\n                    event._hideToolbar();\r\n                } else {\r\n                    context.element.toolbar.style.display = 'none';\r\n                    context.element._stickyDummy.style.display = 'none';\r\n                }\r\n            },\r\n        },\r\n\r\n        /**\r\n         * @description Wysiwyg methods\r\n         */\r\n         wysiwyg: {\r\n            /**\r\n             * @description Disable the wysiwyg area\r\n             */\r\n            disable: function () {\r\n               /** off menus */\r\n                core.controllersOff();\r\n                if (core.modalForm) core.plugins.dialog.close.call(core);\r\n\r\n                context.element.wysiwyg.setAttribute('contenteditable', false);\r\n                core.isDisabled = true;\r\n\r\n                if (options.codeMirrorEditor) {\r\n                    options.codeMirrorEditor.setOption('readOnly', true);\r\n                } else {\r\n                    context.element.code.setAttribute('disabled', 'disabled');\r\n                }\r\n            },\r\n\r\n            /**\r\n             * @description Enable the wysiwyg area\r\n             */\r\n            enable: function () {\r\n                context.element.wysiwyg.setAttribute('contenteditable', true);\r\n                core.isDisabled = false;\r\n\r\n                if (options.codeMirrorEditor) {\r\n                    options.codeMirrorEditor.setOption('readOnly', false);\r\n                } else {\r\n                    context.element.code.removeAttribute('disabled');\r\n                }\r\n            },\r\n         }\r\n    };\r\n\r\n    /************ Core init ************/\r\n    // functions\r\n    core.functions = functions;\r\n    core.options = options;\r\n\r\n    // Create to sibling node\r\n    let contextEl = context.element;\r\n    let originEl = contextEl.originElement;\r\n    let topEl = contextEl.topArea;\r\n    originEl.style.display = 'none';\r\n    topEl.style.display = 'block';\r\n\r\n    // init\r\n    if (options.iframe) {\r\n        contextEl.wysiwygFrame.addEventListener('load', function () {\r\n            util._setIframeDocument(this, options);\r\n            core._editorInit(false, options.value);\r\n            options.value = null;\r\n        });\r\n    }\r\n\r\n    // insert editor element\r\n    if (typeof originEl.nextElementSibling === 'object') {\r\n        originEl.parentNode.insertBefore(topEl, originEl.nextElementSibling);\r\n    } else {\r\n        originEl.parentNode.appendChild(topEl);\r\n    }\r\n\r\n    contextEl.editorArea.appendChild(contextEl.wysiwygFrame);\r\n    contextEl = originEl = topEl = null;\r\n\r\n    // init\r\n    if (!options.iframe) {\r\n        core._editorInit(false, options.value);\r\n        options.value = null;\r\n    }\r\n\r\n    return functions;\r\n}"]},"metadata":{},"sourceType":"module"}