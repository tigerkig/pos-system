{"ast":null,"code":"/*\n * wysiwyg web editor\n *\n * suneditor.js\n * Copyright 2017 JiHong Lee.\n * MIT license.\n */\n'use strict';\n\nimport selectMenu from './_selectMenu';\nexport default {\n  name: 'anchor',\n  add: function add(core) {\n    core.addModule([selectMenu]);\n    core.context.anchor = {\n      caller: {},\n      forms: this.setDialogForm(core),\n      host: (core._w.location.origin + core._w.location.pathname).replace(/\\/$/, ''),\n      callerContext: null\n    };\n  },\n\n  /** dialog */\n  setDialogForm: function setDialogForm(core) {\n    var lang = core.lang;\n    var relList = core.options.linkRel;\n    var defaultRel = (core.options.linkRelDefault.default || '').split(' ');\n    var icons = core.icons;\n    var forms = core.util.createElement('DIV');\n    var html = '<div class=\"se-dialog-body\">' + '<div class=\"se-dialog-form\">' + '<label>' + lang.dialogBox.linkBox.url + '</label>' + '<div class=\"se-dialog-form-files\">' + '<input class=\"se-input-form se-input-url\" type=\"text\" placeholder=\"' + (core.options.protocol || '') + '\" />' + '<button type=\"button\" class=\"se-btn se-dialog-files-edge-button _se_bookmark_button\" title=\"' + lang.dialogBox.linkBox.bookmark + '\" aria-label=\"' + lang.dialogBox.linkBox.bookmark + '\">' + icons.bookmark + '</button>' + core.plugins.selectMenu.setForm() + '</div>' + '<div class=\"se-anchor-preview-form\">' + '<span class=\"se-svg se-anchor-preview-icon _se_anchor_bookmark_icon\">' + icons.bookmark + '</span>' + '<span class=\"se-svg se-anchor-preview-icon _se_anchor_download_icon\">' + icons.download + '</span>' + '<pre class=\"se-link-preview\"></pre>' + '</div>' + '</div>' + '<div class=\"se-dialog-form\">' + '<label>' + lang.dialogBox.linkBox.text + '</label><input class=\"se-input-form _se_anchor_text\" type=\"text\" />' + '</div>' + '<div class=\"se-dialog-form-footer\">' + '<label><input type=\"checkbox\" class=\"se-dialog-btn-check _se_anchor_check\" />&nbsp;' + lang.dialogBox.linkBox.newWindowCheck + '</label>' + '<label><input type=\"checkbox\" class=\"se-dialog-btn-check _se_anchor_download\" />&nbsp;' + lang.dialogBox.linkBox.downloadLinkCheck + '</label>';\n\n    if (relList.length > 0) {\n      html += '<div class=\"se-anchor-rel\"><button type=\"button\" class=\"se-btn se-btn-select se-anchor-rel-btn\">&lt;rel&gt;</button>' + '<div class=\"se-anchor-rel-wrapper\"><pre class=\"se-link-preview se-anchor-rel-preview\"></pre></div>' + '<div class=\"se-list-layer\">' + '<div class=\"se-list-inner\">' + '<ul class=\"se-list-basic se-list-checked\">';\n\n      for (var i = 0, len = relList.length, rel; i < len; i++) {\n        rel = relList[i];\n        html += '<li><button type=\"button\" class=\"se-btn-list' + (defaultRel.indexOf(rel) > -1 ? ' se-checked' : '') + '\" data-command=\"' + rel + '\" title=\"' + rel + '\" aria-label=\"' + rel + '\"><span class=\"se-svg\">' + icons.checked + '</span>' + rel + '</button></li>';\n      }\n\n      html += '</ul></div></div></div>';\n    }\n\n    html += '</div></div>';\n    forms.innerHTML = html;\n    return forms;\n  },\n  initEvent: function initEvent(pluginName, forms) {\n    var anchorPlugin = this.plugins.anchor;\n    var context = this.context.anchor.caller[pluginName] = {\n      modal: forms,\n      urlInput: null,\n      linkDefaultRel: this.options.linkRelDefault,\n      defaultRel: this.options.linkRelDefault.default || '',\n      currentRel: [],\n      linkAnchor: null,\n      linkValue: '',\n      _change: false,\n      callerName: pluginName\n    };\n    if (typeof context.linkDefaultRel.default === 'string') context.linkDefaultRel.default = context.linkDefaultRel.default.trim();\n    if (typeof context.linkDefaultRel.check_new_window === 'string') context.linkDefaultRel.check_new_window = context.linkDefaultRel.check_new_window.trim();\n    if (typeof context.linkDefaultRel.check_bookmark === 'string') context.linkDefaultRel.check_bookmark = context.linkDefaultRel.check_bookmark.trim();\n    context.urlInput = forms.querySelector('.se-input-url');\n    context.anchorText = forms.querySelector('._se_anchor_text');\n    context.newWindowCheck = forms.querySelector('._se_anchor_check');\n    context.downloadCheck = forms.querySelector('._se_anchor_download');\n    context.download = forms.querySelector('._se_anchor_download_icon');\n    context.preview = forms.querySelector('.se-link-preview');\n    context.bookmark = forms.querySelector('._se_anchor_bookmark_icon');\n    context.bookmarkButton = forms.querySelector('._se_bookmark_button');\n    this.plugins.selectMenu.initEvent.call(this, pluginName, forms);\n    var listContext = this.context.selectMenu.caller[pluginName];\n    /** rel */\n\n    if (this.options.linkRel.length > 0) {\n      context.relButton = forms.querySelector('.se-anchor-rel-btn');\n      context.relList = forms.querySelector('.se-list-layer');\n      context.relPreview = forms.querySelector('.se-anchor-rel-preview');\n      context.relButton.addEventListener('click', anchorPlugin.onClick_relButton.bind(this, context));\n      context.relList.addEventListener('click', anchorPlugin.onClick_relList.bind(this, context));\n    }\n\n    context.newWindowCheck.addEventListener('change', anchorPlugin.onChange_newWindowCheck.bind(this, context));\n    context.downloadCheck.addEventListener('change', anchorPlugin.onChange_downloadCheck.bind(this, context));\n    context.anchorText.addEventListener('input', anchorPlugin.onChangeAnchorText.bind(this, context));\n    context.urlInput.addEventListener('input', anchorPlugin.onChangeUrlInput.bind(this, context));\n    context.urlInput.addEventListener('keydown', anchorPlugin.onKeyDownUrlInput.bind(this, listContext));\n    context.urlInput.addEventListener('focus', anchorPlugin.onFocusUrlInput.bind(this, context, listContext));\n    context.urlInput.addEventListener('blur', anchorPlugin.onBlurUrlInput.bind(this, listContext));\n    context.bookmarkButton.addEventListener('click', anchorPlugin.onClick_bookmarkButton.bind(this, context));\n  },\n  on: function on(contextAnchor, update) {\n    var anchorPlugin = this.plugins.anchor;\n\n    if (!update) {\n      anchorPlugin.init.call(this, contextAnchor);\n      contextAnchor.anchorText.value = this.getSelection().toString().trim();\n      contextAnchor.newWindowCheck.checked = this.options.linkTargetNewWindow;\n    } else if (contextAnchor.linkAnchor) {\n      this.context.dialog.updateModal = true;\n      var href = contextAnchor.linkAnchor.getAttribute('href');\n      contextAnchor.linkValue = contextAnchor.preview.textContent = contextAnchor.urlInput.value = anchorPlugin.selfPathBookmark.call(this, href) ? href.substr(href.lastIndexOf('#')) : href;\n      contextAnchor.anchorText.value = contextAnchor.linkAnchor.textContent || contextAnchor.linkAnchor.getAttribute('alt');\n      contextAnchor.newWindowCheck.checked = /_blank/i.test(contextAnchor.linkAnchor.target) ? true : false;\n      contextAnchor.downloadCheck.checked = contextAnchor.linkAnchor.download;\n    }\n\n    this.context.anchor.callerContext = contextAnchor;\n    anchorPlugin.setRel.call(this, contextAnchor, update && contextAnchor.linkAnchor ? contextAnchor.linkAnchor.rel : contextAnchor.defaultRel);\n    anchorPlugin.setLinkPreview.call(this, contextAnchor, contextAnchor.linkValue);\n    this.plugins.selectMenu.on.call(this, contextAnchor.callerName, this.plugins.anchor.setHeaderBookmark);\n  },\n  selfPathBookmark: function selfPathBookmark(path) {\n    var href = this._w.location.href.replace(/\\/$/, '');\n\n    return path.indexOf('#') === 0 || path.indexOf(href) === 0 && path.indexOf('#') === (href.indexOf(\"#\") === -1 ? href.length : href.substr(0, href.indexOf(\"#\")).length);\n  },\n  _closeRelMenu: null,\n  toggleRelList: function toggleRelList(contextAnchor, show) {\n    if (!show) {\n      if (this.plugins.anchor._closeRelMenu) this.plugins.anchor._closeRelMenu();\n    } else {\n      var target = contextAnchor.relButton;\n      var relList = contextAnchor.relList;\n      this.util.addClass(target, 'active');\n      relList.style.visibility = 'hidden';\n      relList.style.display = 'block';\n      if (!this.options.rtl) relList.style.left = target.offsetLeft + target.offsetWidth + 1 + 'px';else relList.style.left = target.offsetLeft - relList.offsetWidth - 1 + 'px';\n      relList.style.top = target.offsetTop + target.offsetHeight / 2 - relList.offsetHeight / 2 + 'px';\n      relList.style.visibility = '';\n\n      this.plugins.anchor._closeRelMenu = function (context, target, e) {\n        if (e && (context.relButton.contains(e.target) || context.relList.contains(e.target))) return;\n        this.util.removeClass(target, 'active');\n        context.relList.style.display = 'none';\n        this.modalForm.removeEventListener('click', this.plugins.anchor._closeRelMenu);\n        this.plugins.anchor._closeRelMenu = null;\n      }.bind(this, contextAnchor, target);\n\n      this.modalForm.addEventListener('click', this.plugins.anchor._closeRelMenu);\n    }\n  },\n  onClick_relButton: function onClick_relButton(contextAnchor, e) {\n    this.plugins.anchor.toggleRelList.call(this, contextAnchor, !this.util.hasClass(e.target, 'active'));\n  },\n  onClick_relList: function onClick_relList(contextAnchor, e) {\n    var target = e.target;\n    var cmd = target.getAttribute('data-command');\n    if (!cmd) return;\n    var current = contextAnchor.currentRel;\n    var checked = this.util.toggleClass(target, 'se-checked');\n    var index = current.indexOf(cmd);\n\n    if (checked) {\n      if (index === -1) current.push(cmd);\n    } else {\n      if (index > -1) current.splice(index, 1);\n    }\n\n    contextAnchor.relPreview.title = contextAnchor.relPreview.textContent = current.join(' ');\n  },\n  setRel: function setRel(contextAnchor, relAttr) {\n    var relListEl = contextAnchor.relList;\n    var rels = contextAnchor.currentRel = !relAttr ? [] : relAttr.split(' ');\n    if (!relListEl) return;\n    var checkedRel = relListEl.querySelectorAll('button');\n\n    for (var i = 0, len = checkedRel.length, cmd; i < len; i++) {\n      cmd = checkedRel[i].getAttribute('data-command');\n\n      if (rels.indexOf(cmd) > -1) {\n        this.util.addClass(checkedRel[i], 'se-checked');\n      } else {\n        this.util.removeClass(checkedRel[i], 'se-checked');\n      }\n    }\n\n    contextAnchor.relPreview.title = contextAnchor.relPreview.textContent = rels.join(' ');\n  },\n  createHeaderList: function createHeaderList(contextAnchor, contextList, urlValue) {\n    var headers = this.util.getListChildren(this.context.element.wysiwyg, function (current) {\n      return /h[1-6]/i.test(current.nodeName);\n    });\n    if (headers.length === 0) return;\n    var valueRegExp = new this._w.RegExp('^' + urlValue.replace(/^#/, ''), 'i');\n    var list = [];\n    var html = '';\n\n    for (var i = 0, len = headers.length, h; i < len; i++) {\n      h = headers[i];\n      if (!valueRegExp.test(h.textContent)) continue;\n      list.push(h);\n      html += '<li class=\"se-select-item\" data-index=\"' + i + '\">' + h.textContent + '</li>';\n    }\n\n    if (list.length === 0) {\n      this.plugins.selectMenu.close.call(this, contextList);\n    } else {\n      this.plugins.selectMenu.createList(contextList, list, html);\n      this.plugins.selectMenu.open.call(this, contextList, this.plugins.anchor._setMenuListPosition.bind(this, contextAnchor));\n    }\n  },\n  _setMenuListPosition: function _setMenuListPosition(contextAnchor, list) {\n    list.style.top = contextAnchor.urlInput.offsetHeight + 1 + 'px';\n  },\n  onKeyDownUrlInput: function onKeyDownUrlInput(contextList, e) {\n    var keyCode = e.keyCode;\n\n    switch (keyCode) {\n      case 38:\n        // up\n        e.preventDefault();\n        e.stopPropagation();\n        this.plugins.selectMenu.moveItem.call(this, contextList, -1);\n        break;\n\n      case 40:\n        // down\n        e.preventDefault();\n        e.stopPropagation();\n        this.plugins.selectMenu.moveItem.call(this, contextList, 1);\n        break;\n\n      case 13:\n        // enter\n        if (contextList.index > -1) {\n          e.preventDefault();\n          e.stopPropagation();\n          this.plugins.anchor.setHeaderBookmark.call(this, this.plugins.selectMenu.getItem(contextList, null));\n        }\n\n        break;\n    }\n  },\n  setHeaderBookmark: function setHeaderBookmark(header) {\n    var contextAnchor = this.context.anchor.callerContext;\n\n    var id = header.id || 'h_' + this._w.Math.random().toString().replace(/.+\\./, '');\n\n    header.id = id;\n    contextAnchor.urlInput.value = '#' + id;\n\n    if (!contextAnchor.anchorText.value.trim() || !contextAnchor._change) {\n      contextAnchor.anchorText.value = header.textContent;\n    }\n\n    this.plugins.anchor.setLinkPreview.call(this, contextAnchor, contextAnchor.urlInput.value);\n    this.plugins.selectMenu.close.call(this, this.context.selectMenu.callerContext);\n    this.context.anchor.callerContext.urlInput.focus();\n  },\n  onChangeAnchorText: function onChangeAnchorText(contextAnchor, e) {\n    contextAnchor._change = !!e.target.value.trim();\n  },\n  onChangeUrlInput: function onChangeUrlInput(contextAnchor, e) {\n    var value = e.target.value.trim();\n    this.plugins.anchor.setLinkPreview.call(this, contextAnchor, value);\n    if (this.plugins.anchor.selfPathBookmark.call(this, value)) this.plugins.anchor.createHeaderList.call(this, contextAnchor, this.context.selectMenu.callerContext, value);else this.plugins.selectMenu.close.call(this, this.context.selectMenu.callerContext);\n  },\n  onFocusUrlInput: function onFocusUrlInput(contextAnchor, contextLink) {\n    var value = contextAnchor.urlInput.value;\n    if (this.plugins.anchor.selfPathBookmark.call(this, value)) this.plugins.anchor.createHeaderList.call(this, contextAnchor, contextLink, value);\n  },\n  onBlurUrlInput: function onBlurUrlInput(contextList) {\n    this.plugins.selectMenu.close.call(this, contextList);\n  },\n  setLinkPreview: function setLinkPreview(context, value) {\n    var preview = context.preview;\n    var protocol = this.options.linkProtocol;\n    var noPrefix = this.options.linkNoPrefix;\n    var reservedProtocol = /^(mailto\\:|tel\\:|sms\\:|https*\\:\\/\\/|#)/.test(value);\n    var sameProtocol = !protocol ? false : this._w.RegExp('^' + value.substr(0, protocol.length)).test(protocol);\n    value = context.linkValue = preview.textContent = !value ? '' : noPrefix ? value : protocol && !reservedProtocol && !sameProtocol ? protocol + value : reservedProtocol ? value : /^www\\./.test(value) ? 'http://' + value : this.context.anchor.host + (/^\\//.test(value) ? '' : '/') + value;\n\n    if (this.plugins.anchor.selfPathBookmark.call(this, value)) {\n      context.bookmark.style.display = 'block';\n      this.util.addClass(context.bookmarkButton, 'active');\n    } else {\n      context.bookmark.style.display = 'none';\n      this.util.removeClass(context.bookmarkButton, 'active');\n    }\n\n    if (!this.plugins.anchor.selfPathBookmark.call(this, value) && context.downloadCheck.checked) {\n      context.download.style.display = 'block';\n    } else {\n      context.download.style.display = 'none';\n    }\n  },\n  setCtx: function setCtx(anchor, contextAnchor) {\n    if (!anchor) return;\n    contextAnchor.linkAnchor = anchor;\n    contextAnchor.linkValue = anchor.href;\n    contextAnchor.currentRel = anchor.rel.split(\" \");\n  },\n  updateAnchor: function updateAnchor(anchor, url, alt, contextAnchor, notText) {\n    // download\n    if (!this.plugins.anchor.selfPathBookmark.call(this, url) && contextAnchor.downloadCheck.checked) {\n      anchor.setAttribute('download', alt || url);\n    } else {\n      anchor.removeAttribute('download');\n    } // new window\n\n\n    if (contextAnchor.newWindowCheck.checked) anchor.target = '_blank';else anchor.removeAttribute('target'); // rel\n\n    var rel = contextAnchor.currentRel.join(' ');\n    if (!rel) anchor.removeAttribute('rel');else anchor.rel = rel; // est url, alt\n\n    anchor.href = url;\n    anchor.setAttribute('alt', alt);\n\n    if (notText) {\n      if (anchor.children.length === 0) anchor.textContent = '';\n    } else {\n      anchor.textContent = alt;\n    }\n  },\n  createAnchor: function createAnchor(contextAnchor, notText) {\n    if (contextAnchor.linkValue.length === 0) return null;\n    var url = contextAnchor.linkValue;\n    var anchor = contextAnchor.anchorText;\n    var anchorText = anchor.value.length === 0 ? url : anchor.value;\n    var oA = contextAnchor.linkAnchor || this.util.createElement('A');\n    this.plugins.anchor.updateAnchor.call(this, oA, url, anchorText, contextAnchor, notText);\n    contextAnchor.linkValue = contextAnchor.preview.textContent = contextAnchor.urlInput.value = contextAnchor.anchorText.value = '';\n    return oA;\n  },\n  onClick_bookmarkButton: function onClick_bookmarkButton(contextAnchor) {\n    var url = contextAnchor.urlInput.value;\n\n    if (this.plugins.anchor.selfPathBookmark.call(this, url)) {\n      url = url.substr(1);\n      contextAnchor.bookmark.style.display = 'none';\n      this.util.removeClass(contextAnchor.bookmarkButton, 'active');\n      this.plugins.selectMenu.close.call(this, this.context.selectMenu.callerContext);\n    } else {\n      url = '#' + url;\n      contextAnchor.bookmark.style.display = 'block';\n      this.util.addClass(contextAnchor.bookmarkButton, 'active');\n      contextAnchor.downloadCheck.checked = false;\n      contextAnchor.download.style.display = 'none';\n      this.plugins.anchor.createHeaderList.call(this, contextAnchor, this.context.selectMenu.callerContext, url);\n    }\n\n    contextAnchor.urlInput.value = url;\n    this.plugins.anchor.setLinkPreview.call(this, contextAnchor, url);\n    contextAnchor.urlInput.focus();\n  },\n  onChange_newWindowCheck: function onChange_newWindowCheck(contextAnchor, e) {\n    if (typeof contextAnchor.linkDefaultRel.check_new_window !== 'string') return;\n\n    if (e.target.checked) {\n      this.plugins.anchor.setRel.call(this, contextAnchor, this.plugins.anchor._relMerge.call(this, contextAnchor, contextAnchor.linkDefaultRel.check_new_window));\n    } else {\n      this.plugins.anchor.setRel.call(this, contextAnchor, this.plugins.anchor._relDelete.call(this, contextAnchor, contextAnchor.linkDefaultRel.check_new_window));\n    }\n  },\n  onChange_downloadCheck: function onChange_downloadCheck(contextAnchor, e) {\n    if (e.target.checked) {\n      contextAnchor.download.style.display = 'block';\n      contextAnchor.bookmark.style.display = 'none';\n      this.util.removeClass(contextAnchor.bookmarkButton, 'active');\n      contextAnchor.linkValue = contextAnchor.preview.textContent = contextAnchor.urlInput.value = contextAnchor.urlInput.value.replace(/^\\#+/, '');\n\n      if (typeof contextAnchor.linkDefaultRel.check_bookmark === 'string') {\n        this.plugins.anchor.setRel.call(this, contextAnchor, this.plugins.anchor._relMerge.call(this, contextAnchor, contextAnchor.linkDefaultRel.check_bookmark));\n      }\n    } else {\n      contextAnchor.download.style.display = 'none';\n\n      if (typeof contextAnchor.linkDefaultRel.check_bookmark === 'string') {\n        this.plugins.anchor.setRel.call(this, contextAnchor, this.plugins.anchor._relDelete.call(this, contextAnchor, contextAnchor.linkDefaultRel.check_bookmark));\n      }\n    }\n  },\n  _relMerge: function _relMerge(contextAnchor, relAttr) {\n    var current = contextAnchor.currentRel;\n    if (!relAttr) return current.join(' ');\n\n    if (/^only\\:/.test(relAttr)) {\n      relAttr = relAttr.replace(/^only\\:/, '').trim();\n      contextAnchor.currentRel = relAttr.split(' ');\n      return relAttr;\n    }\n\n    var rels = relAttr.split(' ');\n\n    for (var i = 0, len = rels.length, index; i < len; i++) {\n      index = current.indexOf(rels[i]);\n      if (index === -1) current.push(rels[i]);\n    }\n\n    return current.join(' ');\n  },\n  _relDelete: function _relDelete(contextAnchor, relAttr) {\n    if (!relAttr) return contextAnchor.currentRel.join(' ');\n    if (/^only\\:/.test(relAttr)) relAttr = relAttr.replace(/^only\\:/, '').trim();\n    var rels = contextAnchor.currentRel.join(' ').replace(this._w.RegExp(relAttr + '\\\\s*'), '');\n    contextAnchor.currentRel = rels.split(' ');\n    return rels;\n  },\n  init: function init(contextAnchor) {\n    contextAnchor.linkAnchor = null;\n    contextAnchor.linkValue = contextAnchor.preview.textContent = contextAnchor.urlInput.value = '';\n    contextAnchor.anchorText.value = '';\n    contextAnchor.newWindowCheck.checked = false;\n    contextAnchor.downloadCheck.checked = false;\n    contextAnchor._change = false;\n    this.plugins.anchor.setRel.call(this, contextAnchor, contextAnchor.defaultRel);\n\n    if (contextAnchor.relList) {\n      this.plugins.anchor.toggleRelList.call(this, contextAnchor, false);\n    }\n\n    this.context.anchor.callerContext = null;\n    this.plugins.selectMenu.init.call(this, this.context.selectMenu.callerContext);\n  }\n};","map":{"version":3,"sources":["E:/React/pos-system/main/node_modules/suneditor/src/plugins/modules/_anchor.js"],"names":["selectMenu","name","add","core","addModule","context","anchor","caller","forms","setDialogForm","host","_w","location","origin","pathname","replace","callerContext","lang","relList","options","linkRel","defaultRel","linkRelDefault","default","split","icons","util","createElement","html","dialogBox","linkBox","url","protocol","bookmark","plugins","setForm","download","text","newWindowCheck","downloadLinkCheck","length","i","len","rel","indexOf","checked","innerHTML","initEvent","pluginName","anchorPlugin","modal","urlInput","linkDefaultRel","currentRel","linkAnchor","linkValue","_change","callerName","trim","check_new_window","check_bookmark","querySelector","anchorText","downloadCheck","preview","bookmarkButton","call","listContext","relButton","relPreview","addEventListener","onClick_relButton","bind","onClick_relList","onChange_newWindowCheck","onChange_downloadCheck","onChangeAnchorText","onChangeUrlInput","onKeyDownUrlInput","onFocusUrlInput","onBlurUrlInput","onClick_bookmarkButton","on","contextAnchor","update","init","value","getSelection","toString","linkTargetNewWindow","dialog","updateModal","href","getAttribute","textContent","selfPathBookmark","substr","lastIndexOf","test","target","setRel","setLinkPreview","setHeaderBookmark","path","_closeRelMenu","toggleRelList","show","addClass","style","visibility","display","rtl","left","offsetLeft","offsetWidth","top","offsetTop","offsetHeight","e","contains","removeClass","modalForm","removeEventListener","hasClass","cmd","current","toggleClass","index","push","splice","title","join","relAttr","relListEl","rels","checkedRel","querySelectorAll","createHeaderList","contextList","urlValue","headers","getListChildren","element","wysiwyg","nodeName","valueRegExp","RegExp","list","h","close","createList","open","_setMenuListPosition","keyCode","preventDefault","stopPropagation","moveItem","getItem","header","id","Math","random","focus","contextLink","linkProtocol","noPrefix","linkNoPrefix","reservedProtocol","sameProtocol","setCtx","updateAnchor","alt","notText","setAttribute","removeAttribute","children","createAnchor","oA","_relMerge","_relDelete"],"mappings":"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","sourcesContent":["/*\n * wysiwyg web editor\n *\n * suneditor.js\n * Copyright 2017 JiHong Lee.\n * MIT license.\n */\n'use strict';\n\nimport selectMenu from './_selectMenu';\n\nexport default {\n    name: 'anchor',\n    add: function (core) {\n        core.addModule([selectMenu]);\n        \n        core.context.anchor = {\n            caller: {},\n            forms: this.setDialogForm(core),\n            host: (core._w.location.origin + core._w.location.pathname).replace(/\\/$/, ''),\n            callerContext: null\n        };\n    },\n\n    /** dialog */\n    setDialogForm: function (core) {\n        const lang = core.lang;\n        const relList = core.options.linkRel;\n        const defaultRel = (core.options.linkRelDefault.default || '').split(' ');\n        const icons = core.icons;\n        const forms = core.util.createElement('DIV');\n\n        let html = '<div class=\"se-dialog-body\">' +\n            '<div class=\"se-dialog-form\">' +\n                '<label>' + lang.dialogBox.linkBox.url + '</label>' +\n                '<div class=\"se-dialog-form-files\">' +\n                    '<input class=\"se-input-form se-input-url\" type=\"text\" placeholder=\"' + (core.options.protocol || '') + '\" />' +\n                    '<button type=\"button\" class=\"se-btn se-dialog-files-edge-button _se_bookmark_button\" title=\"' + lang.dialogBox.linkBox.bookmark + '\" aria-label=\"' + lang.dialogBox.linkBox.bookmark + '\">' + icons.bookmark + '</button>' +\n                    core.plugins.selectMenu.setForm() +\n                '</div>' +\n                '<div class=\"se-anchor-preview-form\">' +\n                    '<span class=\"se-svg se-anchor-preview-icon _se_anchor_bookmark_icon\">' + icons.bookmark + '</span>' +\n                    '<span class=\"se-svg se-anchor-preview-icon _se_anchor_download_icon\">' + icons.download + '</span>' +\n                    '<pre class=\"se-link-preview\"></pre>' +\n                '</div>' +\n            '</div>' +\n            '<div class=\"se-dialog-form\">' +\n                '<label>' + lang.dialogBox.linkBox.text + '</label><input class=\"se-input-form _se_anchor_text\" type=\"text\" />' +\n            '</div>' +\n            '<div class=\"se-dialog-form-footer\">' +\n                '<label><input type=\"checkbox\" class=\"se-dialog-btn-check _se_anchor_check\" />&nbsp;' + lang.dialogBox.linkBox.newWindowCheck + '</label>' +\n                '<label><input type=\"checkbox\" class=\"se-dialog-btn-check _se_anchor_download\" />&nbsp;' + lang.dialogBox.linkBox.downloadLinkCheck + '</label>';\n            if (relList.length > 0) {\n                html += '<div class=\"se-anchor-rel\"><button type=\"button\" class=\"se-btn se-btn-select se-anchor-rel-btn\">&lt;rel&gt;</button>' +\n                    '<div class=\"se-anchor-rel-wrapper\"><pre class=\"se-link-preview se-anchor-rel-preview\"></pre></div>' +\n                    '<div class=\"se-list-layer\">' +\n                        '<div class=\"se-list-inner\">' +\n                            '<ul class=\"se-list-basic se-list-checked\">';\n                for (let i = 0, len = relList.length, rel; i < len; i++) {\n                    rel = relList[i];\n                    html += '<li><button type=\"button\" class=\"se-btn-list' + (defaultRel.indexOf(rel) > -1 ? ' se-checked' : '') + '\" data-command=\"' + rel + '\" title=\"' + rel + '\" aria-label=\"' + rel + '\"><span class=\"se-svg\">' + icons.checked + '</span>' + rel + '</button></li>';\n                }\n                html += '</ul></div></div></div>';\n            }\n\n        html += '</div></div>';\n\n        forms.innerHTML = html;\n        return forms;\n    },\n\n    initEvent: function (pluginName, forms) {\n        const anchorPlugin = this.plugins.anchor;\n        const context = this.context.anchor.caller[pluginName] = {\n            modal: forms,\n            urlInput: null,\n            linkDefaultRel: this.options.linkRelDefault,\n            defaultRel: this.options.linkRelDefault.default || '',\n            currentRel: [],\n            linkAnchor: null,\n            linkValue: '',\n            _change: false,\n            callerName: pluginName\n        };\n\n        if (typeof context.linkDefaultRel.default === 'string') context.linkDefaultRel.default = context.linkDefaultRel.default.trim();\n        if (typeof context.linkDefaultRel.check_new_window === 'string') context.linkDefaultRel.check_new_window = context.linkDefaultRel.check_new_window.trim();\n        if (typeof context.linkDefaultRel.check_bookmark === 'string') context.linkDefaultRel.check_bookmark = context.linkDefaultRel.check_bookmark.trim();\n\n        context.urlInput = forms.querySelector('.se-input-url');\n        context.anchorText = forms.querySelector('._se_anchor_text');\n        context.newWindowCheck = forms.querySelector('._se_anchor_check');\n        context.downloadCheck = forms.querySelector('._se_anchor_download');\n        context.download = forms.querySelector('._se_anchor_download_icon');\n        context.preview = forms.querySelector('.se-link-preview');\n        context.bookmark = forms.querySelector('._se_anchor_bookmark_icon');\n        context.bookmarkButton = forms.querySelector('._se_bookmark_button');\n\n        this.plugins.selectMenu.initEvent.call(this, pluginName, forms);\n        const listContext = this.context.selectMenu.caller[pluginName];\n        \n        /** rel */\n        if (this.options.linkRel.length > 0) {\n            context.relButton = forms.querySelector('.se-anchor-rel-btn');\n            context.relList = forms.querySelector('.se-list-layer');\n            context.relPreview = forms.querySelector('.se-anchor-rel-preview');\n            context.relButton.addEventListener('click', anchorPlugin.onClick_relButton.bind(this, context));\n            context.relList.addEventListener('click', anchorPlugin.onClick_relList.bind(this, context));\n        }\n\n        context.newWindowCheck.addEventListener('change', anchorPlugin.onChange_newWindowCheck.bind(this, context));\n        context.downloadCheck.addEventListener('change', anchorPlugin.onChange_downloadCheck.bind(this, context));\n        context.anchorText.addEventListener('input', anchorPlugin.onChangeAnchorText.bind(this, context));\n        context.urlInput.addEventListener('input', anchorPlugin.onChangeUrlInput.bind(this, context));\n        context.urlInput.addEventListener('keydown', anchorPlugin.onKeyDownUrlInput.bind(this, listContext));\n        context.urlInput.addEventListener('focus', anchorPlugin.onFocusUrlInput.bind(this, context, listContext));\n        context.urlInput.addEventListener('blur', anchorPlugin.onBlurUrlInput.bind(this, listContext));\n        context.bookmarkButton.addEventListener('click', anchorPlugin.onClick_bookmarkButton.bind(this, context));\n    },\n\n    on: function (contextAnchor, update) {\n        const anchorPlugin = this.plugins.anchor;\n\n        if (!update) {\n            anchorPlugin.init.call(this, contextAnchor);\n            contextAnchor.anchorText.value = this.getSelection().toString().trim();\n            contextAnchor.newWindowCheck.checked = this.options.linkTargetNewWindow;\n        } else if (contextAnchor.linkAnchor) {\n            this.context.dialog.updateModal = true;\n            const href = contextAnchor.linkAnchor.getAttribute('href');\n            contextAnchor.linkValue = contextAnchor.preview.textContent = contextAnchor.urlInput.value = anchorPlugin.selfPathBookmark.call(this, href) ? href.substr(href.lastIndexOf('#')) : href;\n            contextAnchor.anchorText.value = contextAnchor.linkAnchor.textContent || contextAnchor.linkAnchor.getAttribute('alt');\n            contextAnchor.newWindowCheck.checked = (/_blank/i.test(contextAnchor.linkAnchor.target) ? true : false);\n            contextAnchor.downloadCheck.checked = contextAnchor.linkAnchor.download;\n        }\n\n        this.context.anchor.callerContext = contextAnchor;\n        anchorPlugin.setRel.call(this, contextAnchor, (update && contextAnchor.linkAnchor) ? contextAnchor.linkAnchor.rel : contextAnchor.defaultRel);\n        anchorPlugin.setLinkPreview.call(this, contextAnchor, contextAnchor.linkValue);\n        this.plugins.selectMenu.on.call(this, contextAnchor.callerName, this.plugins.anchor.setHeaderBookmark);\n    },\n\n    selfPathBookmark: function(path) {\n        const href = this._w.location.href.replace(/\\/$/, '');\n        return path.indexOf('#') === 0 || (path.indexOf(href) === 0 && path.indexOf('#') === (href.indexOf(\"#\") === -1 ? href.length : href.substr(0, href.indexOf(\"#\")).length));\n    },\n\n    _closeRelMenu: null,\n    toggleRelList: function (contextAnchor, show) {\n        if (!show) {\n            if (this.plugins.anchor._closeRelMenu) this.plugins.anchor._closeRelMenu();\n        } else {\n            const target = contextAnchor.relButton;\n            const relList = contextAnchor.relList;\n            this.util.addClass(target, 'active');\n            relList.style.visibility = 'hidden';\n            relList.style.display = 'block';\n            if (!this.options.rtl) relList.style.left = (target.offsetLeft + target.offsetWidth + 1) + 'px';\n            else relList.style.left = (target.offsetLeft - relList.offsetWidth - 1) + 'px';\n            relList.style.top = (target.offsetTop + (target.offsetHeight / 2) - (relList.offsetHeight / 2)) + 'px';\n            relList.style.visibility = '';\n\n            this.plugins.anchor._closeRelMenu = function (context, target, e) {\n                if (e && (context.relButton.contains(e.target) || context.relList.contains(e.target))) return;\n                this.util.removeClass(target, 'active');\n                context.relList.style.display = 'none';\n                this.modalForm.removeEventListener('click', this.plugins.anchor._closeRelMenu);\n                this.plugins.anchor._closeRelMenu = null;\n            }.bind(this, contextAnchor, target);\n    \n            this.modalForm.addEventListener('click', this.plugins.anchor._closeRelMenu);\n        }\n    },\n\n    onClick_relButton: function (contextAnchor, e) {\n        this.plugins.anchor.toggleRelList.call(this, contextAnchor, !this.util.hasClass(e.target, 'active'));\n    },\n\n    onClick_relList: function (contextAnchor, e) {\n        const target = e.target;\n        const cmd = target.getAttribute('data-command');\n        if (!cmd) return;\n        \n        const current = contextAnchor.currentRel;\n        const checked = this.util.toggleClass(target, 'se-checked');\n        const index = current.indexOf(cmd);\n        if (checked) {\n            if (index === -1) current.push(cmd);\n        } else {\n            if (index > -1) current.splice(index, 1);\n        }\n\n        contextAnchor.relPreview.title = contextAnchor.relPreview.textContent = current.join(' ');\n    },\n\n    setRel: function (contextAnchor, relAttr) {\n        const relListEl = contextAnchor.relList;\n        const rels = contextAnchor.currentRel = !relAttr ? [] : relAttr.split(' ');\n        if (!relListEl) return;\n\n        const checkedRel = relListEl.querySelectorAll('button');\n        for (let i = 0, len = checkedRel.length, cmd; i < len; i++) {\n            cmd = checkedRel[i].getAttribute('data-command');\n            if (rels.indexOf(cmd) > -1) {\n                this.util.addClass(checkedRel[i], 'se-checked');\n            } else {\n                this.util.removeClass(checkedRel[i], 'se-checked');\n            }\n        }\n\n        contextAnchor.relPreview.title = contextAnchor.relPreview.textContent = rels.join(' ');\n    },\n\n    createHeaderList: function (contextAnchor, contextList, urlValue) {\n        const headers = this.util.getListChildren(this.context.element.wysiwyg, function(current) {\n            return /h[1-6]/i.test(current.nodeName);\n        });\n        if (headers.length === 0) return;\n\n        const valueRegExp = new this._w.RegExp('^' + urlValue.replace(/^#/, ''), 'i');\n        const list = [];\n        let html = '';\n        for(let i = 0, len = headers.length, h; i < len; i++) {\n            h = headers[i];\n            if (!valueRegExp.test(h.textContent)) continue;\n            list.push(h);\n            html += '<li class=\"se-select-item\" data-index=\"' + i + '\">' + h.textContent + '</li>';\n        }\n\n        if (list.length === 0) {\n            this.plugins.selectMenu.close.call(this, contextList);\n        } else {\n            this.plugins.selectMenu.createList(contextList, list, html);\n            this.plugins.selectMenu.open.call(this, contextList, this.plugins.anchor._setMenuListPosition.bind(this, contextAnchor));\n        }\n    },\n\n    _setMenuListPosition: function (contextAnchor, list) {\n        list.style.top = (contextAnchor.urlInput.offsetHeight + 1) + 'px';\n    },\n\n    onKeyDownUrlInput: function (contextList, e) {\n        const keyCode = e.keyCode;\n        switch (keyCode) {\n            case 38: // up\n                e.preventDefault();\n                e.stopPropagation();\n                this.plugins.selectMenu.moveItem.call(this, contextList, -1);\n                break;\n            case 40: // down\n                e.preventDefault();\n                e.stopPropagation();\n                this.plugins.selectMenu.moveItem.call(this, contextList, 1);\n                break;\n            case 13: // enter\n                if (contextList.index > -1) {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    this.plugins.anchor.setHeaderBookmark.call(this, this.plugins.selectMenu.getItem(contextList, null));\n                }\n                break;\n        }\n    },\n\n    setHeaderBookmark: function (header) {\n        const contextAnchor = this.context.anchor.callerContext;\n        const id = header.id || 'h_' + this._w.Math.random().toString().replace(/.+\\./, '');\n        header.id = id;\n        contextAnchor.urlInput.value = '#' + id;\n\n        if (!contextAnchor.anchorText.value.trim() || !contextAnchor._change) {\n            contextAnchor.anchorText.value = header.textContent;\n        }\n        \n        this.plugins.anchor.setLinkPreview.call(this, contextAnchor, contextAnchor.urlInput.value);\n        this.plugins.selectMenu.close.call(this, this.context.selectMenu.callerContext);\n        this.context.anchor.callerContext.urlInput.focus();\n    },\n\n    onChangeAnchorText: function (contextAnchor, e) {\n        contextAnchor._change = !!e.target.value.trim();\n    },\n\n    onChangeUrlInput: function (contextAnchor, e) {\n        const value = e.target.value.trim();\n        this.plugins.anchor.setLinkPreview.call(this, contextAnchor, value);\n\n        if (this.plugins.anchor.selfPathBookmark.call(this, value)) this.plugins.anchor.createHeaderList.call(this, contextAnchor, this.context.selectMenu.callerContext, value);\n        else this.plugins.selectMenu.close.call(this, this.context.selectMenu.callerContext);\n    },\n\n    onFocusUrlInput: function (contextAnchor, contextLink) {\n        const value = contextAnchor.urlInput.value;\n        if (this.plugins.anchor.selfPathBookmark.call(this, value)) this.plugins.anchor.createHeaderList.call(this, contextAnchor, contextLink, value);\n    },\n\n    onBlurUrlInput: function (contextList) {\n        this.plugins.selectMenu.close.call(this, contextList);\n    },\n\n    setLinkPreview: function (context, value) {\n        const preview = context.preview;\n        const protocol = this.options.linkProtocol;\n        const noPrefix = this.options.linkNoPrefix;\n        const reservedProtocol  = /^(mailto\\:|tel\\:|sms\\:|https*\\:\\/\\/|#)/.test(value);\n        const sameProtocol = !protocol ? false : this._w.RegExp('^' + value.substr(0, protocol.length)).test(protocol);\n        value = context.linkValue = preview.textContent = !value ? '' : noPrefix ? value : (protocol && !reservedProtocol && !sameProtocol) ? protocol + value : reservedProtocol ? value : /^www\\./.test(value) ? 'http://' + value : this.context.anchor.host + (/^\\//.test(value) ? '' : '/') + value;\n\n        if (this.plugins.anchor.selfPathBookmark.call(this, value)) {\n            context.bookmark.style.display = 'block';\n            this.util.addClass(context.bookmarkButton, 'active');\n        } else {\n            context.bookmark.style.display = 'none';\n            this.util.removeClass(context.bookmarkButton, 'active');\n        }\n\n        if (!this.plugins.anchor.selfPathBookmark.call(this, value) && context.downloadCheck.checked) {\n            context.download.style.display = 'block';\n        } else {\n            context.download.style.display = 'none';\n        }\n    },\n\n    setCtx: function (anchor, contextAnchor) {\n        if (!anchor) return;\n        contextAnchor.linkAnchor = anchor;\n        contextAnchor.linkValue = anchor.href;\n        contextAnchor.currentRel = anchor.rel.split(\" \");\n    },\n\n    updateAnchor: function (anchor, url, alt, contextAnchor, notText) {\n        // download\n        if (!this.plugins.anchor.selfPathBookmark.call(this, url) && contextAnchor.downloadCheck.checked) {\n            anchor.setAttribute('download', alt || url);\n        } else {\n            anchor.removeAttribute('download');\n        }\n\n        // new window\n        if (contextAnchor.newWindowCheck.checked) anchor.target = '_blank';\n        else anchor.removeAttribute('target');\n        \n        // rel\n        const rel = contextAnchor.currentRel.join(' ');\n        if (!rel) anchor.removeAttribute('rel');\n        else anchor.rel = rel;\n\n        // est url, alt\n        anchor.href = url;\n        anchor.setAttribute('alt', alt);\n        if (notText) {\n            if (anchor.children.length === 0) anchor.textContent = '';\n        } else {\n            anchor.textContent = alt;\n        }\n    },\n\n    createAnchor: function (contextAnchor, notText) {\n        if (contextAnchor.linkValue.length === 0) return null;\n        \n        const url = contextAnchor.linkValue;\n        const anchor = contextAnchor.anchorText;\n        const anchorText = anchor.value.length === 0 ? url : anchor.value;\n\n        const oA = contextAnchor.linkAnchor || this.util.createElement('A');\n        this.plugins.anchor.updateAnchor.call(this, oA, url, anchorText, contextAnchor, notText);\n\n        contextAnchor.linkValue = contextAnchor.preview.textContent = contextAnchor.urlInput.value = contextAnchor.anchorText.value = '';\n\n        return oA;\n    },\n\n    onClick_bookmarkButton: function (contextAnchor) {\n        let url = contextAnchor.urlInput.value;\n        if (this.plugins.anchor.selfPathBookmark.call(this, url)) {\n            url = url.substr(1);\n            contextAnchor.bookmark.style.display = 'none';\n            this.util.removeClass(contextAnchor.bookmarkButton, 'active');\n            this.plugins.selectMenu.close.call(this, this.context.selectMenu.callerContext);\n        } else {\n            url = '#' + url;\n            contextAnchor.bookmark.style.display = 'block';\n            this.util.addClass(contextAnchor.bookmarkButton, 'active');\n            contextAnchor.downloadCheck.checked = false;\n            contextAnchor.download.style.display = 'none';\n            this.plugins.anchor.createHeaderList.call(this, contextAnchor, this.context.selectMenu.callerContext, url);\n        }\n\n        contextAnchor.urlInput.value = url;\n        this.plugins.anchor.setLinkPreview.call(this, contextAnchor, url);\n        contextAnchor.urlInput.focus();\n    },\n\n    onChange_newWindowCheck: function (contextAnchor, e) {\n        if (typeof contextAnchor.linkDefaultRel.check_new_window !== 'string') return;\n        if (e.target.checked) {\n            this.plugins.anchor.setRel.call(this, contextAnchor, this.plugins.anchor._relMerge.call(this, contextAnchor, contextAnchor.linkDefaultRel.check_new_window));\n        } else {\n            this.plugins.anchor.setRel.call(this, contextAnchor, this.plugins.anchor._relDelete.call(this, contextAnchor, contextAnchor.linkDefaultRel.check_new_window));\n        }\n    },\n\n    onChange_downloadCheck: function (contextAnchor, e) {\n        if (e.target.checked) {\n            contextAnchor.download.style.display = 'block';\n            contextAnchor.bookmark.style.display = 'none';\n            this.util.removeClass(contextAnchor.bookmarkButton, 'active');\n            contextAnchor.linkValue = contextAnchor.preview.textContent = contextAnchor.urlInput.value = contextAnchor.urlInput.value.replace(/^\\#+/, '');\n            if (typeof contextAnchor.linkDefaultRel.check_bookmark === 'string') {\n                this.plugins.anchor.setRel.call(this, contextAnchor, this.plugins.anchor._relMerge.call(this, contextAnchor, contextAnchor.linkDefaultRel.check_bookmark));\n            }\n        } else {\n            contextAnchor.download.style.display = 'none';\n            if (typeof contextAnchor.linkDefaultRel.check_bookmark === 'string') {\n                this.plugins.anchor.setRel.call(this, contextAnchor, this.plugins.anchor._relDelete.call(this, contextAnchor, contextAnchor.linkDefaultRel.check_bookmark));\n            }\n        }\n    },\n\n    _relMerge: function (contextAnchor, relAttr) {\n        const current = contextAnchor.currentRel;\n        if (!relAttr) return current.join(' ');\n        \n        if (/^only\\:/.test(relAttr)) {\n            relAttr = relAttr.replace(/^only\\:/, '').trim();\n            contextAnchor.currentRel = relAttr.split(' ');\n            return relAttr;\n        }\n\n        const rels = relAttr.split(' ');\n        for (let i = 0, len = rels.length, index; i < len; i++) {\n            index = current.indexOf(rels[i]);\n            if (index === -1) current.push(rels[i]);\n        }\n\n        return current.join(' ');\n    },\n\n    _relDelete: function (contextAnchor, relAttr) {\n        if (!relAttr) return contextAnchor.currentRel.join(' ');\n        if (/^only\\:/.test(relAttr)) relAttr = relAttr.replace(/^only\\:/, '').trim();\n\n        const rels = contextAnchor.currentRel.join(' ').replace(this._w.RegExp(relAttr + '\\\\s*'), '');\n        contextAnchor.currentRel = rels.split(' ');\n        return rels;\n    },\n\n    init: function (contextAnchor) {\n        contextAnchor.linkAnchor = null;\n        contextAnchor.linkValue = contextAnchor.preview.textContent = contextAnchor.urlInput.value = '';\n        contextAnchor.anchorText.value = '';\n        contextAnchor.newWindowCheck.checked = false;\n        contextAnchor.downloadCheck.checked = false;\n        contextAnchor._change = false;\n        this.plugins.anchor.setRel.call(this, contextAnchor, contextAnchor.defaultRel);\n        if (contextAnchor.relList) {\n            this.plugins.anchor.toggleRelList.call(this, contextAnchor, false);\n        }\n        this.context.anchor.callerContext = null;\n        this.plugins.selectMenu.init.call(this, this.context.selectMenu.callerContext);\n    }\n};\n"]},"metadata":{},"sourceType":"module"}