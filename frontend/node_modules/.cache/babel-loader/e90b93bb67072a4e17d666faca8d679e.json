{"ast":null,"code":"import { base64Decode, base64Encode } from '../encoding/base64';\nimport { md5 } from '../encoding/md5';\nimport { LicenseStatus } from '../utils/licenseStatus';\nimport { LICENSE_SCOPES } from '../utils/licenseScope';\nimport { LICENSING_MODELS } from '../utils/licensingModel';\n\nconst getDefaultReleaseDate = () => {\n  const today = new Date();\n  today.setHours(0, 0, 0, 0);\n  return today;\n};\n\nexport function generateReleaseInfo() {\n  let releaseDate = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : getDefaultReleaseDate();\n  return base64Encode(releaseDate.getTime().toString());\n}\nconst expiryReg = /^.*EXPIRY=([0-9]+),.*$/;\n/**\n * Format: ORDER:${orderNumber},EXPIRY=${expiryTimestamp},KEYVERSION=1\n */\n\nconst decodeLicenseVersion1 = license => {\n  let expiryTimestamp;\n\n  try {\n    expiryTimestamp = parseInt(license.match(expiryReg)[1], 10);\n\n    if (!expiryTimestamp || Number.isNaN(expiryTimestamp)) {\n      expiryTimestamp = null;\n    }\n  } catch (err) {\n    expiryTimestamp = null;\n  }\n\n  return {\n    scope: 'pro',\n    licensingModel: 'perpetual',\n    expiryTimestamp\n  };\n};\n/**\n * Format: O=${orderNumber},E=${expiryTimestamp},S=${scope},LM=${licensingModel},KV=2`;\n */\n\n\nconst decodeLicenseVersion2 = license => {\n  const licenseInfo = {\n    scope: null,\n    licensingModel: null,\n    expiryTimestamp: null\n  };\n  license.split(',').map(token => token.split('=')).filter(el => el.length === 2).forEach(_ref => {\n    let [key, value] = _ref;\n\n    if (key === 'S') {\n      licenseInfo.scope = value;\n    }\n\n    if (key === 'LM') {\n      licenseInfo.licensingModel = value;\n    }\n\n    if (key === 'E') {\n      const expiryTimestamp = parseInt(value, 10);\n\n      if (expiryTimestamp && !Number.isNaN(expiryTimestamp)) {\n        licenseInfo.expiryTimestamp = expiryTimestamp;\n      }\n    }\n  });\n  return licenseInfo;\n};\n/**\n * Decode the license based on its key version and return a version-agnostic `MuiLicense` object.\n */\n\n\nconst decodeLicense = encodedLicense => {\n  const license = base64Decode(encodedLicense);\n\n  if (license.includes('KEYVERSION=1')) {\n    return decodeLicenseVersion1(license);\n  }\n\n  if (license.includes('KV=2')) {\n    return decodeLicenseVersion2(license);\n  }\n\n  return null;\n};\n\nexport function verifyLicense(_ref2) {\n  let {\n    releaseInfo,\n    licenseKey,\n    acceptedScopes,\n    isProduction\n  } = _ref2;\n\n  if (!releaseInfo) {\n    throw new Error('MUI: The release information is missing. Not able to validate license.');\n  }\n\n  if (!licenseKey) {\n    return LicenseStatus.NotFound;\n  }\n\n  const hash = licenseKey.substr(0, 32);\n  const encoded = licenseKey.substr(32);\n\n  if (hash !== md5(encoded)) {\n    return LicenseStatus.Invalid;\n  }\n\n  const license = decodeLicense(encoded);\n\n  if (license == null) {\n    console.error('Error checking license. Key version not found!');\n    return LicenseStatus.Invalid;\n  }\n\n  if (license.licensingModel == null || !LICENSING_MODELS.includes(license.licensingModel)) {\n    console.error('Error checking license. Sales model not found or invalid!');\n    return LicenseStatus.Invalid;\n  }\n\n  if (license.expiryTimestamp == null) {\n    console.error('Error checking license. Expiry timestamp not found or invalid!');\n    return LicenseStatus.Invalid;\n  }\n\n  if (license.licensingModel === 'perpetual' || isProduction) {\n    const pkgTimestamp = parseInt(base64Decode(releaseInfo), 10);\n\n    if (Number.isNaN(pkgTimestamp)) {\n      throw new Error('MUI: The release information is invalid. Not able to validate license.');\n    }\n\n    if (license.expiryTimestamp < pkgTimestamp) {\n      return LicenseStatus.Expired;\n    }\n  } else if (license.licensingModel === 'subscription') {\n    if (license.expiryTimestamp < new Date().getTime()) {\n      return LicenseStatus.Expired;\n    }\n  }\n\n  if (license.scope == null || !LICENSE_SCOPES.includes(license.scope)) {\n    console.error('Error checking license. scope not found or invalid!');\n    return LicenseStatus.Invalid;\n  }\n\n  if (!acceptedScopes.includes(license.scope)) {\n    return LicenseStatus.Invalid;\n  }\n\n  return LicenseStatus.Valid;\n}","map":{"version":3,"sources":["E:/React/pos-system/main/node_modules/@mui/x-license-pro/verifyLicense/verifyLicense.js"],"names":["base64Decode","base64Encode","md5","LicenseStatus","LICENSE_SCOPES","LICENSING_MODELS","getDefaultReleaseDate","today","Date","setHours","generateReleaseInfo","releaseDate","getTime","toString","expiryReg","decodeLicenseVersion1","license","expiryTimestamp","parseInt","match","Number","isNaN","err","scope","licensingModel","decodeLicenseVersion2","licenseInfo","split","map","token","filter","el","length","forEach","key","value","decodeLicense","encodedLicense","includes","verifyLicense","releaseInfo","licenseKey","acceptedScopes","isProduction","Error","NotFound","hash","substr","encoded","Invalid","console","error","pkgTimestamp","Expired","Valid"],"mappings":"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","sourcesContent":["import { base64Decode, base64Encode } from '../encoding/base64';\nimport { md5 } from '../encoding/md5';\nimport { LicenseStatus } from '../utils/licenseStatus';\nimport { LICENSE_SCOPES } from '../utils/licenseScope';\nimport { LICENSING_MODELS } from '../utils/licensingModel';\n\nconst getDefaultReleaseDate = () => {\n  const today = new Date();\n  today.setHours(0, 0, 0, 0);\n  return today;\n};\n\nexport function generateReleaseInfo(releaseDate = getDefaultReleaseDate()) {\n  return base64Encode(releaseDate.getTime().toString());\n}\nconst expiryReg = /^.*EXPIRY=([0-9]+),.*$/;\n\n/**\n * Format: ORDER:${orderNumber},EXPIRY=${expiryTimestamp},KEYVERSION=1\n */\nconst decodeLicenseVersion1 = license => {\n  let expiryTimestamp;\n\n  try {\n    expiryTimestamp = parseInt(license.match(expiryReg)[1], 10);\n\n    if (!expiryTimestamp || Number.isNaN(expiryTimestamp)) {\n      expiryTimestamp = null;\n    }\n  } catch (err) {\n    expiryTimestamp = null;\n  }\n\n  return {\n    scope: 'pro',\n    licensingModel: 'perpetual',\n    expiryTimestamp\n  };\n};\n/**\n * Format: O=${orderNumber},E=${expiryTimestamp},S=${scope},LM=${licensingModel},KV=2`;\n */\n\n\nconst decodeLicenseVersion2 = license => {\n  const licenseInfo = {\n    scope: null,\n    licensingModel: null,\n    expiryTimestamp: null\n  };\n  license.split(',').map(token => token.split('=')).filter(el => el.length === 2).forEach(([key, value]) => {\n    if (key === 'S') {\n      licenseInfo.scope = value;\n    }\n\n    if (key === 'LM') {\n      licenseInfo.licensingModel = value;\n    }\n\n    if (key === 'E') {\n      const expiryTimestamp = parseInt(value, 10);\n\n      if (expiryTimestamp && !Number.isNaN(expiryTimestamp)) {\n        licenseInfo.expiryTimestamp = expiryTimestamp;\n      }\n    }\n  });\n  return licenseInfo;\n};\n/**\n * Decode the license based on its key version and return a version-agnostic `MuiLicense` object.\n */\n\n\nconst decodeLicense = encodedLicense => {\n  const license = base64Decode(encodedLicense);\n\n  if (license.includes('KEYVERSION=1')) {\n    return decodeLicenseVersion1(license);\n  }\n\n  if (license.includes('KV=2')) {\n    return decodeLicenseVersion2(license);\n  }\n\n  return null;\n};\n\nexport function verifyLicense({\n  releaseInfo,\n  licenseKey,\n  acceptedScopes,\n  isProduction\n}) {\n  if (!releaseInfo) {\n    throw new Error('MUI: The release information is missing. Not able to validate license.');\n  }\n\n  if (!licenseKey) {\n    return LicenseStatus.NotFound;\n  }\n\n  const hash = licenseKey.substr(0, 32);\n  const encoded = licenseKey.substr(32);\n\n  if (hash !== md5(encoded)) {\n    return LicenseStatus.Invalid;\n  }\n\n  const license = decodeLicense(encoded);\n\n  if (license == null) {\n    console.error('Error checking license. Key version not found!');\n    return LicenseStatus.Invalid;\n  }\n\n  if (license.licensingModel == null || !LICENSING_MODELS.includes(license.licensingModel)) {\n    console.error('Error checking license. Sales model not found or invalid!');\n    return LicenseStatus.Invalid;\n  }\n\n  if (license.expiryTimestamp == null) {\n    console.error('Error checking license. Expiry timestamp not found or invalid!');\n    return LicenseStatus.Invalid;\n  }\n\n  if (license.licensingModel === 'perpetual' || isProduction) {\n    const pkgTimestamp = parseInt(base64Decode(releaseInfo), 10);\n\n    if (Number.isNaN(pkgTimestamp)) {\n      throw new Error('MUI: The release information is invalid. Not able to validate license.');\n    }\n\n    if (license.expiryTimestamp < pkgTimestamp) {\n      return LicenseStatus.Expired;\n    }\n  } else if (license.licensingModel === 'subscription') {\n    if (license.expiryTimestamp < new Date().getTime()) {\n      return LicenseStatus.Expired;\n    }\n  }\n\n  if (license.scope == null || !LICENSE_SCOPES.includes(license.scope)) {\n    console.error('Error checking license. scope not found or invalid!');\n    return LicenseStatus.Invalid;\n  }\n\n  if (!acceptedScopes.includes(license.scope)) {\n    return LicenseStatus.Invalid;\n  }\n\n  return LicenseStatus.Valid;\n}"]},"metadata":{},"sourceType":"module"}