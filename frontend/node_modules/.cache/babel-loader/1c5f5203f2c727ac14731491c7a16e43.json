{"ast":null,"code":"import _defineProperty from \"E:/React/pos-system/main/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"E:/React/pos-system/main/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"E:/React/pos-system/main/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport * as React from 'react';\nimport { useEventCallback } from '@mui/material/utils';\nimport { useGridApiOptionHandler, useGridApiEventHandler } from '../../utils/useGridApiEventHandler';\nimport { GridCellModes, GridEditModes } from '../../../models/gridEditRowModel';\nimport { isKeyboardEvent, isPrintableKey, isCellEnterEditModeKeys, isCellExitEditModeKeys, isCellEditCommitKeys, isDeleteKeys } from '../../../utils/keyboardUtils';\nimport { useGridLogger } from '../../utils/useGridLogger';\nimport { gridFocusCellSelector } from '../focus/gridFocusStateSelector';\nimport { useGridApiMethod } from '../../utils/useGridApiMethod';\nimport { gridEditRowsStateSelector } from './gridEditRowsSelector';\n\nfunction isPromise(promise) {\n  return typeof promise.then === 'function';\n}\n\nexport var useCellEditing = function useCellEditing(apiRef, props) {\n  var _props$experimentalFe2;\n\n  var logger = useGridLogger(apiRef, 'useGridEditRows');\n\n  var buildCallback = function buildCallback(callback) {\n    return function () {\n      if (props.editMode === GridEditModes.Cell) {\n        callback.apply(void 0, arguments);\n      }\n    };\n  };\n\n  var setCellMode = React.useCallback(function (id, field, mode) {\n    if (apiRef.current.getCellMode(id, field) === mode) {\n      return;\n    }\n\n    logger.debug(\"Switching cell id: \".concat(id, \" field: \").concat(field, \" to mode: \").concat(mode));\n    apiRef.current.setState(function (state) {\n      var newEditRowsState = _extends({}, state.editRows);\n\n      newEditRowsState[id] = _extends({}, newEditRowsState[id]);\n\n      if (mode === GridCellModes.Edit) {\n        newEditRowsState[id][field] = {\n          value: apiRef.current.getCellValue(id, field)\n        };\n      } else {\n        delete newEditRowsState[id][field];\n\n        if (!Object.keys(newEditRowsState[id]).length) {\n          delete newEditRowsState[id];\n        }\n      }\n\n      return _extends({}, state, {\n        editRows: newEditRowsState\n      });\n    });\n    apiRef.current.forceUpdate();\n    apiRef.current.publishEvent('cellModeChange', apiRef.current.getCellParams(id, field));\n  }, [apiRef, logger]);\n  var getCellMode = React.useCallback(function (id, field) {\n    var editRowsState = gridEditRowsStateSelector(apiRef.current.state);\n    var isEditing = editRowsState[id] && editRowsState[id][field];\n    return isEditing ? GridCellModes.Edit : GridCellModes.View;\n  }, [apiRef]); // TODO v6: it should always return a promise\n\n  var commitCellChange = React.useCallback(function (params) {\n    var event = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    var _props$experimentalFe;\n\n    var id = params.id,\n        field = params.field;\n    apiRef.current.unstable_runPendingEditCellValueMutation(id, field);\n    var model = apiRef.current.getEditRowsModel();\n\n    if (!model[id] || !model[id][field]) {\n      throw new Error(\"MUI: Cell at id: \".concat(id, \" and field: \").concat(field, \" is not in edit mode.\"));\n    }\n\n    var editCellProps = model[id][field];\n    var column = apiRef.current.getColumn(field);\n    var row = apiRef.current.getRow(id);\n\n    if ((_props$experimentalFe = props.experimentalFeatures) != null && _props$experimentalFe.preventCommitWhileValidating) {\n      var cellProps = model[id][field];\n\n      if (cellProps.isValidating || cellProps.error) {\n        return false;\n      }\n    }\n\n    var commitParams = _extends({}, params, {\n      value: editCellProps.value\n    });\n\n    var hasError = !!editCellProps.error;\n\n    if (!hasError && typeof column.preProcessEditCellProps === 'function') {\n      var result = column.preProcessEditCellProps({\n        id: id,\n        row: row,\n        props: editCellProps\n      });\n\n      if (isPromise(result)) {\n        return result.then(function (newEditCellProps) {\n          apiRef.current.unstable_setEditCellProps({\n            id: id,\n            field: field,\n            props: newEditCellProps\n          });\n\n          if (newEditCellProps.error) {\n            return false;\n          }\n\n          apiRef.current.publishEvent('cellEditCommit', commitParams, event);\n          return true;\n        });\n      }\n\n      apiRef.current.unstable_setEditCellProps({\n        id: id,\n        field: field,\n        props: result\n      });\n      hasError = !!result.error;\n    }\n\n    if (!hasError) {\n      apiRef.current.publishEvent('cellEditCommit', commitParams, event);\n      return true;\n    }\n\n    return false;\n  }, [apiRef, (_props$experimentalFe2 = props.experimentalFeatures) == null ? void 0 : _props$experimentalFe2.preventCommitWhileValidating]);\n  var setCellEditingEditCellValue = React.useCallback(function (params) {\n    var column = apiRef.current.getColumn(params.field);\n    var row = apiRef.current.getRow(params.id);\n    return new Promise(function (resolve) {\n      var newEditCellProps = {\n        value: params.value\n      };\n      var model = apiRef.current.getEditRowsModel();\n      var editCellProps = model[params.id][params.field];\n\n      if (typeof column.preProcessEditCellProps !== 'function') {\n        apiRef.current.unstable_setEditCellProps(_extends({}, params, {\n          props: newEditCellProps\n        }));\n        resolve(true);\n        return;\n      } // setEditCellProps runs the value parser and returns the updated props\n\n\n      newEditCellProps = apiRef.current.unstable_setEditCellProps(_extends({}, params, {\n        props: _extends({}, editCellProps, {\n          isValidating: true\n        })\n      }));\n      Promise.resolve(column.preProcessEditCellProps({\n        id: params.id,\n        row: row,\n        props: _extends({}, newEditCellProps, {\n          value: apiRef.current.unstable_parseValue(params.id, params.field, params.value)\n        })\n      })).then(function (newEditCellPropsProcessed) {\n        apiRef.current.unstable_setEditCellProps(_extends({}, params, {\n          props: _extends({}, newEditCellPropsProcessed, {\n            isValidating: false\n          })\n        }));\n        resolve(!newEditCellPropsProcessed.error);\n      });\n    });\n  }, [apiRef]);\n  var cellEditingApi = {\n    setCellMode: setCellMode,\n    getCellMode: getCellMode,\n    commitCellChange: commitCellChange,\n    unstable_setCellEditingEditCellValue: setCellEditingEditCellValue\n  };\n  useGridApiMethod(apiRef, cellEditingApi, 'EditRowApi');\n  var handleCellKeyDown = React.useCallback( /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(params, event) {\n      var id, field, cellMode, isEditable, isEditMode, isModifierKeyPressed, commitParams, isValid;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              id = params.id, field = params.field, cellMode = params.cellMode, isEditable = params.isEditable;\n\n              if (isEditable) {\n                _context.next = 3;\n                break;\n              }\n\n              return _context.abrupt(\"return\");\n\n            case 3:\n              isEditMode = cellMode === GridCellModes.Edit;\n              isModifierKeyPressed = event.ctrlKey || event.metaKey || event.altKey;\n\n              if (!isEditMode && isCellEnterEditModeKeys(event.key) && !isModifierKeyPressed && !(event.key === ' ' && event.shiftKey)) {\n                apiRef.current.publishEvent('cellEditStart', params, event);\n              }\n\n              if (!isEditMode && isDeleteKeys(event.key)) {\n                apiRef.current.setEditCellValue({\n                  id: id,\n                  field: field,\n                  value: ''\n                });\n                apiRef.current.commitCellChange({\n                  id: id,\n                  field: field\n                }, event);\n                apiRef.current.publishEvent('cellEditStop', params, event);\n              }\n\n              if (!(isEditMode && isCellEditCommitKeys(event.key))) {\n                _context.next = 14;\n                break;\n              }\n\n              commitParams = {\n                id: id,\n                field: field\n              };\n              _context.next = 11;\n              return apiRef.current.commitCellChange(commitParams, event);\n\n            case 11:\n              isValid = _context.sent;\n\n              if (isValid) {\n                _context.next = 14;\n                break;\n              }\n\n              return _context.abrupt(\"return\");\n\n            case 14:\n              if (isEditMode && isCellExitEditModeKeys(event.key)) {\n                apiRef.current.publishEvent('cellEditStop', params, event);\n              }\n\n            case 15:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function (_x, _x2) {\n      return _ref.apply(this, arguments);\n    };\n  }(), [apiRef]);\n  var handleCellDoubleClick = React.useCallback(function (params, event) {\n    if (!params.isEditable) {\n      return;\n    }\n\n    apiRef.current.publishEvent('cellEditStart', params, event);\n  }, [apiRef]);\n\n  var commitPropsAndExit = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(params, event) {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!(params.cellMode === GridCellModes.View)) {\n                _context2.next = 2;\n                break;\n              }\n\n              return _context2.abrupt(\"return\");\n\n            case 2:\n              _context2.next = 4;\n              return apiRef.current.commitCellChange(params, event);\n\n            case 4:\n              apiRef.current.publishEvent('cellEditStop', params, event);\n\n            case 5:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function commitPropsAndExit(_x3, _x4) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var handleCellFocusOut = useEventCallback(function (params, event) {\n    commitPropsAndExit(params, event);\n  });\n  var handleColumnHeaderDragStart = useEventCallback(function () {\n    var cell = gridFocusCellSelector(apiRef);\n\n    if (!cell) {\n      return;\n    }\n\n    var params = apiRef.current.getCellParams(cell.id, cell.field);\n    commitPropsAndExit(params, {});\n  });\n  var handleCellEditStart = React.useCallback(function (params, event) {\n    if (!params.isEditable) {\n      return;\n    }\n\n    apiRef.current.setCellMode(params.id, params.field, GridCellModes.Edit);\n\n    if (isKeyboardEvent(event) && isPrintableKey(event.key)) {\n      apiRef.current.unstable_setEditCellProps({\n        id: params.id,\n        field: params.field,\n        props: {\n          value: ''\n        }\n      });\n    }\n  }, [apiRef]);\n  var handleCellEditStop = React.useCallback(function (params, event) {\n    apiRef.current.setCellMode(params.id, params.field, GridCellModes.View);\n\n    if (!isKeyboardEvent(event)) {\n      return;\n    }\n\n    if (isCellEditCommitKeys(event.key)) {\n      apiRef.current.publishEvent('cellNavigationKeyDown', params, event);\n      return;\n    }\n\n    if (event.key === 'Escape' || isDeleteKeys(event.key)) {\n      apiRef.current.setCellFocus(params.id, params.field);\n    }\n  }, [apiRef]);\n  var handleCellEditCommit = React.useCallback(function (params) {\n    var id = params.id,\n        field = params.field;\n    var model = apiRef.current.getEditRowsModel();\n    var value = model[id][field].value;\n    logger.debug(\"Setting cell id: \".concat(id, \" field: \").concat(field, \" to value: \").concat(value == null ? void 0 : value.toString()));\n    var row = apiRef.current.getRow(id);\n\n    if (row) {\n      var column = apiRef.current.getColumn(params.field);\n\n      var rowUpdate = _extends({}, row, _defineProperty({}, field, value));\n\n      if (column.valueSetter) {\n        rowUpdate = column.valueSetter({\n          row: row,\n          value: value\n        });\n      }\n\n      apiRef.current.updateRows([rowUpdate]);\n    }\n  }, [apiRef, logger]);\n  var handleEditCellPropsChange = React.useCallback(function (params) {\n    var row = apiRef.current.getRow(params.id);\n    var column = apiRef.current.getColumn(params.field);\n    var editCellProps = column.preProcessEditCellProps ? column.preProcessEditCellProps({\n      id: params.id,\n      row: row,\n      props: params.props\n    }) : params.props;\n\n    if (isPromise(editCellProps)) {\n      editCellProps.then(function (newEditCellProps) {\n        apiRef.current.unstable_setEditCellProps(_extends({}, params, {\n          props: newEditCellProps\n        }));\n      });\n    } else {\n      apiRef.current.unstable_setEditCellProps(_extends({}, params, {\n        props: editCellProps\n      }));\n    }\n  }, [apiRef]);\n  useGridApiEventHandler(apiRef, 'cellKeyDown', buildCallback(handleCellKeyDown));\n  useGridApiEventHandler(apiRef, 'cellDoubleClick', buildCallback(handleCellDoubleClick));\n  useGridApiEventHandler(apiRef, 'cellFocusOut', buildCallback(handleCellFocusOut));\n  useGridApiEventHandler(apiRef, 'columnHeaderDragStart', buildCallback(handleColumnHeaderDragStart));\n  useGridApiEventHandler(apiRef, 'cellEditStart', buildCallback(handleCellEditStart));\n  useGridApiEventHandler(apiRef, 'cellEditStop', buildCallback(handleCellEditStop));\n  useGridApiEventHandler(apiRef, 'cellEditCommit', buildCallback(handleCellEditCommit));\n  useGridApiEventHandler(apiRef, 'editCellPropsChange', buildCallback(handleEditCellPropsChange));\n  useGridApiOptionHandler(apiRef, 'cellEditCommit', props.onCellEditCommit);\n  useGridApiOptionHandler(apiRef, 'cellEditStart', props.onCellEditStart);\n  useGridApiOptionHandler(apiRef, 'cellEditStop', props.onCellEditStop);\n};","map":{"version":3,"sources":["E:/React/pos-system/main/node_modules/@mui/x-data-grid/hooks/features/editRows/useGridCellEditing.old.js"],"names":["_extends","React","useEventCallback","useGridApiOptionHandler","useGridApiEventHandler","GridCellModes","GridEditModes","isKeyboardEvent","isPrintableKey","isCellEnterEditModeKeys","isCellExitEditModeKeys","isCellEditCommitKeys","isDeleteKeys","useGridLogger","gridFocusCellSelector","useGridApiMethod","gridEditRowsStateSelector","isPromise","promise","then","useCellEditing","apiRef","props","_props$experimentalFe2","logger","buildCallback","callback","editMode","Cell","setCellMode","useCallback","id","field","mode","current","getCellMode","debug","setState","state","newEditRowsState","editRows","Edit","value","getCellValue","Object","keys","length","forceUpdate","publishEvent","getCellParams","editRowsState","isEditing","View","commitCellChange","params","event","_props$experimentalFe","unstable_runPendingEditCellValueMutation","model","getEditRowsModel","Error","editCellProps","column","getColumn","row","getRow","experimentalFeatures","preventCommitWhileValidating","cellProps","isValidating","error","commitParams","hasError","preProcessEditCellProps","result","newEditCellProps","unstable_setEditCellProps","setCellEditingEditCellValue","Promise","resolve","unstable_parseValue","newEditCellPropsProcessed","cellEditingApi","unstable_setCellEditingEditCellValue","handleCellKeyDown","cellMode","isEditable","isEditMode","isModifierKeyPressed","ctrlKey","metaKey","altKey","key","shiftKey","setEditCellValue","isValid","handleCellDoubleClick","commitPropsAndExit","handleCellFocusOut","handleColumnHeaderDragStart","cell","handleCellEditStart","handleCellEditStop","setCellFocus","handleCellEditCommit","toString","rowUpdate","valueSetter","updateRows","handleEditCellPropsChange","onCellEditCommit","onCellEditStart","onCellEditStop"],"mappings":"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","sourcesContent":["import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport * as React from 'react';\nimport { useEventCallback } from '@mui/material/utils';\nimport { useGridApiOptionHandler, useGridApiEventHandler } from '../../utils/useGridApiEventHandler';\nimport { GridCellModes, GridEditModes } from '../../../models/gridEditRowModel';\nimport { isKeyboardEvent, isPrintableKey, isCellEnterEditModeKeys, isCellExitEditModeKeys, isCellEditCommitKeys, isDeleteKeys } from '../../../utils/keyboardUtils';\nimport { useGridLogger } from '../../utils/useGridLogger';\nimport { gridFocusCellSelector } from '../focus/gridFocusStateSelector';\nimport { useGridApiMethod } from '../../utils/useGridApiMethod';\nimport { gridEditRowsStateSelector } from './gridEditRowsSelector';\n\nfunction isPromise(promise) {\n  return typeof promise.then === 'function';\n}\n\nexport const useCellEditing = (apiRef, props) => {\n  var _props$experimentalFe2;\n\n  const logger = useGridLogger(apiRef, 'useGridEditRows');\n\n  const buildCallback = callback => (...args) => {\n    if (props.editMode === GridEditModes.Cell) {\n      callback(...args);\n    }\n  };\n\n  const setCellMode = React.useCallback((id, field, mode) => {\n    if (apiRef.current.getCellMode(id, field) === mode) {\n      return;\n    }\n\n    logger.debug(`Switching cell id: ${id} field: ${field} to mode: ${mode}`);\n    apiRef.current.setState(state => {\n      const newEditRowsState = _extends({}, state.editRows);\n\n      newEditRowsState[id] = _extends({}, newEditRowsState[id]);\n\n      if (mode === GridCellModes.Edit) {\n        newEditRowsState[id][field] = {\n          value: apiRef.current.getCellValue(id, field)\n        };\n      } else {\n        delete newEditRowsState[id][field];\n\n        if (!Object.keys(newEditRowsState[id]).length) {\n          delete newEditRowsState[id];\n        }\n      }\n\n      return _extends({}, state, {\n        editRows: newEditRowsState\n      });\n    });\n    apiRef.current.forceUpdate();\n    apiRef.current.publishEvent('cellModeChange', apiRef.current.getCellParams(id, field));\n  }, [apiRef, logger]);\n  const getCellMode = React.useCallback((id, field) => {\n    const editRowsState = gridEditRowsStateSelector(apiRef.current.state);\n    const isEditing = editRowsState[id] && editRowsState[id][field];\n    return isEditing ? GridCellModes.Edit : GridCellModes.View;\n  }, [apiRef]); // TODO v6: it should always return a promise\n\n  const commitCellChange = React.useCallback((params, event = {}) => {\n    var _props$experimentalFe;\n\n    const {\n      id,\n      field\n    } = params;\n    apiRef.current.unstable_runPendingEditCellValueMutation(id, field);\n    const model = apiRef.current.getEditRowsModel();\n\n    if (!model[id] || !model[id][field]) {\n      throw new Error(`MUI: Cell at id: ${id} and field: ${field} is not in edit mode.`);\n    }\n\n    const editCellProps = model[id][field];\n    const column = apiRef.current.getColumn(field);\n    const row = apiRef.current.getRow(id);\n\n    if ((_props$experimentalFe = props.experimentalFeatures) != null && _props$experimentalFe.preventCommitWhileValidating) {\n      const cellProps = model[id][field];\n\n      if (cellProps.isValidating || cellProps.error) {\n        return false;\n      }\n    }\n\n    const commitParams = _extends({}, params, {\n      value: editCellProps.value\n    });\n\n    let hasError = !!editCellProps.error;\n\n    if (!hasError && typeof column.preProcessEditCellProps === 'function') {\n      const result = column.preProcessEditCellProps({\n        id,\n        row,\n        props: editCellProps\n      });\n\n      if (isPromise(result)) {\n        return result.then(newEditCellProps => {\n          apiRef.current.unstable_setEditCellProps({\n            id,\n            field,\n            props: newEditCellProps\n          });\n\n          if (newEditCellProps.error) {\n            return false;\n          }\n\n          apiRef.current.publishEvent('cellEditCommit', commitParams, event);\n          return true;\n        });\n      }\n\n      apiRef.current.unstable_setEditCellProps({\n        id,\n        field,\n        props: result\n      });\n      hasError = !!result.error;\n    }\n\n    if (!hasError) {\n      apiRef.current.publishEvent('cellEditCommit', commitParams, event);\n      return true;\n    }\n\n    return false;\n  }, [apiRef, (_props$experimentalFe2 = props.experimentalFeatures) == null ? void 0 : _props$experimentalFe2.preventCommitWhileValidating]);\n  const setCellEditingEditCellValue = React.useCallback(params => {\n    const column = apiRef.current.getColumn(params.field);\n    const row = apiRef.current.getRow(params.id);\n    return new Promise(resolve => {\n      let newEditCellProps = {\n        value: params.value\n      };\n      const model = apiRef.current.getEditRowsModel();\n      const editCellProps = model[params.id][params.field];\n\n      if (typeof column.preProcessEditCellProps !== 'function') {\n        apiRef.current.unstable_setEditCellProps(_extends({}, params, {\n          props: newEditCellProps\n        }));\n        resolve(true);\n        return;\n      } // setEditCellProps runs the value parser and returns the updated props\n\n\n      newEditCellProps = apiRef.current.unstable_setEditCellProps(_extends({}, params, {\n        props: _extends({}, editCellProps, {\n          isValidating: true\n        })\n      }));\n      Promise.resolve(column.preProcessEditCellProps({\n        id: params.id,\n        row,\n        props: _extends({}, newEditCellProps, {\n          value: apiRef.current.unstable_parseValue(params.id, params.field, params.value)\n        })\n      })).then(newEditCellPropsProcessed => {\n        apiRef.current.unstable_setEditCellProps(_extends({}, params, {\n          props: _extends({}, newEditCellPropsProcessed, {\n            isValidating: false\n          })\n        }));\n        resolve(!newEditCellPropsProcessed.error);\n      });\n    });\n  }, [apiRef]);\n  const cellEditingApi = {\n    setCellMode,\n    getCellMode,\n    commitCellChange,\n    unstable_setCellEditingEditCellValue: setCellEditingEditCellValue\n  };\n  useGridApiMethod(apiRef, cellEditingApi, 'EditRowApi');\n  const handleCellKeyDown = React.useCallback(async (params, event) => {\n    const {\n      id,\n      field,\n      cellMode,\n      isEditable\n    } = params;\n\n    if (!isEditable) {\n      return;\n    }\n\n    const isEditMode = cellMode === GridCellModes.Edit;\n    const isModifierKeyPressed = event.ctrlKey || event.metaKey || event.altKey;\n\n    if (!isEditMode && isCellEnterEditModeKeys(event.key) && !isModifierKeyPressed && !(event.key === ' ' && event.shiftKey)) {\n      apiRef.current.publishEvent('cellEditStart', params, event);\n    }\n\n    if (!isEditMode && isDeleteKeys(event.key)) {\n      apiRef.current.setEditCellValue({\n        id,\n        field,\n        value: ''\n      });\n      apiRef.current.commitCellChange({\n        id,\n        field\n      }, event);\n      apiRef.current.publishEvent('cellEditStop', params, event);\n    }\n\n    if (isEditMode && isCellEditCommitKeys(event.key)) {\n      const commitParams = {\n        id,\n        field\n      };\n      const isValid = await apiRef.current.commitCellChange(commitParams, event);\n\n      if (!isValid) {\n        return;\n      }\n    }\n\n    if (isEditMode && isCellExitEditModeKeys(event.key)) {\n      apiRef.current.publishEvent('cellEditStop', params, event);\n    }\n  }, [apiRef]);\n  const handleCellDoubleClick = React.useCallback((params, event) => {\n    if (!params.isEditable) {\n      return;\n    }\n\n    apiRef.current.publishEvent('cellEditStart', params, event);\n  }, [apiRef]);\n\n  const commitPropsAndExit = async (params, event) => {\n    if (params.cellMode === GridCellModes.View) {\n      return;\n    }\n\n    await apiRef.current.commitCellChange(params, event);\n    apiRef.current.publishEvent('cellEditStop', params, event);\n  };\n\n  const handleCellFocusOut = useEventCallback((params, event) => {\n    commitPropsAndExit(params, event);\n  });\n  const handleColumnHeaderDragStart = useEventCallback(() => {\n    const cell = gridFocusCellSelector(apiRef);\n\n    if (!cell) {\n      return;\n    }\n\n    const params = apiRef.current.getCellParams(cell.id, cell.field);\n    commitPropsAndExit(params, {});\n  });\n  const handleCellEditStart = React.useCallback((params, event) => {\n    if (!params.isEditable) {\n      return;\n    }\n\n    apiRef.current.setCellMode(params.id, params.field, GridCellModes.Edit);\n\n    if (isKeyboardEvent(event) && isPrintableKey(event.key)) {\n      apiRef.current.unstable_setEditCellProps({\n        id: params.id,\n        field: params.field,\n        props: {\n          value: ''\n        }\n      });\n    }\n  }, [apiRef]);\n  const handleCellEditStop = React.useCallback((params, event) => {\n    apiRef.current.setCellMode(params.id, params.field, GridCellModes.View);\n\n    if (!isKeyboardEvent(event)) {\n      return;\n    }\n\n    if (isCellEditCommitKeys(event.key)) {\n      apiRef.current.publishEvent('cellNavigationKeyDown', params, event);\n      return;\n    }\n\n    if (event.key === 'Escape' || isDeleteKeys(event.key)) {\n      apiRef.current.setCellFocus(params.id, params.field);\n    }\n  }, [apiRef]);\n  const handleCellEditCommit = React.useCallback(params => {\n    const {\n      id,\n      field\n    } = params;\n    const model = apiRef.current.getEditRowsModel();\n    const {\n      value\n    } = model[id][field];\n    logger.debug(`Setting cell id: ${id} field: ${field} to value: ${value == null ? void 0 : value.toString()}`);\n    const row = apiRef.current.getRow(id);\n\n    if (row) {\n      const column = apiRef.current.getColumn(params.field);\n\n      let rowUpdate = _extends({}, row, {\n        [field]: value\n      });\n\n      if (column.valueSetter) {\n        rowUpdate = column.valueSetter({\n          row,\n          value\n        });\n      }\n\n      apiRef.current.updateRows([rowUpdate]);\n    }\n  }, [apiRef, logger]);\n  const handleEditCellPropsChange = React.useCallback(params => {\n    const row = apiRef.current.getRow(params.id);\n    const column = apiRef.current.getColumn(params.field);\n    const editCellProps = column.preProcessEditCellProps ? column.preProcessEditCellProps({\n      id: params.id,\n      row,\n      props: params.props\n    }) : params.props;\n\n    if (isPromise(editCellProps)) {\n      editCellProps.then(newEditCellProps => {\n        apiRef.current.unstable_setEditCellProps(_extends({}, params, {\n          props: newEditCellProps\n        }));\n      });\n    } else {\n      apiRef.current.unstable_setEditCellProps(_extends({}, params, {\n        props: editCellProps\n      }));\n    }\n  }, [apiRef]);\n  useGridApiEventHandler(apiRef, 'cellKeyDown', buildCallback(handleCellKeyDown));\n  useGridApiEventHandler(apiRef, 'cellDoubleClick', buildCallback(handleCellDoubleClick));\n  useGridApiEventHandler(apiRef, 'cellFocusOut', buildCallback(handleCellFocusOut));\n  useGridApiEventHandler(apiRef, 'columnHeaderDragStart', buildCallback(handleColumnHeaderDragStart));\n  useGridApiEventHandler(apiRef, 'cellEditStart', buildCallback(handleCellEditStart));\n  useGridApiEventHandler(apiRef, 'cellEditStop', buildCallback(handleCellEditStop));\n  useGridApiEventHandler(apiRef, 'cellEditCommit', buildCallback(handleCellEditCommit));\n  useGridApiEventHandler(apiRef, 'editCellPropsChange', buildCallback(handleEditCellPropsChange));\n  useGridApiOptionHandler(apiRef, 'cellEditCommit', props.onCellEditCommit);\n  useGridApiOptionHandler(apiRef, 'cellEditStart', props.onCellEditStart);\n  useGridApiOptionHandler(apiRef, 'cellEditStop', props.onCellEditStop);\n};"]},"metadata":{},"sourceType":"module"}